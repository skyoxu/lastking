  # 0) 必读输入（按顺序）
  1. `docs/prd/PRD-LASTKING-v1.1-SKELETON.md`
  2. `docs/adr/ADR-0031-path-blocking-nearest-blocker-fallback.md`（Accepted）
  3. `docs/adr/ADR-0032-independent-wave-budget-channels.md`（Accepted）
  4. `docs/adr/ADR-0033-reward-pool-exhaustion-gold-fallback.md`（Accepted）

  # 1) 输出目标
  生成并覆盖：`docs/prd/PRD-LASTKING-v1.2-GAMEDESIGN.md`

  风格：工程化、可执行、可验证，禁止空泛叙述。

  - 核心玩法：高压塔防 + 经营 + 建设 + 募兵，守住地图中部城堡
  - 昼夜循环：白天 4 分钟，夜晚 2 分钟
  - 目标：存活到第 15 天胜利；城堡耐久归零失败（唯一失败条件）
  - 地图：固定高度，1024x768 约 3 屏横向滚动；边缘滚屏 + 键盘滚屏；1 张随机模板
  - 通道：2 条主通道；障碍物/野外建筑随机（80% 中间 1 屏，20% 左右两屏）
  - 敌军预算：`normal` day1=50，按 120% 日复利；`elite` 与 `boss` 独立通道，不参与 normal 换算权重
  - 首领夜：Boss 固定 2 只，不随难度提升
  - 路径规则：允许完全堵路；路径失败时敌军优先攻击最近阻挡建筑
  - 城门：单向出入口（我方可出，敌方不可入）
  - 友伤：我方任何攻击无友伤
  - 控制：自动作战为主，可设集结点，不可微操，技能自动释放
  - 初始资源：金币/木材/人口上限 = 800/150/50
  - 经济：居民住所每 15 秒 +50 金币，+10 人口
  - 兵种：
    - 枪兵：1 人口，100 金币，10 秒训练，50 HP
    - 坦克：3 人口，500 金币，20 秒训练，200 HP
  - 防御：
    - 机枪塔：200 金币，500 HP，占地 1
    - 城墙：20 金币，500 HP，占地 1，可拉线建造
    - 地雷：50 金币，一次性
  - 建筑占地：城堡 4，兵营 2，机枪塔 1，城墙 1
  - 升级：统一 5 级；首次升级成本（城堡/兵营/机枪塔/住所）= 1000/600/400/500；时间=2m/1m/0.5m/1m
  - 科技：仅影响兵种数值；机制解锁主要靠 3 选 1 奖励
  - 科技维度：攻速(%)、伤害(数值)、生产速度(%)、射程(数值)、HP(数值)、建造成本(%)
    - 百分比项必须定义上限；数值项可无上限
  - 奖励：每晚结算触发 1 次 3 选 1；normal/elite/boss 奖励池分离
    - 奖励池元素：宝物 / 高级兵种 / +3 科技点 / +600 金币
    - 非金币奖励：本局永久生效、不可叠加、不可重复
    - 池耗尽：金币兜底（允许重复金币）
    - 高级兵种池首版固定 2 种（新兵种，不是基础兵升级）
  - Boss 机制（首版仅 2 个）：
    - 每 20 秒无敌 5 秒
    - 每 20 秒召唤 2 分身；分身 50% 本体攻击与 HP；永久持续；上限 10；可被减速
  - 存档与云：仅 1 个自动存档；不可被手动存档覆盖；不轮转覆盖
  - 成就：20 个，无隐藏
  - 性能目标：平均 60 FPS；1% low = 45 FPS
  - 记录字段：随机种子 + 波次计时 + 建筑队列

  # 3) 必须产出的章节（严格按此顺序）
  1. 产品定位与目标用户（中核可上手，难度可上探硬核）
  2. 核心循环（分钟级 Day/Night 流程图 + 状态机）
  3. 波次与敌军系统（normal/elite/boss 通道模型）
  4. 数值平衡首版表（Day1~Day15）
  5. 经济与建设系统
  6. 军事系统（基础兵 + 2 高级兵）
  7. 科技系统（仅数值项）
  8. 奖励系统状态机（catalog_available/exhausted/gold_fallback）
  9. Boss 与分身生命周期
  10. UI/交互/镜头规范
  11. 存档/云存档/成就
  12. 测试与验收映射（Test-Refs）
  13. 风险与回退策略
  14. Conflict Log（冲突与待确认项）

  # 4) 必须包含的表格（缺一不可）
  - 表A：Day1~Day15 夜战预算与敌军组成表
    列至少包含：Day, NightType, normalBudget, eliteBudget, bossBudget, spawnPlan摘要, 预计压力等级
  - 表B：建筑与兵种参数表
    列至少包含：对象、成本、训练/建造时间、HP、占地、人口消耗、升级收益
  - 表C：科技与奖励池表
    列至少包含：条目、类型、效果、上限、是否可重复、状态机约束、获取来源

  # 5) 强制计算与规则
  - 给出 `normalBudget(day)` 明确公式（day1=50，120% 复利）。
  - 明确精英夜与首领夜触发日（至少覆盖 day5/day10 精英，day15 首领）。
  - 奖励状态机必须给出：状态、迁移条件、非法迁移、兜底逻辑。
  - 必须说明“路径完全堵死”场景下敌军行为链路，不得出现“卡住等待”。
  - 必须给出最低配置建议（CPU/GPU/RAM/分辨率）并与 60/45 FPS 目标对齐。

  # 6) 输出约束
  - 不得引入联机、手游、多平台、PVP、实时多人。
  - 不得与 3 个 Accepted ADR 冲突。
  - 如遇冲突或信息不足：写入 `Conflict Log`，每项给 A/B 方案与推荐，不得私自改硬约束。
  - 最后追加 `Machine-Readable Appendix (JSON)`，至少包含：
    - `locked_constraints`
    - `day_balance_table`
    - `unit_building_table`
    - `reward_state_machine`
    - `test_refs_draft`

  # 7) 自检清单（输出末尾必须逐条打勾）
  - [ ] 所有硬约束均被保留
  - [ ] 三张核心表完整
  - [ ] 奖励状态机完整且可实现
  - [ ] 波次预算公式可计算
  - [ ] Test-Refs 可落到文件路径
  - [ ] 无联机/移动端/多平台漂移
  - [ ] 与 ADR-0031/0032/0033 无冲突