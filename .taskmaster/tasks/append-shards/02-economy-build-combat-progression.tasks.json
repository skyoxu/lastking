{
  "tasks": [
    {
      "id": 11,
      "title": "Implement integer resource ledger with negative-gold support",
      "description": "Create authoritative resource accounting for gold/iron/pop-cap using integer arithmetic only.",
      "status": "pending",
      "dependencies": [
        1
      ],
      "priority": "high",
      "details": "Implement ledger operations for spend/income/refund with audit records. Allow negative gold state where rules permit and block invalid iron/pop underflow.",
      "testStrategy": "Unit tests validate integer-only operations, debt edge cases, and overflow guards.",
      "subtasks": []
    },
    {
      "id": 12,
      "title": "Implement build footprint and placement rule engine",
      "description": "Enforce occupancy and footprint rules for castle/barracks/tower/wall and non-buildable tiles.",
      "status": "pending",
      "dependencies": [
        11
      ],
      "priority": "high",
      "details": "Build placement validator with hidden-grid occupancy checks and blocked-tile constraints. Reject placements crossing forbidden cells and path-restricted geometry rules.",
      "testStrategy": "Unit tests and map fixtures verify valid placement, rejection reasons, and deterministic outcomes.",
      "subtasks": []
    },
    {
      "id": 13,
      "title": "Implement wall drag-line and one-way gate behavior",
      "description": "Support drag-line wall placement and enforce one-way gate logic (friendly out, enemy in denied).",
      "status": "pending",
      "dependencies": [
        12
      ],
      "priority": "high",
      "details": "Add segmented wall construction planner with cost accumulation and placement previews. Implement gate pass policy by faction and direction.",
      "testStrategy": "Integration tests validate drag segmentation, accumulated cost, and gate traversal restrictions.",
      "subtasks": []
    },
    {
      "id": 14,
      "title": "Implement building construction pipeline",
      "description": "Create construction actions that start when resources are available and run concurrently for buildings.",
      "status": "pending",
      "dependencies": [
        11,
        12
      ],
      "priority": "medium",
      "details": "Implement build action lifecycle (queued/active/completed/cancelled) with immediate cost reservation. Do not apply barracks queue limitations to building construction.",
      "testStrategy": "Unit tests validate build state transitions, resource reservation timing, and concurrency semantics.",
      "subtasks": []
    },
    {
      "id": 15,
      "title": "Implement upgrade system (max 5, no skipping)",
      "description": "Implement upgrade rules including level cap, no skip-level upgrades, and completion full-heal.",
      "status": "pending",
      "dependencies": [
        14
      ],
      "priority": "high",
      "details": "Implement upgrade scheduler with level validation and mutual exclusion hooks for repair. On upgrade completion, restore building HP to full per locked rule.",
      "testStrategy": "Unit tests cover cap enforcement, no-skip checks, and full-heal post-upgrade behavior.",
      "subtasks": []
    },
    {
      "id": 16,
      "title": "Implement repair pipeline and debt-stop behavior",
      "description": "Implement progressive repair cost/time and stop repair automatically on invalid debt conditions.",
      "status": "pending",
      "dependencies": [
        11,
        15
      ],
      "priority": "high",
      "details": "Implement repair at 50% build-speed equivalent and 50% build-cost for full repair (gold-only basis). Block simultaneous repair+upgrade and stop repair if debt rule triggers.",
      "testStrategy": "Unit tests validate incremental deduction, stop/resume conditions, and mutual exclusion with upgrades.",
      "subtasks": []
    },
    {
      "id": 17,
      "title": "Implement barracks training queues and cancellation rules",
      "description": "Support one training queue per barracks and cancellation with 100% refund.",
      "status": "pending",
      "dependencies": [
        11
      ],
      "priority": "medium",
      "details": "Implement queue state machine by barracks instance with immediate training cost lock and cancellation rollback. Keep queue limits independent from castle level.",
      "testStrategy": "Unit tests validate one-queue constraint, cancellation refund correctness, and multi-barracks behavior.",
      "subtasks": []
    },
    {
      "id": 18,
      "title": "Implement combat profiles for base and advanced units",
      "description": "Model core ranged unit stats/roles and enforce no-friendly-fire behavior in damage resolution.",
      "status": "pending",
      "dependencies": [
        17
      ],
      "priority": "high",
      "details": "Implement unit profile registry (rifleman, tank, advanced classes) and attack resolver policies. Ensure targeting and AOE logic never harms allied entities.",
      "testStrategy": "Combat simulation tests verify DPS role expectations and friendly-fire suppression invariants.",
      "subtasks": []
    },
    {
      "id": 19,
      "title": "Implement tech stat progression engine",
      "description": "Implement tech effects on unit stats only, with percent caps and numeric uncapped fields.",
      "status": "pending",
      "dependencies": [
        18
      ],
      "priority": "medium",
      "details": "Create tech modifier pipeline with capped percentage domains (attack speed, production speed, cost) and additive numeric domains (damage/range/hp).",
      "testStrategy": "Unit tests validate cap enforcement, stacking order, and deterministic modifier application.",
      "subtasks": []
    },
    {
      "id": 20,
      "title": "Implement nightly 3-choice reward state machine",
      "description": "Implement reward pools by night type with non-repeat non-stack policy and gold fallback on exhaustion.",
      "status": "pending",
      "dependencies": [
        5,
        19
      ],
      "priority": "high",
      "details": "Build reward selector for normal/elite/boss pools with one trigger per night. Persist taken rewards within run to enforce uniqueness and fallback-to-gold behavior.",
      "testStrategy": "Unit tests verify pool isolation, uniqueness constraints, and exhaustion fallback correctness.",
      "subtasks": []
    }
  ],
  "metadata": {
    "version": "1.0.0",
    "generatedAt": "2026-02-11T19:05:50",
    "sourceShard": "02-economy-build-combat-progression",
    "taskCount": 10
  }
}