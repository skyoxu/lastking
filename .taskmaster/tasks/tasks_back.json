[
  {
    "id": "NG-0001",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [],
    "taskmaster_exported": false,
    "title": "Establish baseline Godot 4.5.1 C# Windows project",
    "description": "Create the canonical baseline Godot 4.5.1 C# Windows project used by all later setup tasks.",
    "status": "pending",
    "priority": "P1",
    "layer": "ci",
    "adr_refs": [
      "ADR-0011",
      "ADR-0001"
    ],
    "chapter_refs": [
      "CH07",
      "CH10",
      "CH01"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "ci"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Tests.Godot/tests/Integration/test_project_bootstrap_editor_compile_run.gd",
      "Tests.Godot/tests/Integration/test_windows_export_startup_flow.gd",
      "Tests.Godot/tests/Scenes/Smoke/test_main_scene_smoke.gd",
      "Tests.Godot/tests/Integration/test_project_bootstrap_restart_stability.gd",
      "Tests.Godot/tests/Integration/test_project_bootstrap_windows_sdk_resolution.gd",
      "Tests.Godot/tests/Integration/test_project_creation_csharp_mode.gd",
      "Tests.Godot/tests/Integration/test_project_structure_referenced_assets.gd",
      "Tests.Godot/tests/Integration/test_windows_export_preset_artifact.gd",
      "Tests.Godot/tests/Scenes/Smoke/test_glue_connections.gd",
      "Game.Core.Tests/Tasks/Task1BaselineVerificationGateTests.cs",
      "Game.Core.Tests/Tasks/Task1ProjectRootUniquenessTests.cs",
      "Tests.Godot/tests/Integration/test_dotnet_solution_generation_build.gd",
      "Tests.Godot/tests/Integration/test_windows_verification_evidence_records.gd",
      "Tests.Godot/tests/Scenes/Smoke/test_main_scene_bindings_persist.gd"
    ],
    "acceptance": [
      "Acceptance requires one canonical Godot 4.5.1 .NET Windows project root that completes all MasterDetails steps: project creation, C# verification, core layout, and runnable Windows export baseline. Refs: Tests.Godot/tests/Integration/test_project_bootstrap_editor_compile_run.gd Tests.Godot/tests/Integration/test_windows_export_startup_flow.gd",
      "Baseline verification passes only when the Godot editor opens that canonical project, C# compilation succeeds, and the configured startup scene executes with its attached C# script. Refs: Tests.Godot/tests/Scenes/Smoke/test_main_scene_smoke.gd",
      "From a clean editor restart, running the same canonical project twice must reach the same startup entry flow without setup-caused regression. Refs: Tests.Godot/tests/Integration/test_project_bootstrap_restart_stability.gd",
      "On Windows, Godot 4.5.1 .NET editor and a compatible .NET SDK must be installed and detected with no missing-SDK warnings. Refs: Tests.Godot/tests/Integration/test_project_bootstrap_windows_sdk_resolution.gd",
      "The canonical project must be created as a C# project, and at least one node-attached C# script must compile in the editor. Refs: Tests.Godot/tests/Integration/test_project_creation_csharp_mode.gd Tests.Godot/tests/Integration/test_project_bootstrap_editor_compile_run.gd",
      "Executing the startup scene in the editor must complete scene load and script execution with no binding, assembly-load, or runtime C# errors. Refs: Tests.Godot/tests/Scenes/Smoke/test_main_scene_smoke.gd",
      "The canonical project must include core directories for scenes, scripts, and assets, and each directory must contain at least one file referenced by the project. Refs: Tests.Godot/tests/Integration/test_project_structure_referenced_assets.gd",
      "A Windows Desktop export preset must exist in the canonical project, and export must produce a Windows artifact. Refs: Tests.Godot/tests/Integration/test_windows_export_preset_artifact.gd",
      "Launching the exported Windows artifact must reach the baseline startup flow as a standalone run. Refs: Tests.Godot/tests/Integration/test_windows_export_startup_flow.gd",
      "Scene creation, node wiring, and script attachment for the startup path must be observable in saved SceneTree and Inspector bindings. Refs: Tests.Godot/tests/Scenes/Smoke/test_glue_connections.gd",
      "Acceptance must fail if any required check fails: editor open, C# compile, startup scene run, exported artifact run, or single-root constraint. Refs: Game.Core.Tests/Tasks/Task1BaselineVerificationGateTests.cs Game.Core.Tests/Tasks/Task1ProjectRootUniquenessTests.cs",
      "A newly initialized canonical Godot 4.5.1 .NET C# project must generate .sln and .csproj files that build successfully with the installed SDK. Refs: Tests.Godot/tests/Integration/test_dotnet_solution_generation_build.gd",
      "The startup scene must be configured as Main Scene, saved, and after editor restart must reload with node-to-script bindings unchanged. Refs: Tests.Godot/tests/Scenes/Smoke/test_main_scene_smoke.gd",
      "Acceptance evidence must include successful Windows verification records for editor open, C# compile, startup scene execution, and export launch from the same root. Refs: Tests.Godot/tests/Integration/test_windows_verification_evidence_records.gd",
      "Creating and opening the canonical Godot 4.5.1 .NET C# project on Windows must show no missing SDK, missing assembly, or failed restore errors. Refs: Tests.Godot/tests/Integration/test_project_bootstrap_windows_sdk_resolution.gd",
      "Both editor play of Main Scene and launch of the exported Windows build must reach startup flow without runtime C# script errors. Refs: Tests.Godot/tests/Scenes/Smoke/test_main_scene_smoke.gd",
      "At least one saved startup scene must include an attached C# bootstrap script, and the attachment must persist after project reopen. Refs: Tests.Godot/tests/Scenes/Smoke/test_main_scene_bindings_persist.gd",
      "The canonical project must be created with C# selected at creation time and open directly without manual post-creation language conversion. Refs: Tests.Godot/tests/Integration/test_project_creation_csharp_mode.gd",
      "All C# and .NET dependencies required for editor run and Windows export must resolve on Windows; unresolved SDK, assembly, or restore errors fail acceptance. Refs: Tests.Godot/tests/Integration/test_project_bootstrap_windows_sdk_resolution.gd Tests.Godot/tests/Integration/test_dotnet_solution_generation_build.gd",
      "Windows export validation must execute the produced build and confirm it reaches the baseline startup flow. Refs: Tests.Godot/tests/Integration/test_windows_export_startup_flow.gd Tests.Godot/tests/Integration/test_windows_export_preset_artifact.gd",
      "Standalone desktop launch compatibility must be explicit: the exported Windows build starts and reaches expected startup flow without blocking initialization errors. Refs: Tests.Godot/tests/Integration/test_windows_export_startup_flow.gd",
      "Acceptance must be rejected if verification bypasses required steps, including C# build, script-attachment validation, startup scene execution, export execution, or root-uniqueness check. Refs: Game.Core.Tests/Tasks/Task1BaselineVerificationGateTests.cs Game.Core.Tests/Tasks/Task1ProjectRootUniquenessTests.cs",
      "Acceptance must fail if this task or any downstream setup task creates a second independent Godot project root instead of reusing the canonical root. Refs: Game.Core.Tests/Tasks/Task1ProjectRootUniquenessTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #1 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 1,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0002",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0001"
    ],
    "taskmaster_exported": false,
    "title": "Implement config-first balancing system",
    "description": "Create a configuration system to manage game balance values (e.g., wave budgets, day durations) without hardcoding.",
    "status": "pending",
    "priority": "P1",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs",
      "Tests.Godot/tests/Integration/test_balance_runtime_config_reload.gd",
      "Tests.Godot/tests/Integration/test_balance_simulation_determinism.gd",
      "Game.Core.Tests/Services/ConfigManagerAccessSurfaceTests.cs",
      "Tests.Godot/tests/Adapters/Config/test_balance_config_single_source.gd",
      "Game.Core.Tests/Services/ConfigManagerParsingTests.cs",
      "Tests.Godot/tests/Integration/test_balance_runtime_day_night_from_config.gd",
      "Game.Core.Tests/Services/WaveBudgetFromConfigTests.cs",
      "Tests.Godot/tests/Integration/test_balance_runtime_wave_budget_from_config.gd",
      "Game.Core.Tests/Services/SpawnScheduleFromConfigTests.cs",
      "Tests.Godot/tests/Integration/test_balance_runtime_spawn_and_boss_from_config.gd",
      "Game.Core.Tests/Services/WaveChannelSelectionTests.cs",
      "Tests.Godot/tests/Integration/test_balance_runtime_channel_selection_from_config.gd",
      "Tests.Godot/tests/Adapters/Config/test_settings_persistence.gd",
      "Game.Core.Tests/Services/ConfigDrivenRuntimeLoopTests.cs",
      "Game.Core.Tests/Services/ConfigReloadBehaviorTests.cs",
      "Game.Core.Tests/Domain/GameConfigContractTests.cs",
      "Game.Core.Tests/Domain/GameConfigValidationTests.cs",
      "Tests.Godot/tests/Security/Hard/test_balance_config_validation_audit.gd",
      "Tests.Godot/tests/Adapters/Config/test_settings_config_utf8.gd",
      "Tests.Godot/tests/Security/Hard/test_settings_config_security.gd"
    ],
    "acceptance": [
      "Hard gate: malformed JSON/INI input must deterministically fail with a fixed reason code, and parse failure must not advance runtime config snapshot (must keep last-known-good or documented fallback).",
      "Hard gate: ConfigManager load order must be deterministic and explicitly verified across initial load, reload, and fallback paths; any order drift fails acceptance.",
      "Hard gate: acceptance requires both anti-hardcode source-scan gate and config-driven runtime behavior regression gate; missing either gate fails acceptance.",
      "只有当运行时可观察到日夜循环、波次预算与刷怪行为由配置值驱动且不依赖代码常量时，本任务才可判定通过。 Refs: Tests.Godot/tests/Integration/test_balance_runtime_config_reload.gd",
      "本任务关联的自动化测试在 Windows Godot + C# 基线环境必须全部通过，任一失败即不通过。 Refs: Tests.Godot/tests/Integration/test_balance_runtime_config_reload.gd",
      "在配置输入不变的条件下，重复执行确定性模拟必须产生一致的核心循环输出，出现任意差异即判失败。 Refs: Tests.Godot/tests/Integration/test_balance_simulation_determinism.gd",
      "系统必须仅采用一个 JSON 或 INI 平衡配置源，且 loop/wave/spawn 只能通过唯一全局 ConfigManager 访问面读取平衡值。 Refs: Game.Core.Tests/Services/ConfigManagerAccessSurfaceTests.cs Tests.Godot/tests/Adapters/Config/test_balance_config_single_source.gd",
      "日夜时长必须由配置解析得到，且运行时实测值必须为 Day=240 秒、Night=120 秒。 Refs: Game.Core.Tests/Services/ConfigManagerParsingTests.cs Tests.Godot/tests/Integration/test_balance_runtime_day_night_from_config.gd",
      "普通波次预算必须由配置解析得到，且运行时值必须为 day1=50、daily growth=120%（1.2）。 Refs: Game.Core.Tests/Services/WaveBudgetFromConfigTests.cs Tests.Godot/tests/Integration/test_balance_runtime_wave_budget_from_config.gd",
      "刷怪节奏与 Boss 数量必须由配置解析得到，且运行时值必须为 spawn cadence=10 秒、boss count=2。 Refs: Game.Core.Tests/Services/SpawnScheduleFromConfigTests.cs Tests.Godot/tests/Integration/test_balance_runtime_spawn_and_boss_from_config.gd",
      "配置必须包含 elite 与 boss channel 字段，且运行时波次/刷怪选路必须实际消费这两个字段。 Refs: Game.Core.Tests/Services/WaveChannelSelectionTests.cs Tests.Godot/tests/Integration/test_balance_runtime_channel_selection_from_config.gd",
      "修改配置并触发重载后，游戏内可观察到的平衡行为必须随新值变化；配置未变化时重载后行为必须保持不变。 Refs: Tests.Godot/tests/Adapters/Config/test_settings_persistence.gd",
      "必须提供可核验证据证明列出的平衡参数在 gameplay 路径均来自 ConfigManager 读取，而非硬编码常量。 Refs: Game.Core.Tests/Services/ConfigDrivenRuntimeLoopTests.cs Game.Core.Tests/Services/ConfigManagerAccessSurfaceTests.cs",
      "在不改动代码的前提下，仅替换平衡配置并重载，必须导致日夜周期、波次预算增长、刷怪节奏和 Boss 数量的运行结果发生变化。 Refs: Game.Core.Tests/Services/ConfigReloadBehaviorTests.cs Tests.Godot/tests/Integration/test_balance_runtime_config_reload.gd",
      "必须定义规范化配置契约（必填 sections/keys、稳定键名、必填键到运行时消费方映射），并可核验日夜时长、普通波次 day1 预算、普通波次日增长、elite channel、boss channel、spawn cadence、boss count 的加载值。 Refs: Game.Core.Tests/Domain/GameConfigContractTests.cs Game.Core.Tests/Services/ConfigManagerParsingTests.cs",
      "初次加载后必须提供全局可访问的强类型平衡快照/API，暴露日时长、夜时长、普通波次 day1 预算、普通波次日增长、elite channel、boss channel、spawn cadence、boss count；缺失可选字段时必须采用确定性默认值。 Refs: Game.Core.Tests/Domain/GameConfigTests.cs",
      "对缺失键、类型错误、越界值，系统必须执行既定 reject/fallback 规则，输出可执行 reason code 审计轨迹，并使运行时保持在文档化 fallback 状态。 Refs: Game.Core.Tests/Domain/GameConfigValidationTests.cs Tests.Godot/tests/Security/Hard/test_balance_config_validation_audit.gd",
      "Obligation lock O9：必须通过测试或审计证据证明“加载配置文件并正确解析值”已满足；无法证明即不通过。 Refs: Tests.Godot/tests/Adapters/Config/test_settings_config_utf8.gd",
      "Obligation lock O11：必须通过测试或审计证据证明“使用 Godot's Resource system or custom file I/O”已满足；无法证明即不通过。 Refs: Tests.Godot/tests/Adapters/Config/test_settings_config_utf8.gd Tests.Godot/tests/Security/Hard/test_settings_config_security.gd"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #2 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 2,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0003",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0002"
    ],
    "taskmaster_exported": false,
    "title": "Develop runtime state machine for Day/Night cycles",
    "description": "Implement a state machine to manage Day and Night cycles with deterministic progression up to Day15.",
    "status": "pending",
    "priority": "P1",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Game.Core.Tests/Tasks/Task3DayNightScopeGuardTests.cs",
      "Game.Core.Tests/State/GameStateManagerTests.cs",
      "Game.Core.Tests/Tasks/Task3DayNightDesignArtifactTests.cs"
    ],
    "acceptance": [
      "Hard gate: deterministic cycle verification must include a fixed-seed forced-terminal scenario, not only natural Day15 completion paths.",
      "Hard gate: forced-terminal verification must assert exactly one terminal emission, zero post-terminal progression, and checkpoint replay parity against baseline.",
      "Taskmaster #3 的实现范围仅限 Day/Night 运行时状态机从 Day1 推进到 Day15；若出现与该循环无关的运行时功能行为变更则判定失败。 Refs: Game.Core.Tests/Tasks/Task3DayNightScopeGuardTests.cs",
      "在 Windows Godot+C# 基线下，本任务相关自动化测试必须全部通过，并覆盖正常推进、计时边界、固定种子重放一致性与 Day15 终局场景。 Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "在 Day/Night 循环条件未变化且输入序列相同的前提下，本功能之外的确定性模拟输出与核心循环可观察行为必须保持不变。 Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "终局触发前，状态机仅暴露 Day 与 Night 两个非终局状态，并且只允许 Day<->Night 合法迁移；任何其他迁移请求必须被拒绝且状态不变。 Refs: Game.Core.Tests/State/GameStateMachineTests.cs",
      "采用配置时长时，Day 阶段在该阶段累计时间达到 4:00 才能迁移，Night 阶段在达到 2:00 才能迁移；未达阈值不得迁移。 Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "day 计数从 1 初始化并按顺序逐日递增，不允许跳号或回退，且不得超出 1-15 的闭区间。 Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "使用相同固定种子且输入/更新序列一致时，多次运行必须产生完全一致的阶段顺序、随机结果与阶段边界检查点序列。 Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "仅在 Day15 完成时发出且仅发出一次终局胜利结果；Day15 完成前不得发出任何终局或胜利结果。 Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "计时与迁移仅通过 Godot process-loop 更新驱动，在 fixed-step 与 variable-step 下都必须保持单调推进且与帧率无关。 Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "从运行时 Day1 启动开始，总耗时到 4:00 时首次发生 Day->Night，总耗时到 6:00 时发生 Night->Day2。 Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "若 process-loop 更新未执行，则累计时间、当前阶段状态与当前 day 值均必须保持不变。 Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "Day15 完成并发出终局胜利后，后续更新不得将 day 推进到 15 以上，且不得再次发出终局或胜利结果。 Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "任一阶段在未达到配置阈值前，阶段状态与 day 必须保持不变；仅在活动更新中达到阈值时才允许发生迁移。 Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "运行时 C# GameStateManager 实例必须可观测地提供当前阶段状态（Day/Night）、当前 day（1-15）以及供下游消费的迁移/终局信号。 Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "必须交付并关联已评审的运行时状态机设计工件，明确 Day/Night 状态图、迁移条件与下游事件消费者；缺失工件即判定不通过。 Refs: Game.Core.Tests/Tasks/Task3DayNightDesignArtifactTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #3 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 3,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0004",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0002",
      "NG-0003"
    ],
    "taskmaster_exported": false,
    "title": "Implement wave budget and channel system",
    "description": "Set up wave generation with normal, elite, and boss channels based on configurable budgets.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Services/CollisionServiceTests.cs",
      "Game.Core.Tests/Services/WaveManagerBudgetChannelTests.cs",
      "Game.Core.Tests/Services/WaveManagerDeterminismTests.cs",
      "Game.Core.Tests/Engine/GameEngineCoreDeterminismTests.cs"
    ],
    "acceptance": [
      "Taskmaster #4 behavior matches PRD lock for Implement wave budget and channel system. Refs: Game.Core.Tests/Services/WaveManagerBudgetChannelTests.cs Game.Core.Tests/Services/WaveManagerDeterminismTests.cs",
      "Referenced automated tests pass on Windows Godot+C# baseline. Refs: Game.Core.Tests/Services/WaveManagerBudgetChannelTests.cs Game.Core.Tests/Services/WaveManagerDeterminismTests.cs",
      "No regression on deterministic simulation and core loop constraints. Refs: Game.Core.Tests/Engine/GameEngineCoreDeterminismTests.cs Game.Core.Tests/Services/WaveManagerDeterminismTests.cs",
      "A WaveManager C# component is available to generate wave outputs from day index, channel budget config, and seed input. Refs: Game.Core.Tests/Services/WaveManagerBudgetChannelTests.cs",
      "Given default config (normal day1 budget = 50), the generated normal-channel budget for day 1 equals 50. Refs: Game.Core.Tests/Services/WaveManagerBudgetChannelTests.cs",
      "For days beyond day 1, normal-channel budget follows the configured daily growth rule (default 120%) and matches expected values across multiple days. Refs: Game.Core.Tests/Services/WaveManagerBudgetChannelTests.cs",
      "Changing elite-channel budget alone does not change normal-channel budget or normal-channel spawn output for the same day and seed. Refs: Game.Core.Tests/Services/WaveManagerBudgetChannelTests.cs Game.Core.Tests/Services/WaveManagerDeterminismTests.cs",
      "Changing boss-channel budget alone does not change normal-channel budget or normal-channel spawn output for the same day and seed. Refs: Game.Core.Tests/Services/WaveManagerBudgetChannelTests.cs Game.Core.Tests/Services/WaveManagerDeterminismTests.cs",
      "Enemy allocation per channel is constrained by that channel budget and does not exceed the configured budget. Refs: Game.Core.Tests/Services/WaveManagerBudgetChannelTests.cs",
      "Using the same fixed seed, day, and config yields identical wave outputs across repeated runs; changing only the seed changes at least one spawn decision. Refs: Game.Core.Tests/Services/WaveManagerDeterminismTests.cs",
      "Independent config tuning for normal, elite, and boss budgets changes only the targeted channel output while non-targeted channel outputs remain unchanged for the same day and seed. Refs: Game.Core.Tests/Services/WaveManagerBudgetChannelTests.cs Game.Core.Tests/Services/WaveManagerDeterminismTests.cs",
      "Each generated wave records auditable per-channel budget evidence (input/allocated/spent/remaining) for normal, elite, and boss channels. Refs: Game.Core.Tests/Services/WaveManagerBudgetChannelTests.cs",
      "Invalid accounting transitions (negative spend, over-budget spend, or cross-channel charge) are rejected without committing channel totals and remain reproducible under same-seed replay traces. Refs: Game.Core.Tests/Services/WaveManagerBudgetChannelTests.cs Game.Core.Tests/Services/WaveManagerDeterminismTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #4 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 4,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0005",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0003",
      "NG-0004"
    ],
    "taskmaster_exported": false,
    "title": "Create enemy spawning system with cadence",
    "description": "Develop a spawning system that continuously spawns enemies during the first 80% of Night with a 10s cadence.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Services/CollisionServiceTests.cs",
      "Game.Core.Tests/Services/WaveManagerNightCadenceWindowTests.cs",
      "Game.Core.Tests/Services/WaveManagerSpawnPolicyTests.cs",
      "Game.Core.Tests/Services/WaveManagerNightStateGateTests.cs"
    ],
    "acceptance": [
      "Taskmaster #5 PRD lock is satisfied: cadence spawning is active only during the first 80% of Night and emits no new cadence-driven spawns in the final 20%. Refs: Game.Core.Tests/Services/WaveManagerNightCadenceWindowTests.cs",
      "Referenced automated tests for this task pass on the Windows Godot+C# baseline and verify Night-window gating, 10-second cadence, boss-count behavior, and spawn-point constraints. Refs: Game.Core.Tests/Services/WaveManagerNightCadenceWindowTests.cs Game.Core.Tests/Services/WaveManagerSpawnPolicyTests.cs",
      "Night spawning behavior is driven by elapsed Night time and timers, producing periodic spawn events rather than per-frame spawning. Refs: Game.Core.Tests/Services/WaveManagerNightCadenceWindowTests.cs",
      "With Night duration configured to 120 seconds, new regular enemy spawn events are emitted only while Night elapsed time is less than 96 seconds. Refs: Game.Core.Tests/Services/WaveManagerNightCadenceWindowTests.cs",
      "During the spawn-enabled Night window (0-96 seconds), consecutive regular enemy spawn events follow a 10-second cadence. Refs: Game.Core.Tests/Services/WaveManagerNightCadenceWindowTests.cs",
      "During the final Night window (96-120 seconds), no new regular cadence spawn events are emitted. Refs: Game.Core.Tests/Services/WaveManagerNightCadenceWindowTests.cs",
      "On boss nights, the system emits exactly 2 boss spawns as defined by configuration. Refs: Game.Core.Tests/Services/WaveManagerSpawnPolicyTests.cs",
      "All emitted spawns use predefined in-world spawn points, and no spawn is emitted outside that configured spawn-point set. Refs: Game.Core.Tests/Services/WaveManagerSpawnPolicyTests.cs",
      "Night cadence spawning is active only in Night state; outside Night state, no cadence-driven enemy spawn events are emitted. Refs: Game.Core.Tests/Services/WaveManagerNightStateGateTests.cs",
      "For a non-boss Night with at least one configured spawn point, at least one regular enemy spawn event is emitted before Night elapsed reaches 96 seconds. Refs: Game.Core.Tests/Services/WaveManagerNightCadenceWindowTests.cs",
      "If Night duration is configured to D seconds, the spawn-enabled window is [0, 0.8D) and the no-new-regular-spawn window is [0.8D, D]. Refs: Game.Core.Tests/Services/WaveManagerNightCadenceWindowTests.cs",
      "Night duration is configuration-driven rather than hardcoded: when Night duration is set to 150 seconds, regular spawns are allowed only before 120 seconds and no new regular cadence spawns are emitted from 120 to 150 seconds. Refs: Game.Core.Tests/Services/WaveManagerNightCadenceWindowTests.cs",
      "For a non-boss Night with Night duration set to 120 seconds and at least one configured spawn point, regular spawn event count in [0,96) is at least 9 and at most 10, and regular spawn event count in [96,120] is 0. Refs: Game.Core.Tests/Services/WaveManagerNightCadenceWindowTests.cs",
      "Obligation lock O1: In WaveManager, implement spawning logic during Night state is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Game.Core.Tests/Services/WaveManagerNightStateGateTests.cs Game.Core.Tests/Services/WaveManagerNightCadenceWindowTests.cs",
      "Obligation lock O6: In the final 20% of Night [0.8D, D], the system must emit no new enemy spawn events of any type (regular, elite, or boss). Refs: Game.Core.Tests/Services/WaveManagerSpawnPolicyTests.cs",
      "Night spawn composition input is contract-validated before runtime use: required cadence fields and deterministic sequencing keys must be present, otherwise Night spawning for that run is rejected.",
      "Given the same configuration, spawn-point set, composition payload, and deterministic seed, repeated runs produce the same spawn emission order and timing schedule for Night.",
      "Spawner orchestration enforces per-channel emission boundaries: regular cadence emissions are confined to the configured spawn window, and boss-channel emissions never exceed the configured fixed count for boss nights.",
      "When spawn composition is malformed, the system fails closed (no undefined spawn emissions) and emits structured diagnostics that identify failure reason and offending contract field.",
      "Regression coverage includes both nominal and malformed-composition paths and verifies deterministic trace stability for same-seed runs."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #5 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 5,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0006",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0001"
    ],
    "taskmaster_exported": false,
    "title": "Implement enemy AI with target priority and pathing",
    "description": "Develop enemy AI that follows target priority rules and handles blocked paths with fallback attacks.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Services/CollisionServiceTests.cs",
      "Game.Core.Tests/Services/EnemyAiTargetSelectionTests.cs",
      "Tests.Godot/tests/Scenes/Combat/test_enemy_ai_blocked_route_fallback.gd",
      "Tests.Godot/tests/Integration/test_combat_friendly_fire_disabled.gd",
      "Game.Core.Tests/Services/EnemyAiDecisionDeterminismTests.cs",
      "Game.Core.Tests/Engine/DeterministicSimulationLoopTests.cs",
      "Tests.Godot/tests/Scenes/Combat/test_enemy_ai_navigation_priority.gd",
      "Tests.Godot/tests/Scenes/Combat/test_enemy_ai_attachment_validation.gd"
    ],
    "acceptance": [
      "Taskmaster #6 behavior implements enemy AI target-priority and blocked-path fallback semantics for Implement enemy AI with target priority and pathing. Refs: Game.Core.Tests/Services/EnemyAiTargetSelectionTests.cs Tests.Godot/tests/Scenes/Combat/test_enemy_ai_blocked_route_fallback.gd",
      "Referenced automated tests for priority selection, blocked-path fallback, fixed-seed determinism, and friendly-fire disablement pass on Windows Godot+C# baseline. Refs: Tests.Godot/tests/Integration/test_combat_friendly_fire_disabled.gd",
      "No regression is introduced to deterministic simulation behavior or core loop constraints. Refs: Game.Core.Tests/Services/EnemyAiDecisionDeterminismTests.cs Game.Core.Tests/Engine/DeterministicSimulationLoopTests.cs",
      "In mixed-target scenarios with at least one valid path, each enemy selects a target by strict reachable priority: unit > castle > armed defense > wall/gate. Refs: Game.Core.Tests/Services/EnemyAiTargetSelectionTests.cs Tests.Godot/tests/Scenes/Combat/test_enemy_ai_navigation_priority.gd",
      "With identical initial state and fixed random seed, tie-breaks between equal-priority candidates produce the same target choice across repeated runs. Refs: Game.Core.Tests/Services/EnemyAiDecisionDeterminismTests.cs",
      "If preferred targets are blocked, the enemy attacks the nearest blocking structure on the blocked route and does not remain idle or switch to unrelated non-blocking targets. Refs: Game.Core.Tests/Services/EnemyAiTargetSelectionTests.cs Tests.Godot/tests/Scenes/Combat/test_enemy_ai_blocked_route_fallback.gd",
      "Pathing behavior follows Godot navigation constraints: enemies traverse only navigable routes, and blocked-path scenarios prevent passage through obstacles. Refs: Tests.Godot/tests/Scenes/Combat/test_enemy_ai_navigation_priority.gd",
      "Enemy nodes used in combat scenes have EnemyAI attached and active; missing attachment is detected as a failed configuration in validation/tests. Refs: Tests.Godot/tests/Scenes/Combat/test_enemy_ai_attachment_validation.gd",
      "Player-origin attacks cannot damage friendly/player units, and friendly-fire hit events are absent in collision-layer/mask validation runs. Refs: Tests.Godot/tests/Integration/test_combat_friendly_fire_disabled.gd",
      "Whenever at least one higher-priority target has a valid navigation path, the enemy does not select any lower-priority target in that decision cycle. Refs: Game.Core.Tests/Services/EnemyAiTargetSelectionTests.cs Tests.Godot/tests/Scenes/Combat/test_enemy_ai_navigation_priority.gd",
      "In blocked-path tests, fallback target selection is validated as the nearest blocking structure on the blocked route by distance, and attack events are directed to that blocker. Refs: Game.Core.Tests/Services/EnemyAiTargetSelectionTests.cs Tests.Godot/tests/Scenes/Combat/test_enemy_ai_blocked_route_fallback.gd",
      "In player-attack combat runs, friendly/player damage event count remains zero from start to end, confirming friendly fire stays disabled. Refs: Tests.Godot/tests/Integration/test_combat_friendly_fire_disabled.gd",
      "Target selection first filters by navigation reachability, then applies priority order (unit > castle > armed defense > wall/gate); unreachable higher-priority targets are not selected. Refs: Game.Core.Tests/Services/EnemyAiTargetSelectionTests.cs Tests.Godot/tests/Scenes/Combat/test_enemy_ai_navigation_priority.gd",
      "With fixed seed and identical initial state, the full decision trace for equal-priority ties and blocked-path fallback target choice is identical across repeated runs. Refs: Game.Core.Tests/Services/EnemyAiDecisionDeterminismTests.cs",
      "Obligation lock O1: Combat enemy nodes must have an active EnemyAI C# script attached at runtime; missing attachment is a configuration failure. Refs: Tests.Godot/tests/Scenes/Combat/test_enemy_ai_attachment_validation.gd",
      "Obligation lock O9: Automated tests must verify fixed-seed deterministic behavior across repeated runs for this task. Refs: Game.Core.Tests/Services/EnemyAiDecisionDeterminismTests.cs",
      "For same-priority reachable candidates, target choice is based on deterministic path-cost comparison, and equal-cost ties are resolved only by the fixed seed so repeated runs keep identical results.",
      "When the current target becomes unreachable or invalid at runtime, the enemy switches to the next valid target under reachability-plus-priority rules and does not traverse non-navigable space to keep the old target.",
      "Blocked-map regression runs produce pathing diagnostics for each fallback decision, and each enemy reaches a fallback attack within the test timeout instead of remaining in a no-move/no-attack deadlock."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #6 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 6,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0007",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0001",
      "NG-0006"
    ],
    "taskmaster_exported": false,
    "title": "Set up castle HP and loss condition",
    "description": "Implement castle health system and loss condition when HP reaches 0.",
    "status": "pending",
    "priority": "P2",
    "layer": "ci",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "ci"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Tests.Godot/tests/Integration/test_battle_castle_loss_flow.gd",
      "Game.Core.Tests/Services/CastleCombatResolutionTests.cs",
      "Game.Core.Tests/State/BattleLossStateMachineTests.cs",
      "Game.Core.Tests/Services/BattleInitializationFromConfigTests.cs",
      "Tests.Godot/tests/Adapters/Config/test_castle_start_hp_config.gd",
      "Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "Game.Core.Tests/Services/EnemyTargetSelectionTests.cs",
      "Tests.Godot/tests/Scenes/Battle/test_castle_current_hp_contract.gd"
    ],
    "acceptance": [
      "Task #7 delivers all required outcomes in one playable flow: castle HP state exists, enemy attacks reduce castle HP, HP=0 triggers loss/game-over, UI shows updated HP, and enemy AI can target the castle. Refs: Tests.Godot/tests/Integration/test_battle_castle_loss_flow.gd",
      "Automated tests on the Windows Godot+C# baseline pass for castle HP reduction under enemy attacks, loss trigger at HP=0, and transition of game state to loss. Refs: Game.Core.Tests/Services/CastleCombatResolutionTests.cs Game.Core.Tests/State/BattleLossStateMachineTests.cs",
      "When castle HP is above 0, battle combat resolution continues normally and the game does not enter unintended loss/game-over. Refs: Game.Core.Tests/State/BattleLossStateMachineTests.cs",
      "At battle start, castle HP is initialized from the configured starting HP value, and that starting value is above 0. Refs: Game.Core.Tests/Services/BattleInitializationFromConfigTests.cs Tests.Godot/tests/Adapters/Config/test_castle_start_hp_config.gd",
      "When an enemy attack is resolved against the castle, castle HP decreases by that attack's resolved damage amount. Refs: Game.Core.Tests/Services/CastleCombatResolutionTests.cs",
      "If no enemy attack is applied to the castle during an observed interval, castle HP remains unchanged during that interval. Refs: Game.Core.Tests/Services/CastleCombatResolutionTests.cs",
      "When enemy damage causes castle HP to reach 0, the game immediately transitions to the loss/game-over state. Refs: Game.Core.Tests/State/BattleLossStateMachineTests.cs Game.Core.Tests/Services/CastleCombatResolutionTests.cs",
      "After the game enters loss/game-over at castle HP=0, normal battle gameplay flow does not continue. Refs: Game.Core.Tests/State/BattleLossStateMachineTests.cs Tests.Godot/tests/Integration/test_battle_castle_loss_flow.gd",
      "Gameplay UI displays the current castle HP and refreshes the displayed HP value after each castle HP change. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "Enemy AI can choose the castle as a valid target, and attacks from that targeting path reduce castle HP. Refs: Game.Core.Tests/Services/EnemyTargetSelectionTests.cs Tests.Godot/tests/Integration/test_battle_castle_loss_flow.gd",
      "Loss/game-over is triggered at the HP=0 threshold; while castle HP stays above 0, loss/game-over is not triggered. Refs: Game.Core.Tests/State/BattleLossStateMachineTests.cs",
      "Across multiple resolved enemy attacks in one battle, castle HP updates cumulatively, and the UI HP display matches the latest castle HP after each update. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "Castle state exposes a readable current HP value from castle script/state for both combat resolution and UI HP update flows. Refs: Tests.Godot/tests/Scenes/Battle/test_castle_current_hp_contract.gd",
      "Changing the configured starting HP value changes castle HP at battle start without requiring code changes. Refs: Tests.Godot/tests/Adapters/Config/test_castle_start_hp_config.gd",
      "Obligation lock O1: A concrete Castle C# script (Castle.cs or equivalent) must exist and expose a readable CurrentHp property for gameplay, combat resolution, and UI binding. Refs: Tests.Godot/tests/Scenes/Battle/test_castle_current_hp_contract.gd",
      "Castle HP mutation boundaries are enforced: CurrentHp changes only at battle initialization from configured starting HP and when resolved enemy attacks apply damage; without either trigger, CurrentHp must remain unchanged.",
      "Terminal transition is deterministic and single-dispatch: when CurrentHp first reaches 0, exactly one loss/game-over transition is emitted, and further damage processing while already terminal must not emit an additional loss transition.",
      "Terminal-state evidence and replay checks are required: entering loss/game-over at HP=0 must emit terminal-transition evidence artifacts, and repeated runs with the same seed must produce the same loss-transition timing; missing evidence must fail validation."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #7 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 7,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0008",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0003",
      "NG-0007"
    ],
    "taskmaster_exported": false,
    "title": "Develop win condition and game progression",
    "description": "Implement win condition (survive Day15) and integrate with day progression.",
    "status": "pending",
    "priority": "P3",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Game.Core.Tests/State/GameStateManagerTests.cs"
    ],
    "acceptance": [
      "Taskmaster #8 is complete only when run progression applies these rules: reaching Day15 with castle HP > 0 results in win, and loss may end the run earlier. Refs: Game.Core.Tests/State/GameStateManagerTests.cs Game.Core.Tests/State/GameStateMachineTests.cs",
      "Referenced automated tests for Day15 win trigger, pre-Day15 loss precedence when castle HP = 0, and terminal-state handling pass on the Windows Godot+C# baseline. Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "With identical inputs and timing, day/night progression yields deterministic win/loss outcomes without core-loop regression. Refs: Game.Core.Tests/State/GameStateManagerTests.cs Game.Core.Tests/State/GameStateMachineTests.cs",
      "When current day first reaches Day15 and castle HP is greater than 0, the game enters a win terminal state and displays a win screen or win message. Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "If castle HP becomes 0 before Day15, the game enters a loss terminal state and emits no win state for that run. Refs: Game.Core.Tests/State/GameStateManagerTests.cs Game.Core.Tests/State/GameStateMachineTests.cs",
      "Before any terminal state is reached, day/night progression continues normally, and each progression step evaluates Day15 and castle HP end-state conditions. Refs: Game.Core.Tests/State/GameStateManagerTests.cs Game.Core.Tests/State/GameStateMachineTests.cs",
      "After win or loss is triggered, configured end-of-game handling (pause or reset) is applied, and normal progression does not continue without explicit restart/reset. Refs: Game.Core.Tests/State/GameStateManagerTests.cs Game.Core.Tests/State/GameStateMachineTests.cs",
      "When current day is below Day15 and castle HP is above 0, the run remains in a non-terminal, non-win progression state. Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "At the first progression step where current day becomes Day15 and castle HP is greater than 0, win state is entered immediately in that same step. Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "If castle HP is 0 at or before the Day15 evaluation step, the run remains in loss state and cannot transition to win unless an explicit restart/reset starts a new run. Refs: Game.Core.Tests/State/GameStateManagerTests.cs Game.Core.Tests/State/GameStateMachineTests.cs",
      "After entering win or loss, additional day/night ticks do not create extra terminal-state transitions or duplicate win/loss UI emissions in the same run. Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "A playthrough that reaches Day15 while castle HP remains above 0 triggers win in that run and does not emit loss before restart/reset. Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "A playthrough where castle HP becomes 0 before reaching Day15 triggers loss and does not emit win in that run. Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "Before terminal state is reached, each progression update re-evaluates end-state conditions using that run's current day and current castle HP. Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "Once a terminal state is reached, the run stays terminal and normal progression does not resume until an explicit restart/reset starts a new run. Refs: Game.Core.Tests/State/GameStateManagerTests.cs Game.Core.Tests/State/GameStateMachineTests.cs",
      "Obligation lock O1: In GameStateManager, check if current day reaches 15 and castle HP > 0 to trigger win is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Game.Core.Tests/State/GameStateManagerTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #8 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 8,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0009",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0001",
      "NG-0003",
      "NG-0007"
    ],
    "taskmaster_exported": false,
    "title": "Create basic UI for day/night and HP display",
    "description": "Implement a minimal user interface to show current day, time in cycle, and castle HP.",
    "status": "pending",
    "priority": "P3",
    "layer": "adapter",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "adapter"
    ],
    "test_refs": [
      "Tests.Godot/tests/UI/test_hud_scene.gd",
      "Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Game.Core.Tests/State/GameStateManagerTests.cs",
      "Tests.Godot/tests/Integration/test_hud_integration.gd"
    ],
    "acceptance": [
      "Delivery for Taskmaster #9 remains limited to a minimal HUD for day, cycle time remaining, and castle HP in the main play view. Refs: Tests.Godot/tests/UI/test_hud_scene.gd",
      "Referenced automated tests for this task pass on the Windows Godot + C# baseline. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "Adding the HUD does not change deterministic simulation outcomes or break core-loop progression rules. Refs: Game.Core.Tests/State/GameStateMachineTests.cs Game.Core.Tests/State/GameStateManagerTests.cs",
      "At runtime, the main play view renders three separate HUD values: current day, remaining time in the current Day/Night cycle, and castle HP. Refs: Tests.Godot/tests/UI/test_hud_scene.gd",
      "As simulation progresses, the day HUD value tracks the game day counter and stays within 1-15. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "While a Day/Night cycle is running, the displayed remaining cycle time updates over time and is not static. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "When a Day/Night phase transition occurs, the cycle-time HUD switches to the new phase/timing state without retaining stale previous-phase values. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd Tests.Godot/tests/Integration/test_hud_integration.gd",
      "When gameplay changes castle HP, the HUD HP value updates in the same play session. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "If day, cycle remaining time, and HP source values stay unchanged, their HUD values also stay unchanged. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "On scene start, all three HUD fields are populated with concrete runtime values before any progression-driven update occurs. Refs: Tests.Godot/tests/UI/test_hud_scene.gd",
      "In a session that includes at least one Day/Night transition and one HP change, all three HUD fields remain visible and continue updating without freeze or disappearance. Refs: Tests.Godot/tests/Integration/test_hud_integration.gd Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "During normal core-loop gameplay, the three HUD values remain continuously readable on the main play view without opening debug or menu screens. Refs: Tests.Godot/tests/UI/test_hud_scene.gd",
      "The main play scene implements these outputs as standard text UI controls (Label or equivalent Control-derived text elements), one distinct field per value. Refs: Tests.Godot/tests/UI/test_hud_scene.gd",
      "During active play, each HUD field refreshes automatically from state changes without requiring scene reload, menu toggle, or manual refresh. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "In a run with day progression, at least one Day/Night transition, and at least one HP change, all three HUD values visibly track their source values in real time on the main play view. Refs: Tests.Godot/tests/Integration/test_hud_integration.gd Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "The delivered HUD stays minimal for this scope by exposing only day, cycle time remaining, and castle HP as directly visible core-loop status outputs. Refs: Tests.Godot/tests/UI/test_hud_scene.gd",
      "Obligation lock O6: Update UI in real-time via C# scripts is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "A single HUD data contract defines mandatory fields for day, cycle time remaining, and castle HP, and defines explicit fallback placeholder states for invalid or unavailable source values; contract tests fail if any required field is missing.",
      "HUD binding is event-driven from core loop transitions: day/night transition events and HP change events must update their mapped HUD outputs in the same play session without scene reload or manual refresh.",
      "Regression coverage includes day/night transition continuity, HP change continuity, and invalid-data fallback handling, and emits UI state diagnostics at transition points and fallback activation points."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #9 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 9,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0010",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0001",
      "NG-0002",
      "NG-0003",
      "NG-0004",
      "NG-0005",
      "NG-0006",
      "NG-0007",
      "NG-0008",
      "NG-0009"
    ],
    "taskmaster_exported": false,
    "title": "Integrate and test full core loop",
    "description": "Combine all systems and test the complete core gameplay loop from start to win/loss.",
    "status": "pending",
    "priority": "P1",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Game.Core.Tests/Engine/GameEngineCoreEventTests.cs",
      "Tests.Godot/tests/Integration/test_day1_day15_seeded_replay_terminal_outcome.gd",
      "Tests.Godot/tests/Integration/test_playable_core_loop_flow_deterministic_order.gd",
      "Tests.Godot/tests/Scenes/Main/test_main_day_night_wave_terminal_dispatch.gd",
      "Game.Core.Tests/Tasks/Task10DeterministicCheckpointSequenceTests.cs",
      "Tests.Godot/tests/Integration/test_day1_day15_checkpoint_sequence_stable.gd",
      "Game.Core.Tests/Services/CollisionServiceTests.cs",
      "Game.Core.Tests/Tasks/Task10BossChannelIsolationTests.cs",
      "Tests.Godot/tests/Integration/test_spawn_channels_boss_lock_isolation.gd",
      "Tests.Godot/tests/Integration/test_integration_slices_emit_evidence_artifacts.gd",
      "Tests.Godot/tests/Integration/test_staged_slices_order_and_verdict.gd",
      "Game.Core.Tests/Tasks/Task10DeterministicReplayTerminalStateTests.cs",
      "Tests.Godot/tests/Integration/test_day1_day15_replay_records_required_anchors.gd",
      "Game.Core.Tests/Services/EventBusTests.cs",
      "Tests.Godot/tests/Integration/test_regression_smoke_logs_core_anchors.gd",
      "Game.Core.Tests/Tasks/Task10StagedGatePrerequisiteTests.cs",
      "Tests.Godot/tests/Integration/test_replay_requires_staged_complete_flag.gd"
    ],
    "acceptance": [
      "Taskmaster #10 is accepted only if a single integration gate verifies runtime-loop wiring, spawn-channel execution, path-block fallback, and win/loss completion in one end-to-end run. Refs: Game.Core.Tests/Engine/GameEngineCoreEventTests.cs",
      "All automated tests referenced by this task (staged integration and full seeded replay) must pass on the Windows Godot+C# baseline; any failing case blocks acceptance. Refs: Tests.Godot/tests/Integration/test_day1_day15_seeded_replay_terminal_outcome.gd",
      "Regression runs against the locked baseline must show zero deterministic-simulation drift and zero core-loop rule regression; any drift or rule break fails acceptance. Refs: Game.Core.Tests/Engine/GameEngineCoreEventTests.cs Game.Core.Tests/State/GameStateMachineTests.cs",
      "One playable scene flow must wire Game.Core runtime-loop services through adapters with an explicit deterministic update order, and smoke evidence must show day-night transition, wave start, and terminal win/loss dispatch. Refs: Tests.Godot/tests/Integration/test_playable_core_loop_flow_deterministic_order.gd Tests.Godot/tests/Scenes/Main/test_main_day_night_wave_terminal_dispatch.gd",
      "Deterministic checkpoints must be emitted at each major transition, and two Day1-Day15 runs with the same seed must produce the same ordered checkpoint sequence; any sequence mismatch fails acceptance. Refs: Game.Core.Tests/Tasks/Task10DeterministicCheckpointSequenceTests.cs Tests.Godot/tests/Integration/test_day1_day15_checkpoint_sequence_stable.gd",
      "Using fully blocked seeded map fixtures, path-block fallback targeting must engage without deadlock and must return to normal targeting after a valid path appears; deadlock or missing recovery fails acceptance. Refs: Game.Core.Tests/Services/CollisionServiceTests.cs",
      "Normal, elite, and boss-night scenarios must enforce fixed boss-count lock and per-channel accounting isolation; any cross-channel budget leakage fails acceptance. Refs: Game.Core.Tests/Tasks/Task10BossChannelIsolationTests.cs Tests.Godot/tests/Integration/test_spawn_channels_boss_lock_isolation.gd",
      "Each integration slice must run independently and publish consolidated evidence artifacts to logs/e2e and logs/ci with required core-anchor fields for CI inspection and manual debugging handoff. Refs: Tests.Godot/tests/Integration/test_integration_slices_emit_evidence_artifacts.gd",
      "Staged integration must execute slices in the required order (runtime loop wiring, seeded checkpoints, blocked-map fallback, boss/channel checks, evidence packaging), and each slice must emit an explicit pass/fail result when run independently. Refs: Tests.Godot/tests/Integration/test_staged_slices_order_and_verdict.gd",
      "A full seeded end-to-end replay from Day1 through Day15 must reach exactly one terminal state (win or loss) and record deterministic timeline, channel isolation, blocker fallback engagement, and boss-count lock anchors in logs/e2e and logs/ci; missing terminal state or missing anchors fails acceptance. Refs: Game.Core.Tests/Tasks/Task10DeterministicReplayTerminalStateTests.cs Tests.Godot/tests/Integration/test_day1_day15_replay_records_required_anchors.gd",
      "Spawn-channel behavior must be exercised in staged slices and in the Day1-Day15 replay with observable channel-specific activity and isolated accounting boundaries; no channel activity evidence or cross-channel attribution fails acceptance. Refs: Game.Core.Tests/Services/EventBusTests.cs",
      "Regression smoke logs must exist for every staged slice and for the final Day1-Day15 replay under logs/e2e and logs/ci, and each log must include required core-anchor fields plus an explicit pass/fail verdict; missing logs or required fields fails acceptance. Refs: Tests.Godot/tests/Integration/test_regression_smoke_logs_core_anchors.gd",
      "Staged integration is accepted only if all five required slices execute to completion in the mandated order with no skipped or inconclusive slice; otherwise acceptance fails. Refs: Tests.Godot/tests/Integration/test_staged_slices_order_and_verdict.gd",
      "The Day1-Day15 seeded replay is accepted only if it starts at Day1, reaches Day15, and emits exactly one terminal outcome (win or loss); early abort, non-terminal completion, or multiple terminal outcomes fails acceptance. Refs: Game.Core.Tests/State/GameStateMachineTests.cs",
      "Spawn-channel verification requires observable per-channel events and per-channel budget/accounting records in both staged slices and the full Day1-Day15 replay; missing per-channel evidence fails acceptance. Refs: Game.Core.Tests/Services/EventBusTests.cs",
      "Staged integration must complete all five slices with pass verdicts before Day1-Day15 full seeded replay starts; replay start without staged_complete=true (or with any incomplete slice) fails acceptance. Refs: Game.Core.Tests/Tasks/Task10StagedGatePrerequisiteTests.cs Tests.Godot/tests/Integration/test_replay_requires_staged_complete_flag.gd",
      "Blocked-map validation must include reproducible seeded tie cases (equal-priority candidates) and record tie-break sequence; same-seed reruns with any tie-break sequence mismatch fail acceptance. Refs: Game.Core.Tests/Services/CollisionServiceTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #10 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 10,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0011",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0001"
    ],
    "taskmaster_exported": false,
    "title": "Refine baseline bootstrap with main-scene and structure standards",
    "description": "Refine the existing T1 project with stricter main-scene, startup bootstrap script, and folder standards.",
    "status": "pending",
    "priority": "P1",
    "layer": "ci",
    "adr_refs": [
      "ADR-0011",
      "ADR-0001"
    ],
    "chapter_refs": [
      "CH07",
      "CH10",
      "CH01"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "ci"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Game.Core.Tests/Tasks/Task11ProjectReuseGuardsTests.cs",
      "Tests.Godot/tests/Scenes/Smoke/test_main_scene_smoke.gd",
      "Game.Core.Tests/Tasks/Task11WindowsCSharpBaselineGateTests.cs",
      "Tests.Godot/tests/Scenes/Smoke/test_glue_connections.gd",
      "Game.Core.Tests/Tasks/Task11ProjectStructureStandardsTests.cs",
      "Tests.Godot/tests/Scenes/Smoke/test_main_scene_bootstrap_path.gd",
      "Game.Core.Tests/Domain/GameConfigTests.cs",
      "Tests.Godot/tests/Integration/test_editor_reopen_rebuild_stability.gd",
      "Tests.Godot/tests/Integration/test_singleplayer_startup_flow.gd",
      "Game.Core.Tests/Services/StartupBootstrapServiceTests.cs"
    ],
    "acceptance": [
      "T11 必须在既有 T1 项目根目录上执行加固与验证，不得新建或替换为另一个 Godot 项目。 Refs: Game.Core.Tests/Tasks/Task11ProjectReuseGuardsTests.cs",
      "既有 T1 项目的 Main Scene 与启动绑定已被检查并收敛到统一标准，运行时使用该绑定。 Refs: Tests.Godot/tests/Scenes/Smoke/test_main_scene_smoke.gd",
      "交付结果保持为 Windows Godot 4.5.1 + C# 工作流的同一基线项目，不接受退化为非 C# 基线。 Refs: Game.Core.Tests/Tasks/Task11WindowsCSharpBaselineGateTests.cs",
      "针对 Windows Godot+C# 基线且与本任务相关的自动化检查在复用的 T1 根目录上全部通过。 Refs: Game.Core.Tests/Tasks/Task11ProjectReuseGuardsTests.cs Game.Core.Tests/Tasks/Task11WindowsCSharpBaselineGateTests.cs",
      "加固后项目可稳定完成基础启动循环，且未引入新的启动不稳定问题。 Refs: Tests.Godot/tests/Scenes/Smoke/test_main_scene_smoke.gd Tests.Godot/tests/Scenes/Smoke/test_glue_connections.gd",
      "在 Windows 上，项目可由 Godot 4.5.1 打开，.NET/C# 支持处于可用状态，且编辑器启动无错误。 Refs: Tests.Godot/tests/Scenes/Smoke/test_main_scene_smoke.gd",
      "在 Godot 编辑器内构建 C# 脚本可完成，且 C# 编译错误为 0。 Refs: Game.Core.Tests/Tasks/Task11WindowsCSharpBaselineGateTests.cs",
      "Main Scene 被配置为启动场景，运行项目时进入该场景且无运行时异常。 Refs: Tests.Godot/tests/Scenes/Smoke/test_main_scene_smoke.gd",
      "项目结构满足目录标准，包含并使用 scripts、scenes、assets、config 四类专用目录。 Refs: Game.Core.Tests/Tasks/Task11ProjectStructureStandardsTests.cs",
      "启动游戏流程由 Godot C# API 的启动路径实现，并在 Main Scene 运行时实际执行。 Refs: Tests.Godot/tests/Scenes/Smoke/test_main_scene_bootstrap_path.gd",
      "C# 启动/配置逻辑可成功加载并解析至少一个 JSON 配置文件，且无加载或解析错误。 Refs: Game.Core.Tests/Domain/GameConfigTests.cs",
      "重开/重建验证必须在同一个 T1 项目根目录执行，不接受在新建项目路径上完成验证。 Refs: Game.Core.Tests/Tasks/Task11ProjectReuseGuardsTests.cs Tests.Godot/tests/Integration/test_editor_reopen_rebuild_stability.gd",
      "至少完成一次完整的编辑器重开并重建流程，且启动场景配置在该流程后保持有效。 Refs: Tests.Godot/tests/Scenes/Smoke/test_main_scene_smoke.gd",
      "完成验证后的项目再次运行可到达初始场景，且不会立即崩溃。 Refs: Tests.Godot/tests/Scenes/Smoke/test_main_scene_smoke.gd",
      "若任一必需的打开、编译、运行、重开或重建验证失败，则该任务不予验收。 Refs: Game.Core.Tests/Tasks/Task11WindowsCSharpBaselineGateTests.cs Tests.Godot/tests/Integration/test_editor_reopen_rebuild_stability.gd",
      "验证需确认 Windows 环境下 Godot 4.5.1 与可用于 Godot C# 编译的 .NET SDK 同时存在；任一缺失即不予验收。 Refs: Game.Core.Tests/Tasks/Task11WindowsCSharpBaselineGateTests.cs",
      "初始场景加载期间，至少一个启动路径 C# 脚本产生可观测效果，证明不是空操作。 Refs: Tests.Godot/tests/Scenes/Smoke/test_glue_connections.gd",
      "验证后的 Windows 构建进入单人启动流程，且不依赖多人会话初始化。 Refs: Tests.Godot/tests/Integration/test_singleplayer_startup_flow.gd Game.Core.Tests/Services/StartupBootstrapServiceTests.cs",
      "Obligation lock O7: 启动路径 C# 脚本必须同时完成窗口初始化设置与初始场景加载，缺任一步即不通过。 Refs: Game.Core.Tests/Services/StartupBootstrapServiceTests.cs Tests.Godot/tests/Scenes/Smoke/test_main_scene_bootstrap_path.gd",
      "Scope boundary: 本任务仅允许对既有 T1 项目做加固与验证；创建第二个 Godot 项目即不通过。 Refs: Game.Core.Tests/Tasks/Task11ProjectReuseGuardsTests.cs",
      "Scope boundary hard gate: T11 必须复用既有 T1 项目根目录，且禁止任何 new-project bootstrap；出现即不通过。 Refs: Game.Core.Tests/Tasks/Task11ProjectReuseGuardsTests.cs",
      "T11 复用验证必须在同一 T1 根目录完成，并包含至少两次编辑器重开且 Main Scene 与脚本绑定保持不变；缺少证据即不通过。 Refs: Tests.Godot/tests/Integration/test_editor_reopen_rebuild_stability.gd",
      "T11 执行期间若发生任何 reinitialization 或再次创建 Godot 项目，即使其他构建检查通过也判定不通过。 Refs: Game.Core.Tests/Tasks/Task11ProjectReuseGuardsTests.cs",
      "在同一 T1 根目录内，必须明确并验证启动基线命名约定（Main Scene 名称、启动脚本名称、scripts/scenes/assets/config 目录命名）并保持一致；任一不一致即不通过。",
      "必需 bootstrap 资产（至少含启动场景与启动脚本）必须由结构契约检查列出并校验；缺失任一必需项时门禁必须失败。",
      "启动 wiring 与目录标准调整后，集成冒烟需证明启动流仍从既有主场景进入且目录完整；若出现 secondary root 或替代根路径即不通过。",
      "结构回归与门禁检查必须在复用的 T1 根目录生成可审计验证工件并记录缺失项失败结果；未产出工件或缺失项未触发失败即不通过。"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #11 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 11,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0012",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0011"
    ],
    "taskmaster_exported": false,
    "title": "Implement Core Resource System with Integer Safety",
    "description": "Create a resource management system for gold, iron, and population cap, ensuring integer-safe operations to prevent floating-point drift.",
    "status": "pending",
    "priority": "P1",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Game.Core.Tests/Services/ResourceManagerTests.cs",
      "Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "Game.Core.Tests/Services/ResourceManagerEventTests.cs"
    ],
    "acceptance": [
      "Hard gate: integer safety requires both static scan and runtime assertion gates; any non-integer resource arithmetic must fail immediately and keep state unchanged.",
      "Hard gate: all economy modules must consume the shared resource contract/API, with cross-module tests proving consistent names, initial values, and invariants.",
      "Taskmaster #12 delivery is strictly limited to integer-safe resource management for gold, iron, and population cap, with no unrelated behavior changes. Refs: Game.Core.Tests/Services/ResourceManagerTests.cs",
      "All automated tests referenced by this task pass on the Windows Godot+C# baseline. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "Resource mutations and resource-state snapshot serialization are deterministic: identical integer initial state plus identical mutation sequence always yields identical final state and serialized snapshot. Refs: Game.Core.Tests/Services/ResourceManagerTests.cs",
      "The ResourceManager contract fixes resource names (gold, iron, population cap), declares integer-only invariants, and initializes state exactly to gold=800, iron=150, pop-cap=50. Refs: Game.Core.Tests/Services/ResourceManagerTests.cs",
      "A spend request succeeds only when current gold and iron are each greater than or equal to requested integer costs, and success deducts exactly those costs. Refs: Game.Core.Tests/Services/ResourceManagerTests.cs",
      "Any spend or subtraction request that would make any tracked resource negative is rejected atomically, and all tracked resource values remain unchanged. Refs: Game.Core.Tests/Services/ResourceManagerTests.cs",
      "Zero-cost or zero-delta requests have deterministic, repeatable outcomes while preserving all declared resource invariants. Refs: Game.Core.Tests/Services/ResourceManagerTests.cs",
      "Negative inputs for spend/add/subtract follow an explicit contract (rejection or defined no-op); when rejected, state remains unchanged. Refs: Game.Core.Tests/Services/ResourceManagerTests.cs",
      "Add, subtract, and spend operations enforce integer overflow/underflow guards so wrapped values are never committed to state. Refs: Game.Core.Tests/Services/ResourceManagerTests.cs",
      "Every successful resource mutation emits a Godot signal or equivalent event containing new totals and structured delta/reason fields for UI refresh. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "Resource logic for gold, iron, and population cap uses integer arithmetic only, with no floating-point math in mutation paths. Refs: Game.Core.Tests/Services/ResourceManagerTests.cs",
      "Valid add/subtract/spend requests for gold, iron, and population cap mutate state only through defined mutation APIs as exact integer deltas, and outcomes are observable via state reads and emitted payloads. Refs: Game.Core.Tests/Services/ResourceManagerTests.cs Game.Core.Tests/Services/ResourceManagerEventTests.cs",
      "When a mutation is refused for insufficient resources, negative input, or overflow/underflow risk, all tracked resource values remain exactly equal to pre-request values. Refs: Game.Core.Tests/Services/ResourceManagerTests.cs",
      "Spend/add/subtract APIs expose success/failure results consistent with state transitions: success only when the exact integer mutation is applied, failure only when state is unchanged. Refs: Game.Core.Tests/Services/ResourceManagerTests.cs Game.Core.Tests/Services/ResourceManagerEventTests.cs",
      "Automated tests explicitly verify initial values, successful mutations, zero-input behavior, negative-input handling, overflow/underflow refusal, rapid-update event ordering and payload integrity, and snapshot roundtrip parity for gold, iron, and population cap. Refs: Game.Core.Tests/Services/ResourceManagerTests.cs Game.Core.Tests/Services/ResourceManagerEventTests.cs",
      "Obligation lock O10: no floating-point usage in resource calculations is a hard acceptance gate, with regression checks that fail if any resource path introduces float math. Refs: Game.Core.Tests/Services/ResourceManagerTests.cs",
      "Obligation lock O11: resource-system unit tests are implemented in C# test projects and executed by NUnit or an equivalent .NET test framework. Refs: Game.Core.Tests/Services/ResourceManagerTests.cs",
      "Obligation lock O1: the task delivers a C# ResourceManager that tracks gold, iron, and population cap as integer state. Refs: Game.Core.Tests/Services/ResourceManagerTests.cs",
      "Obligation lock O2: initial resource state is exactly gold=800, iron=150, and pop-cap=50. Refs: Game.Core.Tests/Services/ResourceManagerTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #12 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 12,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0013",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0011",
      "NG-0012"
    ],
    "taskmaster_exported": false,
    "title": "Design and Implement Building System with Footprint Rules",
    "description": "Develop a building system that supports core buildings (castle, residence, mine, barracks, MG tower, wall, mine trap) with footprint rules and placement logic.",
    "status": "pending",
    "priority": "P1",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Tests.Godot/tests/UI/test_hud_scene.gd",
      "Game.Core.Tests/Services/BuildingSubtypePlacementTests.cs",
      "Game.Core.Tests/Services/BuildingPlacementValidationTests.cs",
      "Game.Core.Tests/Services/BuildingPlacementTransactionTests.cs",
      "Game.Core.Tests/Services/BuildingPlacementDeterminismTests.cs",
      "Game.Core.Tests/Engine/BuildingSystemCoreLoopDeterminismTests.cs",
      "Game.Core.Tests/Domain/BuildingArchetypeTests.cs",
      "Game.Core.Tests/State/GridOccupancyTrackerTests.cs",
      "Game.Core.Tests/Services/WallDragPlacementServiceTests.cs",
      "Game.Core.Tests/Services/GatePathingRulesTests.cs",
      "Game.Core.Tests/Services/BuildingSelectionPolicyTests.cs",
      "Tests.Godot/tests/Scenes/Building/test_building_debug_overlays_alignment.gd"
    ],
    "acceptance": [
      "Hard gate: scene tests must explicitly assert gate-segment creation outcomes (count, position, direction) during drag-line wall building.",
      "Hard gate: invalid gate-creation input must be rejected with no gate/wall side effects and no resource state mutation.",
      "Taskmaster #13 在后端实现 castle、residence、mine、barracks、MG tower、wall、mine trap 的建造行为，且放置结果由 footprint 规则决定并限定在任务范围内。 Refs: Game.Core.Tests/Services/BuildingSubtypePlacementTests.cs Game.Core.Tests/Services/BuildingPlacementValidationTests.cs",
      "所有被引用的自动化测试在 Windows Godot+C# 基线上通过。 Refs: Game.Core.Tests/Services/BuildingPlacementValidationTests.cs Game.Core.Tests/Services/BuildingPlacementTransactionTests.cs",
      "在相同 grid 状态、资源状态、seed 和输入序列下，放置、gate-pathing 与拒绝结果必须可重复且保持确定性。 Refs: Game.Core.Tests/Services/BuildingPlacementDeterminismTests.cs Game.Core.Tests/Engine/BuildingSystemCoreLoopDeterminismTests.cs",
      "必须定义 castle、residence、mine、barracks、MG tower、wall、mine trap 的 canonical archetype，且每个 archetype 都提供 type、level、footprint size、HP、cost，并被放置与扣费校验实际使用。 Refs: Game.Core.Tests/Domain/BuildingArchetypeTests.cs",
      "放置校验必须精确执行任务明示的 footprint 值：castle=4、barracks=2、MG tower=1、wall=1。 Refs: Game.Core.Tests/Domain/BuildingArchetypeTests.cs",
      "仅当目标 footprint 覆盖的全部格子都在边界内且为空时，建造请求才可接受；否则必须以确定性的 reason code 拒绝。 Refs: Game.Core.Tests/Services/BuildingPlacementValidationTests.cs Game.Core.Tests/State/GridOccupancyTrackerTests.cs",
      "只要任一目标格 out-of-bounds、blocked 或 occupied，请求必须被拒绝，且不得创建建筑、不得改变资源。 Refs: Game.Core.Tests/Services/BuildingPlacementValidationTests.cs Game.Core.Tests/Services/BuildingPlacementTransactionTests.cs",
      "当资源低于所选建筑 cost 时，请求必须被拒绝，且不得创建建筑、不得改变资源。 Refs: Game.Core.Tests/Services/BuildingPlacementTransactionTests.cs",
      "建造成功时，资源只扣减一次，且提交的占用格必须与已接受 footprint 完全一致。 Refs: Game.Core.Tests/Services/BuildingPlacementTransactionTests.cs Game.Core.Tests/State/GridOccupancyTrackerTests.cs",
      "wall 拖线模式在有效格上沿拖拽路径生成连续墙段；无效格不得生成墙段且不得消耗资源。 Refs: Game.Core.Tests/Services/WallDragPlacementServiceTests.cs",
      "pathing 必须执行 gate 单向规则：非 gate 墙格阻挡通行，gate 格仅允许其配置方向通行。 Refs: Game.Core.Tests/Services/GatePathingRulesTests.cs",
      "自动化校验必须覆盖：有效/无效放置、边界与碰撞拒绝、成功扣费与失败回滚、wall 拖线、gate 行为、blocked-path fallback、gate tie 的确定性处理。 Refs: Game.Core.Tests/Services/BuildingPlacementDeterminismTests.cs Game.Core.Tests/Services/GatePathingRulesTests.cs",
      "放置校验与占用追踪必须基于离散网格坐标（TileMap 或等价自定义网格），且成功放置不得提交任何 off-grid 占用。 Refs: Game.Core.Tests/State/GridOccupancyTrackerTests.cs Game.Core.Tests/Services/BuildingPlacementValidationTests.cs",
      "对每个受支持建筑类型（castle、residence、mine、barracks、MG tower、wall、mine trap），放置校验与 cost 校验都必须使用该类型自身配置的 footprint 与 cost。 Refs: Game.Core.Tests/Services/BuildingSelectionPolicyTests.cs Game.Core.Tests/Domain/BuildingArchetypeTests.cs",
      "必须存在共享 C# Building 基类（type、level、footprint size、HP、cost），且所列核心建筑都作为具体子类型实现并参与放置校验与建造事务。 Refs: Game.Core.Tests/Domain/BuildingArchetypeTests.cs Game.Core.Tests/Services/BuildingPlacementTransactionTests.cs",
      "放置资格校验必须对完整 footprint 原子执行：任一必需格无效即整体拒绝，occupancy 与资源都不允许变化。 Refs: Game.Core.Tests/Services/BuildingPlacementValidationTests.cs Game.Core.Tests/Services/BuildingPlacementTransactionTests.cs",
      "自动化测试必须对每个具体建筑子类型至少包含一个成功用例和一个拒绝用例，并断言其 subtype 对应的 footprint 与 cost 校验。 Refs: Game.Core.Tests/Services/BuildingSubtypePlacementTests.cs Game.Core.Tests/Domain/BuildingArchetypeTests.cs",
      "校验与测试运行必须提供可视化调试边界（footprint 边界与 occupied-cell overlay），且与成功放置后最终提交的网格格子一致。 Refs: Tests.Godot/tests/Scenes/Building/test_building_debug_overlays_alignment.gd"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #13 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 13,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0014",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0012",
      "NG-0013"
    ],
    "taskmaster_exported": false,
    "title": "Implement Economy and Tax System for Residences",
    "description": "Add economy features where residences generate gold tax every 15 seconds and provide population capacity.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Tests.Godot/tests/Integration/test_residence_economy_flow.gd",
      "Tests.Godot/tests/Scenes/Economy/test_residence_tax_timer_cadence.gd",
      "Game.Core.Tests/Domain/ResidenceBuildingTests.cs",
      "Game.Core.Tests/Services/ResidenceTaxConfigTests.cs",
      "Game.Core.Tests/Services/ResidenceTaxCadenceTests.cs",
      "Tests.Godot/tests/Scenes/Economy/test_residence_placement_no_effect_on_cancel.gd",
      "Tests.Godot/tests/Scenes/Economy/test_residence_multi_tax_sum.gd",
      "Tests.Godot/tests/Scenes/Economy/test_residence_timer_node_tax_binding.gd"
    ],
    "acceptance": [
      "Task 14 is complete only when a successful Residence build increases population cap and built Residences generate tax gold on a 15-second cadence. Refs: Tests.Godot/tests/Integration/test_residence_economy_flow.gd",
      "Automated tests that verify Residence 15-second tax timing and ResourceManager gold addition pass on the Windows Godot+C# baseline. Refs: Tests.Godot/tests/Scenes/Economy/test_residence_tax_timer_cadence.gd",
      "Residence economy updates are deterministic for identical build and timer inputs and are not frame-rate dependent. Refs: Tests.Godot/tests/Scenes/Economy/test_residence_tax_timer_cadence.gd",
      "Each successful Residence placement increases population cap by exactly the configured population-cap value once for that placement. Refs: Game.Core.Tests/Domain/ResidenceBuildingTests.cs",
      "After a Residence is built, ResourceManager gold does not increase from Residence tax before the first 15-second timeout, then increases by the configured per-tick tax at each timeout. Refs: Tests.Godot/tests/Scenes/Economy/test_residence_tax_timer_cadence.gd",
      "Residence tax per tick is sourced from configuration, including level-based tax values when such configuration exists. Refs: Game.Core.Tests/Services/ResidenceTaxConfigTests.cs",
      "Residence-driven gold and population-cap updates remain integer-safe over repeated ticks, with no fractional accumulation or floating-point drift in stored totals. Refs: Game.Core.Tests/Services/ResidenceTaxCadenceTests.cs",
      "If no Residence is built, Residence tax processing contributes zero gold change. Refs: Game.Core.Tests/Services/ResidenceTaxCadenceTests.cs",
      "Verification includes unit coverage for 15-second tax cadence and gold addition, plus in-game validation that placement raises population cap and gold increments every 15 seconds on Windows Godot+C#. Refs: Tests.Godot/tests/Integration/test_residence_economy_flow.gd",
      "Failed or canceled Residence placement leaves population cap and gold unchanged and does not start Residence tax cadence. Refs: Game.Core.Tests/Domain/ResidenceBuildingTests.cs Tests.Godot/tests/Scenes/Economy/test_residence_placement_no_effect_on_cancel.gd",
      "When multiple Residences are built, each 15-second payout increases gold by the sum of configured taxes for all eligible built Residences. Refs: Tests.Godot/tests/Scenes/Economy/test_residence_multi_tax_sum.gd",
      "In a controlled 45-second observation window after one successful Residence build, exactly three payouts occur at 15s, 30s, and 45s, and cumulative gold gain equals three times the configured per-tick tax for that Residence context. Refs: Tests.Godot/tests/Scenes/Economy/test_residence_tax_timer_cadence.gd",
      "A single successful Residence placement event is idempotent for population-cap gain: reprocessing the same placement event cannot create an additional cap increment. Refs: Game.Core.Tests/Domain/ResidenceBuildingTests.cs",
      "Obligation lock O1: Extend the Building system for Residence class is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Game.Core.Tests/Domain/ResidenceBuildingTests.cs",
      "Obligation lock O5: Use a timer in Godot (Timer node) to trigger tax every 15 seconds: add gold to ResourceManager is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Tests.Godot/tests/Scenes/Economy/test_residence_timer_node_tax_binding.gd Tests.Godot/tests/Scenes/Economy/test_residence_tax_timer_cadence.gd",
      "Residence economy contract defines negative-gold handling expectations for states touched by tax flow, and tested outcomes must match that policy without undefined or silent state changes.",
      "Residence tax runtime applies integer-only mutations in deterministic per-tick ordering, and identical initial state plus identical tick sequence yields identical gold totals and debt-state transitions when debt is enabled.",
      "Economy regression coverage records a structured tax-tick trace with mutation reason and delta for each Residence payout, and fixed-seed runs reproduce the same trace sequence and totals."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #14 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 14,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0015",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0013",
      "NG-0014"
    ],
    "taskmaster_exported": false,
    "title": "Develop Upgrade and Repair System with Constraints",
    "description": "Create a system for building upgrades (max level 5, no skipping) and repairs, with economic rules and constraints.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Game.Core.Tests/Domain/BuildingUpgradeTests.cs",
      "Game.Core.Tests/Services/BuildingOperationStateMachineTests.cs",
      "Tests.Godot/tests/Integration/test_building_upgrade_repair_progress_flow.gd",
      "Game.Core.Tests/Engine/GameEngineCoreEventTests.cs",
      "Game.Core.Tests/Services/BuildingRepairProgressTests.cs"
    ],
    "acceptance": [
      "Taskmaster #15 implementation behavior is limited to the upgrade/repair rules and constraints defined for Develop Upgrade and Repair System with Constraints. Refs: Game.Core.Tests/Domain/BuildingUpgradeTests.cs Game.Core.Tests/Services/BuildingOperationStateMachineTests.cs",
      "All referenced automated tests for Taskmaster #15 pass on the Windows Godot+C# baseline. Refs: Tests.Godot/tests/Integration/test_building_upgrade_repair_progress_flow.gd",
      "With deterministic inputs, behavior outside upgrade/repair effects remains deterministic with no unintended regression to core loop constraints. Refs: Game.Core.Tests/Engine/GameEngineCoreEventTests.cs",
      "Upgrade start is permitted only when state is Idle, level is below 5, and config-defined upgrade resource cost is affordable. Refs: Game.Core.Tests/Domain/BuildingUpgradeTests.cs",
      "Each completed successful upgrade increases level by exactly 1; level skipping is refused and level never exceeds 5. Refs: Game.Core.Tests/Domain/BuildingUpgradeTests.cs",
      "If an upgrade request is invalid (non-Idle state, insufficient resources, or level already 5), upgrade does not start and level/state/resources remain unchanged. Refs: Game.Core.Tests/Domain/BuildingUpgradeTests.cs",
      "On upgrade completion, current HP is restored to full HP. Refs: Game.Core.Tests/Domain/BuildingUpgradeTests.cs",
      "When upgrade cost values change in configuration, subsequent upgrade charges use the updated configured values. Refs: Game.Core.Tests/Domain/BuildingUpgradeTests.cs",
      "Repair consumes gold only; repairing from damaged HP to full HP deducts total gold equal to 50% of the building build cost. Refs: Game.Core.Tests/Services/BuildingRepairProgressTests.cs",
      "Repair is applied incrementally over time (not as an instant full heal) until HP reaches full. Refs: Game.Core.Tests/Services/BuildingRepairProgressTests.cs Tests.Godot/tests/Integration/test_building_upgrade_repair_progress_flow.gd",
      "Upgrade and repair are mutually exclusive; starting one while the other is active is refused and cannot create concurrent Upgrading and Repairing activity. Refs: Game.Core.Tests/Services/BuildingOperationStateMachineTests.cs Tests.Godot/tests/Integration/test_building_upgrade_repair_progress_flow.gd",
      "When a progress operation completes, state returns to Idle, and automated tests verify level progression, cost rules, HP restoration, conflict handling, integer-safe arithmetic, and config-driven values on the Windows Godot+C# baseline. Refs: Game.Core.Tests/Services/BuildingOperationStateMachineTests.cs Game.Core.Tests/Services/BuildingRepairProgressTests.cs",
      "Upgrade and repair complete asynchronously through progress flow (queue/coroutine/timer driven), so completion outcomes are observable only after progress updates, not in the same tick as a successful start request. Refs: Tests.Godot/tests/Integration/test_building_upgrade_repair_progress_flow.gd Game.Core.Tests/Services/BuildingRepairProgressTests.cs",
      "Repair start is permitted only when state is Idle, current HP is below full HP, and required gold is payable; if invalid (non-Idle, full HP, or insufficient gold), repair does not start and HP/state/gold remain unchanged. Refs: Game.Core.Tests/Services/BuildingRepairProgressTests.cs Game.Core.Tests/Services/BuildingOperationStateMachineTests.cs",
      "For any starting HP below full HP, cumulative gold deducted across incremental repair steps to full HP equals exactly 50% of build cost, using deterministic integer-safe arithmetic that never overcharges. Refs: Game.Core.Tests/Services/BuildingRepairProgressTests.cs",
      "While state is Upgrading or Repairing, additional upgrade/repair start requests are rejected and do not create duplicate or parallel progress flows for the same building. Refs: Tests.Godot/tests/Integration/test_building_upgrade_repair_progress_flow.gd",
      "A successful upgrade start deducts exactly one config-defined upgrade cost for the current level, transitions state to Upgrading immediately, and does not change level or restore HP in that same tick. Refs: Game.Core.Tests/Domain/BuildingUpgradeTests.cs Game.Core.Tests/Services/BuildingOperationStateMachineTests.cs",
      "Repair progress updates HP in multiple deterministic integer-safe steps and deducts gold cumulatively so no single step can overcharge beyond the remaining amount needed to reach full HP. Refs: Game.Core.Tests/Services/BuildingRepairProgressTests.cs Tests.Godot/tests/Integration/test_building_upgrade_repair_progress_flow.gd",
      "State transitions cannot bypass Idle: once Upgrading or Repairing has started, switching to the other operation is refused until the active operation completes and state returns to Idle. Refs: Game.Core.Tests/Services/BuildingOperationStateMachineTests.cs",
      "Obligation lock O1: Add upgrade and repair functionality to Building class is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Game.Core.Tests/Domain/BuildingUpgradeTests.cs Game.Core.Tests/Services/BuildingRepairProgressTests.cs",
      "Obligation lock O10: public enum BuildState { Idle, Upgrading, Repairing }; is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Game.Core.Tests/Domain/BuildingUpgradeTests.cs Game.Core.Tests/Services/BuildingOperationStateMachineTests.cs",
      "Obligation lock O11: Progress flow implementation must use Godot queue or coroutine mechanisms; timer-only implementation is rejected as insufficient acceptance evidence. Refs: Tests.Godot/tests/Integration/test_building_upgrade_repair_progress_flow.gd",
      "When a cancel or interruption path is invoked for an active upgrade or repair, refund outcomes are deterministic and integer-safe: refunded value equals only the remaining unconsumed cost and never exceeds what was already deducted.",
      "Given fixed initial state and fixed progress-step inputs, upgrade/repair execution timing and completion ordering are deterministic across repeated runs.",
      "Regression scenarios must emit an ordered operation timeline (start, progress, completion, refusal) that demonstrates illegal concurrent requests are refused and valid requests can still complete after the building returns to Idle."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #15 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 15,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0016",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0013",
      "NG-0014"
    ],
    "taskmaster_exported": false,
    "title": "Implement Unit Training Queue in Barracks",
    "description": "Add unit training functionality to barracks with a single queue per barracks, cancellable with 100% refund.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Game.Core.Tests/Services/BarracksTrainingQueueTests.cs",
      "Tests.Godot/tests/Integration/test_barracks_training_queue_flow.gd",
      "Game.Core.Tests/Engine/GameEngineCoreEventTests.cs",
      "Game.Core.Tests/Services/BarracksTrainingCostScheduleTests.cs",
      "Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "Game.Core.Tests/Domain/BarracksBuildingTests.cs"
    ],
    "acceptance": [
      "Each Barracks instance owns exactly one unit-training queue, and canceling any queued job refunds 100% of that job's deducted resources. Refs: Game.Core.Tests/Services/BarracksTrainingQueueTests.cs",
      "Referenced automated tests for Task #16 pass on the Windows Godot+C# baseline. Refs: Tests.Godot/tests/Integration/test_barracks_training_queue_flow.gd",
      "Changes are limited to Barracks training-queue behavior; deterministic simulation behavior outside that scope remains unchanged. Refs: Game.Core.Tests/Engine/GameEngineCoreEventTests.cs Game.Core.Tests/State/GameStateMachineTests.cs",
      "Queue operations on one Barracks (enqueue/cancel/progress) do not mutate queue state in any other Barracks instance. Refs: Game.Core.Tests/Services/BarracksTrainingQueueTests.cs",
      "When a training request is accepted, deductions follow that unit's config-defined timing; if required request-time payment cannot be made, the request is rejected and queue/resource totals remain unchanged. Refs: Game.Core.Tests/Services/BarracksTrainingCostScheduleTests.cs Game.Core.Tests/Services/BarracksTrainingQueueTests.cs",
      "Training jobs execute in FIFO order with config-driven durations, and each completed head job is removed once and produces exactly one trained unit result. Refs: Game.Core.Tests/Services/BarracksTrainingQueueTests.cs Game.Core.Tests/Services/BarracksTrainingCostScheduleTests.cs",
      "Canceling with a valid index removes only the targeted job, refunds 100% of that job's deducted resources, and preserves the relative order of remaining jobs. Refs: Game.Core.Tests/Services/BarracksTrainingQueueTests.cs",
      "Canceling with an invalid index is rejected and leaves queue contents and resource totals unchanged. Refs: Game.Core.Tests/Services/BarracksTrainingQueueTests.cs",
      "Godot signals are emitted on enqueue, cancel, and completion so UI updates can be driven by emitted queue/resource state changes. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "Training and cancellation resource arithmetic is integer-safe: no overflow, no underflow, and no negative resource totals. Refs: Game.Core.Tests/Services/BarracksTrainingCostScheduleTests.cs",
      "Canceling the currently active head job is supported: that job is removed, refunded 100% of deducted resources, produces no unit, and remaining jobs continue in order. Refs: Game.Core.Tests/Services/BarracksTrainingQueueTests.cs Tests.Godot/tests/Integration/test_barracks_training_queue_flow.gd",
      "No training job completes before its configured duration elapses. Refs: Game.Core.Tests/Services/BarracksTrainingCostScheduleTests.cs",
      "For staged-cost configuration, each staged deduction occurs only at its configured progress/time point and for the configured integer amount. Refs: Game.Core.Tests/Services/BarracksTrainingCostScheduleTests.cs",
      "For any job canceled after partial or full in-progress deductions, total refunded resources for that job equal total resources deducted for that job. Refs: Game.Core.Tests/Services/BarracksTrainingCostScheduleTests.cs",
      "Per-job configuration is authoritative for cost: across upfront, staged, or mixed deduction timing, summed integer deductions for a job equal configured cost, and cancellation refunds exactly that job's deducted total. Refs: Game.Core.Tests/Services/BarracksTrainingCostScheduleTests.cs",
      "Obligation lock O1: Create a Barracks class extending Building is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Game.Core.Tests/Domain/BarracksBuildingTests.cs",
      "Obligation lock O2: Implement a training queue (List or Queue in C#) for units is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Game.Core.Tests/Domain/BarracksBuildingTests.cs Game.Core.Tests/Services/BarracksTrainingQueueTests.cs",
      "Obligation lock O8: Unit tests for queue operations, resource deduction/refund on cancel is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Game.Core.Tests/Services/BarracksTrainingQueueTests.cs Game.Core.Tests/Services/BarracksTrainingCostScheduleTests.cs",
      "Obligation lock O10: At least one in-game test must pass for the scenario multi-unit training + mid-training cancel + exact refund + queue-state correctness, and this evidence must be traceable. Refs: Tests.Godot/tests/Integration/test_barracks_training_queue_flow.gd"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #16 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 16,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0017",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0013",
      "NG-0016"
    ],
    "taskmaster_exported": false,
    "title": "Design and Integrate Tech Tree for Unit Stats",
    "description": "Develop a config-driven tech tree that affects unit stats (atk speed %, damage, production speed %, range, HP, cost %).",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Tests.Godot/tests/Adapters/test_techtree_resource_loading.gd",
      "Game.Core.Tests/Services/TechTreeManagerJsonLoadingTests.cs",
      "Game.Core.Tests/Services/TechTreeMultiplierTests.cs",
      "Game.Core.Tests/Services/TechTreeDeterminismTests.cs",
      "Game.Core.Tests/Services/BarracksUnitStatApplicationTests.cs",
      "Tests.Godot/tests/Integration/test_barracks_techtree_stats.gd",
      "Tests.Godot/tests/Integration/test_techtree_reload_unlock_paths.gd",
      "Game.Core.Tests/Services/TechTreeUnlockPrerequisitesTests.cs",
      "Game.Core.Tests/Services/TechTreeReloadBehaviorTests.cs",
      "Game.Core.Tests/Services/TechTreeManagerContractTests.cs"
    ],
    "acceptance": [
      "Given a valid tech-tree JSON resource loaded via Godot Resource APIs, runtime exposes node IDs, prerequisites, and stat modifiers exactly as defined in that resource. Refs: Tests.Godot/tests/Adapters/test_techtree_resource_loading.gd",
      "Referenced automated tests for JSON loading/parsing and stat-multiplier calculations pass on the Windows Godot + C# baseline. Refs: Game.Core.Tests/Services/TechTreeManagerJsonLoadingTests.cs Game.Core.Tests/Services/TechTreeMultiplierTests.cs",
      "With identical JSON config and identical unlock state, repeated evaluations return identical stat multipliers and identical barracks-trained unit stats. Refs: Game.Core.Tests/Services/TechTreeDeterminismTests.cs Game.Core.Tests/Services/BarracksUnitStatApplicationTests.cs",
      "Tech node definitions and unlock requirements are sourced from JSON resource data at runtime, and the in-memory node set equals the active config content. Refs: Game.Core.Tests/Services/TechTreeManagerJsonLoadingTests.cs",
      "For attack speed, damage, production speed, range, HP, and cost, unlocked node effects are combined multiplicatively rather than additively. Refs: Game.Core.Tests/Services/TechTreeMultiplierTests.cs",
      "When no unlocked node defines a modifier for a stat, that stat multiplier remains 1.0 and newly barracks-trained units keep baseline values for that stat. Refs: Game.Core.Tests/Services/TechTreeMultiplierTests.cs Game.Core.Tests/Services/BarracksUnitStatApplicationTests.cs",
      "After configured tech nodes are unlocked, units trained from barracks reflect stat values equal to baseline multiplied by current computed multipliers. Refs: Tests.Godot/tests/Integration/test_barracks_techtree_stats.gd",
      "Unlock progression is config-driven: modifying prerequisite/unlock-path data in JSON changes unlock availability after reload without C# source edits. Refs: Tests.Godot/tests/Integration/test_techtree_reload_unlock_paths.gd",
      "Automated parsing tests assert that runtime node IDs, prerequisite links, and modifier values match the JSON resource content. Refs: Game.Core.Tests/Services/TechTreeManagerJsonLoadingTests.cs",
      "Unit tests verify multiplicative stacking across multiple unlocked nodes (for example 1.1 x 1.2 = 1.32) and verify locked nodes are excluded. Refs: Game.Core.Tests/Services/TechTreeMultiplierTests.cs",
      "In-game verification unlocks configured techs, trains barracks units, and confirms attack speed, damage, production speed, range, HP, and cost equal baseline x configured multipliers. Refs: Tests.Godot/tests/Integration/test_barracks_techtree_stats.gd",
      "If prerequisites are not satisfied in current config state, the target tech remains unavailable and output stats stay unchanged from currently applicable multipliers. Refs: Game.Core.Tests/Services/TechTreeUnlockPrerequisitesTests.cs Game.Core.Tests/Services/BarracksUnitStatApplicationTests.cs",
      "Any tech node present in JSON but not unlocked at evaluation time contributes no modifiers and does not affect newly barracks-trained unit stats. Refs: Game.Core.Tests/Services/TechTreeMultiplierTests.cs Game.Core.Tests/Services/BarracksUnitStatApplicationTests.cs",
      "Changing only JSON multiplier values or prerequisite links, then reloading config, changes computed multipliers and barracks-trained outcomes without changing C# source. Refs: Tests.Godot/tests/Integration/test_techtree_reload_unlock_paths.gd",
      "Switching between two valid JSON tech-tree resources without C# source changes produces unlock availability and barracks-trained unit stats that follow the active resource. Refs: Game.Core.Tests/Services/TechTreeReloadBehaviorTests.cs Tests.Godot/tests/Integration/test_techtree_reload_unlock_paths.gd",
      "For each supported stat (attack speed, damage, production speed, range, HP, cost), runtime multiplier equals the product of modifiers from currently unlocked nodes that define that stat. Refs: Game.Core.Tests/Services/TechTreeMultiplierTests.cs",
      "Obligation lock O1: Create a TechTreeManager class is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Game.Core.Tests/Services/TechTreeManagerContractTests.cs",
      "Obligation lock O7: public float GetStatMultiplier(string stat) { // Calculate based on unlocked techs } is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Game.Core.Tests/Services/TechTreeManagerContractTests.cs",
      "TechTreeManager is the loading owner: it must load tech definitions from JSON config via Godot Resource APIs and build the runtime node set; delegating JSON load ownership outside TechTreeManager fails acceptance. Refs: Tests.Godot/tests/Adapters/test_techtree_resource_loading.gd",
      "TechTreeManager must maintain ID-keyed node storage as private Dictionary<string, TechNode> nodes (or an audit-equivalent private dictionary with string keys and TechNode values), verifiable by tests or audit evidence. Refs: Game.Core.Tests/Services/TechTreeManagerContractTests.cs",
      "Tech modifier activation is schema-validated before runtime use: percentage-based modifiers are accepted only when within defined bounds, and apply order is deterministic for the same unlocked node set.",
      "Tech effects propagate through runtime snapshots: after unlock-state changes, the next snapshot for barracks unit stat computation reflects the new multipliers while previously produced snapshots remain unchanged.",
      "Tech calculations use active config values at runtime rather than embedded constants: changing only configured modifier values changes computed multipliers after reload with no source-code edits.",
      "Out-of-range modifier inputs are rejected without mutating computed multipliers or trained-unit stats, and rejection is observable in runtime results.",
      "Regression runs with fixed seeds and identical config/unlock sequences produce identical tech-application outcomes, including identical final multipliers and barracks-trained unit stats.",
      "Tech regression outputs include deterministic application trace artifacts that expose unlock sequence and resulting multiplier snapshots for audit and replay comparison. Refs: Game.Core.Tests/Services/TechTreeDeterminismTests.cs Game.Core.Tests/Services/TechTreeReloadBehaviorTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #17 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 17,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0018",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0012",
      "NG-0014"
    ],
    "taskmaster_exported": false,
    "title": "Implement Reward System with Nightly Choices",
    "description": "Add a reward system that triggers each night, offering 3 choices from separate pools, with fallback to gold if pool is exhausted.",
    "status": "pending",
    "priority": "P3",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Game.Core.Tests/Services/RewardManagerBehaviorTests.cs",
      "Tests.Godot/tests/Integration/test_day_night_reward_flow.gd",
      "Tests.Godot/tests/UI/test_reward_panel_shows_three_choices.gd",
      "Game.Core.Tests/Services/RewardPoolJsonConfigurationTests.cs",
      "Tests.Godot/tests/UI/test_reward_panel_supported_choice_kinds.gd",
      "Tests.Godot/tests/UI/test_reward_panel_hidden_on_fallback.gd",
      "Game.Core.Tests/Services/RewardChoiceSelectionTests.cs",
      "Tests.Godot/tests/Scenes/Rewards/test_reward_panel_selection_applies_single_effect.gd",
      "Game.Core.Tests/Services/RewardManagerConstructionTests.cs"
    ],
    "acceptance": [
      "Taskmaster #18 is accepted only when nightly rewards match scope: one reward trigger per night, three choices from the active night-type pool when available, and fixed-gold fallback when that pool yields zero choices. Refs: Game.Core.Tests/Services/RewardManagerBehaviorTests.cs Tests.Godot/tests/Integration/test_day_night_reward_flow.gd",
      "Referenced automated tests pass on the Windows Godot + C# baseline for Taskmaster #18 reward behavior. Refs: Tests.Godot/tests/Integration/test_day_night_reward_flow.gd",
      "Nightly reward handling completes without blocking or skipping normal day/night progression outside intended reward effects. Refs: Game.Core.Tests/Services/RewardManagerBehaviorTests.cs Tests.Godot/tests/Integration/test_day_night_reward_flow.gd",
      "When the day/night cycle enters a night phase, exactly one reward trigger occurs for that night and reward generation uses that active night type. Refs: Game.Core.Tests/Services/RewardManagerBehaviorTests.cs Tests.Godot/tests/Integration/test_day_night_reward_flow.gd",
      "Given an active night type with at least three available entries in its configured pool, the system presents exactly three reward choices sourced from that pool. Refs: Game.Core.Tests/Services/RewardManagerBehaviorTests.cs Tests.Godot/tests/UI/test_reward_panel_shows_three_choices.gd",
      "Reward pools are loaded from JSON configuration keyed by night type, and modifying the JSON changes subsequently generated choices without code changes. Refs: Game.Core.Tests/Services/RewardPoolJsonConfigurationTests.cs",
      "Each generated choice is a supported reward kind (resource, unit, or bonus) and is visible in the Godot UI for night reward selection. Refs: Tests.Godot/tests/UI/test_reward_panel_supported_choice_kinds.gd",
      "If the active night-type pool yields zero choices, the system grants the configured fixed fallback gold amount exactly once for that trigger and does not present selectable reward choices for that trigger. Refs: Game.Core.Tests/Services/RewardManagerBehaviorTests.cs Tests.Godot/tests/UI/test_reward_panel_hidden_on_fallback.gd",
      "Automated coverage includes choice generation, pool exhaustion, fallback-to-gold behavior, and JSON-driven pool selection; in-game night progression verifies reward presentation and fallback behavior. Refs: Game.Core.Tests/Services/RewardPoolJsonConfigurationTests.cs Tests.Godot/tests/Integration/test_day_night_reward_flow.gd",
      "Reward processing does not trigger during non-night phases, and no reward-choice UI or fallback gold is produced outside a night trigger. Refs: Tests.Godot/tests/Integration/test_day_night_reward_flow.gd",
      "For any night trigger where generated choice count is greater than zero, fallback gold is not granted for that trigger. Refs: Game.Core.Tests/Services/RewardManagerBehaviorTests.cs",
      "Across consecutive nights with different night types, each trigger uses the currently active night-type pool, and presented choices correspond to that active night type. Refs: Game.Core.Tests/Services/RewardManagerBehaviorTests.cs Tests.Godot/tests/Integration/test_day_night_reward_flow.gd",
      "For any night trigger with presented choices, selecting one choice applies exactly one corresponding reward effect and does not apply effects from non-selected choices. Refs: Game.Core.Tests/Services/RewardChoiceSelectionTests.cs Tests.Godot/tests/Scenes/Rewards/test_reward_panel_selection_applies_single_effect.gd",
      "Each processed night reward trigger has a verifiable non-noop outcome: either reward-choice UI is presented for selection or fixed-gold fallback is granted. Refs: Tests.Godot/tests/Integration/test_day_night_reward_flow.gd",
      "Within a single night reward trigger, all presented choices originate only from the active night-type pool and do not mix entries from other night-type pools. Refs: Game.Core.Tests/Services/RewardManagerBehaviorTests.cs Tests.Godot/tests/UI/test_reward_panel_shows_three_choices.gd",
      "Changing the configured fixed fallback gold value updates the granted fallback amount on subsequent exhausted-pool night triggers without code changes. Refs: Game.Core.Tests/Services/RewardPoolJsonConfigurationTests.cs",
      "Obligation lock O1: Create a RewardManager class is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Game.Core.Tests/Services/RewardManagerConstructionTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #18 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 18,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0019",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0011",
      "NG-0013"
    ],
    "taskmaster_exported": false,
    "title": "Add Day/Night Cycle and Game Win/Lose Conditions",
    "description": "Implement the day/night cycle (4 min Day + 2 min Night, Day1-Day15) and win/lose conditions based on castle HP.",
    "status": "pending",
    "priority": "P1",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Tests.Godot/tests/Integration/test_game_flow_day_night_terminal_paths.gd",
      "Game.Core.Tests/Services/GameManagerCycleTests.cs",
      "Game.Core.Tests/State/GameStateManagerTests.cs",
      "Game.Core.Tests/Services/GameManagerTerminalConditionsTests.cs",
      "Tests.Godot/tests/UI/test_hud_day_counter_updates.gd",
      "Tests.Godot/tests/Scenes/Gameplay/test_game_manager_phase_signal_flow.gd",
      "Game.Core.Tests/Domain/GameConfigTests.cs"
    ],
    "acceptance": [
      "Hard gate: UI integration tests must assert payload-to-display consistency for both transition and terminal events, including correct Win/Lose prompt mapping.",
      "Hard gate: one deterministic end-to-end suite must jointly gate cycle timing boundaries and terminal outcomes in the same run; any failed assertion fails the suite.",
      "GameManager is the single runtime authority for phase timing, day progression, and terminal-state evaluation, with transitions observable through exposed state or events. Refs: Game.Core.Tests/State/GameStateMachineTests.cs",
      "On the Windows Godot+C# baseline, automated tests for this feature execute to completion and pass. Refs: Tests.Godot/tests/Integration/test_game_flow_day_night_terminal_paths.gd",
      "Given the same initial state and timing inputs, repeated runs produce the same phase sequence, day boundaries, and terminal result. Refs: Game.Core.Tests/State/GameStateMachineTests.cs",
      "Each cycle runs Day for 240 seconds then Night for 120 seconds in fixed order, with no skipped, duplicated, or reordered phases. Refs: Game.Core.Tests/Services/GameManagerCycleTests.cs",
      "Runtime-observable state exposes current day and cycle progress, and day numbering advances sequentially from Day1 to Day15 only after a completed Day+Night pair. Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "If castle HP reaches 0 or below at any time, the run transitions to Lose immediately and cannot transition to Win afterward. Refs: Game.Core.Tests/State/GameStateMachineTests.cs",
      "If castle HP remains above 0 through completion of Day15->Night15, the run transitions to Win and cannot transition to Lose afterward. Refs: Game.Core.Tests/Services/GameManagerTerminalConditionsTests.cs",
      "Win/Lose evaluation reads castle HP from the building/castle gameplay source of truth, not from UI-only displayed values. Refs: Tests.Godot/tests/Integration/test_game_flow_day_night_terminal_paths.gd",
      "Godot signals with stable payloads are emitted for UI-observable state updates, including day counter updates when day progression occurs. Refs: Tests.Godot/tests/UI/test_hud_day_counter_updates.gd Tests.Godot/tests/Scenes/Gameplay/test_game_manager_phase_signal_flow.gd",
      "Deterministic end-to-end validation covers both terminal paths: forced castle destruction triggers Lose, and surviving the required cycle length triggers Win. Refs: Tests.Godot/tests/Integration/test_game_flow_day_night_terminal_paths.gd",
      "Configured timing for 15 full days is approximately 90 minutes (15 x (4 + 2) minutes), remaining within the stated 60-90 minute match-duration target boundary. Refs: Game.Core.Tests/Domain/GameConfigTests.cs",
      "Runtime-observable state includes current phase plus elapsed or remaining phase time so tests and UI can verify day-night progress without private-field access. Refs: Tests.Godot/tests/Scenes/Gameplay/test_game_manager_phase_signal_flow.gd",
      "A full win-path sequence is observable from Day1->Night1 through Day15->Night15 before terminal Win, and no Day16 phase begins. Refs: Game.Core.Tests/Services/GameManagerCycleTests.cs Tests.Godot/tests/Integration/test_game_flow_day_night_terminal_paths.gd",
      "After entering either terminal state (Win or Lose), phase transitions stop and no further day progression updates are emitted. Refs: Game.Core.Tests/Services/GameManagerTerminalConditionsTests.cs Tests.Godot/tests/Scenes/Gameplay/test_game_manager_phase_signal_flow.gd",
      "Automated unit tests explicitly assert both terminal predicates: (a) castle HP <= 0 triggers Lose, and (b) surviving through completion of Day15->Night15 with castle HP > 0 triggers Win. Refs: Game.Core.Tests/Services/GameManagerTerminalConditionsTests.cs",
      "Timing verification tests measure phase durations and fail when observed Day or Night duration deviates from 240s/120s beyond defined test tolerance. Refs: Game.Core.Tests/Services/GameManagerCycleTests.cs",
      "Phase switches are timer-driven and occur automatically at 240s/120s boundaries; Day->Night and Night->next-Day transitions require no manual player action. Refs: Tests.Godot/tests/Integration/test_game_flow_day_night_terminal_paths.gd",
      "Day numbering increments exactly once per completed Day+Night pair and does not increment on the Day->Night boundary alone. Refs: Game.Core.Tests/Services/GameManagerCycleTests.cs",
      "Terminal-condition evaluation continues during cycle progression, and if castle HP <= 0 during Day15 or Night15, the terminal outcome is Lose rather than Win. Refs: Game.Core.Tests/Services/GameManagerTerminalConditionsTests.cs Tests.Godot/tests/Integration/test_game_flow_day_night_terminal_paths.gd",
      "Win is emitted only after completion of Day15->Night15 with castle HP > 0, and exactly one terminal outcome (Win or Lose) is emitted per run. Refs: Game.Core.Tests/State/GameStateMachineTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #19 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 19,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0020",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0013",
      "NG-0016",
      "NG-0017"
    ],
    "taskmaster_exported": false,
    "title": "Integrate Combat with Friendly Fire Disabled",
    "description": "Implement combat system for units and towers, with friendly fire disabled for all player attacks.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Game.Core.Tests/Services/CombatServiceTests.cs",
      "Tests.Godot/tests/Scenes/Combat/test_combat_scene_targeting_range.gd",
      "Tests.Godot/tests/Integration/test_combat_units_towers_walls_flow.gd",
      "Game.Core.Tests/Services/CombatSystemTests.cs"
    ],
    "acceptance": [
      "Taskmaster #20 behavior matches PRD lock for Integrate Combat with Friendly Fire Disabled. Refs: Game.Core.Tests/Services/CombatServiceTests.cs",
      "Referenced automated tests pass on Windows Godot+C# baseline. Refs: Game.Core.Tests/Services/CombatServiceTests.cs",
      "No regression on deterministic simulation and core loop constraints. Refs: Game.Core.Tests/State/GameStateMachineTests.cs Game.Core.Tests/Services/CombatServiceTests.cs",
      "If attacker and target share the same team/owner, the attack is refused and target HP remains unchanged. Refs: Game.Core.Tests/Services/CombatServiceTests.cs",
      "Player-owned units can damage enemy units or enemy buildings when a valid target is in attack range. Refs: Tests.Godot/tests/Scenes/Combat/test_combat_scene_targeting_range.gd",
      "MG towers can acquire and damage enemy targets, and never damage same-team units or same-team walls. Refs: Tests.Godot/tests/Integration/test_combat_units_towers_walls_flow.gd",
      "Attack damage uses current config/tech-tree-derived stats for the attacker, and stat changes produce corresponding damage changes. Refs: Game.Core.Tests/Services/CombatServiceTests.cs",
      "Automated verification includes unit tests for attack resolution and friendly-fire prevention plus an in-game scenario covering player units, enemies, MG towers, and walls where only enemies are hit. Refs: Game.Core.Tests/Services/CombatServiceTests.cs",
      "CombatSystem provides a shared attack-resolution path for both unit and MG tower attacks, and both paths enforce the same team/owner friendly-fire block before any damage is applied. Refs: Game.Core.Tests/Services/CombatSystemTests.cs",
      "Target acquisition uses in-range detection (physics query or area overlap), so attacks execute only against detected enemy targets in range, while non-detected or out-of-range targets receive no damage. Refs: Tests.Godot/tests/Scenes/Combat/test_combat_scene_targeting_range.gd",
      "Combat resolution contract is locked for all unit and MG tower attacks: emitted combat events include attacker identity/team, target identity/team, resolved damage, and outcome, and contract tests fail on payload field drift.",
      "With identical simulation state and tick timing, combat target selection and damage application order are deterministic across repeated runs, and same-team entities are excluded from damage paths before resolution.",
      "Combat diagnostics are emitted for each target pick and damage/refusal event (including friendly-fire refusals), and dense-engagement regression tests assert those diagnostics are present and consistent."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #20 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 20,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0021",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0011"
    ],
    "taskmaster_exported": false,
    "title": "Lock Windows export profile and Steam runtime startup validation",
    "description": "On top of T11, lock Windows-only export profile and validate Steam runtime startup path for single-player mode.",
    "status": "pending",
    "priority": "P1",
    "layer": "ci",
    "adr_refs": [
      "ADR-0011",
      "ADR-0001"
    ],
    "chapter_refs": [
      "CH07",
      "CH10",
      "CH01"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "ci"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs",
      "Game.Core.Tests/Services/T11BaselineReuseGuardTests.cs",
      "Game.Core.Tests/Services/SteamRuntimeStartupValidationTests.cs",
      "Tests.Godot/tests/Integration/test_windows_startup_steam_runtime.gd",
      "Game.Core.Tests/Tasks/Task21WindowsSteamScopeTests.cs",
      "Game.Core.Tests/Services/WindowsExportProfileLockTests.cs",
      "Game.Core.Tests/Engine/DeterministicCoreLoopRegressionTests.cs",
      "Tests.Godot/tests/Integration/test_csharp_startup_on_godot_451.gd",
      "Game.Core.Tests/Services/ProjectSettingsBaselineTests.cs",
      "Tests.Godot/tests/Scenes/Smoke/test_main_scene_smoke.gd",
      "Tests.Godot/tests/Integration/Security/test_security_http_block_signal.gd",
      "Tests.Godot/tests/Integration/Security/test_security_http_audit.gd"
    ],
    "acceptance": [
      "Validation runs on the existing T11 project root; creating or initializing a new project for this task fails acceptance. Refs: Game.Core.Tests/Services/T11BaselineReuseGuardTests.cs",
      "Windows single-player startup validation must include a launch under Steam runtime context; skipping Steam runtime checks fails acceptance. Refs: Game.Core.Tests/Services/SteamRuntimeStartupValidationTests.cs Tests.Godot/tests/Integration/test_windows_startup_steam_runtime.gd",
      "Taskmaster #21 behavior stays within the PRD lock for Windows export profile locking and Steam runtime startup-path validation. Refs: Game.Core.Tests/Tasks/Task21WindowsSteamScopeTests.cs Game.Core.Tests/Services/WindowsExportProfileLockTests.cs",
      "Referenced automated tests pass on Windows using the reused Godot+C# baseline from T11. Refs: Tests.Godot/tests/Integration/test_windows_startup_steam_runtime.gd",
      "No regression is observed in deterministic simulation and core loop constraints after applying this task on the T11 baseline. Refs: Game.Core.Tests/Engine/DeterministicCoreLoopRegressionTests.cs",
      "The reused T11 project opens in Godot 4.5.1 with C# enabled and without C# project initialization errors. Refs: Tests.Godot/tests/Integration/test_csharp_startup_on_godot_451.gd",
      "On the reused baseline, project settings keep application/config/name=\"LASTKING\" and application/run/main_scene=\"res://scenes/Main.tscn\". Refs: Game.Core.Tests/Services/ProjectSettingsBaselineTests.cs",
      "On the reused baseline, project settings keep display/window/size/width=1920 and display/window/size/height=1080. Refs: Game.Core.Tests/Services/ProjectSettingsBaselineTests.cs",
      "Export presets include Windows Desktop (64-bit) and a Steam App ID placeholder or real appid for single-player runtime launch validation. Refs: Game.Core.Tests/Services/WindowsExportProfileLockTests.cs",
      "Non-Windows export targets are disabled or absent; any enabled non-Windows target fails acceptance. Refs: Game.Core.Tests/Services/WindowsExportProfileLockTests.cs",
      "Required baseline folders for scripts, scenes, configs, saves, assets, ui, and audio remain present for Windows startup validation. Refs: Game.Core.Tests/Services/T11BaselineReuseGuardTests.cs",
      "Main scene at res://scenes/Main.tscn starts on Windows without startup errors and emits console output containing \"Project setup complete\" from attached C# logic. Refs: Tests.Godot/tests/Scenes/Smoke/test_main_scene_smoke.gd",
      ".NET SDK/toolchain is compatible with Godot 4.5.1 C# and successfully builds/runs the validated Windows startup path. Refs: Tests.Godot/tests/Integration/test_csharp_startup_on_godot_451.gd",
      "Scope boundary is enforced: this task validates Windows export and Steam runtime on the T11 baseline only; project re-bootstrap fails acceptance. Refs: Game.Core.Tests/Tasks/Task21WindowsSteamScopeTests.cs Game.Core.Tests/Services/T11BaselineReuseGuardTests.cs",
      "Steam runtime hard gate: at least one Windows export launch under Steam runtime context (real appid or Steam launch stub) reaches startup without Steam-blocking integration errors. Refs: Game.Core.Tests/Services/SteamRuntimeStartupValidationTests.cs Tests.Godot/tests/Integration/test_windows_startup_steam_runtime.gd",
      "Single-player isolation hard gate: startup path does not require backend or multiplayer services; any launch-time online dependency requirement fails acceptance. Refs: Tests.Godot/tests/Integration/Security/test_security_http_block_signal.gd",
      "Steam runtime startup-path validation includes auditable evidence of Steam-context launch and successful startup entry. Refs: Tests.Godot/tests/Integration/Security/test_security_http_audit.gd"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #21 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 21,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0022",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0021"
    ],
    "taskmaster_exported": false,
    "title": "Implement Camera and Interaction System with Edge and Keyboard Scrolling",
    "description": "Develop camera controls for edge scrolling and keyboard-based scrolling in the game world.",
    "status": "pending",
    "priority": "P1",
    "layer": "adapter",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "adapter"
    ],
    "test_refs": [
      "Tests.Godot/tests/UI/test_hud_scene.gd",
      "Tests.Godot/tests/Scenes/Camera/test_camera_controller_scroll_inputs.gd",
      "Tests.Godot/tests/Scenes/Camera/test_main_scene_camera_wiring.gd",
      "Tests.Godot/tests/Scenes/Camera/test_camera_controller_delta_speed_and_bounds.gd"
    ],
    "acceptance": [
      "Taskmaster #22 delivers a playable camera control system where both edge scrolling and keyboard scrolling are implemented for world navigation. Refs: Tests.Godot/tests/Scenes/Camera/test_camera_controller_scroll_inputs.gd Tests.Godot/tests/Scenes/Camera/test_main_scene_camera_wiring.gd",
      "Referenced automated tests pass on Windows Godot+C# baseline and verify edge scrolling, keyboard scrolling, and world-boundary clamping behaviors. Refs: Tests.Godot/tests/Scenes/Camera/test_camera_controller_scroll_inputs.gd Tests.Godot/tests/Scenes/Camera/test_camera_controller_delta_speed_and_bounds.gd",
      "Camera scrolling logic does not regress core loop behavior: with no scroll input camera position remains unchanged, and with sustained scroll input updates remain responsive without observable stutter. Refs: Tests.Godot/tests/Scenes/Camera/test_camera_controller_scroll_inputs.gd Tests.Godot/tests/Scenes/Camera/test_camera_controller_delta_speed_and_bounds.gd",
      "When the mouse cursor enters a configurable edge margin near each viewport border, the camera moves in the corresponding world direction; when the cursor is outside all edge margins and no scroll keys are pressed, camera position does not change. Refs: Tests.Godot/tests/Scenes/Camera/test_camera_controller_scroll_inputs.gd",
      "Pressing scroll actions mapped to Arrow keys and WASD moves the camera in the expected cardinal directions, and releasing those keys stops keyboard-driven scrolling. Refs: Tests.Godot/tests/Scenes/Camera/test_camera_controller_scroll_inputs.gd",
      "Camera translation is smooth and frame-rate independent, with movement scaled by delta time and a configurable scroll speed value that can be adjusted without code changes. Refs: Tests.Godot/tests/Scenes/Camera/test_camera_controller_delta_speed_and_bounds.gd",
      "Camera movement is clamped to configured world boundaries so the visible area cannot be scrolled beyond map limits on any side. Refs: Tests.Godot/tests/Scenes/Camera/test_camera_controller_delta_speed_and_bounds.gd",
      "Edge scrolling and keyboard scrolling can both be active in the same frame without input loss, and resulting movement remains continuous. Refs: Tests.Godot/tests/Scenes/Camera/test_camera_controller_scroll_inputs.gd",
      "A CameraController with an active Camera2D is present in the playable scene, and camera movement is applied through that camera. Refs: Tests.Godot/tests/Scenes/Camera/test_main_scene_camera_wiring.gd",
      "With default configuration, entering within 20 pixels of any viewport edge triggers movement toward that edge, and scroll input is read through Godot Input plus viewport mouse-position events. Refs: Tests.Godot/tests/Scenes/Camera/test_camera_controller_scroll_inputs.gd",
      "A camera movement contract defines scroll speed, edge-margin threshold, bounds clamping invariants, and lock-state interaction rules; contract tests fail if movement occurs while locked or if movement exceeds configured bounds.",
      "Runtime behavior is state-aware: in active state, edge and keyboard inputs move the camera continuously; in paused state, the same inputs do not change camera position, and bounds invariants remain satisfied.",
      "Camera state diagnostics are emitted for movement-mode transitions (idle, edge, keyboard, combined, locked), and regression checks verify consistent transition behavior with no boundary escape under repeated input sequences."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #22 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 22,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0023",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0021"
    ],
    "taskmaster_exported": false,
    "title": "Develop Runtime Speed Controls (Pause, 1x, 2x) with Timer Freeze",
    "description": "Implement game speed controls including pause, 1x, and 2x speeds, ensuring all timers freeze during pause.",
    "status": "pending",
    "priority": "P1",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Game.Core.Tests/Services/RuntimeSpeedControllerTests.cs",
      "Tests.Godot/tests/UI/test_speed_controls_buttons_apply_speed.gd",
      "Tests.Godot/tests/Integration/test_runtime_speed_progression_order.gd",
      "Game.Core.Tests/Services/GameplayProgressionRateTests.cs",
      "Game.Core.Tests/Services/CountdownSchedulerPauseTests.cs",
      "Tests.Godot/tests/Scenes/Runtime/test_nodes_process_mode_pause_resume.gd",
      "Tests.Godot/tests/Integration/test_game_manager_singleton_speed_modes.gd"
    ],
    "acceptance": [
      "交付范围仅包含 Pause、1x、2x 三态速度控制与暂停冻结计时，不以其他机制替代，也不增加额外速度档位。 Refs: Game.Core.Tests/Services/RuntimeSpeedControllerTests.cs Tests.Godot/tests/UI/test_speed_controls_buttons_apply_speed.gd",
      "在 Windows Godot+C# 基线环境中，任务引用的自动化测试必须全部通过。 Refs: Tests.Godot/tests/Integration/test_runtime_speed_progression_order.gd",
      "在相同输入与初始状态下，除时间倍率导致的推进快慢差异外，核心玩法规则与状态转移结果保持一致。 Refs: Game.Core.Tests/Services/GameplayProgressionRateTests.cs",
      "触发 Pause 后，运行时速度立即为 0x，且同一观察窗口内可验证玩法进度不再推进。 Refs: Game.Core.Tests/Services/RuntimeSpeedControllerTests.cs Tests.Godot/tests/Integration/test_runtime_speed_progression_order.gd",
      "触发 1x 后，运行时速度立即为 1x，且玩法推进速率回到基线速率。 Refs: Game.Core.Tests/Services/RuntimeSpeedControllerTests.cs Tests.Godot/tests/Integration/test_runtime_speed_progression_order.gd",
      "触发 2x 后，运行时速度立即为 2x，且相同墙钟时长内的玩法推进量严格大于 1x。 Refs: Game.Core.Tests/Services/GameplayProgressionRateTests.cs Tests.Godot/tests/Integration/test_runtime_speed_progression_order.gd",
      "Pause 激活期间，所有活动倒计时与已入队倒计时（含波次倒计时）均停止递减，且不会在暂停中完成。 Refs: Game.Core.Tests/Services/CountdownSchedulerPauseTests.cs Tests.Godot/tests/Integration/test_runtime_speed_progression_order.gd",
      "从 Pause 恢复后，暂停前已存在的倒计时从暂停瞬间的剩余值继续，不重置且不跳段。 Refs: Game.Core.Tests/Services/CountdownSchedulerPauseTests.cs",
      "界面必须提供 Pause、1x、2x 三个可交互按钮；每次点击都在同次交互内更新当前速度并生效。 Refs: Tests.Godot/tests/UI/test_speed_controls_buttons_apply_speed.gd",
      "被配置为随玩法暂停的节点在 Pause 期间停止处理，恢复后继续处理。 Refs: Tests.Godot/tests/Scenes/Runtime/test_nodes_process_mode_pause_resume.gd",
      "当当前为 Pause 时，直接点击 1x 或 2x 会清除暂停态并立即应用所选倍率。 Refs: Game.Core.Tests/Services/RuntimeSpeedControllerTests.cs Tests.Godot/tests/UI/test_speed_controls_buttons_apply_speed.gd",
      "Pause 期间即使墙钟时间持续流逝，自定义计时器剩余值保持不变；恢复后从该精确值继续。 Refs: Game.Core.Tests/Services/CountdownSchedulerPauseTests.cs Tests.Godot/tests/Integration/test_runtime_speed_progression_order.gd",
      "任意时刻 Pause、1x、2x 仅允许一个激活态，且观测到的实际推进速率与激活态一致。 Refs: Game.Core.Tests/Services/RuntimeSpeedControllerTests.cs Tests.Godot/tests/Integration/test_runtime_speed_progression_order.gd",
      "在持续 Pause 且未发生新的速度输入时，多次墙钟采样得到的玩法进度值必须完全相同。 Refs: Tests.Godot/tests/Integration/test_runtime_speed_progression_order.gd",
      "在相同初始条件与相同墙钟区间下，2x 模式的倒计时减少量必须严格大于 1x。 Refs: Game.Core.Tests/Services/CountdownSchedulerPauseTests.cs Tests.Godot/tests/Integration/test_runtime_speed_progression_order.gd",
      "运行中按 1x -> 2x -> 1x 连续切换时，每次切换立即生效，且进行中的倒计时不被重置。 Refs: Game.Core.Tests/Services/RuntimeSpeedControllerTests.cs Game.Core.Tests/Services/CountdownSchedulerPauseTests.cs",
      "Pause 激活且未恢复前，每个被跟踪的自定义倒计时剩余值保持恒定，直到解除 Pause 或显式选速。 Refs: Game.Core.Tests/Services/CountdownSchedulerPauseTests.cs",
      "若通过取消 Pause 恢复且期间未新选 1x/2x，则恢复到最近一次非零速度并与该速度的推进速率一致。 Refs: Game.Core.Tests/Services/RuntimeSpeedControllerTests.cs",
      "相同初始条件与墙钟时长下，观测到的玩法进度和倒计时减少量满足严格顺序：2x > 1x > Pause(0x)。 Refs: Game.Core.Tests/Services/GameplayProgressionRateTests.cs Tests.Godot/tests/Integration/test_runtime_speed_progression_order.gd",
      "无论倒计时在 Pause 前已入队还是 Pause 中新入队，Pause 期间均不推进；恢复后按保存的排队顺序与剩余值继续执行，不重置、不提前完成。 Refs: Game.Core.Tests/Services/CountdownSchedulerPauseTests.cs Tests.Godot/tests/Integration/test_runtime_speed_progression_order.gd",
      "Obligation lock O2: Create a GameManager singleton to manage game state and speed is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Tests.Godot/tests/Integration/test_game_manager_singleton_speed_modes.gd Game.Core.Tests/Services/RuntimeSpeedControllerTests.cs",
      "Obligation lock O3: Implement pause functionality that sets Engine.TimeScale to 0 and freezes all custom timers is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Tests.Godot/tests/Integration/test_game_manager_singleton_speed_modes.gd Game.Core.Tests/Services/CountdownSchedulerPauseTests.cs",
      "Obligation lock O4: For 1x and 2x speeds, set TimeScale to 1 and 2 respectively is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Tests.Godot/tests/Integration/test_game_manager_singleton_speed_modes.gd Game.Core.Tests/Services/RuntimeSpeedControllerTests.cs",
      "Obligation lock O6: Use Godot's ProcessMode to handle pausing of nodes is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Tests.Godot/tests/Scenes/Runtime/test_nodes_process_mode_pause_resume.gd",
      "每次速度状态变更（Pause/1x/2x）都必须产出可排序时间线证据，至少包含变更前状态、变更后状态、生效时刻与触发来源；任一字段缺失即判定不通过。",
      "在相同初始状态、相同输入序列与相同随机种子下重放速度切换，时间线锚点（切换顺序、倒计时完成顺序、关键进度里程碑）必须一致；出现锚点漂移即判定不通过。",
      "回归与门禁检查必须读取并校验上述速度时间线证据；若证据未生成、不可读取或与观测状态不一致，则验收失败。"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #23 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 23,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0024",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0021"
    ],
    "taskmaster_exported": false,
    "title": "Create UI Feedback System for Invalid Actions and Errors",
    "description": "Implement UI feedback for invalid placement, blocked actions, and migration/load errors with clear user-facing messages.",
    "status": "pending",
    "priority": "P2",
    "layer": "adapter",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "adapter"
    ],
    "test_refs": [
      "Tests.Godot/tests/UI/test_hud_scene.gd",
      "Tests.Godot/tests/UI/test_hud_action_feedback.gd",
      "Tests.Godot/tests/UI/test_hud_error_dialog.gd",
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Game.Core.Tests/Services/ScoreServiceTests.cs",
      "Tests.Godot/tests/UI/test_hud_feedback_timeout.gd",
      "Tests.Godot/tests/Integration/test_gameplay_action_rejection_state_invariant.gd",
      "Tests.Godot/tests/Integration/test_load_failure_feedback_flow.gd",
      "Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "Tests.Godot/tests/Adapters/test_event_bus_adapter.gd"
    ],
    "acceptance": [
      "Taskmaster #24 delivers user-facing UI feedback for all required scenarios: invalid placement, blocked actions, and migration/load failures. Refs: Tests.Godot/tests/UI/test_hud_action_feedback.gd Tests.Godot/tests/UI/test_hud_error_dialog.gd",
      "Automated tests that exercise invalid placement, blocked actions, and migration/load failure feedback pass on the Windows Godot+C# baseline. Refs: Tests.Godot/tests/UI/test_hud_action_feedback.gd Tests.Godot/tests/UI/test_hud_error_dialog.gd",
      "For valid actions, deterministic simulation outputs and core-loop state transitions remain unchanged after this change. Refs: Game.Core.Tests/State/GameStateMachineTests.cs Game.Core.Tests/Services/ScoreServiceTests.cs",
      "When placement is invalid (including blocked placement or invalid terrain), the gameplay UI shows a temporary human-readable message (for example, \"Cannot build here.\"), and that message auto-hides after a short timeout. Refs: Tests.Godot/tests/UI/test_hud_action_feedback.gd Tests.Godot/tests/UI/test_hud_feedback_timeout.gd",
      "When an action is blocked, the UI feedback includes the concrete blocking reason, and the blocked action is refused without changing game state. Refs: Tests.Godot/tests/UI/test_hud_action_feedback.gd Tests.Godot/tests/Integration/test_gameplay_action_rejection_state_invariant.gd",
      "When migration or load fails (including corrupted save input), a persistent error dialog is shown with error details and remains visible until the user dismisses it. Refs: Tests.Godot/tests/UI/test_hud_error_dialog.gd Tests.Godot/tests/Integration/test_load_failure_feedback_flow.gd",
      "Temporary feedback is non-intrusive: while visible, it does not block normal gameplay interaction. Refs: Tests.Godot/tests/UI/test_hud_action_feedback.gd",
      "Feedback display is event-driven: invalid placement, blocked action, and migration/load error events each trigger their corresponding UI feedback output. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd Tests.Godot/tests/Adapters/test_event_bus_adapter.gd",
      "On an invalid placement attempt, placement is refused and no new entity is committed to game state while the temporary feedback is shown. Refs: Tests.Godot/tests/Integration/test_gameplay_action_rejection_state_invariant.gd Tests.Godot/tests/UI/test_hud_action_feedback.gd",
      "The migration/load error dialog is dismissible only by explicit user action and does not auto-hide. Refs: Tests.Godot/tests/UI/test_hud_error_dialog.gd",
      "For blocked actions and migration/load failures, the displayed message content reflects the concrete triggering reason/details rather than a generic placeholder. Refs: Tests.Godot/tests/UI/test_hud_action_feedback.gd Tests.Godot/tests/UI/test_hud_error_dialog.gd",
      "Temporary feedback content for invalid placement is human-readable and non-empty in the active gameplay UI (not only logs/internal codes). Refs: Tests.Godot/tests/UI/test_hud_action_feedback.gd",
      "A timing check confirms temporary feedback is hidden after its configured short timeout and remains hidden unless a new triggering event occurs. Refs: Tests.Godot/tests/UI/test_hud_feedback_timeout.gd",
      "The persistent migration/load error dialog exposes an explicit dismiss control, and using it closes the dialog and returns normal UI control. Refs: Tests.Godot/tests/UI/test_hud_error_dialog.gd Tests.Godot/tests/Integration/test_load_failure_feedback_flow.gd",
      "Obligation lock O11: Use Godot's Control nodes for UI is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Tests.Godot/tests/UI/test_hud_scene.gd",
      "Obligation lock O12: Design a UIFeedbackManager that displays messages via a label or popup is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Tests.Godot/tests/UI/test_hud_action_feedback.gd Tests.Godot/tests/UI/test_hud_error_dialog.gd",
      "Invalid-action feedback contract enumerates reason codes and i18n message keys, and contract tests fail when any supported reason code lacks a mapped message key.",
      "UI feedback resolution uses reason-code-to-message-key mapping so locale changes alter displayed text without changing trigger conditions or reason semantics.",
      "Runtime feedback dispatch applies deterministic priority rules for competing feedback events, and identical event sequences always produce the same visible feedback outcome.",
      "Runtime feedback dispatch de-duplicates repeated feedback events with the same reason/details within the configured dedup scope so duplicate concurrent messages/dialogs are not shown.",
      "Regression tests cover repeated invalid placements, blocked actions, and load/migration failures to verify stable feedback behavior across repeated errors.",
      "Feedback diagnostics include reason code and resolved message key/details for blocked actions and migration/load failures so troubleshooting can correlate UI output with triggering cause.",
      "Localization checks verify that required feedback paths render non-empty localized user-facing text for active locales rather than raw/internal reason codes."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #24 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 24,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0025",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0021"
    ],
    "taskmaster_exported": false,
    "title": "Build Save System with Autosave and Migration Handling",
    "description": "Develop a save system with one autosave slot, start-of-day autosaves, and migration for invalid configs/loads.",
    "status": "pending",
    "priority": "P1",
    "layer": "adapter",
    "adr_refs": [
      "ADR-0006",
      "ADR-0008",
      "ADR-0011"
    ],
    "chapter_refs": [
      "CH05",
      "CH10",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "adapter"
    ],
    "test_refs": [
      "Tests.Godot/tests/Integration/test_backup_restore_savegame.gd",
      "Tests.Godot/tests/Adapters/Save/test_save_manager_autosave_slot_path.gd",
      "Tests.Godot/tests/Adapters/Db/test_savegame_update_overwrite_cross_restart.gd",
      "Tests.Godot/tests/Adapters/Save/test_save_manager_daystart_autosave.gd",
      "Tests.Godot/tests/Adapters/Db/test_savegame_persistence_cross_restart.gd",
      "Tests.Godot/tests/Adapters/Save/test_save_manager_roundtrip_state_seed_wave.gd",
      "Game.Core.Tests/State/SavePayloadSerializationTests.cs",
      "Tests.Godot/tests/Adapters/Save/test_save_manager_load_failures_feedback.gd",
      "Tests.Godot/tests/Adapters/Db/test_savegame_upsert_rollback.gd",
      "Tests.Godot/tests/Adapters/Save/test_save_manager_version_migration_guard.gd",
      "Tests.Godot/tests/Adapters/Save/test_save_manager_contract_save_load.gd"
    ],
    "acceptance": [
      "Every save operation writes only to the single autosave slot at user://autosave.save (Windows-safe user path); writing to any alternate slot path fails acceptance. Refs: Tests.Godot/tests/Adapters/Save/test_save_manager_autosave_slot_path.gd",
      "From the second save onward, saving deterministically overwrites user://autosave.save and creates no additional save-slot files. Refs: Tests.Godot/tests/Adapters/Db/test_savegame_update_overwrite_cross_restart.gd",
      "Each in-game day-start event causes exactly one autosave write attempt. Refs: Tests.Godot/tests/Adapters/Save/test_save_manager_daystart_autosave.gd",
      "Across repeated day-start events, autosave keeps targeting the same autosave path and never creates extra slot files. Refs: Tests.Godot/tests/Adapters/Save/test_save_manager_daystart_autosave.gd Tests.Godot/tests/Adapters/Save/test_save_manager_autosave_slot_path.gd",
      "Loading a valid autosave applies persisted game state, seed, and wave timer to runtime state. Refs: Tests.Godot/tests/Adapters/Db/test_savegame_persistence_cross_restart.gd",
      "A valid save-then-load round trip restores game state, seed, and wave timer exactly to the values captured at save time. Refs: Tests.Godot/tests/Adapters/Save/test_save_manager_roundtrip_state_seed_wave.gd Game.Core.Tests/State/SavePayloadSerializationTests.cs",
      "If no autosave file exists, load returns a deterministic failure result, shows explicit user feedback, and leaves runtime state unchanged. Refs: Tests.Godot/tests/Adapters/Save/test_save_manager_load_failures_feedback.gd",
      "If save-file read or write I/O fails, the operation returns a deterministic failure result with explicit user feedback and no crash; for load failure, runtime state remains unchanged. Refs: Tests.Godot/tests/Adapters/Db/test_savegame_upsert_rollback.gd",
      "If save content is invalid or corrupt, load fails with explicit user feedback and applies no partial runtime state. Refs: Tests.Godot/tests/Adapters/Save/test_save_manager_load_failures_feedback.gd",
      "The serialized save payload includes a version field and all persisted runtime fields needed to restore game state, seed, and wave timer. Refs: Tests.Godot/tests/Adapters/Save/test_save_manager_roundtrip_state_seed_wave.gd",
      "On load, version compatibility is validated before any persisted field mutates runtime state. Refs: Tests.Godot/tests/Adapters/Save/test_save_manager_version_migration_guard.gd",
      "If the save version is incompatible with the current version, load is rejected, a user-visible migration error reason is shown, and runtime state remains unchanged. Refs: Tests.Godot/tests/Adapters/Save/test_save_manager_version_migration_guard.gd",
      "Save and load use one selected serialization format (JSON or binary) consistently for this autosave file. Refs: Game.Core.Tests/State/SavePayloadSerializationTests.cs",
      "If deserialization fails for the selected format, load reports explicit failure and applies no runtime state changes. Refs: Tests.Godot/tests/Adapters/Save/test_save_manager_load_failures_feedback.gd Game.Core.Tests/State/SavePayloadSerializationTests.cs",
      "SaveManager save/load ownership is proven by deterministic verification covering valid roundtrip, missing file, I/O failure, corruption, and version mismatch, with audit evidence containing required fields for each path. Refs: Tests.Godot/tests/Adapters/Save/test_save_manager_contract_save_load.gd",
      "On the first in-match day-start autosave trigger, user://autosave.save is created; missing creation fails acceptance with auditable test or log evidence. Refs: Tests.Godot/tests/Adapters/Save/test_save_manager_daystart_autosave.gd"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #25 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 25,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0026",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0025"
    ],
    "taskmaster_exported": false,
    "title": "Integrate Steam Cloud Save with Account Binding",
    "description": "Implement Steam cloud save functionality using Steam account binding for save data synchronization.",
    "status": "pending",
    "priority": "P2",
    "layer": "adapter",
    "adr_refs": [
      "ADR-0006",
      "ADR-0008",
      "ADR-0011"
    ],
    "chapter_refs": [
      "CH05",
      "CH10",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "adapter"
    ],
    "test_refs": [
      "Tests.Godot/tests/Integration/test_backup_restore_savegame.gd",
      "Tests.Godot/tests/Integration/test_save_manager_steam_cloud_sync_flow.gd",
      "Tests.Godot/tests/Integration/test_steam_remote_storage_real_ops.gd",
      "Game.Core.Tests/Engine/DeterministicSimulationLoopTests.cs",
      "Game.Core.Tests/Services/SaveManagerWorkflowTests.cs",
      "Tests.Godot/tests/Adapters/Steam/test_steam_cloud_upload_on_save_trigger.gd",
      "Tests.Godot/tests/Adapters/Db/test_savegame_persistence_cross_restart.gd",
      "Game.Core.Tests/Services/CloudSaveConflictResolverTests.cs",
      "Tests.Godot/tests/UI/test_save_conflict_prompt_blocks_overwrite.gd",
      "Tests.Godot/tests/Adapters/Db/test_savegame_upsert_rollback.gd",
      "Tests.Godot/tests/Adapters/Db/test_savegame_unique_slot_per_user.gd",
      "Tests.Godot/tests/Adapters/Db/test_savegame_repository.gd",
      "Tests.Godot/tests/UI/test_save_conflict_prompt_branch_selection.gd",
      "Tests.Godot/tests/Adapters/Steam/test_steam_api_binding_remote_storage.gd"
    ],
    "acceptance": [
      "Taskmaster #26 behavior matches PRD lock for Integrate Steam Cloud Save with Account Binding. Refs: Tests.Godot/tests/Integration/test_save_manager_steam_cloud_sync_flow.gd Tests.Godot/tests/Integration/test_steam_remote_storage_real_ops.gd",
      "Referenced automated tests pass on Windows Godot+C# baseline. Refs: Tests.Godot/tests/Integration/test_save_manager_steam_cloud_sync_flow.gd",
      "No regression on deterministic simulation and core loop constraints. Refs: Game.Core.Tests/Engine/DeterministicSimulationLoopTests.cs Game.Core.Tests/Services/SaveManagerWorkflowTests.cs",
      "When a Steam development account is logged in, triggering save through the existing SaveManager uploads the active save file to Steam Cloud and reports a successful upload result. Refs: Tests.Godot/tests/Adapters/Steam/test_steam_cloud_upload_on_save_trigger.gd Tests.Godot/tests/Integration/test_save_manager_steam_cloud_sync_flow.gd",
      "After a successful cloud upload, restarting the game and loading the same profile restores save data from Steam Cloud, and the loaded data matches the previously uploaded save content. Refs: Tests.Godot/tests/Adapters/Db/test_savegame_persistence_cross_restart.gd",
      "If local and cloud save versions conflict, the game blocks automatic overwrite and shows a user choice prompt before deciding which version to load. Refs: Game.Core.Tests/Services/CloudSaveConflictResolverTests.cs Tests.Godot/tests/UI/test_save_conflict_prompt_blocks_overwrite.gd",
      "If upload or download fails due to network/API/unavailable cloud conditions, the failure is surfaced to the user and the pre-existing local save file remains unchanged. Refs: Tests.Godot/tests/Adapters/Db/test_savegame_upsert_rollback.gd",
      "Save data is bound to the current Steam account identity, and cloud operations only read/write that account's cloud save scope. Refs: Tests.Godot/tests/Adapters/Db/test_savegame_unique_slot_per_user.gd",
      "Steam Cloud integration remains compatible with the current SaveManager workflow, and local save/load continues to work when Steam Cloud is unavailable. Refs: Tests.Godot/tests/Adapters/Db/test_savegame_repository.gd",
      "In a Steam development environment, downloading cloud save data to a clean local target after upload restores the same profile state with no missing persisted fields. Refs: Tests.Godot/tests/Integration/test_backup_restore_savegame.gd",
      "When a local-vs-cloud conflict prompt is shown, choosing the local option loads local data for that operation without automatic cloud overwrite, and choosing the cloud option loads cloud data for that operation. Refs: Game.Core.Tests/Services/CloudSaveConflictResolverTests.cs Tests.Godot/tests/UI/test_save_conflict_prompt_branch_selection.gd",
      "When no valid Steam login is present, cloud sync is explicitly skipped with user-visible status, and SaveManager local save/load still completes successfully without save corruption. Refs: Tests.Godot/tests/Adapters/Db/test_savegame_repository.gd",
      "Cloud sync calls are executed against Steam API integration (Steamworks.NET or GodotSteam) in the Steam development environment, and are verifiable as real Steam Remote Storage operations for the logged-in Steam account (not local-only mock behavior). Refs: Tests.Godot/tests/Integration/test_steam_remote_storage_real_ops.gd Tests.Godot/tests/Adapters/Steam/test_steam_api_binding_remote_storage.gd",
      "Cloud-save binding enforces a single auto-save slot identity per Steam account, so operations for one account cannot create, read, or overwrite another account's slot.",
      "Cloud sync validates deterministic save metadata and ownership before apply; if ownership does not match the logged-in Steam account, the cloud payload is rejected and local save state remains unchanged.",
      "Regression coverage includes upload, download, conflict, and failure-recovery paths, and each failure path emits structured save-sync diagnostics with enough evidence to verify deterministic recovery or explicit rejection."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #26 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 26,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0027",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0021"
    ],
    "taskmaster_exported": false,
    "title": "Implement Achievements System with Deterministic Unlocking",
    "description": "Create an achievements system with a visible list, non-hidden achievements, and deterministic unlock triggers.",
    "status": "pending",
    "priority": "P2",
    "layer": "adapter",
    "adr_refs": [
      "ADR-0006",
      "ADR-0008",
      "ADR-0011"
    ],
    "chapter_refs": [
      "CH05",
      "CH10",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "adapter"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Game.Core.Tests/Tasks/Task27DeterministicUnlockFlowTests.cs",
      "Tests.Godot/tests/Integration/test_achievements_end_to_end_unlock_and_sync.gd",
      "Game.Core.Tests/Engine/CoreLoopDeterminismRegressionTests.cs",
      "Game.Core.Tests/Services/AchievementDefinitionLoaderTests.cs",
      "Game.Core.Tests/Repositories/AchievementConfigRepositoryTests.cs",
      "Game.Core.Tests/State/AchievementStateInitializationTests.cs",
      "Tests.Godot/tests/UI/test_achievements_list_visible_on_session_start.gd",
      "Game.Core.Tests/Services/AchievementDeterministicUnlockingTests.cs",
      "Tests.Godot/tests/Integration/test_achievements_deterministic_replay_unlock_order.gd",
      "Game.Core.Tests/Services/AchievementUnlockIdempotencyTests.cs",
      "Tests.Godot/tests/UI/test_achievements_unlock_notification_once.gd",
      "Game.Core.Tests/Services/AchievementInvalidTriggerTests.cs",
      "Tests.Godot/tests/UI/test_achievements_locked_on_invalid_event.gd",
      "Game.Core.Tests/Tasks/Task27SingleCoordinatorOwnershipTests.cs"
    ],
    "acceptance": [
      "Taskmaster #27 behavior matches the PRD lock for Implement Achievements System with Deterministic Unlocking. Refs: Game.Core.Tests/Tasks/Task27DeterministicUnlockFlowTests.cs Tests.Godot/tests/Integration/test_achievements_end_to_end_unlock_and_sync.gd",
      "Referenced automated tests for this task pass on the Windows Godot+C# baseline. Refs: Tests.Godot/tests/Integration/test_achievements_end_to_end_unlock_and_sync.gd",
      "Deterministic simulation and core loop constraints remain unchanged with no regression introduced by this task. Refs: Game.Core.Tests/Engine/CoreLoopDeterminismRegressionTests.cs",
      "At startup, achievement definitions are loaded from configuration, and each loaded definition provides an ID, name, description, and unlock condition. Refs: Game.Core.Tests/Services/AchievementDefinitionLoaderTests.cs Game.Core.Tests/Repositories/AchievementConfigRepositoryTests.cs",
      "Before any unlock condition is satisfied, all configured achievements are present as visible (non-hidden) entries. Refs: Game.Core.Tests/State/AchievementStateInitializationTests.cs Tests.Godot/tests/UI/test_achievements_list_visible_on_session_start.gd",
      "Given the same ordered game-event sequence across repeated runs, the same achievement IDs unlock at the same trigger points, and no additional achievements unlock. Refs: Game.Core.Tests/Services/AchievementDeterministicUnlockingTests.cs Tests.Godot/tests/Integration/test_achievements_deterministic_replay_unlock_order.gd",
      "Processing an already unlocked achievement ID does not produce duplicate unlock state transitions, duplicate notifications, or duplicate persistence/sync writes. Refs: Game.Core.Tests/Services/AchievementUnlockIdempotencyTests.cs Tests.Godot/tests/UI/test_achievements_unlock_notification_once.gd",
      "If Steamworks integration is enabled, unlocking a valid achievement updates Steam achievement state and stores stats; if disabled, local unlock state and UI flow still complete without external API dependency. Refs: Tests.Godot/tests/Integration/test_achievements_end_to_end_unlock_and_sync.gd",
      "After configuration load, every configured achievement ID has tracked state initialized to locked until its unlock condition is met. Refs: Game.Core.Tests/State/AchievementStateInitializationTests.cs",
      "Events or unlock requests that do not map to a valid, currently unlockable achievement leave unlock state unchanged and emit no notification or external sync call. Refs: Game.Core.Tests/Services/AchievementInvalidTriggerTests.cs Tests.Godot/tests/UI/test_achievements_locked_on_invalid_event.gd",
      "Obligation lock O1: A single AchievementManager (or equivalent sole coordinator) must own achievement progress tracking and unlock orchestration. Refs: Game.Core.Tests/Tasks/Task27SingleCoordinatorOwnershipTests.cs",
      "Obligation lock O2: Achievement definitions must load from external configuration files (JSON or equivalent), and code hardcoding cannot be the only data source. Refs: Game.Core.Tests/Repositories/AchievementConfigRepositoryTests.cs Game.Core.Tests/Services/AchievementDefinitionLoaderTests.cs",
      "Obligation lock O10: Automated test gates must explicitly cover unlock trigger plus UI update, achievements list presentation, deterministic repeat actions, and Steam verification when enabled on Windows baseline. Refs: Tests.Godot/tests/Integration/test_achievements_end_to_end_unlock_and_sync.gd"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #27 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 27,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0028",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0021"
    ],
    "taskmaster_exported": false,
    "title": "Set Up Localization (i18n) for zh-CN and en-US",
    "description": "Implement key-based internationalization workflow supporting zh-CN and en-US at launch.",
    "status": "pending",
    "priority": "P2",
    "layer": "ci",
    "adr_refs": [
      "ADR-0006",
      "ADR-0008",
      "ADR-0011"
    ],
    "chapter_refs": [
      "CH05",
      "CH10",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "ci"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Game.Core.Tests/Tasks/Task28LocalizationScopeLockTests.cs",
      "Tests.Godot/tests/Integration/test_i18n_full_behavior_sweep.gd",
      "Game.Core.Tests/Engine/CoreLoopDeterminismLocalizationTests.cs",
      "Tests.Godot/tests/UI/test_settings_locale.gd",
      "Tests.Godot/tests/Integration/test_settings_event_integration.gd",
      "Game.Core.Tests/Services/LocalizationManagerTests.cs",
      "Tests.Godot/tests/UI/test_settings_locale_persist.gd",
      "Tests.Godot/tests/Adapters/Config/test_settings_persistence.gd",
      "Game.Core.Tests/Services/LocalizationLocaleValidationTests.cs",
      "Tests.Godot/tests/UI/test_settings_locale_unsupported_rejected.gd",
      "Game.Core.Tests/Tasks/Task28LocalizationKeyStabilityTests.cs",
      "Tests.Godot/tests/Integration/test_locale_resource_load_guard.gd"
    ],
    "acceptance": [
      "Taskmaster #28 scope-lock validation passes, confirming delivered behavior is limited to key-based i18n setup for zh-CN and en-US. Refs: Game.Core.Tests/Tasks/Task28LocalizationScopeLockTests.cs",
      "All automated tests linked to Task #28 pass on the Windows Godot + C# baseline. Refs: Tests.Godot/tests/Integration/test_i18n_full_behavior_sweep.gd",
      "With identical gameplay inputs, localization changes do not alter deterministic simulation/core-loop outputs except localized text rendering. Refs: Game.Core.Tests/Engine/CoreLoopDeterminismLocalizationTests.cs",
      "Selecting en-US or zh-CN loads the corresponding locale resource and resolves the same key (for example, UI_PAUSE) to locale-correct text for that locale. Refs: Tests.Godot/tests/UI/test_settings_locale.gd",
      "A settings control allows language switching at runtime, and changing it refreshes already-visible localized UI text within the same running session. Refs: Tests.Godot/tests/UI/test_settings_locale.gd Tests.Godot/tests/Integration/test_settings_event_integration.gd",
      "When the active locale lacks a key, rendered output falls back to the key literal itself (for example, MISSING_KEY renders as \"MISSING_KEY\"). Refs: Game.Core.Tests/Services/LocalizationManagerTests.cs",
      "After selecting en-US or zh-CN, the language preference is persisted to config and automatically restored on next launch. Refs: Tests.Godot/tests/UI/test_settings_locale_persist.gd Tests.Godot/tests/Adapters/Config/test_settings_persistence.gd",
      "At launch, only en-US and zh-CN are valid locale options; requesting an unsupported locale is rejected and the current language state remains unchanged. Refs: Game.Core.Tests/Services/LocalizationLocaleValidationTests.cs Tests.Godot/tests/UI/test_settings_locale_unsupported_rejected.gd",
      "Localization key identifiers consumed by UI remain stable across patches: previously released UI-referenced keys are not unintentionally renamed or removed. Refs: Game.Core.Tests/Tasks/Task28LocalizationKeyStabilityTests.cs",
      "Locale resources for both en-US and zh-CN are present and parseable at runtime; if loading or parsing fails, language switching is refused and the previously active language state remains unchanged. Refs: Game.Core.Tests/Services/LocalizationManagerTests.cs Tests.Godot/tests/Integration/test_locale_resource_load_guard.gd",
      "Representative visible UI text is key-driven rather than hardcoded: in one session, displayed values for the same key path change by locale. Refs: Tests.Godot/tests/UI/test_settings_locale.gd",
      "For the same representative UI key set, switching en-US -> zh-CN -> en-US in one session yields locale-correct text after each switch with no stale mixed-language values. Refs: Tests.Godot/tests/UI/test_settings_locale.gd",
      "Automated regression validation fails if any previously released UI-referenced i18n key identifier is renamed or removed between patches. Refs: Game.Core.Tests/Tasks/Task28LocalizationKeyStabilityTests.cs",
      "A single automated run verifies all core behaviors together: en-US/zh-CN runtime switching updates already-visible UI text, missing-key lookup returns the key literal, and both locale resources load and parse successfully. Refs: Tests.Godot/tests/Integration/test_i18n_full_behavior_sweep.gd",
      "Obligation lock O1: Create a LocalizationManager that loads translation files (e.g., CSV or JSON) for each language is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Game.Core.Tests/Services/LocalizationManagerTests.cs Tests.Godot/tests/Integration/test_locale_resource_load_guard.gd",
      "The launch i18n key contract is explicitly defined, and every required key in that contract is present in both en-US and zh-CN locale resources; validation fails when either locale is missing a required key.",
      "Missing-key fallback behavior is deterministic across repeated lookups and locale reloads in the same session: the same missing key always yields the same fallback output.",
      "Regression/key-audit tests emit diagnostics for unresolved keys and fallback paths, and each diagnostic record includes at least the active locale and key identifier."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #28 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 28,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0029",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0021"
    ],
    "taskmaster_exported": false,
    "title": "Add Audio Settings for Music and SFX Channels",
    "description": "Implement audio settings to control music and sound effects volume at launch.",
    "status": "pending",
    "priority": "P3",
    "layer": "adapter",
    "adr_refs": [
      "ADR-0006",
      "ADR-0008",
      "ADR-0011"
    ],
    "chapter_refs": [
      "CH05",
      "CH10",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "adapter"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Tests.Godot/tests/UI/test_settings_panel_audio_channels.gd",
      "Tests.Godot/tests/Integration/test_audio_settings_persistence_cross_restart.gd",
      "Game.Core.Tests/Engine/GameEngineCoreEventTests.cs",
      "Tests.Godot/tests/Adapters/test_audio_manager_channel_isolation.gd",
      "Tests.Godot/tests/Adapters/Config/test_settings_persistence.gd"
    ],
    "acceptance": [
      "Taskmaster #29 delivers only the scoped feature: launch-time control and persistence of music and SFX channel volume settings. Refs: Tests.Godot/tests/UI/test_settings_panel_audio_channels.gd Tests.Godot/tests/Integration/test_audio_settings_persistence_cross_restart.gd",
      "Referenced automated tests pass on the Windows Godot+C# baseline. Refs: Game.Core.Tests/Engine/GameEngineCoreEventTests.cs",
      "Adding audio settings does not regress deterministic simulation behavior or core loop constraints. Refs: Game.Core.Tests/State/GameStateMachineTests.cs Game.Core.Tests/Engine/GameEngineCoreEventTests.cs",
      "Music and SFX keep separate volume values, and changing one channel value does not change the other channel value. Refs: Tests.Godot/tests/Adapters/test_audio_manager_channel_isolation.gd Tests.Godot/tests/UI/test_settings_panel_audio_channels.gd",
      "When music or SFX volume is changed at runtime, only the corresponding channel loudness changes immediately in the same session without restart. Refs: Tests.Godot/tests/Adapters/test_audio_manager_channel_isolation.gd Tests.Godot/tests/UI/test_settings_panel_audio_channels.gd",
      "Changed music and SFX volume settings are saved to configuration and restored/applied on the next game launch. Refs: Tests.Godot/tests/Adapters/Config/test_settings_persistence.gd",
      "With both channels active, music and SFX playback remain independently controllable, with no cross-channel side effects. Refs: Tests.Godot/tests/Adapters/test_audio_manager_channel_isolation.gd Tests.Godot/tests/UI/test_settings_panel_audio_channels.gd",
      "Repeated runtime volume changes do not produce runtime errors, and playback continues without interruption or glitches. Refs: Tests.Godot/tests/Adapters/test_audio_manager_channel_isolation.gd Tests.Godot/tests/UI/test_settings_panel_audio_channels.gd",
      "On launch after a previous save, initial audible output for each channel already reflects its restored setting before any user interaction. Refs: Tests.Godot/tests/Adapters/Config/test_settings_persistence.gd",
      "If only one channel setting is changed and saved, relaunch applies that change while the unchanged channel remains at its prior saved value. Refs: Tests.Godot/tests/Adapters/Config/test_settings_persistence.gd",
      "If music and SFX are saved with different numeric values, relaunch restores those two distinct per-channel values (within configured precision) instead of collapsing to one shared value. Refs: Tests.Godot/tests/Adapters/Config/test_settings_persistence.gd",
      "After saving changed audio settings, persisted configuration stores separate music and SFX entries, and loading that configuration reproduces the same effective per-channel loudness. Refs: Tests.Godot/tests/Adapters/Config/test_settings_persistence.gd",
      "A dedicated AudioManager runtime component controls both music playback and SFX playback, and one playback path does not disable or overwrite the other. Refs: Tests.Godot/tests/Adapters/test_audio_manager_channel_isolation.gd",
      "Music and SFX channels are each driven by a Godot AudioStreamPlayer node, and per-channel volume changes apply only to the corresponding node. Refs: Tests.Godot/tests/Adapters/test_audio_manager_channel_isolation.gd",
      "Obligation lock O5: Audio preferences must be persisted in a configuration file medium (for example user://settings.cfg) and restored from file with separate music_volume and sfx_volume keys. Refs: Tests.Godot/tests/Adapters/Config/test_settings_persistence.gd"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #29 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 29,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0030",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0021",
      "NG-0022",
      "NG-0023",
      "NG-0024",
      "NG-0025",
      "NG-0026",
      "NG-0027",
      "NG-0028",
      "NG-0029"
    ],
    "taskmaster_exported": false,
    "title": "Optimize for Performance Targets (45 FPS 1% Low, 60 FPS Average)",
    "description": "Implement optimizations to meet non-functional goals: low-end baseline 45 FPS (1% low) and average 60 FPS target.",
    "status": "pending",
    "priority": "P1",
    "layer": "adapter",
    "adr_refs": [
      "ADR-0015",
      "ADR-0005",
      "ADR-0011"
    ],
    "chapter_refs": [
      "CH09",
      "CH07",
      "CH10"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "adapter"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Game.Core.Tests/Tasks/Task30PerformanceScopeGuardTests.cs",
      "Tests.Godot/tests/Integration/test_performance_gate_windows_baseline.gd",
      "Game.Core.Tests/Engine/DeterministicCoreLoopRegressionTests.cs",
      "Tests.Godot/tests/Integration/test_simulation_determinism_fixed_seed.gd",
      "Tests.Godot/tests/Integration/test_perf_baseline_locked_camera_repeatability.gd",
      "Game.Core.Tests/Services/PerformanceBaselineVarianceTests.cs",
      "Game.Core.Tests/Services/FrameTimeHotspotRankingTests.cs",
      "Game.Core.Tests/Services/PerformanceRemediationImpactTests.cs",
      "Tests.Godot/tests/Integration/test_perf_stress_endurance_presets.gd",
      "Tests.Godot/tests/Integration/test_perf_gate_artifacts_headless_playable.gd",
      "Tests.Godot/tests/Integration/test_perf_gate_thresholds_fixed_seed.gd",
      "Game.Core.Tests/Services/PerformanceGateFailureConditionsTests.cs",
      "Game.Core.Tests/Services/PerformanceEvidencePairingTests.cs",
      "Game.Core.Tests/Services/PerformancePhaseEvidenceTests.cs",
      "Game.Core.Tests/Services/PerformanceComparisonIdentityTests.cs",
      "Game.Core.Tests/Services/PerformanceSummarySchemaTests.cs"
    ],
    "acceptance": [
      "Taskmaster #30 completion remains scoped to the PRD lock for Optimize for Performance Targets (45 FPS 1% Low, 60 FPS Average), and unrelated changes do not satisfy this task. Refs: Game.Core.Tests/Tasks/Task30PerformanceScopeGuardTests.cs",
      "All automated tests referenced by this task pass on the Windows Godot+C# baseline environment. Refs: Tests.Godot/tests/Integration/test_performance_gate_windows_baseline.gd",
      "Post-optimization validation shows no regression in deterministic simulation behavior or core loop constraints. Refs: Game.Core.Tests/Engine/DeterministicCoreLoopRegressionTests.cs Tests.Godot/tests/Integration/test_simulation_determinism_fixed_seed.gd",
      "Deterministic baseline profiles are captured with locked camera paths and scripted sessions, and two repeated runs stay within the declared variance window. Refs: Tests.Godot/tests/Integration/test_perf_baseline_locked_camera_repeatability.gd Game.Core.Tests/Services/PerformanceBaselineVarianceTests.cs",
      "A profiling report identifies and ranks frame-time hotspots by subsystem (AI, spawn, render, UI) with repeatable timing data for each ranked offender. Refs: Game.Core.Tests/Services/FrameTimeHotspotRankingTests.cs",
      "Config-safe targeted optimizations to update loops, pooling, and expensive queries produce measurable frame-time improvement versus baseline, while regression tests verify gameplay semantics are unchanged. Refs: Game.Core.Tests/Services/PerformanceRemediationImpactTests.cs Game.Core.Tests/Engine/DeterministicCoreLoopRegressionTests.cs",
      "Stress and endurance validation at launch presets covers worst-case wave mixes and UI-heavy scenarios, and the report records memory growth and stutter spikes with threshold verdicts or explicit fail reasons plus traces. Refs: Tests.Godot/tests/Integration/test_perf_stress_endurance_presets.gd",
      "Standardized gate artifacts are written to logs/perf and logs/ci for fixed-seed Windows headless and playable runs, with integer threshold fields and verdicts for baseline, 1% low FPS, and average FPS. Refs: Tests.Godot/tests/Integration/test_perf_gate_artifacts_headless_playable.gd",
      "Task completion is PASS only when reproducible fixed-seed Windows headless and playable gate runs meet at least 45 FPS for 1% low and 60 FPS for average FPS. Refs: Tests.Godot/tests/Integration/test_perf_gate_thresholds_fixed_seed.gd",
      "If measurable improvement versus baseline is not shown within the declared variance window, or required artifact files/fields are missing, the task verdict is FAIL and cannot be accepted. Refs: Game.Core.Tests/Services/PerformanceGateFailureConditionsTests.cs",
      "Gate evidence includes paired baseline and post-optimization metrics for the same fixed-seed scenes so 1% low and average FPS deltas are directly verifiable. Refs: Game.Core.Tests/Services/PerformanceEvidencePairingTests.cs",
      "Acceptance is blocked when any required phase evidence (baseline capture, hotspot isolation, frame-budget remediation, stress validation, gate artifact output) is missing from logs/perf or logs/ci. Refs: Game.Core.Tests/Services/PerformancePhaseEvidenceTests.cs",
      "Baseline-to-post comparisons are valid only when scene set, fixed seed, camera path script, launch preset, and run mode (headless/playable) are identical; otherwise the gate verdict is FAIL. Refs: Game.Core.Tests/Services/PerformanceComparisonIdentityTests.cs",
      "Gate summary artifacts include explicit integer fields for baseline and post-optimization 1% low and average FPS, plus the applied variance window and threshold values, enabling machine-verifiable threshold evaluation. Refs: Game.Core.Tests/Services/PerformanceSummarySchemaTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #30 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 30,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0031",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0021"
    ],
    "taskmaster_exported": false,
    "title": "Scaffold config-contract workspace on existing project",
    "description": "Extend the existing project with config schema/sample workspace structure for contract-driven tuning.",
    "status": "pending",
    "priority": "P1",
    "layer": "ci",
    "adr_refs": [
      "ADR-0011",
      "ADR-0001"
    ],
    "chapter_refs": [
      "CH07",
      "CH10",
      "CH01"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "ci"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs",
      "Game.Core.Tests/Tasks/Task31ConfigWorkspaceGuardrailsTests.cs",
      "Tests.Godot/tests/Adapters/Config/test_settings_config_utf8.gd",
      "Game.Core.Tests/Services/CollisionServiceTests.cs",
      "Tests.Godot/tests/Integration/test_hud_integration.gd",
      "Tests.Godot/tests/Scenes/Smoke/test_glue_connections.gd",
      "Tests.Godot/tests/Security/Hard/test_settings_config_security.gd",
      "Game.Core.Tests/Tasks/Task31ConfigContractWiringTests.cs"
    ],
    "acceptance": [
      "Taskmaster #31 implementation stays within PRD lock by scaffolding a config-contract workspace on top of the existing T21 project, without project bootstrap or reinitialization. Refs: Game.Core.Tests/Tasks/Task31ConfigWorkspaceGuardrailsTests.cs",
      "Referenced automated checks pass on the Windows Godot+C# baseline for the added config workspace and contract entrypoints. Refs: Tests.Godot/tests/Adapters/Config/test_settings_config_utf8.gd",
      "Compared with the T21 baseline, no unrelated gameplay/core-loop behavior is changed; this task only introduces config workspace, contract docs, and wiring. Refs: Game.Core.Tests/Services/CollisionServiceTests.cs Tests.Godot/tests/Integration/test_hud_integration.gd",
      "The inherited project still opens in Godot 4.5.1 on Windows, and C# project generation/build succeeds after the scaffold changes. Refs: Tests.Godot/tests/Scenes/Smoke/test_glue_connections.gd",
      "Both directories config/schemas/ and config/samples/ exist under the inherited project root after setup. Refs: Game.Core.Tests/Tasks/Task31ConfigWorkspaceGuardrailsTests.cs",
      "Setup does not create a second project root, standalone Godot project, or reinitialized project artifacts. Refs: Game.Core.Tests/Tasks/Task31ConfigWorkspaceGuardrailsTests.cs",
      "Config-contract workspace paths are wired as project-root-relative paths in the existing project, not absolute or external workspace paths. Refs: Tests.Godot/tests/Security/Hard/test_settings_config_security.gd",
      "A README.md for the config-contract workspace exists and documents the purpose and expected usage of config/schemas/ and config/samples/. Refs: Game.Core.Tests/Tasks/Task31ConfigWorkspaceGuardrailsTests.cs",
      "The existing project exposes config-contract wiring entrypoints that map schema loading to config/schemas/ and sample loading/discovery to config/samples/. Refs: Game.Core.Tests/Domain/GameConfigTests.cs",
      "Acceptance fails if config workspace wiring entrypoints are missing, unreachable, or not connected to the declared config paths. Refs: Game.Core.Tests/Tasks/Task31ConfigContractWiringTests.cs",
      "Scope boundary is enforceable: this task modifies the T21 baseline in place; creating or recreating a standalone Godot project fails acceptance. Refs: Game.Core.Tests/Tasks/Task31ConfigWorkspaceGuardrailsTests.cs",
      "Hard gate: both config/schemas and config/samples plus working wiring entrypoints are required; directory-only scaffolding fails acceptance. Refs: Game.Core.Tests/Tasks/Task31ConfigContractWiringTests.cs Game.Core.Tests/Tasks/Task31ConfigWorkspaceGuardrailsTests.cs",
      "Contract artifacts under config/schemas/ and config/samples/ follow the canonical workspace naming/path conventions and include all required metadata fields; any missing required metadata or naming mismatch fails acceptance.",
      "Running the scaffold repeatedly on the same inherited T21 project root is idempotent: no duplicate project root or reinitialized artifacts are created, required directories and wiring remain valid, and CI-verifiable scaffold evidence is produced for troubleshooting."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #31 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 31,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0032",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0031"
    ],
    "taskmaster_exported": false,
    "title": "Implement enemy-config.schema.json with validation rules",
    "description": "Define JSON schema for enemy configuration, including fields for enemy types, stats, and behaviors, adhering to config-first balancing and no hardcoded values.",
    "status": "pending",
    "priority": "P1",
    "layer": "core",
    "adr_refs": [
      "ADR-0023",
      "ADR-0007",
      "ADR-0005"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs",
      "Game.Core.Tests/Services/EnemyConfigSchemaValidationTests.cs",
      "Game.Core.Tests/Services/EnemyConfigSampleFileValidationTests.cs",
      "Game.Core.Tests/Engine/GameEngineCoreEventTests.cs",
      "Game.Core.Tests/State/GameStateMachineTests.cs"
    ],
    "acceptance": [
      "Taskmaster #32 behavior matches PRD lock for Implement enemy-config.schema.json with validation rules. Refs: Game.Core.Tests/Services/EnemyConfigSchemaValidationTests.cs",
      "Referenced automated tests pass on Windows Godot+C# baseline. Refs: Game.Core.Tests/Services/EnemyConfigSchemaValidationTests.cs Game.Core.Tests/Services/EnemyConfigSampleFileValidationTests.cs",
      "No regression on deterministic simulation and core loop constraints. Refs: Game.Core.Tests/Engine/GameEngineCoreEventTests.cs Game.Core.Tests/State/GameStateMachineTests.cs",
      "config/schemas/enemy-config.schema.json exists and declares \"$schema\": \"http://json-schema.org/draft-07/schema#\" with top-level \"type\": \"object\". Refs: Game.Core.Tests/Services/EnemyConfigSchemaValidationTests.cs",
      "The schema defines an \"enemies\" property as an array, and each array item is an object schema for a single enemy configuration. Refs: Game.Core.Tests/Services/EnemyConfigSchemaValidationTests.cs",
      "Each enemy item schema includes at least enemy_id (string), health (number, minimum 1), damage (number, minimum 0), and speed (number, minimum 0), and these fields are listed in required. Refs: Game.Core.Tests/Services/EnemyConfigSchemaValidationTests.cs",
      "The schema includes configurable enemy type/identity and behavior-related fields with explicit type constraints, so behavior selection is data-driven by config. Refs: Game.Core.Tests/Services/EnemyConfigSchemaValidationTests.cs",
      "Validator-based tests on Windows C# reject payloads with missing required fields, wrong field types, or numeric values below declared minima. Refs: Game.Core.Tests/Services/EnemyConfigSchemaValidationTests.cs Game.Core.Tests/Services/EnemyConfigSampleFileValidationTests.cs",
      "Validator-based tests on Windows C# accept at least one valid payload where all required fields and numeric constraints are satisfied. Refs: Game.Core.Tests/Services/EnemyConfigSchemaValidationTests.cs Game.Core.Tests/Services/EnemyConfigSampleFileValidationTests.cs",
      "Enemy balance values are sourced from schema-validated configuration data; adding or adjusting enemy balance values does not require hardcoded per-enemy constants for schema compliance. Refs: Game.Core.Tests/Services/EnemyConfigSchemaValidationTests.cs Game.Core.Tests/Services/EnemyConfigSampleFileValidationTests.cs",
      "The root schema lists \"enemies\" in required, and validator-based tests reject a top-level payload that omits \"enemies\". Refs: Game.Core.Tests/Services/EnemyConfigSchemaValidationTests.cs",
      "Validator-based tests reject enemy objects where behavior-related fields are present but use types that differ from the schema declaration. Refs: Game.Core.Tests/Services/EnemyConfigSchemaValidationTests.cs Game.Core.Tests/Services/EnemyConfigSampleFileValidationTests.cs",
      "Validator-based tests accept a payload containing at least two enemy entries with different valid health/damage/speed values without requiring schema or code changes. Refs: Game.Core.Tests/Services/EnemyConfigSampleFileValidationTests.cs",
      "Validator-based tests on Windows C# fail when each required enemy field (enemy_id, health, damage, speed) is omitted individually from an enemy item. Refs: Game.Core.Tests/Services/EnemyConfigSchemaValidationTests.cs",
      "Validator-based tests on Windows C# pass after changing enemy balance numbers only in configuration data (within schema limits) without modifying schema structure or gameplay code. Refs: Game.Core.Tests/Services/EnemyConfigSampleFileValidationTests.cs",
      "Windows C# validator tests must validate schema using payloads loaded from test JSON files (at least one valid sample and multiple invalid samples), not inline-only objects. Refs: Game.Core.Tests/Services/EnemyConfigSampleFileValidationTests.cs",
      "If a required test JSON sample is missing, unreadable, or invalid JSON, the validation test run must fail and cannot be counted as pass. Refs: Game.Core.Tests/Services/EnemyConfigSampleFileValidationTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #32 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 32,
    "contractRefs": [
      "Game.Core/Contracts/Config/enemy-config.schema.json"
    ]
  },
  {
    "id": "NG-0033",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0031"
    ],
    "taskmaster_exported": false,
    "title": "Implement difficulty-config.schema.json with versioning and lock constraints",
    "description": "Create JSON schema for difficulty configuration, including version field, difficulty levels, and constants, ensuring difficulty is locked at run start per PRD.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0023",
      "ADR-0007",
      "ADR-0005"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs",
      "Game.Core.Tests/Engine/GameEngineDifficultyLockTests.cs",
      "Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "Game.Core.Tests/Engine/GameEngineCoreEventTests.cs"
    ],
    "acceptance": [
      "After a run starts, any request to change active difficulty is rejected and the active difficulty remains unchanged. Refs: Game.Core.Tests/Engine/GameEngineDifficultyLockTests.cs",
      "On the Windows Godot+C# baseline, all referenced automated tests for this task pass. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs Game.Core.Tests/Engine/GameEngineDifficultyLockTests.cs",
      "After this change, deterministic simulation and core-loop regression checks run and report no new failures. Refs: Game.Core.Tests/Engine/GameEngineCoreEventTests.cs",
      "A file exists at `config/schemas/difficulty-config.schema.json` and parses as valid JSON. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "The schema requires both `version` and `difficulty_level`, and validation rejects inputs where `version` is missing. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "`version` is validated as a string matching `^\\d+\\.\\d+$`; `1.0` passes while `v1` and `1` fail. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "`difficulty_level` is validated as a string enum limited to `easy`, `medium`, and `hard`; any other value is rejected. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "`modifiers` is defined as an object, and each declared modifier field is numeric; non-numeric modifier values are rejected. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "Per the PRD lock constraint, once a run starts, any attempt to change active difficulty is refused or leaves the active difficulty unchanged. Refs: Game.Core.Tests/Engine/GameEngineDifficultyLockTests.cs",
      "Schema validation tests include positive and negative samples for invalid enum, missing `version`, and invalid `version` pattern, with expected pass/fail outcomes. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "The schema declares `version` as an explicit top-level property and includes it in `required`, ensuring revision data is always present for backward-trackability checks. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "Validation accepts at least two configurations that differ only in declared numeric `modifiers` values, confirming these values are configurable data rather than fixed constants. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "A lock-behavior test verifies that difficulty changes can take effect before run start, while after run start a change attempt is refused or leaves active difficulty unchanged. Refs: Game.Core.Tests/Engine/GameEngineDifficultyLockTests.cs",
      "Schema validation rejects inputs where `difficulty_level` is missing, confirming both required fields are enforced. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "Schema validation passes for valid samples using each allowed `difficulty_level` value (`easy`, `medium`, `hard`) with valid `version` and numeric `modifiers`. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "Obligation lock O8: The task schema must not collapse all values into one fixed constant set; configurable fields must allow alternative valid inputs. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "Obligation lock O8: Schema validation accepts at least two valid version values matching `^\\d+\\.\\d+$` (for example `1.0` and `2.1`) while `difficulty_level` and `modifiers` remain otherwise identical. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "Obligation lock O8: If schema constrains version to a single constant value (for example `const` or single-value `enum`), validation must fail. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "Obligation lock O8: All configurable fields must remain tunable and must not be constrained to single constant values; validation tests must fail const/single-value restrictions for `version`, `difficulty_level`, and `modifiers`. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "Schema validation accepts at least two valid `version` values matching `^\\d+\\.\\d+$` (e.g., `1.0` and `2.1`) with identical `difficulty_level` and `modifiers`. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "If schema constrains `version` to a single constant value (e.g., `const` or single-value `enum`), validation test must fail. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "Subtask 1 coverage: acceptance explicitly requires tier definitions (`easy`,`medium`,`hard`), run-start lock semantics, and migration/backward-trackability metadata via required top-level `version` to be validated together.",
      "Subtask 2 coverage: strict validation must return explicit reject reasons for invalid tier enum, missing required fields, type mismatch in `modifiers`, and any declared numeric bound violations.",
      "Subtask 3 coverage: regression fixtures must keep pass/fail outcomes stable across runs, and loading an invalid difficulty config must refuse activation and preserve the last valid runtime state (or configured safe default)."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #33 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 33,
    "contractRefs": [
      "Game.Core/Contracts/Config/difficulty-config.schema.json"
    ]
  },
  {
    "id": "NG-0034",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0031"
    ],
    "taskmaster_exported": false,
    "title": "Implement spawn-config.schema.json for deterministic wave composition",
    "description": "Define JSON schema for spawn configuration to control enemy waves, ensuring determinism: same seed + same config => same wave timeline.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0023",
      "ADR-0007",
      "ADR-0005"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs",
      "Game.Core.Tests/Services/SpawnWaveTimelineDeterminismTests.cs",
      "Game.Core.Tests/Services/SpawnWaveTimelineCadenceTests.cs"
    ],
    "acceptance": [
      "Taskmaster #34 behavior matches PRD lock for Implement spawn-config.schema.json for deterministic wave composition. Refs: Game.Core.Tests/Domain/GameConfigTests.cs",
      "Referenced automated tests pass on Windows Godot+C# baseline. Refs: Game.Core.Tests/Domain/GameConfigTests.cs",
      "No regression on deterministic simulation and core loop constraints. Refs: Game.Core.Tests/Services/SpawnWaveTimelineDeterminismTests.cs Game.Core.Tests/Services/SpawnWaveTimelineCadenceTests.cs",
      "config/schemas/spawn-config.schema.json exists and validates a spawn config object with seed (integer) and waves (array) fields. Refs: Game.Core.Tests/Domain/GameConfigTests.cs",
      "Each wave object validation enforces day as an integer in [1, 15] and includes day/night timing values aligned to a 4-minute Day + 2-minute Night cycle. Refs: Game.Core.Tests/Domain/GameConfigTests.cs",
      "Enemy entries in each wave validate enemy_id as string and count as integer with minimum 0; negative counts or wrong types fail validation. Refs: Game.Core.Tests/Domain/GameConfigTests.cs",
      "Validation test data includes at least one valid config and failing cases for day outside 1-15 and negative enemy count, and failures are observable in test results. Refs: Game.Core.Tests/Domain/GameConfigTests.cs",
      "Determinism test demonstrates that repeated wave generation with the same seed and the same valid config yields the same wave timeline, while invalid config is rejected with no timeline output. Refs: Game.Core.Tests/Domain/GameConfigTests.cs",
      "Wave timeline generation inputs are restricted to schema-valid config values plus seed, with no hidden runtime override required to reproduce results. Refs: Game.Core.Tests/Domain/GameConfigTests.cs",
      "Schema/timeline verification demonstrates that the configured 4-minute Day + 2-minute Night cadence over Day1-Day15 produces a timeline within the required 60-90 minute match window (90 minutes at full 15-day coverage) using config values only. Refs: Game.Core.Tests/Services/SpawnWaveTimelineCadenceTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #34 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 34,
    "contractRefs": [
      "Game.Core/Contracts/Config/spawn-config.schema.json"
    ]
  },
  {
    "id": "NG-0035",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0031"
    ],
    "taskmaster_exported": false,
    "title": "Implement pressure-normalization.config.schema.json with baseline constants and range checks",
    "description": "Create JSON schema for pressure normalization configuration, including explicit baseline constants and validation for ranges as per PRD.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0023",
      "ADR-0007",
      "ADR-0005"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs",
      "Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs",
      "Game.Core.Tests/Services/DeterministicSimulationConstraintTests.cs",
      "Game.Core.Tests/State/GameStateMachineTests.cs"
    ],
    "acceptance": [
      "Taskmaster #35 output is traceably consistent with the PRD-locked intent for implementing pressure-normalization.config.schema.json with baseline constants and range checks. Refs: Game.Core.Tests/Domain/GameConfigTests.cs",
      "All referenced automated tests pass in the Windows Godot+C# baseline environment. Refs: Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs Game.Core.Tests/Services/DeterministicSimulationConstraintTests.cs",
      "Deterministic simulation and core loop constraint checks remain passing after this schema change. Refs: Game.Core.Tests/State/GameStateMachineTests.cs",
      "config/schemas/pressure-normalization.config.schema.json exists and is parseable by a JSON Schema validator. Refs: Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs",
      "The schema defines baseline, min_pressure, and max_pressure as number-typed fields, and defines normalization_factors as an array with number-typed items. Refs: Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs",
      "Schema validation fails when baseline, min_pressure, max_pressure, or normalization_factors is missing. Refs: Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs",
      "The schema declares explicit baseline and pressure-bound constants (including a baseline lower bound) rather than relying on implicit defaults. Refs: Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs",
      "Schema validation fails when min_pressure is greater than or equal to max_pressure. Refs: Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs",
      "Schema validation fails for non-numeric baseline values and passes for numeric baseline values that satisfy declared bounds. Refs: Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs",
      "Schema validation passes for a configuration with numeric baseline, min_pressure < max_pressure, and normalization_factors containing only numbers. Refs: Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs",
      "Schema validation fails when normalization_factors contains any non-numeric element. Refs: Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs",
      "If a constraints object is provided, constraints.range_check is boolean-typed and non-boolean values fail schema validation. Refs: Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs",
      "Schema validation fails when baseline violates the declared lower-bound constant. Refs: Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs",
      "A validation case with min_pressure equal to max_pressure fails, confirming strict enforcement of min_pressure < max_pressure. Refs: Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs",
      "A validation case with min_pressure greater than max_pressure fails, and the same case with min_pressure less than max_pressure passes when all required fields are otherwise valid. Refs: Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs",
      "A validation case with baseline below the declared lower-bound constant fails, and a case at or above that bound passes when other constraints are satisfied. Refs: Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs",
      "Schema validation fails when normalization_factors is not an array, even if baseline, min_pressure, and max_pressure are otherwise valid. Refs: Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs",
      "Regression fixtures include at least one baseline-valid revision and one baseline-invalid revision, and invalid revisions produce stable fallback/rejection reason codes in validation evidence. Refs: Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs Game.Core.Tests/Services/DeterministicSimulationConstraintTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #35 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 35,
    "contractRefs": [
      "Game.Core/Contracts/Config/pressure-normalization.config.schema.json"
    ]
  },
  {
    "id": "NG-0036",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0032",
      "NG-0033",
      "NG-0034",
      "NG-0035"
    ],
    "taskmaster_exported": false,
    "title": "Create sample JSON files for all configs with valid data",
    "description": "Generate sample JSON files (difficulty-config.sample.json, spawn-config.sample.json, pressure-normalization.config.sample.json) that adhere to the schemas and include realistic values.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0023",
      "ADR-0007",
      "ADR-0005"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs",
      "Game.Core.Tests/Tasks/Task36ConfigSampleArtifactsTests.cs",
      "Game.Core.Tests/Tasks/Task36ConfigValidationFlowTests.cs"
    ],
    "acceptance": [
      "Deliverables are limited to Taskmaster #36 config-sample outputs, and each output is a contract-release sample artifact; placeholder-only artifacts fail acceptance. Refs: Game.Core.Tests/Tasks/Task36ConfigSampleArtifactsTests.cs",
      "On the Windows Godot+C# baseline, automated validation shows every required positive sample passes both schema validation and semantic validation. Refs: Game.Core.Tests/Tasks/Task36ConfigValidationFlowTests.cs",
      "Artifacts are split by config domain (difficulty, spawn, pressure-normalization), and validation output reports all three domains; omission of any domain fails acceptance. Refs: Game.Core.Tests/Tasks/Task36ConfigSampleArtifactsTests.cs Game.Core.Tests/Tasks/Task36ConfigValidationFlowTests.cs",
      "difficulty-config.sample.json exists, is non-empty, passes schema and semantic validation, and includes version metadata, deterministic launch-tier defaults, and lock-at-start fields. Refs: Game.Core.Tests/Tasks/Task36ConfigSampleArtifactsTests.cs",
      "spawn-config.sample.json exists, is non-empty, passes schema and semantic validation, and includes Day1-Day15 cadence coverage plus channel isolation flags required by the runtime parser. Refs: Game.Core.Tests/Tasks/Task36ConfigSampleArtifactsTests.cs",
      "pressure-normalization.config.sample.json exists, is non-empty, passes schema and semantic validation, explicitly defines baseline constants, and keeps tuning values within guard bands. Refs: Game.Core.Tests/Tasks/Task36ConfigSampleArtifactsTests.cs",
      "Negative fixtures are present for all three config domains and include malformed and boundary-breach inputs; each negative case is rejected while positive samples remain passing in the same validation flow. Refs: Game.Core.Tests/Tasks/Task36ConfigValidationFlowTests.cs",
      "A CI-consumable validation summary artifact is produced with schema and semantic outcomes for every positive and negative fixture; missing this artifact fails acceptance. Refs: Game.Core.Tests/Tasks/Task36ConfigValidationFlowTests.cs",
      "Acceptance fails if any required positive sample file is missing, empty, or excluded from validation output. Refs: Game.Core.Tests/Tasks/Task36ConfigValidationFlowTests.cs",
      "Validation output includes explicit per-file schema and semantic pass/fail results for each required positive sample; missing per-file results fail acceptance. Refs: Game.Core.Tests/Tasks/Task36ConfigValidationFlowTests.cs",
      "For each config domain, at least one malformed fixture and one boundary-breach fixture run and are rejected with non-empty explicit reason codes in the same run where all required positive samples pass. Refs: Game.Core.Tests/Tasks/Task36ConfigValidationFlowTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #36 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 36,
    "contractRefs": [
      "Game.Core/Contracts/Config/difficulty-config.sample.json",
      "Game.Core/Contracts/Config/spawn-config.sample.json",
      "Game.Core/Contracts/Config/pressure-normalization.config.sample.json"
    ]
  },
  {
    "id": "NG-0037",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0032",
      "NG-0033",
      "NG-0034",
      "NG-0035"
    ],
    "taskmaster_exported": false,
    "title": "Implement config validation and fallback handling in C#",
    "description": "Develop C# code in Godot to load and validate config files against schemas, applying invalid config handling policy: reject and fallback to built-in safe defaults.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0023",
      "ADR-0007",
      "ADR-0005"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs",
      "Tests.Godot/tests/Adapters/Config/test_settings_config_utf8.gd",
      "Tests.Godot/tests/Adapters/Config/test_settings_persistence.gd",
      "Game.Core.Tests/Services/ConfigValidationPipelineTests.cs",
      "Game.Core.Tests/Services/ConfigApplicationGuardsTests.cs",
      "Game.Core.Tests/Services/ConfigStructuralValidationAdapterTests.cs",
      "Game.Core.Tests/Services/ConfigPolicyRoutingTests.cs",
      "Game.Core.Tests/Services/ConfigAuditArtifactsTests.cs"
    ],
    "acceptance": [
      "Taskmaster #37 implementation enforces PRD-locked behavior: config files are loaded and validated, and invalid inputs end only in reject or fallback to built-in safe defaults. Refs: Tests.Godot/tests/Adapters/Config/test_settings_config_utf8.gd",
      "All referenced automated tests pass on the Windows Godot + C# baseline, including config validation and fallback scenarios. Refs: Tests.Godot/tests/Adapters/Config/test_settings_persistence.gd",
      "Executing the validation/fallback flow causes no unintended runtime side effects outside the config decision path, including no deterministic core-loop drift for identical inputs. Refs: Game.Core.Tests/Services/ConfigValidationPipelineTests.cs Game.Core.Tests/Services/ConfigApplicationGuardsTests.cs",
      "Schema-invalid config payloads are rejected at the structural validation stage with deterministic normalized error codes and required error payload fields. Refs: Game.Core.Tests/Services/ConfigStructuralValidationAdapterTests.cs",
      "Semantic rule violations are evaluated only after structural pass, and each violation maps to exactly one explicit policy action with a machine-verifiable reason key. Refs: Game.Core.Tests/Services/ConfigPolicyRoutingTests.cs",
      "Runtime config application enforces immutable and difficulty-locked fields: only allowed fields may fallback to built-in safe defaults, and forbidden changes are rejected without protected-state mutation. Refs: Game.Core.Tests/Services/ConfigApplicationGuardsTests.cs",
      "Each validation decision emits standardized audit entries and CI summary artifacts under logs/ci, including policy decision trace and reject/fallback reasons. Refs: Game.Core.Tests/Services/ConfigAuditArtifactsTests.cs",
      "A valid/invalid/boundary config matrix yields policy-consistent terminal outcomes (accept, reject, or fallback) with observable logs for each case. Refs: Game.Core.Tests/Services/ConfigValidationPipelineTests.cs Game.Core.Tests/Services/ConfigAuditArtifactsTests.cs",
      "On every rejection path, protected runtime fields remain unchanged and no partial config mutation is observable after the decision. Refs: Game.Core.Tests/Services/ConfigApplicationGuardsTests.cs",
      "Reject and fallback outcomes expose explicit machine-verifiable reason identifiers in both test assertions and emitted audit records. Refs: Game.Core.Tests/Services/ConfigPolicyRoutingTests.cs Game.Core.Tests/Services/ConfigAuditArtifactsTests.cs",
      "Each config evaluation produces exactly one terminal outcome (accept, reject, or fallback), and tests confirm no dual/conflicting outcomes for a single input. Refs: Game.Core.Tests/Services/ConfigValidationPipelineTests.cs",
      "Validation runs in layered order (structural -> semantic -> policy routing), and decision traces identify the stage responsible for the terminal outcome. Refs: Game.Core.Tests/Services/ConfigValidationPipelineTests.cs",
      "Boundary-case evaluations are deterministic across repeated runs: identical input yields identical terminal outcome and identical machine-verifiable reason identifiers. Refs: Game.Core.Tests/Services/ConfigValidationPipelineTests.cs",
      "For every structural validation failure, output includes a normalized machine-readable error payload with deterministic code and location fields; structurally valid inputs proceed to semantic validation. Refs: Game.Core.Tests/Services/ConfigStructuralValidationAdapterTests.cs",
      "For every semantic violation, policy routing returns exactly one explicit action and one machine-verifiable reason key; unmapped violations are rejected with an explicit reason identifier. Refs: Game.Core.Tests/Services/ConfigPolicyRoutingTests.cs",
      "Fallback application updates only allowed mutable fields to built-in safe defaults, while immutable and difficulty-locked fields stay unchanged; any forbidden update attempt is rejected with no partial state mutation. Refs: Game.Core.Tests/Services/ConfigApplicationGuardsTests.cs",
      "Each config evaluation writes one standardized audit record and one CI-consumable summary artifact in logs/ci containing terminal outcome, decision stage, policy trace, and reason identifiers. Refs: Game.Core.Tests/Services/ConfigAuditArtifactsTests.cs",
      "Obligation lock O4: Implement schema-level structural validation adapters :: Centralize structural validation and collect normalized error payloads is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Game.Core.Tests/Services/ConfigStructuralValidationAdapterTests.cs",
      "Obligation lock O7: Encode rule sets from validator contracts and map each failure to policy action is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Game.Core.Tests/Services/ConfigPolicyRoutingTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #37 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 37,
    "contractRefs": [
      "Game.Core/Contracts/Config/spawn-config.validator.rules.md"
    ]
  },
  {
    "id": "NG-0038",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0037"
    ],
    "taskmaster_exported": false,
    "title": "Integrate config governance for gameplay tuning",
    "description": "Connect config values to gameplay systems (e.g., enemy stats, wave spawning) to ensure all tuning is via config only, with no implementation hardcoding.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0023",
      "ADR-0007",
      "ADR-0005"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs",
      "Game.Core.Tests/Tasks/Task38ConfigGovernanceTests.cs",
      "Game.Core.Tests/Services/GameplayTuningConfigIntegrationTests.cs",
      "Game.Core.Tests/Services/WaveSeedDeterminismTests.cs",
      "Game.Core.Tests/Services/EnemyStatConfigBindingTests.cs",
      "Game.Core.Tests/Services/SpawnTimingConfigBindingTests.cs",
      "Game.Core.Tests/Services/GameplayConfigSetSwitchingTests.cs"
    ],
    "acceptance": [
      "Taskmaster #38 enforces the PRD lock by sourcing enemy stats and wave spawning parameters from ConfigManager-backed config data, not hardcoded gameplay constants. Refs: Game.Core.Tests/Tasks/Task38ConfigGovernanceTests.cs Game.Core.Tests/Services/GameplayTuningConfigIntegrationTests.cs",
      "Referenced automated tests pass on the Windows Godot+C# baseline, including integration checks for config-driven enemy stats, spawn timing, and seed-based wave generation. Refs: Game.Core.Tests/Services/GameplayTuningConfigIntegrationTests.cs Game.Core.Tests/Services/WaveSeedDeterminismTests.cs",
      "After replacing hardcoded tuning with config-governed values, deterministic simulation behavior and core loop constraints remain within expected results. Refs: Game.Core.Tests/Services/WaveSeedDeterminismTests.cs Game.Core.Tests/Services/GameplayTuningConfigIntegrationTests.cs",
      "When only enemy-config values are changed, corresponding runtime enemy stats (including health) change in gameplay without any C# script edits; unchanged stats after a config-only change fail acceptance. Refs: Game.Core.Tests/Services/EnemyStatConfigBindingTests.cs Game.Core.Tests/Services/GameplayTuningConfigIntegrationTests.cs",
      "When only spawn-config timing values are changed, runtime wave spawn timing changes in gameplay without any C# script edits; unchanged timing after a config-only change fails acceptance. Refs: Game.Core.Tests/Services/SpawnTimingConfigBindingTests.cs Game.Core.Tests/Services/GameplayTuningConfigIntegrationTests.cs",
      "Wave generation uses the spawn-config seed so repeated runs with the same seed produce identical wave composition/order, and changing only the seed changes composition/order. Refs: Game.Core.Tests/Services/WaveSeedDeterminismTests.cs",
      "When valid config values are present, gameplay systems use those values for enemy stats and wave-spawn parameters, and any hardcoded override fails acceptance. Refs: Game.Core.Tests/Tasks/Task38ConfigGovernanceTests.cs Game.Core.Tests/Services/GameplayTuningConfigIntegrationTests.cs",
      "Integration runs with at least two distinct valid config sets show that enemy stats and wave composition outputs follow config differences while remaining deterministic under a fixed seed. Refs: Game.Core.Tests/Services/GameplayConfigSetSwitchingTests.cs Game.Core.Tests/Services/WaveSeedDeterminismTests.cs",
      "Using the same executable and content, tuning outcomes are achieved by config-only changes: updating enemy-config or spawn-config changes gameplay outputs without editing C# scripts; requiring script changes fails acceptance. Refs: Game.Core.Tests/Services/GameplayConfigSetSwitchingTests.cs Game.Core.Tests/Tasks/Task38ConfigGovernanceTests.cs",
      "For a selected enemyId and spawn profile, observed runtime enemy health and spawn interval values exactly match the active config values in that run; any mismatch fails acceptance. Refs: Game.Core.Tests/Services/EnemyStatConfigBindingTests.cs Game.Core.Tests/Services/SpawnTimingConfigBindingTests.cs",
      "In the same executable/content build with spawn-config fixed, changing only enemy-config for a selected enemyId changes that enemyId runtime health/stat outputs to the new config values and requires no C# script edits. Refs: Game.Core.Tests/Services/EnemyStatConfigBindingTests.cs",
      "In the same executable/content build with all non-seed spawn settings fixed, changing only spawn-config seed changes wave composition/order outputs, while reruns with that same seed reproduce identical composition/order outputs. Refs: Game.Core.Tests/Services/WaveSeedDeterminismTests.cs",
      "With one executable/content build and two valid config sets A/B, switching A->B changes at least one enemy runtime stat and at least one wave output metric that correspond to changed config fields; no observable change after config-only switching fails acceptance. Refs: Game.Core.Tests/Services/GameplayConfigSetSwitchingTests.cs Game.Core.Tests/Services/SpawnTimingConfigBindingTests.cs",
      "With one executable/content build, switching config set A->B->A restores enemy stat outputs and wave composition/order outputs to the original A results under the same seed; failure to restore fails acceptance. Refs: Game.Core.Tests/Services/GameplayConfigSetSwitchingTests.cs Game.Core.Tests/Services/WaveSeedDeterminismTests.cs",
      "Obligation lock O1: Modify existing gameplay C# scripts to read values from ConfigManager instead of hardcoded constants is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Game.Core.Tests/Domain/GameConfigTests.cs",
      "Config-governance policy contract is enforced for tuning promotion: mandatory governance fields and promotion preconditions must be present and valid before promotion, and any missing/invalid required field rejects promotion with no active gameplay-config mutation.",
      "Governance checks in the tuning workflow execute fail-fast and produce deterministic reject reasons: for identical invalid input, repeated runs return the same reject outcome and reason while preventing partial promotion side effects.",
      "Governance regression and audit outputs are produced for each promotion attempt: CI/manual handoff artifacts include allow/reject decision and evaluated governance criteria, and missing audit output for an attempt fails acceptance."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #38 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 38,
    "contractRefs": [
      "Game.Core/Contracts/Config/config-change-audit.schema.json"
    ]
  },
  {
    "id": "NG-0039",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0037"
    ],
    "taskmaster_exported": false,
    "title": "Add config hash/version to battle report metadata for auditability",
    "description": "Implement functionality to compute and include config hash or version in battle report metadata, as required for auditability.",
    "status": "pending",
    "priority": "P3",
    "layer": "core",
    "adr_refs": [
      "ADR-0023",
      "ADR-0007",
      "ADR-0005"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs",
      "Game.Core.Tests/Services/BattleReportMetadataTests.cs",
      "Game.Core.Tests/Services/ConfigManagerFingerprintTests.cs",
      "Game.Core.Tests/Services/BattleReportOutcomeStabilityTests.cs",
      "Game.Core.Tests/State/BattleReportPersistenceTests.cs"
    ],
    "acceptance": [
      "For Taskmaster #39, report generation computes config-derived metadata (either hash or version) and writes it into each generated battle report metadata. Refs: Game.Core.Tests/Services/BattleReportMetadataTests.cs",
      "Automated tests covering metadata presence, same-config stability, and changed-config/version detection pass on the Windows Godot+C# baseline. Refs: Game.Core.Tests/Services/BattleReportMetadataTests.cs Game.Core.Tests/Services/ConfigManagerFingerprintTests.cs",
      "Adding config metadata does not change battle simulation outcomes: with the same battle inputs, match-result fields remain unchanged except for the added metadata field. Refs: Game.Core.Tests/Services/BattleReportOutcomeStabilityTests.cs",
      "Each generated battle report includes either \"config_hash\" or \"config_version\" with a non-empty value derived from the exact config used for that battle. Refs: Game.Core.Tests/Services/BattleReportMetadataTests.cs Game.Core.Tests/Services/ConfigManagerFingerprintTests.cs",
      "Repeated report generation with byte-identical config content or the same declared version yields the same recorded metadata value. Refs: Game.Core.Tests/Services/ConfigManagerFingerprintTests.cs",
      "If config content changes or declared version changes before report generation, the next battle report records a different metadata value. Refs: Game.Core.Tests/Services/ConfigManagerFingerprintTests.cs",
      "Any battle report that contains neither \"config_hash\" nor \"config_version\" is invalid output and fails audit-complete acceptance. Refs: Game.Core.Tests/Services/BattleReportMetadataTests.cs",
      "Persisted battle report payloads retain match-result content and include the selected config metadata field (\"config_hash\" or \"config_version\") for audit retrieval. Refs: Game.Core.Tests/State/BattleReportPersistenceTests.cs Game.Core.Tests/Services/BattleReportMetadataTests.cs",
      "The recorded value (\"config_hash\" or \"config_version\") comes from the exact configuration payload/version consumed by that battle at report-generation time and is stored in BattleReport metadata. Refs: Game.Core.Tests/Services/BattleReportMetadataTests.cs Game.Core.Tests/Services/ConfigManagerFingerprintTests.cs",
      "When \"config_hash\" is used, the value is computed from the exact consumed config payload and is reproducible for byte-identical payloads. Refs: Game.Core.Tests/Services/ConfigManagerFingerprintTests.cs",
      "When \"config_version\" is used, the value equals the declared version extracted from the exact consumed config and changes when that declared version changes. Refs: Game.Core.Tests/Services/ConfigManagerFingerprintTests.cs",
      "Obligation lock O1: In ConfigManager, add method to compute hash (e.g., SHA256) of config files or extract version fields is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Game.Core.Tests/Services/ConfigManagerFingerprintTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #39 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 39,
    "contractRefs": [
      "Game.Core/Contracts/Config/config-change-audit.schema.json"
    ]
  },
  {
    "id": "NG-0040",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0037"
    ],
    "taskmaster_exported": false,
    "title": "Implement version migration rule with force migration",
    "description": "Develop version handling to force migration when config version changes, without dual-version compatibility, per PRD.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0006",
      "ADR-0008",
      "ADR-0011"
    ],
    "chapter_refs": [
      "CH05",
      "CH10",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs",
      "Game.Core.Tests/Services/ConfigManagerVersionPolicyTests.cs",
      "Game.Core.Tests/Services/ConfigManagerMigrationLoggingTests.cs"
    ],
    "acceptance": [
      "Taskmaster #40 PRD lock is satisfied: version mismatch rejects the loaded config and loads defaults, while a matching version keeps the loaded config. Refs: Game.Core.Tests/Services/ConfigManagerVersionPolicyTests.cs Game.Core.Tests/Services/ConfigManagerMigrationLoggingTests.cs",
      "Referenced automated tests for this task pass on the Windows Godot+C# baseline. Refs: Game.Core.Tests/Services/ConfigManagerVersionPolicyTests.cs Game.Core.Tests/Services/ConfigManagerMigrationLoggingTests.cs",
      "When config version matches expectedVersion, runtime configuration stays on the loaded-config path and does not trigger default fallback. Refs: Game.Core.Tests/Services/ConfigManagerVersionPolicyTests.cs",
      "If a loaded config version differs from the expected version, the loaded config is rejected and runtime configuration falls back to default values. Refs: Game.Core.Tests/Services/ConfigManagerVersionPolicyTests.cs",
      "On version mismatch, an error log entry is emitted that explicitly indicates migration is required. Refs: Game.Core.Tests/Services/ConfigManagerMigrationLoggingTests.cs",
      "No dual-version compatibility path is active: mismatched-version configs are never partially accepted, transformed, or auto-adapted. Refs: Game.Core.Tests/Services/ConfigManagerVersionPolicyTests.cs",
      "Automated unit tests cover both matching and mismatching config versions, and verify fallback occurs only for mismatches. Refs: Game.Core.Tests/Services/ConfigManagerVersionPolicyTests.cs",
      "When a loaded config version equals the expected version, the loaded config is accepted and runtime configuration does not fall back to default values. Refs: Game.Core.Tests/Services/ConfigManagerVersionPolicyTests.cs",
      "Unit tests explicitly assert both paths: matching version keeps loaded config, mismatching version rejects loaded config and triggers default fallback with migration-required logging. Refs: Game.Core.Tests/Services/ConfigManagerVersionPolicyTests.cs Game.Core.Tests/Services/ConfigManagerMigrationLoggingTests.cs",
      "Unit tests explicitly verify that mismatch handling does not activate any compatibility mode or auto-adaptation path. Refs: Game.Core.Tests/Services/ConfigManagerVersionPolicyTests.cs",
      "Version handling applies a single expected-version equality rule: any non-equal version is treated as mismatch and follows reject + default fallback + migration-required logging. Refs: Game.Core.Tests/Services/ConfigManagerVersionPolicyTests.cs Game.Core.Tests/Services/ConfigManagerMigrationLoggingTests.cs",
      "Obligation lock O1: In ConfigManager, check version field of loaded config against expected version is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Game.Core.Tests/Services/ConfigManagerVersionPolicyTests.cs",
      "Forced-migration contract is validated as a trigger matrix: expectedVersion match keeps loaded config, and any non-equal version is treated as migration-required and rejected to default config.",
      "Migration executor behavior is deterministic under this PRD lock: no cross-version compatibility path is accepted, and unsupported or fatal migration handling always resolves to reject-load plus default fallback.",
      "Regression and failure-path tests verify migration diagnostics are emitted for mismatch or fatal migration handling, and runtime state remains default with no partial loaded-config acceptance."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #40 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 40,
    "contractRefs": [
      "Game.Core/Contracts/Config/difficulty-config.schema.json"
    ]
  }
]
