[
  {
    "id": "NG-0001",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [],
    "taskmaster_exported": false,
    "title": "Set up Godot 4.5.1 C# project for Windows",
    "description": "Initialize a Godot 4.5.1 project with C# scripting on Windows, ensuring compatibility with Steam single-player and required dependencies.",
    "status": "pending",
    "priority": "P1",
    "layer": "ci",
    "adr_refs": [
      "ADR-0011",
      "ADR-0001"
    ],
    "chapter_refs": [
      "CH07",
      "CH10",
      "CH01"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "ci"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs"
    ],
    "acceptance": [
      "Task scope is accepted only if deliverables cover all MasterDetails setup steps on Windows (Godot 4.5.1 .NET install, C# project creation, structure setup, Windows export config, startup readiness).",
      "Windows baseline verification succeeds: Godot editor opens the project, C# script compilation succeeds, and a startup scene with an attached script executes.",
      "Running the initialized project twice from a clean editor restart reaches the same startup entry flow without setup-induced core-loop entry regression.",
      "On Windows, Godot 4.5.1 .NET editor and a compatible .NET SDK are installed and detected by the project without missing-SDK warnings.",
      "The project is created and configured for C# scripting, and at least one node-attached C# script builds successfully in the editor.",
      "Executing the startup scene in the Godot editor completes scene load and runs attached C# behavior with no binding, assembly-load, or runtime script errors.",
      "Project layout contains dedicated scenes, scripts, and assets directories, each containing at least one relevant file used by the project.",
      "A Windows Desktop export preset exists, and export execution produces a runnable Windows artifact.",
      "Launching the exported artifact reaches main startup or game flow in standalone single-player mode without requiring multiplayer or backend connectivity.",
      "Scene creation, node wiring, and script attachment are verifiable using Godot built-in SceneTree and Inspector saved bindings.",
      "Acceptance fails if any required check fails: editor startup, C# compile, startup scene load and execute, or Windows export run.",
      "A newly initialized Godot 4.5.1 .NET C# project on Windows generates .sln and .csproj files that compile successfully with the installed .NET SDK.",
      "A startup scene is set as Main Scene in project settings, saved, and after editor restart reloads with node-to-script bindings unchanged.",
      "Acceptance evidence includes successful Windows verification of editor run, C# compile and execute, and startup scene loading with attached script behavior.",
      "Creating a Godot 4.5.1 .NET C# project on Windows succeeds, and opening it shows no missing SDK, missing assembly, or failed restore errors.",
      "Both editor play of the configured Main Scene and launch of the exported Windows build reach startup game flow without runtime C# script errors.",
      "At least one saved startup scene includes an attached C# bootstrap script for core-loop readiness, and this attachment persists after project reopen.",
      "A fresh Godot 4.5.1 .NET project created with C# selected at creation opens directly in the editor without manual language conversion.",
      "All required C# and .NET dependencies needed for editor run and Windows export resolve on Windows; unresolved SDK, assembly, or restore errors reject acceptance.",
      "Windows export settings are validated for Steam single-player by launching the export into offline single-player startup flow with no multiplayer or backend requirement.",
      "Steam compatibility validation is explicit: the Windows export can be launched as a Steam desktop game build with expected startup flow and no Steam-integration blocking errors.",
      "Acceptance is rejected if verification bypasses required steps such as C# build, script attachment checks, or startup scene execution."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #1 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 1,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0002",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0001"
    ],
    "taskmaster_exported": false,
    "title": "Implement config-first balancing system",
    "description": "Create a configuration system to manage game balance values (e.g., wave budgets, day durations) without hardcoding.",
    "status": "pending",
    "priority": "P1",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs"
    ],
    "acceptance": [
      "Taskmaster #2 is accepted only when config-first balancing required by the PRD is observable in runtime day/night, wave, and spawn behavior.",
      "All automated tests referenced by this task pass on the Windows Godot + C# baseline.",
      "Given unchanged configuration input, repeated deterministic simulation runs produce unchanged core-loop outputs (no regression).",
      "A single JSON or INI balance source is loaded by ConfigManager, and loop/wave/spawn systems read balance values only through one global ConfigManager access surface.",
      "Day/Night timing is read from configuration and resolves at runtime to Day=240 seconds and Night=120 seconds.",
      "Normal wave budget parameters are read from configuration and resolve to day1=50 and daily growth=120% (multiplier 1.2).",
      "Spawn cadence and boss count are read from configuration and resolve to spawn cadence=10 seconds and boss count=2.",
      "Elite and boss channel fields exist in configuration and are consumed by runtime wave/spawn channel selection logic.",
      "After editing configuration values and reloading, observable in-game balance behavior changes to the edited values; if configuration is unchanged, reload keeps behavior unchanged.",
      "Verification evidence confirms the listed balance parameters are sourced from ConfigManager reads in gameplay paths rather than hardcoded constants.",
      "With no code changes, replacing only balance configuration values and reloading changes runtime outcomes for day/night cycle length, wave budget progression, spawn cadence, and boss count.",
      "A canonical config contract defines required sections/keys, key names remain stable across revisions, each required key maps to its runtime consumer, and loaded runtime values are verifiable for day/night duration, normal wave day1 budget, normal wave daily growth, elite channel, boss channel, spawn cadence, and boss count.",
      "On initial load, one global typed balance snapshot/API exposes day duration, night duration, normal wave day1 budget, normal wave daily growth, elite channel, boss channel, spawn cadence, and boss count parsed from configuration, with deterministic defaults for absent optional fields.",
      "For missing keys, wrong types, or out-of-range values, validation enforces defined reject/fallback rules, emits actionable reason-coded audit traces, and keeps runtime behavior in the documented fallback state.",
      "Obligation lock O9: Load config file and verify values are correctly parsed is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence.",
      "Obligation lock O11: Use Godot's Resource system or custom file I/O is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #2 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 2,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0003",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0002"
    ],
    "taskmaster_exported": false,
    "title": "Develop runtime state machine for Day/Night cycles",
    "description": "Implement a state machine to manage Day and Night cycles with deterministic progression up to Day15.",
    "status": "pending",
    "priority": "P1",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs"
    ],
    "acceptance": [
      "Taskmaster #3 implementation is limited to Day/Night runtime state-machine behavior up to Day15 and does not introduce unrelated feature behavior.",
      "Automated tests for this task pass on the Windows Godot+C# baseline and cover normal flow, edge timing boundaries, deterministic replay parity, and Day15 terminal-state scenarios.",
      "For identical non-Day/Night inputs, deterministic simulation outputs and core-loop behavior outside this feature remain unchanged.",
      "The runtime state machine exposes exactly two non-terminal cycle states, Day and Night, and rejects any non-Day<->Night transition before terminal completion.",
      "Using configured durations, each Day phase transitions at 4:00 elapsed phase time and each Night phase transitions at 2:00 elapsed phase time.",
      "The tracked day initializes at 1, advances in order without skips, and never exceeds the inclusive range 1-15.",
      "With the same fixed seed and identical inputs/update sequence, phase order, random outcomes, and phase-boundary checkpoints are identical across repeated runs.",
      "Completing Day15 emits exactly one terminal win outcome, and no terminal or win outcome is emitted before Day15 completion.",
      "Cycle timers and transitions advance only via Godot process-loop updates, with monotonic, frame-rate-independent results under fixed-step and variable-step updates.",
      "From runtime start at Day1, the first transition is Day->Night at 4:00 and the next is Night->Day2 at 6:00 total elapsed cycle time.",
      "If process-loop updates do not execute, elapsed cycle time, current state, and current day remain unchanged.",
      "After Day15 completion and terminal win emission, subsequent updates do not advance day above 15 and do not emit additional terminal or win outcomes.",
      "Before a configured phase-duration threshold is reached, cycle state and day remain unchanged; transition occurs only when the threshold is reached during an active update.",
      "A runtime C# GameStateManager instance exposes observable current cycle state (Day/Night), current day (1-15), and transition/terminal signals for downstream consumers.",
      "A reviewed runtime state-machine design artifact must be delivered and linked, explicitly documenting Day/Night state graph, transition conditions, and downstream event consumers; missing artifact fails acceptance."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #3 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 3,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0004",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0002",
      "NG-0003"
    ],
    "taskmaster_exported": false,
    "title": "Implement wave budget and channel system",
    "description": "Set up wave generation with normal, elite, and boss channels based on configurable budgets.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Services/CollisionServiceTests.cs"
    ],
    "acceptance": [
      "Taskmaster #4 behavior matches PRD lock for Implement wave budget and channel system.",
      "Referenced automated tests pass on Windows Godot+C# baseline.",
      "No regression on deterministic simulation and core loop constraints.",
      "A WaveManager C# component is available to generate wave outputs from day index, channel budget config, and seed input.",
      "Given default config (normal day1 budget = 50), the generated normal-channel budget for day 1 equals 50.",
      "For days beyond day 1, normal-channel budget follows the configured daily growth rule (default 120%) and matches expected values across multiple days.",
      "Changing elite-channel budget alone does not change normal-channel budget or normal-channel spawn output for the same day and seed.",
      "Changing boss-channel budget alone does not change normal-channel budget or normal-channel spawn output for the same day and seed.",
      "Enemy allocation per channel is constrained by that channel budget and does not exceed the configured budget.",
      "Using the same fixed seed, day, and config yields identical wave outputs across repeated runs; changing only the seed changes at least one spawn decision.",
      "Independent config tuning for normal, elite, and boss budgets changes only the targeted channel output while non-targeted channel outputs remain unchanged for the same day and seed."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #4 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 4,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0005",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0003",
      "NG-0004"
    ],
    "taskmaster_exported": false,
    "title": "Create enemy spawning system with cadence",
    "description": "Develop a spawning system that continuously spawns enemies during the first 80% of Night with a 10s cadence.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Services/CollisionServiceTests.cs"
    ],
    "acceptance": [
      "Taskmaster #5 PRD lock is satisfied: cadence spawning is active only during the first 80% of Night and emits no new cadence-driven spawns in the final 20%.",
      "Referenced automated tests for this task pass on the Windows Godot+C# baseline and verify Night-window gating, 10-second cadence, boss-count behavior, and spawn-point constraints.",
      "Night spawning behavior is driven by elapsed Night time and timers, producing periodic spawn events rather than per-frame spawning.",
      "With Night duration configured to 120 seconds, new regular enemy spawn events are emitted only while Night elapsed time is less than 96 seconds.",
      "During the spawn-enabled Night window (0-96 seconds), consecutive regular enemy spawn events follow a 10-second cadence.",
      "During the final Night window (96-120 seconds), no new regular cadence spawn events are emitted.",
      "On boss nights, the system emits exactly 2 boss spawns as defined by configuration.",
      "All emitted spawns use predefined in-world spawn points, and no spawn is emitted outside that configured spawn-point set.",
      "Night cadence spawning is active only in Night state; outside Night state, no cadence-driven enemy spawn events are emitted.",
      "For a non-boss Night with at least one configured spawn point, at least one regular enemy spawn event is emitted before Night elapsed reaches 96 seconds.",
      "If Night duration is configured to D seconds, the spawn-enabled window is [0, 0.8D) and the no-new-regular-spawn window is [0.8D, D].",
      "Night duration is configuration-driven rather than hardcoded: when Night duration is set to 150 seconds, regular spawns are allowed only before 120 seconds and no new regular cadence spawns are emitted from 120 to 150 seconds.",
      "For a non-boss Night with Night duration set to 120 seconds and at least one configured spawn point, regular spawn event count in [0,96) is at least 9 and at most 10, and regular spawn event count in [96,120] is 0.",
      "Obligation lock O1: In WaveManager, implement spawning logic during Night state is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence.",
      "Obligation lock O6: In the final 20% of Night [0.8D, D], the system must emit no new enemy spawn events of any type (regular, elite, or boss)."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #5 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 5,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0006",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0001"
    ],
    "taskmaster_exported": false,
    "title": "Implement enemy AI with target priority and pathing",
    "description": "Develop enemy AI that follows target priority rules and handles blocked paths with fallback attacks.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Services/CollisionServiceTests.cs"
    ],
    "acceptance": [
      "Taskmaster #6 behavior implements enemy AI target-priority and blocked-path fallback semantics for Implement enemy AI with target priority and pathing.",
      "Referenced automated tests for priority selection, blocked-path fallback, fixed-seed determinism, and friendly-fire disablement pass on Windows Godot+C# baseline.",
      "No regression is introduced to deterministic simulation behavior or core loop constraints.",
      "In mixed-target scenarios with at least one valid path, each enemy selects a target by strict reachable priority: unit > castle > armed defense > wall/gate.",
      "With identical initial state and fixed random seed, tie-breaks between equal-priority candidates produce the same target choice across repeated runs.",
      "If preferred targets are blocked, the enemy attacks the nearest blocking structure on the blocked route and does not remain idle or switch to unrelated non-blocking targets.",
      "Pathing behavior follows Godot navigation constraints: enemies traverse only navigable routes, and blocked-path scenarios prevent passage through obstacles.",
      "Enemy nodes used in combat scenes have EnemyAI attached and active; missing attachment is detected as a failed configuration in validation/tests.",
      "Player-origin attacks cannot damage friendly/player units, and friendly-fire hit events are absent in collision-layer/mask validation runs.",
      "Whenever at least one higher-priority target has a valid navigation path, the enemy does not select any lower-priority target in that decision cycle.",
      "In blocked-path tests, fallback target selection is validated as the nearest blocking structure on the blocked route by distance, and attack events are directed to that blocker.",
      "In player-attack combat runs, friendly/player damage event count remains zero from start to end, confirming friendly fire stays disabled.",
      "Target selection first filters by navigation reachability, then applies priority order (unit > castle > armed defense > wall/gate); unreachable higher-priority targets are not selected.",
      "With fixed seed and identical initial state, the full decision trace for equal-priority ties and blocked-path fallback target choice is identical across repeated runs.",
      "Obligation lock O1: Combat enemy nodes must have an active EnemyAI C# script attached at runtime; missing attachment is a configuration failure.",
      "Obligation lock O9: Automated tests must verify fixed-seed deterministic behavior across repeated runs for this task."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #6 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 6,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0007",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0001",
      "NG-0006"
    ],
    "taskmaster_exported": false,
    "title": "Set up castle HP and loss condition",
    "description": "Implement castle health system and loss condition when HP reaches 0.",
    "status": "pending",
    "priority": "P2",
    "layer": "ci",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "ci"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs"
    ],
    "acceptance": [
      "Task #7 delivers all required outcomes in one playable flow: castle HP state exists, enemy attacks reduce castle HP, HP=0 triggers loss/game-over, UI shows updated HP, and enemy AI can target the castle.",
      "Automated tests on the Windows Godot+C# baseline pass for castle HP reduction under enemy attacks, loss trigger at HP=0, and transition of game state to loss.",
      "When castle HP is above 0, battle combat resolution continues normally and the game does not enter unintended loss/game-over.",
      "At battle start, castle HP is initialized from the configured starting HP value, and that starting value is above 0.",
      "When an enemy attack is resolved against the castle, castle HP decreases by that attack's resolved damage amount.",
      "If no enemy attack is applied to the castle during an observed interval, castle HP remains unchanged during that interval.",
      "When enemy damage causes castle HP to reach 0, the game immediately transitions to the loss/game-over state.",
      "After the game enters loss/game-over at castle HP=0, normal battle gameplay flow does not continue.",
      "Gameplay UI displays the current castle HP and refreshes the displayed HP value after each castle HP change.",
      "Enemy AI can choose the castle as a valid target, and attacks from that targeting path reduce castle HP.",
      "Loss/game-over is triggered at the HP=0 threshold; while castle HP stays above 0, loss/game-over is not triggered.",
      "Across multiple resolved enemy attacks in one battle, castle HP updates cumulatively, and the UI HP display matches the latest castle HP after each update.",
      "Castle state exposes a readable current HP value from castle script/state for both combat resolution and UI HP update flows.",
      "Changing the configured starting HP value changes castle HP at battle start without requiring code changes.",
      "Obligation lock O1: A concrete Castle C# script (Castle.cs or equivalent) must exist and expose a readable CurrentHp property for gameplay, combat resolution, and UI binding."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #7 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 7,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0008",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0003",
      "NG-0007"
    ],
    "taskmaster_exported": false,
    "title": "Develop win condition and game progression",
    "description": "Implement win condition (survive Day15) and integrate with day progression.",
    "status": "pending",
    "priority": "P3",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs"
    ],
    "acceptance": [
      "Taskmaster #8 is complete only when run progression applies these rules: reaching Day15 with castle HP > 0 results in win, and loss may end the run earlier.",
      "Referenced automated tests for Day15 win trigger, pre-Day15 loss precedence when castle HP = 0, and terminal-state handling pass on the Windows Godot+C# baseline.",
      "With identical inputs and timing, day/night progression yields deterministic win/loss outcomes without core-loop regression.",
      "When current day first reaches Day15 and castle HP is greater than 0, the game enters a win terminal state and displays a win screen or win message.",
      "If castle HP becomes 0 before Day15, the game enters a loss terminal state and emits no win state for that run.",
      "Before any terminal state is reached, day/night progression continues normally, and each progression step evaluates Day15 and castle HP end-state conditions.",
      "After win or loss is triggered, configured end-of-game handling (pause or reset) is applied, and normal progression does not continue without explicit restart/reset.",
      "When current day is below Day15 and castle HP is above 0, the run remains in a non-terminal, non-win progression state.",
      "At the first progression step where current day becomes Day15 and castle HP is greater than 0, win state is entered immediately in that same step.",
      "If castle HP is 0 at or before the Day15 evaluation step, the run remains in loss state and cannot transition to win unless an explicit restart/reset starts a new run.",
      "After entering win or loss, additional day/night ticks do not create extra terminal-state transitions or duplicate win/loss UI emissions in the same run.",
      "A playthrough that reaches Day15 while castle HP remains above 0 triggers win in that run and does not emit loss before restart/reset.",
      "A playthrough where castle HP becomes 0 before reaching Day15 triggers loss and does not emit win in that run.",
      "Before terminal state is reached, each progression update re-evaluates end-state conditions using that run's current day and current castle HP.",
      "Once a terminal state is reached, the run stays terminal and normal progression does not resume until an explicit restart/reset starts a new run.",
      "Obligation lock O1: In GameStateManager, check if current day reaches 15 and castle HP > 0 to trigger win is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #8 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 8,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0009",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0001",
      "NG-0003",
      "NG-0007"
    ],
    "taskmaster_exported": false,
    "title": "Create basic UI for day/night and HP display",
    "description": "Implement a minimal user interface to show current day, time in cycle, and castle HP.",
    "status": "pending",
    "priority": "P3",
    "layer": "adapter",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "adapter"
    ],
    "test_refs": [
      "Tests.Godot/tests/UI/test_hud_scene.gd"
    ],
    "acceptance": [
      "Delivery for Taskmaster #9 remains limited to a minimal HUD for day, cycle time remaining, and castle HP in the main play view.",
      "Referenced automated tests for this task pass on the Windows Godot + C# baseline.",
      "Adding the HUD does not change deterministic simulation outcomes or break core-loop progression rules.",
      "At runtime, the main play view renders three separate HUD values: current day, remaining time in the current Day/Night cycle, and castle HP.",
      "As simulation progresses, the day HUD value tracks the game day counter and stays within 1-15.",
      "While a Day/Night cycle is running, the displayed remaining cycle time updates over time and is not static.",
      "When a Day/Night phase transition occurs, the cycle-time HUD switches to the new phase/timing state without retaining stale previous-phase values.",
      "When gameplay changes castle HP, the HUD HP value updates in the same play session.",
      "If day, cycle remaining time, and HP source values stay unchanged, their HUD values also stay unchanged.",
      "On scene start, all three HUD fields are populated with concrete runtime values before any progression-driven update occurs.",
      "In a session that includes at least one Day/Night transition and one HP change, all three HUD fields remain visible and continue updating without freeze or disappearance.",
      "During normal core-loop gameplay, the three HUD values remain continuously readable on the main play view without opening debug or menu screens.",
      "The main play scene implements these outputs as standard text UI controls (Label or equivalent Control-derived text elements), one distinct field per value.",
      "During active play, each HUD field refreshes automatically from state changes without requiring scene reload, menu toggle, or manual refresh.",
      "In a run with day progression, at least one Day/Night transition, and at least one HP change, all three HUD values visibly track their source values in real time on the main play view.",
      "The delivered HUD stays minimal for this scope by exposing only day, cycle time remaining, and castle HP as directly visible core-loop status outputs.",
      "Obligation lock O6: Update UI in real-time via C# scripts is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #9 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 9,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0010",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0001",
      "NG-0002",
      "NG-0003",
      "NG-0004",
      "NG-0005",
      "NG-0006",
      "NG-0007",
      "NG-0008",
      "NG-0009"
    ],
    "taskmaster_exported": false,
    "title": "Integrate and test full core loop",
    "description": "Combine all systems and test the complete core gameplay loop from start to win/loss.",
    "status": "pending",
    "priority": "P1",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs"
    ],
    "acceptance": [
      "Taskmaster #10 is accepted only if a single integration gate verifies runtime-loop wiring, spawn-channel execution, path-block fallback, and win/loss completion in one end-to-end run.",
      "All automated tests referenced by this task (staged integration and full seeded replay) must pass on the Windows Godot+C# baseline; any failing case blocks acceptance.",
      "Regression runs against the locked baseline must show zero deterministic-simulation drift and zero core-loop rule regression; any drift or rule break fails acceptance.",
      "One playable scene flow must wire Game.Core runtime-loop services through adapters with an explicit deterministic update order, and smoke evidence must show day-night transition, wave start, and terminal win/loss dispatch.",
      "Deterministic checkpoints must be emitted at each major transition, and two Day1-Day15 runs with the same seed must produce the same ordered checkpoint sequence; any sequence mismatch fails acceptance.",
      "Using fully blocked seeded map fixtures, path-block fallback targeting must engage without deadlock and must return to normal targeting after a valid path appears; deadlock or missing recovery fails acceptance.",
      "Normal, elite, and boss-night scenarios must enforce fixed boss-count lock and per-channel accounting isolation; any cross-channel budget leakage fails acceptance.",
      "Each integration slice must run independently and publish consolidated evidence artifacts to logs/e2e and logs/ci with required core-anchor fields for CI inspection and manual debugging handoff.",
      "Staged integration must execute slices in the required order (runtime loop wiring, seeded checkpoints, blocked-map fallback, boss/channel checks, evidence packaging), and each slice must emit an explicit pass/fail result when run independently.",
      "A full seeded end-to-end replay from Day1 through Day15 must reach exactly one terminal state (win or loss) and record deterministic timeline, channel isolation, blocker fallback engagement, and boss-count lock anchors in logs/e2e and logs/ci; missing terminal state or missing anchors fails acceptance.",
      "Spawn-channel behavior must be exercised in staged slices and in the Day1-Day15 replay with observable channel-specific activity and isolated accounting boundaries; no channel activity evidence or cross-channel attribution fails acceptance.",
      "Regression smoke logs must exist for every staged slice and for the final Day1-Day15 replay under logs/e2e and logs/ci, and each log must include required core-anchor fields plus an explicit pass/fail verdict; missing logs or required fields fails acceptance.",
      "Staged integration is accepted only if all five required slices execute to completion in the mandated order with no skipped or inconclusive slice; otherwise acceptance fails.",
      "The Day1-Day15 seeded replay is accepted only if it starts at Day1, reaches Day15, and emits exactly one terminal outcome (win or loss); early abort, non-terminal completion, or multiple terminal outcomes fails acceptance.",
      "Spawn-channel verification requires observable per-channel events and per-channel budget/accounting records in both staged slices and the full Day1-Day15 replay; missing per-channel evidence fails acceptance.",
      "Staged integration must complete all five slices with pass verdicts before Day1-Day15 full seeded replay starts; replay start without staged_complete=true (or with any incomplete slice) fails acceptance.",
      "Blocked-map validation must include reproducible seeded tie cases (equal-priority candidates) and record tie-break sequence; same-seed reruns with any tie-break sequence mismatch fail acceptance."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #10 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 10,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0011",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [],
    "taskmaster_exported": false,
    "title": "Set Up Godot 4.5.1 C# Project for Windows",
    "description": "Initialize a Godot 4.5.1 project with C# support on Windows, ensuring compatibility with Steam single-player and setting up the basic project structure.",
    "status": "pending",
    "priority": "P1",
    "layer": "ci",
    "adr_refs": [
      "ADR-0011",
      "ADR-0001"
    ],
    "chapter_refs": [
      "CH07",
      "CH10",
      "CH01"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "ci"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs"
    ],
    "acceptance": [
      "The delivered setup is a Windows Godot 4.5.1 project with C# workflow enabled, not a non-C# baseline.",
      "All automated checks referenced for the Windows Godot+C# baseline complete successfully.",
      "The initialized baseline can run the basic startup loop without introducing startup instability.",
      "On Windows, the project opens in Godot 4.5.1 with .NET/C# support active and no editor startup errors.",
      "Building C# scripts from the Godot editor completes with zero C# compilation errors.",
      "A main scene is configured as the startup scene, and running the project opens that scene without runtime exceptions.",
      "The project structure contains dedicated directories for scripts, scenes, assets, and config files.",
      "Startup game flow is implemented via Godot C# API and executes when the main scene runs.",
      "C# runtime configuration logic loads and parses at least one JSON balancing/config file without load or parse errors.",
      "Project export settings include a Windows Desktop preset configured for Steam single-player compatibility.",
      "Exporting with the configured Windows preset produces a runnable Windows executable artifact.",
      "Launching the exported Windows executable reaches the initial scene without immediate crash.",
      "If any required open, compile, run, export, or launch validation fails, the task is not accepted.",
      "Validation confirms Godot editor version 4.5.1 and a .NET SDK capable of Godot C# compilation on Windows; if either is missing, the task is not accepted.",
      "During initial scene load, at least one startup-path C# script executes with observable effect, proving non-no-op C# game logic execution.",
      "The validated Windows build launches into a single-player start flow and does not require multiplayer session setup.",
      "Obligation lock O7: Startup-path C# scripts must explicitly apply window initialization settings and load the initial scene; missing either step fails acceptance."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #11 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 11,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0012",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0011"
    ],
    "taskmaster_exported": false,
    "title": "Implement Core Resource System with Integer Safety",
    "description": "Create a resource management system for gold, iron, and population cap, ensuring integer-safe operations to prevent floating-point drift.",
    "status": "pending",
    "priority": "P1",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs"
    ],
    "acceptance": [
      "Taskmaster #12 delivered behavior is limited to implementing resource management for gold, iron, and population cap with integer-safe mutations, excluding unrelated systems.",
      "All automated tests referenced for this task pass on the Windows Godot+C# baseline.",
      "Resource operations and resource-state snapshot serialization are deterministic: identical integer starting state and identical mutation requests produce identical outcomes and identical serialized snapshots.",
      "The ResourceManager contract locks resource names (gold, iron, population cap), integer-only invariants, and initial values, and stores these resources as integer state initialized to gold=800, iron=150, pop-cap=50.",
      "A spend request succeeds only when current gold and iron are each greater than or equal to requested integer costs; on success, exactly those costs are deducted.",
      "If any spend or subtraction request would drive any tracked resource below zero, the request is rejected and all tracked values remain unchanged.",
      "Zero-cost or zero-delta requests have deterministic, repeatable outcomes and keep resource state valid.",
      "Negative inputs to spend/add/subtract are handled by contract as explicit rejection or a defined no-op, with unchanged state when rejected.",
      "Add/subtract/spend arithmetic blocks integer overflow and underflow so no wraparound value can be committed.",
      "Each successful resource state change emits a Godot signal or equivalent event with updated totals plus structured delta and reason fields so UI can refresh from the new state.",
      "Resource logic for gold, iron, and population cap uses integer semantics only and does not rely on floating-point arithmetic.",
      "Valid add/subtract/spend requests on gold, iron, and population cap are applied through defined mutation APIs as exact integer deltas, and resulting values are observable via state reads and emitted update payloads.",
      "When a mutation is refused due to insufficient resources, negative amount, or overflow/underflow risk, all tracked resource values remain exactly at pre-request values.",
      "Spend/add/subtract operations expose success/failure outcomes consistent with state transitions: success only when the requested integer mutation is applied, failure when state remains unchanged.",
      "Automated tests explicitly cover initial values, successful mutations, zero-input behavior, negative-input handling, overflow/underflow refusal, rapid-update event ordering/payload integrity, and snapshot serialization roundtrip parity for gold, iron, and population cap.",
      "Obligation lock O10: Verify no floating-point usage in resource calculations is enforced as a hard acceptance criterion, with regression checks that fail when any resource path introduces float math.",
      "Obligation lock O11: Resource-system unit tests for this task must be implemented in C# test projects and executed by NUnit or an equivalent .NET test framework.",
      "Obligation lock O1: This task must implement a C# ResourceManager that tracks gold, iron, and population cap as integer state.",
      "Obligation lock O2: Initial resource state must be exactly gold=800, iron=150, and pop-cap=50."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #12 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 12,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0013",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0011",
      "NG-0012"
    ],
    "taskmaster_exported": false,
    "title": "Design and Implement Building System with Footprint Rules",
    "description": "Develop a building system that supports core buildings (castle, residence, mine, barracks, MG tower, wall, mine trap) with footprint rules and placement logic.",
    "status": "pending",
    "priority": "P1",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Tests.Godot/tests/UI/test_hud_scene.gd"
    ],
    "acceptance": [
      "Taskmaster #13 delivers backend building-system behavior for castle, residence, mine, barracks, MG tower, wall, and mine trap with footprint-governed placement within the defined scope.",
      "Referenced automated tests pass on the Windows Godot+C# baseline.",
      "For the same grid state, resource state, seed, and input sequence, placement, gate-pathing, and refusal outcomes are deterministic and do not break core loop behavior.",
      "Canonical building archetypes exist for castle, residence, mine, barracks, MG tower, wall, and mine trap, and each provides type, level, footprint size, HP, and cost for placement and spend checks.",
      "Placement enforces footprint values from the task details: castle=4, barracks=2, MG tower=1, wall=1.",
      "A build request is accepted only when every cell in the target footprint is in-bounds and free; otherwise it is refused with a deterministic validation reason code.",
      "If any target cell is out of bounds, blocked, or already occupied, the request is refused, no building is created, and resources remain unchanged.",
      "If resources are below the selected building cost, the request is refused, no building is created, and resources remain unchanged.",
      "On successful build, resources are deducted exactly once and committed occupied cells exactly equal the accepted footprint.",
      "Wall drag-line mode creates contiguous wall segments along the dragged grid path on valid cells; invalid cells create no segment and consume no resources.",
      "Gate one-way rules are enforced in pathing: wall segments block traversal except gate cells, and each gate allows traversal only in its configured direction.",
      "Automated validation includes valid and invalid placement, boundary and collision rejection, spend-on-success and rollback-on-failure, wall drag-line behavior, gate behavior, blocked-path fallback, and deterministic gate tie handling.",
      "Placement validation and occupancy tracking use discrete grid coordinates (TileMap or equivalent custom grid), and accepted placements never commit off-grid occupancy.",
      "For every supported building type (castle, residence, mine, barracks, MG tower, wall, mine trap), placement and cost checks use that type's configured footprint and cost values.",
      "A shared C# Building base type defines type, level, footprint size, HP, and cost, and each listed core building type is implemented as a concrete subtype consumed by validation and build transactions.",
      "Placement eligibility is atomic across the full footprint: if any required cell is invalid, placement is refused and neither occupancy nor resource state changes.",
      "Automated tests include at least one success case and one refusal case per concrete building subtype, asserting subtype-specific footprint and cost validation.",
      "Validation and test runs expose debug-visible footprint boundaries and occupied-cell overlays that match final committed grid cells for successful placements."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #13 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 13,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0014",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0012",
      "NG-0013"
    ],
    "taskmaster_exported": false,
    "title": "Implement Economy and Tax System for Residences",
    "description": "Add economy features where residences generate gold tax every 15 seconds and provide population capacity.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs"
    ],
    "acceptance": [
      "Task 14 is complete only when a successful Residence build increases population cap and built Residences generate tax gold on a 15-second cadence.",
      "Automated tests that verify Residence 15-second tax timing and ResourceManager gold addition pass on the Windows Godot+C# baseline.",
      "Residence economy updates are deterministic for identical build and timer inputs and are not frame-rate dependent.",
      "Each successful Residence placement increases population cap by exactly the configured population-cap value once for that placement.",
      "After a Residence is built, ResourceManager gold does not increase from Residence tax before the first 15-second timeout, then increases by the configured per-tick tax at each timeout.",
      "Residence tax per tick is sourced from configuration, including level-based tax values when such configuration exists.",
      "Residence-driven gold and population-cap updates remain integer-safe over repeated ticks, with no fractional accumulation or floating-point drift in stored totals.",
      "If no Residence is built, Residence tax processing contributes zero gold change.",
      "Verification includes unit coverage for 15-second tax cadence and gold addition, plus in-game validation that placement raises population cap and gold increments every 15 seconds on Windows Godot+C#.",
      "Failed or canceled Residence placement leaves population cap and gold unchanged and does not start Residence tax cadence.",
      "When multiple Residences are built, each 15-second payout increases gold by the sum of configured taxes for all eligible built Residences.",
      "In a controlled 45-second observation window after one successful Residence build, exactly three payouts occur at 15s, 30s, and 45s, and cumulative gold gain equals three times the configured per-tick tax for that Residence context.",
      "A single successful Residence placement event is idempotent for population-cap gain: reprocessing the same placement event cannot create an additional cap increment.",
      "Obligation lock O1: Extend the Building system for Residence class is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence.",
      "Obligation lock O5: Use a timer in Godot (Timer node) to trigger tax every 15 seconds: add gold to ResourceManager is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #14 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 14,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0015",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0013",
      "NG-0014"
    ],
    "taskmaster_exported": false,
    "title": "Develop Upgrade and Repair System with Constraints",
    "description": "Create a system for building upgrades (max level 5, no skipping) and repairs, with economic rules and constraints.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs"
    ],
    "acceptance": [
      "Taskmaster #15 implementation behavior is limited to the upgrade/repair rules and constraints defined for Develop Upgrade and Repair System with Constraints.",
      "All referenced automated tests for Taskmaster #15 pass on the Windows Godot+C# baseline.",
      "With deterministic inputs, behavior outside upgrade/repair effects remains deterministic with no unintended regression to core loop constraints.",
      "Upgrade start is permitted only when state is Idle, level is below 5, and config-defined upgrade resource cost is affordable.",
      "Each completed successful upgrade increases level by exactly 1; level skipping is refused and level never exceeds 5.",
      "If an upgrade request is invalid (non-Idle state, insufficient resources, or level already 5), upgrade does not start and level/state/resources remain unchanged.",
      "On upgrade completion, current HP is restored to full HP.",
      "When upgrade cost values change in configuration, subsequent upgrade charges use the updated configured values.",
      "Repair consumes gold only; repairing from damaged HP to full HP deducts total gold equal to 50% of the building build cost.",
      "Repair is applied incrementally over time (not as an instant full heal) until HP reaches full.",
      "Upgrade and repair are mutually exclusive; starting one while the other is active is refused and cannot create concurrent Upgrading and Repairing activity.",
      "When a progress operation completes, state returns to Idle, and automated tests verify level progression, cost rules, HP restoration, conflict handling, integer-safe arithmetic, and config-driven values on the Windows Godot+C# baseline.",
      "Upgrade and repair complete asynchronously through progress flow (queue/coroutine/timer driven), so completion outcomes are observable only after progress updates, not in the same tick as a successful start request.",
      "Repair start is permitted only when state is Idle, current HP is below full HP, and required gold is payable; if invalid (non-Idle, full HP, or insufficient gold), repair does not start and HP/state/gold remain unchanged.",
      "For any starting HP below full HP, cumulative gold deducted across incremental repair steps to full HP equals exactly 50% of build cost, using deterministic integer-safe arithmetic that never overcharges.",
      "While state is Upgrading or Repairing, additional upgrade/repair start requests are rejected and do not create duplicate or parallel progress flows for the same building.",
      "A successful upgrade start deducts exactly one config-defined upgrade cost for the current level, transitions state to Upgrading immediately, and does not change level or restore HP in that same tick.",
      "Repair progress updates HP in multiple deterministic integer-safe steps and deducts gold cumulatively so no single step can overcharge beyond the remaining amount needed to reach full HP.",
      "State transitions cannot bypass Idle: once Upgrading or Repairing has started, switching to the other operation is refused until the active operation completes and state returns to Idle.",
      "Obligation lock O1: Add upgrade and repair functionality to Building class is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence.",
      "Obligation lock O10: public enum BuildState { Idle, Upgrading, Repairing }; is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence.",
      "Obligation lock O11: Progress flow implementation must use Godot queue or coroutine mechanisms; timer-only implementation is rejected as insufficient acceptance evidence."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #15 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 15,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0016",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0013",
      "NG-0014"
    ],
    "taskmaster_exported": false,
    "title": "Implement Unit Training Queue in Barracks",
    "description": "Add unit training functionality to barracks with a single queue per barracks, cancellable with 100% refund.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs"
    ],
    "acceptance": [
      "Each Barracks instance owns exactly one unit-training queue, and canceling any queued job refunds 100% of that job's deducted resources.",
      "Referenced automated tests for Task #16 pass on the Windows Godot+C# baseline.",
      "Changes are limited to Barracks training-queue behavior; deterministic simulation behavior outside that scope remains unchanged.",
      "Queue operations on one Barracks (enqueue/cancel/progress) do not mutate queue state in any other Barracks instance.",
      "When a training request is accepted, deductions follow that unit's config-defined timing; if required request-time payment cannot be made, the request is rejected and queue/resource totals remain unchanged.",
      "Training jobs execute in FIFO order with config-driven durations, and each completed head job is removed once and produces exactly one trained unit result.",
      "Canceling with a valid index removes only the targeted job, refunds 100% of that job's deducted resources, and preserves the relative order of remaining jobs.",
      "Canceling with an invalid index is rejected and leaves queue contents and resource totals unchanged.",
      "Godot signals are emitted on enqueue, cancel, and completion so UI updates can be driven by emitted queue/resource state changes.",
      "Training and cancellation resource arithmetic is integer-safe: no overflow, no underflow, and no negative resource totals.",
      "Canceling the currently active head job is supported: that job is removed, refunded 100% of deducted resources, produces no unit, and remaining jobs continue in order.",
      "No training job completes before its configured duration elapses.",
      "For staged-cost configuration, each staged deduction occurs only at its configured progress/time point and for the configured integer amount.",
      "For any job canceled after partial or full in-progress deductions, total refunded resources for that job equal total resources deducted for that job.",
      "Per-job configuration is authoritative for cost: across upfront, staged, or mixed deduction timing, summed integer deductions for a job equal configured cost, and cancellation refunds exactly that job's deducted total.",
      "Obligation lock O1: Create a Barracks class extending Building is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence.",
      "Obligation lock O2: Implement a training queue (List or Queue in C#) for units is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence.",
      "Obligation lock O8: Unit tests for queue operations, resource deduction/refund on cancel is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence.",
      "Obligation lock O10: At least one in-game test must pass for the scenario multi-unit training + mid-training cancel + exact refund + queue-state correctness, and this evidence must be traceable."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #16 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 16,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0017",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0013",
      "NG-0016"
    ],
    "taskmaster_exported": false,
    "title": "Design and Integrate Tech Tree for Unit Stats",
    "description": "Develop a config-driven tech tree that affects unit stats (atk speed %, damage, production speed %, range, HP, cost %).",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs"
    ],
    "acceptance": [
      "Given a valid tech-tree JSON resource loaded via Godot Resource APIs, runtime exposes node IDs, prerequisites, and stat modifiers exactly as defined in that resource.",
      "Referenced automated tests for JSON loading/parsing and stat-multiplier calculations pass on the Windows Godot + C# baseline.",
      "With identical JSON config and identical unlock state, repeated evaluations return identical stat multipliers and identical barracks-trained unit stats.",
      "Tech node definitions and unlock requirements are sourced from JSON resource data at runtime, and the in-memory node set equals the active config content.",
      "For attack speed, damage, production speed, range, HP, and cost, unlocked node effects are combined multiplicatively rather than additively.",
      "When no unlocked node defines a modifier for a stat, that stat multiplier remains 1.0 and newly barracks-trained units keep baseline values for that stat.",
      "After configured tech nodes are unlocked, units trained from barracks reflect stat values equal to baseline multiplied by current computed multipliers.",
      "Unlock progression is config-driven: modifying prerequisite/unlock-path data in JSON changes unlock availability after reload without C# source edits.",
      "Automated parsing tests assert that runtime node IDs, prerequisite links, and modifier values match the JSON resource content.",
      "Unit tests verify multiplicative stacking across multiple unlocked nodes (for example 1.1 x 1.2 = 1.32) and verify locked nodes are excluded.",
      "In-game verification unlocks configured techs, trains barracks units, and confirms attack speed, damage, production speed, range, HP, and cost equal baseline x configured multipliers.",
      "If prerequisites are not satisfied in current config state, the target tech remains unavailable and output stats stay unchanged from currently applicable multipliers.",
      "Any tech node present in JSON but not unlocked at evaluation time contributes no modifiers and does not affect newly barracks-trained unit stats.",
      "Changing only JSON multiplier values or prerequisite links, then reloading config, changes computed multipliers and barracks-trained outcomes without changing C# source.",
      "Switching between two valid JSON tech-tree resources without C# source changes produces unlock availability and barracks-trained unit stats that follow the active resource.",
      "For each supported stat (attack speed, damage, production speed, range, HP, cost), runtime multiplier equals the product of modifiers from currently unlocked nodes that define that stat.",
      "Obligation lock O1: Create a TechTreeManager class is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence.",
      "Obligation lock O7: public float GetStatMultiplier(string stat) { // Calculate based on unlocked techs } is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence.",
      "TechTreeManager is the loading owner: it must load tech definitions from JSON config via Godot Resource APIs and build the runtime node set; delegating JSON load ownership outside TechTreeManager fails acceptance.",
      "TechTreeManager must maintain ID-keyed node storage as private Dictionary<string, TechNode> nodes (or an audit-equivalent private dictionary with string keys and TechNode values), verifiable by tests or audit evidence."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #17 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 17,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0018",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0012",
      "NG-0014"
    ],
    "taskmaster_exported": false,
    "title": "Implement Reward System with Nightly Choices",
    "description": "Add a reward system that triggers each night, offering 3 choices from separate pools, with fallback to gold if pool is exhausted.",
    "status": "pending",
    "priority": "P3",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs"
    ],
    "acceptance": [
      "Taskmaster #18 is accepted only when nightly rewards match scope: one reward trigger per night, three choices from the active night-type pool when available, and fixed-gold fallback when that pool yields zero choices.",
      "Referenced automated tests pass on the Windows Godot + C# baseline for Taskmaster #18 reward behavior.",
      "Nightly reward handling completes without blocking or skipping normal day/night progression outside intended reward effects.",
      "When the day/night cycle enters a night phase, exactly one reward trigger occurs for that night and reward generation uses that active night type.",
      "Given an active night type with at least three available entries in its configured pool, the system presents exactly three reward choices sourced from that pool.",
      "Reward pools are loaded from JSON configuration keyed by night type, and modifying the JSON changes subsequently generated choices without code changes.",
      "Each generated choice is a supported reward kind (resource, unit, or bonus) and is visible in the Godot UI for night reward selection.",
      "If the active night-type pool yields zero choices, the system grants the configured fixed fallback gold amount exactly once for that trigger and does not present selectable reward choices for that trigger.",
      "Automated coverage includes choice generation, pool exhaustion, fallback-to-gold behavior, and JSON-driven pool selection; in-game night progression verifies reward presentation and fallback behavior.",
      "Reward processing does not trigger during non-night phases, and no reward-choice UI or fallback gold is produced outside a night trigger.",
      "For any night trigger where generated choice count is greater than zero, fallback gold is not granted for that trigger.",
      "Across consecutive nights with different night types, each trigger uses the currently active night-type pool, and presented choices correspond to that active night type.",
      "For any night trigger with presented choices, selecting one choice applies exactly one corresponding reward effect and does not apply effects from non-selected choices.",
      "Each processed night reward trigger has a verifiable non-noop outcome: either reward-choice UI is presented for selection or fixed-gold fallback is granted.",
      "Within a single night reward trigger, all presented choices originate only from the active night-type pool and do not mix entries from other night-type pools.",
      "Changing the configured fixed fallback gold value updates the granted fallback amount on subsequent exhausted-pool night triggers without code changes.",
      "Obligation lock O1: Create a RewardManager class is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #18 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 18,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0019",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0011",
      "NG-0013"
    ],
    "taskmaster_exported": false,
    "title": "Add Day/Night Cycle and Game Win/Lose Conditions",
    "description": "Implement the day/night cycle (4 min Day + 2 min Night, Day1-Day15) and win/lose conditions based on castle HP.",
    "status": "pending",
    "priority": "P1",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs"
    ],
    "acceptance": [
      "Runtime behavior includes a GameManager-controlled game-state flow that governs phase timing, day progression, and win/lose evaluation for this feature.",
      "Referenced automated tests for this feature pass on the Windows Godot+C# baseline.",
      "Given the same initial state and timing inputs, cycle progression and terminal outcomes remain deterministic for the core loop.",
      "A gameplay cycle runs Day for 240 seconds then Night for 120 seconds, in that fixed order, with no skipped or reordered phases.",
      "Game state exposes current day and cycle progress, and day numbering advances sequentially from Day1 to Day15 only after each full Day+Night cycle.",
      "If castle HP reaches 0 or below at any point, the run transitions to Lose immediately and must not later transition to Win.",
      "If castle HP stays above 0 through completion of Day15, the run transitions to Win and must not later transition to Lose.",
      "Win/Lose checks consume castle HP from the building/castle gameplay source of truth rather than UI-only displayed values.",
      "Godot signals are emitted for UI-observable state updates, including day counter updates when day progression occurs.",
      "End-to-end validation demonstrates both terminal paths: forced castle destruction triggers Lose, and surviving through the required cycle length triggers Win.",
      "Configured timing for 15 full days is approximately 90 minutes (15 x (4 + 2) minutes), meeting the stated 60-90 minute match-duration target boundary.",
      "Runtime-observable state includes current phase plus elapsed or remaining phase time so tests/UI can verify day-night progress without private-field access.",
      "A full win-path sequence is observable from Day1->Night1 through Day15->Night15 before terminal Win, and no Day16 phase begins.",
      "After entering either terminal state (Win or Lose), phase transitions stop and no further day progression updates are emitted.",
      "Automated unit tests explicitly assert both terminal predicates: (a) castle HP <= 0 triggers Lose, and (b) surviving through completion of Day15->Night15 with castle HP > 0 triggers Win.",
      "Timing verification tests measure phase durations and fail when observed Day or Night duration deviates from 240s/120s beyond defined test tolerance.",
      "Phase switches are timer-driven and occur automatically at 240s/120s boundaries; Day->Night and Night->next-Day transitions require no manual player action.",
      "Day numbering increments exactly once per completed Day+Night pair and does not increment on the Day->Night boundary alone.",
      "Terminal-condition evaluation continues during cycle progression, and if castle HP <= 0 during Day15 or Night15, the terminal outcome is Lose rather than Win.",
      "Win is emitted only after completion of Day15->Night15 with castle HP > 0, and exactly one terminal outcome (Win or Lose) is emitted per run."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #19 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 19,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0020",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0013",
      "NG-0016",
      "NG-0017"
    ],
    "taskmaster_exported": false,
    "title": "Integrate Combat with Friendly Fire Disabled",
    "description": "Implement combat system for units and towers, with friendly fire disabled for all player attacks.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs"
    ],
    "acceptance": [
      "Taskmaster #20 behavior matches PRD lock for Integrate Combat with Friendly Fire Disabled.",
      "Referenced automated tests pass on Windows Godot+C# baseline.",
      "No regression on deterministic simulation and core loop constraints.",
      "If attacker and target share the same team/owner, the attack is refused and target HP remains unchanged.",
      "Player-owned units can damage enemy units or enemy buildings when a valid target is in attack range.",
      "MG towers can acquire and damage enemy targets, and never damage same-team units or same-team walls.",
      "Attack damage uses current config/tech-tree-derived stats for the attacker, and stat changes produce corresponding damage changes.",
      "Automated verification includes unit tests for attack resolution and friendly-fire prevention plus an in-game scenario covering player units, enemies, MG towers, and walls where only enemies are hit.",
      "CombatSystem provides a shared attack-resolution path for both unit and MG tower attacks, and both paths enforce the same team/owner friendly-fire block before any damage is applied.",
      "Target acquisition uses in-range detection (physics query or area overlap), so attacks execute only against detected enemy targets in range, while non-detected or out-of-range targets receive no damage."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #20 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 20,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0021",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [],
    "taskmaster_exported": false,
    "title": "Set Up Godot 4.5.1 C# Project with Windows Configuration",
    "description": "Initialize a Godot 4.5.1 project with C# scripting, configure for Windows-only Steam single-player, and establish project structure.",
    "status": "pending",
    "priority": "P1",
    "layer": "ci",
    "adr_refs": [
      "ADR-0011",
      "ADR-0001"
    ],
    "chapter_refs": [
      "CH07",
      "CH10",
      "CH01"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "ci"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs"
    ],
    "acceptance": [
      "Taskmaster #21 behavior matches PRD lock for Set Up Godot 4.5.1 C# Project with Windows Configuration.",
      "Referenced automated tests pass on Windows Godot+C# baseline.",
      "No regression on deterministic simulation and core loop constraints.",
      "Project opens in Godot 4.5.1 with C# scripting enabled and C# project files generated without initialization errors.",
      "Project settings set application/config/name to \"LASTKING\" and application/run/main_scene to \"res://scenes/Main.tscn\".",
      "Project settings set display/window/size/width to 1920 and display/window/size/height to 1080.",
      "Export presets include Windows Desktop (64-bit) and a Steam App ID placeholder for single-player configuration.",
      "Non-Windows export targets are disabled or absent; enabling other platform targets fails acceptance.",
      "Required project folders exist for scripts, scenes, configs, saves, and game assets organization (including assets, ui, and audio paths).",
      "Main scene at res://scenes/Main.tscn runs on Windows without startup errors and emits console output containing \"Project setup complete\" from an attached C# script.",
      ".NET SDK/toolchain configured for the project is compatible with Godot 4.5.1 C# and supports successful build/run."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #21 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 21,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0022",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0021"
    ],
    "taskmaster_exported": false,
    "title": "Implement Camera and Interaction System with Edge and Keyboard Scrolling",
    "description": "Develop camera controls for edge scrolling and keyboard-based scrolling in the game world.",
    "status": "pending",
    "priority": "P1",
    "layer": "adapter",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "adapter"
    ],
    "test_refs": [
      "Tests.Godot/tests/UI/test_hud_scene.gd"
    ],
    "acceptance": [
      "Taskmaster #22 delivers a playable camera control system where both edge scrolling and keyboard scrolling are implemented for world navigation.",
      "Referenced automated tests pass on Windows Godot+C# baseline and verify edge scrolling, keyboard scrolling, and world-boundary clamping behaviors.",
      "Camera scrolling logic does not regress core loop behavior: with no scroll input camera position remains unchanged, and with sustained scroll input updates remain responsive without observable stutter.",
      "When the mouse cursor enters a configurable edge margin near each viewport border, the camera moves in the corresponding world direction; when the cursor is outside all edge margins and no scroll keys are pressed, camera position does not change.",
      "Pressing scroll actions mapped to Arrow keys and WASD moves the camera in the expected cardinal directions, and releasing those keys stops keyboard-driven scrolling.",
      "Camera translation is smooth and frame-rate independent, with movement scaled by delta time and a configurable scroll speed value that can be adjusted without code changes.",
      "Camera movement is clamped to configured world boundaries so the visible area cannot be scrolled beyond map limits on any side.",
      "Edge scrolling and keyboard scrolling can both be active in the same frame without input loss, and resulting movement remains continuous.",
      "A CameraController with an active Camera2D is present in the playable scene, and camera movement is applied through that camera.",
      "With default configuration, entering within 20 pixels of any viewport edge triggers movement toward that edge, and scroll input is read through Godot Input plus viewport mouse-position events."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #22 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 22,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0023",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0021"
    ],
    "taskmaster_exported": false,
    "title": "Develop Runtime Speed Controls (Pause, 1x, 2x) with Timer Freeze",
    "description": "Implement game speed controls including pause, 1x, and 2x speeds, ensuring all timers freeze during pause.",
    "status": "pending",
    "priority": "P1",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs"
    ],
    "acceptance": [
      " Pause1x2x ",
      " Windows Godot+C# ",
      "",
      " Pause  0x",
      " 1x  1x",
      " 2x  2x 1x",
      "Pause ",
      " Pause ",
      " Pause1x2x ",
      " Pause ",
      " Pause  1x  2x ",
      "Pause ",
      " Pause1x2x ",
      " Pause ",
      "2x  1x",
      " 1x -> 2x -> 1x ",
      "Pause  Pause ",
      " Pause  1x/2x",
      "2x > 1x > Pause(0x)",
      " Pause  Pause Pause ",
      "Obligation lock O2: Create a GameManager singleton to manage game state and speed is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence.",
      "Obligation lock O3: Implement pause functionality that sets Engine.TimeScale to 0 and freezes all custom timers is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence.",
      "Obligation lock O4: For 1x and 2x speeds, set TimeScale to 1 and 2 respectively is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence.",
      "Obligation lock O6: Use Godot's ProcessMode to handle pausing of nodes is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #23 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 23,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0024",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0021"
    ],
    "taskmaster_exported": false,
    "title": "Create UI Feedback System for Invalid Actions and Errors",
    "description": "Implement UI feedback for invalid placement, blocked actions, and migration/load errors with clear user-facing messages.",
    "status": "pending",
    "priority": "P2",
    "layer": "adapter",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "adapter"
    ],
    "test_refs": [
      "Tests.Godot/tests/UI/test_hud_scene.gd"
    ],
    "acceptance": [
      "Taskmaster #24 delivers user-facing UI feedback for all required scenarios: invalid placement, blocked actions, and migration/load failures.",
      "Automated tests that exercise invalid placement, blocked actions, and migration/load failure feedback pass on the Windows Godot+C# baseline.",
      "For valid actions, deterministic simulation outputs and core-loop state transitions remain unchanged after this change.",
      "When placement is invalid (including blocked placement or invalid terrain), the gameplay UI shows a temporary human-readable message (for example, \"Cannot build here.\"), and that message auto-hides after a short timeout.",
      "When an action is blocked, the UI feedback includes the concrete blocking reason, and the blocked action is refused without changing game state.",
      "When migration or load fails (including corrupted save input), a persistent error dialog is shown with error details and remains visible until the user dismisses it.",
      "Temporary feedback is non-intrusive: while visible, it does not block normal gameplay interaction.",
      "Feedback display is event-driven: invalid placement, blocked action, and migration/load error events each trigger their corresponding UI feedback output.",
      "On an invalid placement attempt, placement is refused and no new entity is committed to game state while the temporary feedback is shown.",
      "The migration/load error dialog is dismissible only by explicit user action and does not auto-hide.",
      "For blocked actions and migration/load failures, the displayed message content reflects the concrete triggering reason/details rather than a generic placeholder.",
      "Temporary feedback content for invalid placement is human-readable and non-empty in the active gameplay UI (not only logs/internal codes).",
      "A timing check confirms temporary feedback is hidden after its configured short timeout and remains hidden unless a new triggering event occurs.",
      "The persistent migration/load error dialog exposes an explicit dismiss control, and using it closes the dialog and returns normal UI control.",
      "Obligation lock O11: Use Godot's Control nodes for UI is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence.",
      "Obligation lock O12: Design a UIFeedbackManager that displays messages via a label or popup is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #24 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 24,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0025",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0021"
    ],
    "taskmaster_exported": false,
    "title": "Build Save System with Autosave and Migration Handling",
    "description": "Develop a save system with one autosave slot, start-of-day autosaves, and migration for invalid configs/loads.",
    "status": "pending",
    "priority": "P1",
    "layer": "adapter",
    "adr_refs": [
      "ADR-0006",
      "ADR-0008",
      "ADR-0011"
    ],
    "chapter_refs": [
      "CH05",
      "CH10",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "adapter"
    ],
    "test_refs": [
      "Tests.Godot/tests/Integration/test_backup_restore_savegame.gd"
    ],
    "acceptance": [
      "All save operations target the single Windows-safe user path user://autosave.save as the only autosave slot.",
      "Repeated save operations overwrite the same autosave slot file and do not create additional save-slot files.",
      "Each in-game day-start event triggers exactly one autosave operation.",
      "Across multiple day-start events, autosave continues writing to the same autosave path and creates no extra slot files.",
      "Loading a valid autosave restores persisted game state, seed, and wave timer values.",
      "A save-then-load round trip reproduces game state, seed, and wave timer exactly as captured at save time.",
      "If no autosave file exists, load returns a deterministic failure outcome, shows explicit user feedback, and leaves runtime state unchanged.",
      "If save-file read or write fails, the operation returns a deterministic failure outcome with explicit user feedback and no crash.",
      "If save content is invalid or corrupt, load fails with explicit user feedback and applies no partial runtime state.",
      "The save payload includes version information and persisted runtime data required to restore game state, seed, and wave timer.",
      "On load, version compatibility is validated before any persisted field is applied to runtime state.",
      "If save version is incompatible with the current version, load is rejected, a user-visible migration error is shown, and runtime state remains unchanged.",
      "Save and load use one selected serialization format (JSON or binary) consistently for this save file.",
      "If deserialization fails for the selected format, load reports explicit failure and applies no runtime state changes.",
      "Obligation lock O1: Create a SaveManager that handles saving and loading game state to a file is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence.",
      "On the first in-match day-start autosave trigger, user://autosave.save must be created and the creation outcome must be auditable via test assertion or log evidence; missing file creation fails acceptance."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #25 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 25,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0026",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0025"
    ],
    "taskmaster_exported": false,
    "title": "Integrate Steam Cloud Save with Account Binding",
    "description": "Implement Steam cloud save functionality using Steam account binding for save data synchronization.",
    "status": "pending",
    "priority": "P2",
    "layer": "adapter",
    "adr_refs": [
      "ADR-0006",
      "ADR-0008",
      "ADR-0011"
    ],
    "chapter_refs": [
      "CH05",
      "CH10",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "adapter"
    ],
    "test_refs": [
      "Tests.Godot/tests/Integration/test_backup_restore_savegame.gd"
    ],
    "acceptance": [
      "Taskmaster #26 behavior matches PRD lock for Integrate Steam Cloud Save with Account Binding.",
      "Referenced automated tests pass on Windows Godot+C# baseline.",
      "No regression on deterministic simulation and core loop constraints.",
      "When a Steam development account is logged in, triggering save through the existing SaveManager uploads the active save file to Steam Cloud and reports a successful upload result.",
      "After a successful cloud upload, restarting the game and loading the same profile restores save data from Steam Cloud, and the loaded data matches the previously uploaded save content.",
      "If local and cloud save versions conflict, the game blocks automatic overwrite and shows a user choice prompt before deciding which version to load.",
      "If upload or download fails due to network/API/unavailable cloud conditions, the failure is surfaced to the user and the pre-existing local save file remains unchanged.",
      "Save data is bound to the current Steam account identity, and cloud operations only read/write that account's cloud save scope.",
      "Steam Cloud integration remains compatible with the current SaveManager workflow, and local save/load continues to work when Steam Cloud is unavailable.",
      "In a Steam development environment, downloading cloud save data to a clean local target after upload restores the same profile state with no missing persisted fields.",
      "When a local-vs-cloud conflict prompt is shown, choosing the local option loads local data for that operation without automatic cloud overwrite, and choosing the cloud option loads cloud data for that operation.",
      "When no valid Steam login is present, cloud sync is explicitly skipped with user-visible status, and SaveManager local save/load still completes successfully without save corruption.",
      "Cloud sync calls are executed against Steam API integration (Steamworks.NET or GodotSteam) in the Steam development environment, and are verifiable as real Steam Remote Storage operations for the logged-in Steam account (not local-only mock behavior)."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #26 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 26,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0027",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0021"
    ],
    "taskmaster_exported": false,
    "title": "Implement Achievements System with Deterministic Unlocking",
    "description": "Create an achievements system with a visible list, non-hidden achievements, and deterministic unlock triggers.",
    "status": "pending",
    "priority": "P2",
    "layer": "adapter",
    "adr_refs": [
      "ADR-0006",
      "ADR-0008",
      "ADR-0011"
    ],
    "chapter_refs": [
      "CH05",
      "CH10",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "adapter"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs"
    ],
    "acceptance": [
      "Taskmaster #27 behavior matches the PRD lock for Implement Achievements System with Deterministic Unlocking.",
      "Referenced automated tests for this task pass on the Windows Godot+C# baseline.",
      "Deterministic simulation and core loop constraints remain unchanged with no regression introduced by this task.",
      "At startup, achievement definitions are loaded from configuration, and each loaded definition provides an ID, name, description, and unlock condition.",
      "Before any unlock condition is satisfied, all configured achievements are present as visible (non-hidden) entries.",
      "Given the same ordered game-event sequence across repeated runs, the same achievement IDs unlock at the same trigger points, and no additional achievements unlock.",
      "Processing an already unlocked achievement ID does not produce duplicate unlock state transitions, duplicate notifications, or duplicate persistence/sync writes.",
      "If Steamworks integration is enabled, unlocking a valid achievement updates Steam achievement state and stores stats; if disabled, local unlock state and UI flow still complete without external API dependency.",
      "After configuration load, every configured achievement ID has tracked state initialized to locked until its unlock condition is met.",
      "Events or unlock requests that do not map to a valid, currently unlockable achievement leave unlock state unchanged and emit no notification or external sync call.",
      "Obligation lock O1: A single AchievementManager (or equivalent sole coordinator) must own achievement progress tracking and unlock orchestration.",
      "Obligation lock O2: Achievement definitions must load from external configuration files (JSON or equivalent), and code hardcoding cannot be the only data source.",
      "Obligation lock O10: Automated test gates must explicitly cover unlock trigger plus UI update, achievements list presentation, deterministic repeat actions, and Steam verification when enabled on Windows baseline."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #27 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 27,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0028",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0021"
    ],
    "taskmaster_exported": false,
    "title": "Set Up Localization (i18n) for zh-CN and en-US",
    "description": "Implement key-based internationalization workflow supporting zh-CN and en-US at launch.",
    "status": "pending",
    "priority": "P2",
    "layer": "ci",
    "adr_refs": [
      "ADR-0006",
      "ADR-0008",
      "ADR-0011"
    ],
    "chapter_refs": [
      "CH05",
      "CH10",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "ci"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs"
    ],
    "acceptance": [
      "Taskmaster #28 scope-lock validation passes, confirming delivered behavior is limited to key-based i18n setup for zh-CN and en-US.",
      "All automated tests linked to Task #28 pass on the Windows Godot + C# baseline.",
      "With identical gameplay inputs, localization changes do not alter deterministic simulation/core-loop outputs except localized text rendering.",
      "Selecting en-US or zh-CN loads the corresponding locale resource and resolves the same key (for example, UI_PAUSE) to locale-correct text for that locale.",
      "A settings control allows language switching at runtime, and changing it refreshes already-visible localized UI text within the same running session.",
      "When the active locale lacks a key, rendered output falls back to the key literal itself (for example, MISSING_KEY renders as \"MISSING_KEY\").",
      "After selecting en-US or zh-CN, the language preference is persisted to config and automatically restored on next launch.",
      "At launch, only en-US and zh-CN are valid locale options; requesting an unsupported locale is rejected and the current language state remains unchanged.",
      "Localization key identifiers consumed by UI remain stable across patches: previously released UI-referenced keys are not unintentionally renamed or removed.",
      "Locale resources for both en-US and zh-CN are present and parseable at runtime; if loading or parsing fails, language switching is refused and the previously active language state remains unchanged.",
      "Representative visible UI text is key-driven rather than hardcoded: in one session, displayed values for the same key path change by locale.",
      "For the same representative UI key set, switching en-US -> zh-CN -> en-US in one session yields locale-correct text after each switch with no stale mixed-language values.",
      "Automated regression validation fails if any previously released UI-referenced i18n key identifier is renamed or removed between patches.",
      "A single automated run verifies all core behaviors together: en-US/zh-CN runtime switching updates already-visible UI text, missing-key lookup returns the key literal, and both locale resources load and parse successfully.",
      "Obligation lock O1: Create a LocalizationManager that loads translation files (e.g., CSV or JSON) for each language is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #28 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 28,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0029",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0021"
    ],
    "taskmaster_exported": false,
    "title": "Add Audio Settings for Music and SFX Channels",
    "description": "Implement audio settings to control music and sound effects volume at launch.",
    "status": "pending",
    "priority": "P3",
    "layer": "adapter",
    "adr_refs": [
      "ADR-0006",
      "ADR-0008",
      "ADR-0011"
    ],
    "chapter_refs": [
      "CH05",
      "CH10",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "adapter"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs"
    ],
    "acceptance": [
      "Taskmaster #29 delivers only the scoped feature: launch-time control and persistence of music and SFX channel volume settings.",
      "Referenced automated tests pass on the Windows Godot+C# baseline.",
      "Adding audio settings does not regress deterministic simulation behavior or core loop constraints.",
      "Music and SFX keep separate volume values, and changing one channel value does not change the other channel value.",
      "When music or SFX volume is changed at runtime, only the corresponding channel loudness changes immediately in the same session without restart.",
      "Changed music and SFX volume settings are saved to configuration and restored/applied on the next game launch.",
      "With both channels active, music and SFX playback remain independently controllable, with no cross-channel side effects.",
      "Repeated runtime volume changes do not produce runtime errors, and playback continues without interruption or glitches.",
      "On launch after a previous save, initial audible output for each channel already reflects its restored setting before any user interaction.",
      "If only one channel setting is changed and saved, relaunch applies that change while the unchanged channel remains at its prior saved value.",
      "If music and SFX are saved with different numeric values, relaunch restores those two distinct per-channel values (within configured precision) instead of collapsing to one shared value.",
      "After saving changed audio settings, persisted configuration stores separate music and SFX entries, and loading that configuration reproduces the same effective per-channel loudness.",
      "A dedicated AudioManager runtime component controls both music playback and SFX playback, and one playback path does not disable or overwrite the other.",
      "Music and SFX channels are each driven by a Godot AudioStreamPlayer node, and per-channel volume changes apply only to the corresponding node.",
      "Obligation lock O5: Audio preferences must be persisted in a configuration file medium (for example user://settings.cfg) and restored from file with separate music_volume and sfx_volume keys."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #29 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 29,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0030",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0021",
      "NG-0022",
      "NG-0023",
      "NG-0024",
      "NG-0025",
      "NG-0026",
      "NG-0027",
      "NG-0028",
      "NG-0029"
    ],
    "taskmaster_exported": false,
    "title": "Optimize for Performance Targets (45 FPS 1% Low, 60 FPS Average)",
    "description": "Implement optimizations to meet non-functional goals: low-end baseline 45 FPS (1% low) and average 60 FPS target.",
    "status": "pending",
    "priority": "P1",
    "layer": "adapter",
    "adr_refs": [
      "ADR-0015",
      "ADR-0005",
      "ADR-0011"
    ],
    "chapter_refs": [
      "CH09",
      "CH07",
      "CH10"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "adapter"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs"
    ],
    "acceptance": [
      "Taskmaster #30 completion remains scoped to the PRD lock for Optimize for Performance Targets (45 FPS 1% Low, 60 FPS Average), and unrelated changes do not satisfy this task.",
      "All automated tests referenced by this task pass on the Windows Godot+C# baseline environment.",
      "Post-optimization validation shows no regression in deterministic simulation behavior or core loop constraints.",
      "Deterministic baseline profiles are captured with locked camera paths and scripted sessions, and two repeated runs stay within the declared variance window.",
      "A profiling report identifies and ranks frame-time hotspots by subsystem (AI, spawn, render, UI) with repeatable timing data for each ranked offender.",
      "Config-safe targeted optimizations to update loops, pooling, and expensive queries produce measurable frame-time improvement versus baseline, while regression tests verify gameplay semantics are unchanged.",
      "Stress and endurance validation at launch presets covers worst-case wave mixes and UI-heavy scenarios, and the report records memory growth and stutter spikes with threshold verdicts or explicit fail reasons plus traces.",
      "Standardized gate artifacts are written to logs/perf and logs/ci for fixed-seed Windows headless and playable runs, with integer threshold fields and verdicts for baseline, 1% low FPS, and average FPS.",
      "Task completion is PASS only when reproducible fixed-seed Windows headless and playable gate runs meet at least 45 FPS for 1% low and 60 FPS for average FPS.",
      "If measurable improvement versus baseline is not shown within the declared variance window, or required artifact files/fields are missing, the task verdict is FAIL and cannot be accepted.",
      "Gate evidence includes paired baseline and post-optimization metrics for the same fixed-seed scenes so 1% low and average FPS deltas are directly verifiable.",
      "Acceptance is blocked when any required phase evidence (baseline capture, hotspot isolation, frame-budget remediation, stress validation, gate artifact output) is missing from logs/perf or logs/ci.",
      "Baseline-to-post comparisons are valid only when scene set, fixed seed, camera path script, launch preset, and run mode (headless/playable) are identical; otherwise the gate verdict is FAIL.",
      "Gate summary artifacts include explicit integer fields for baseline and post-optimization 1% low and average FPS, plus the applied variance window and threshold values, enabling machine-verifiable threshold evaluation."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #30 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 30,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0031",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [],
    "taskmaster_exported": false,
    "title": "Set up Godot 4.5.1 C# project structure for config contracts",
    "description": "Initialize a Godot 4.5.1 C# project on Windows with a dedicated folder structure for config schemas and samples, ensuring compatibility with Steam single-player and Windows-only constraints.",
    "status": "pending",
    "priority": "P1",
    "layer": "ci",
    "adr_refs": [
      "ADR-0011",
      "ADR-0001"
    ],
    "chapter_refs": [
      "CH07",
      "CH10",
      "CH01"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "ci"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs"
    ],
    "acceptance": [
      "Taskmaster #31 behavior matches PRD lock for Set up Godot 4.5.1 C# project structure for config contracts.",
      "Referenced automated tests pass on Windows Godot+C# baseline.",
      "No regression on deterministic simulation and core loop constraints.",
      "The project opens successfully in Godot 4.5.1 on Windows, and C# project generation/build completes without compile errors.",
      "Both directories `config/schemas/` and `config/samples/` exist in the project structure after setup.",
      "Export configuration includes a Windows Desktop target and does not enable non-Windows export targets.",
      "Project settings are configured for single-player operation, with networking/multiplayer features disabled so gameplay does not depend on online connectivity.",
      "A `README.md` file exists and documents the config-first approach, including the purpose of `config/schemas/` and `config/samples/`.",
      "The project is initialized with C# scripting enabled (not GDScript-only), and Godot 4.5.1 on Windows generates/uses C# project files that compile successfully.",
      "Acceptance fails if startup or core single-player flow requires network connectivity or multiplayer services to be available."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #31 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 31,
    "contractRefs": [
      "Game.Core/Contracts/DomainEvent.cs"
    ]
  },
  {
    "id": "NG-0032",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0031"
    ],
    "taskmaster_exported": false,
    "title": "Implement enemy-config.schema.json with validation rules",
    "description": "Define JSON schema for enemy configuration, including fields for enemy types, stats, and behaviors, adhering to config-first balancing and no hardcoded values.",
    "status": "pending",
    "priority": "P1",
    "layer": "core",
    "adr_refs": [
      "ADR-0023",
      "ADR-0007",
      "ADR-0005"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs"
    ],
    "acceptance": [
      "Taskmaster #32 behavior matches PRD lock for Implement enemy-config.schema.json with validation rules.",
      "Referenced automated tests pass on Windows Godot+C# baseline.",
      "No regression on deterministic simulation and core loop constraints.",
      "config/schemas/enemy-config.schema.json exists and declares \"$schema\": \"http://json-schema.org/draft-07/schema#\" with top-level \"type\": \"object\".",
      "The schema defines an \"enemies\" property as an array, and each array item is an object schema for a single enemy configuration.",
      "Each enemy item schema includes at least enemy_id (string), health (number, minimum 1), damage (number, minimum 0), and speed (number, minimum 0), and these fields are listed in required.",
      "The schema includes configurable enemy type/identity and behavior-related fields with explicit type constraints, so behavior selection is data-driven by config.",
      "Validator-based tests on Windows C# reject payloads with missing required fields, wrong field types, or numeric values below declared minima.",
      "Validator-based tests on Windows C# accept at least one valid payload where all required fields and numeric constraints are satisfied.",
      "Enemy balance values are sourced from schema-validated configuration data; adding or adjusting enemy balance values does not require hardcoded per-enemy constants for schema compliance.",
      "The root schema lists \"enemies\" in required, and validator-based tests reject a top-level payload that omits \"enemies\".",
      "Validator-based tests reject enemy objects where behavior-related fields are present but use types that differ from the schema declaration.",
      "Validator-based tests accept a payload containing at least two enemy entries with different valid health/damage/speed values without requiring schema or code changes.",
      "Validator-based tests on Windows C# fail when each required enemy field (enemy_id, health, damage, speed) is omitted individually from an enemy item.",
      "Validator-based tests on Windows C# pass after changing enemy balance numbers only in configuration data (within schema limits) without modifying schema structure or gameplay code.",
      "Windows C# validator tests must validate schema using payloads loaded from test JSON files (at least one valid sample and multiple invalid samples), not inline-only objects.",
      "If a required test JSON sample is missing, unreadable, or invalid JSON, the validation test run must fail and cannot be counted as pass."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #32 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 32,
    "contractRefs": [
      "Game.Core/Contracts/Config/enemy-config.schema.json"
    ]
  },
  {
    "id": "NG-0033",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0031"
    ],
    "taskmaster_exported": false,
    "title": "Implement difficulty-config.schema.json with versioning and lock constraints",
    "description": "Create JSON schema for difficulty configuration, including version field, difficulty levels, and constants, ensuring difficulty is locked at run start per PRD.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0023",
      "ADR-0007",
      "ADR-0005"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs"
    ],
    "acceptance": [
      "Taskmaster #33 implementation enforces the PRD lock semantics for difficulty: after a run starts, the active difficulty cannot be changed.",
      "All referenced automated tests for this task pass on the Windows Godot+C# baseline.",
      "Existing deterministic simulation and core-loop regression checks run after the change and report no new failures.",
      "A file exists at `config/schemas/difficulty-config.schema.json` and parses as valid JSON.",
      "The schema marks both `version` and `difficulty_level` as required, and validation rejects inputs where `version` is missing.",
      "`version` is validated as a string matching `^\\d+\\.\\d+$`; examples like `1.0` pass while `v1` and `1` fail.",
      "`difficulty_level` is validated as a string enum limited to `easy`, `medium`, and `hard`; any other value is rejected.",
      "`modifiers` is defined as an object, and each declared modifier field is numeric; non-numeric modifier values are rejected.",
      "Per PRD lock constraint, once a run starts, any attempt to change active difficulty is refused or leaves the active difficulty unchanged.",
      "Schema validation tests include positive and negative samples for invalid enum, missing `version`, and invalid `version` pattern, with expected pass/fail outcomes.",
      "The schema declares `version` as an explicit top-level property and includes it in `required`, so configuration revision is always present for backward-trackability checks.",
      "Validation accepts at least two configurations that differ only in declared numeric `modifiers` values, confirming these values are configurable data rather than fixed constants.",
      "A lock-behavior test verifies that difficulty changes can take effect before run start, while after run start a change attempt is refused or leaves active difficulty unchanged.",
      "Schema validation rejects inputs where `difficulty_level` is missing, confirming both required fields are enforced.",
      "Schema validation passes for valid samples using each allowed `difficulty_level` value (`easy`, `medium`, `hard`) with valid `version` and numeric `modifiers`.",
      "Obligation lock O8: All schema values in this task must remain configurable inputs and must not be fixed to a single constant set.",
      "Obligation lock O8: Schema validation accepts at least two valid version values matching ^\\d+\\.\\d+$ (for example 1.0 and 2.1) while difficulty_level and modifiers remain otherwise identical.",
      "Obligation lock O8: If schema constrains version to a single constant value (for example const or single-value enum), validation must fail.",
      "Obligation lock O8: All configurable fields must remain tunable and must not be constrained to single constant values; validation tests must fail const/single-value restrictions for version, difficulty_level, and modifiers.",
      "Schema validation accepts at least two valid `version` values matching `^\\d+\\.\\d+$` (e.g., `1.0` and `2.1`) with identical `difficulty_level` and `modifiers`.",
      "If schema constrains `version` to a single constant value (e.g., `const` or single-value `enum`), validation test must fail."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #33 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 33,
    "contractRefs": [
      "Game.Core/Contracts/Config/difficulty-config.schema.json"
    ]
  },
  {
    "id": "NG-0034",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0031"
    ],
    "taskmaster_exported": false,
    "title": "Implement spawn-config.schema.json for deterministic wave composition",
    "description": "Define JSON schema for spawn configuration to control enemy waves, ensuring determinism: same seed + same config => same wave timeline.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0023",
      "ADR-0007",
      "ADR-0005"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs"
    ],
    "acceptance": [
      "Taskmaster #34 behavior matches PRD lock for Implement spawn-config.schema.json for deterministic wave composition.",
      "Referenced automated tests pass on Windows Godot+C# baseline.",
      "No regression on deterministic simulation and core loop constraints.",
      "config/schemas/spawn-config.schema.json exists and validates a spawn config object with seed (integer) and waves (array) fields.",
      "Each wave object validation enforces day as an integer in [1, 15] and includes day/night timing values aligned to a 4-minute Day + 2-minute Night cycle.",
      "Enemy entries in each wave validate enemy_id as string and count as integer with minimum 0; negative counts or wrong types fail validation.",
      "Validation test data includes at least one valid config and failing cases for day outside 1-15 and negative enemy count, and failures are observable in test results.",
      "Determinism test demonstrates that repeated wave generation with the same seed and the same valid config yields the same wave timeline, while invalid config is rejected with no timeline output.",
      "Wave timeline generation inputs are restricted to schema-valid config values plus seed, with no hidden runtime override required to reproduce results.",
      "Schema/timeline verification demonstrates that the configured 4-minute Day + 2-minute Night cadence over Day1-Day15 produces a timeline within the required 60-90 minute match window (90 minutes at full 15-day coverage) using config values only."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #34 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 34,
    "contractRefs": [
      "Game.Core/Contracts/Config/spawn-config.schema.json"
    ]
  },
  {
    "id": "NG-0035",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0031"
    ],
    "taskmaster_exported": false,
    "title": "Implement pressure-normalization.config.schema.json with baseline constants and range checks",
    "description": "Create JSON schema for pressure normalization configuration, including explicit baseline constants and validation for ranges as per PRD.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0023",
      "ADR-0007",
      "ADR-0005"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs"
    ],
    "acceptance": [
      "Taskmaster #35 output is traceably consistent with the PRD-locked intent for implementing pressure-normalization.config.schema.json with baseline constants and range checks.",
      "All referenced automated tests pass in the Windows Godot+C# baseline environment.",
      "Deterministic simulation and core loop constraint checks remain passing after this schema change.",
      "config/schemas/pressure-normalization.config.schema.json exists and is parseable by a JSON Schema validator.",
      "The schema defines baseline, min_pressure, and max_pressure as number-typed fields, and defines normalization_factors as an array with number-typed items.",
      "Schema validation fails when baseline, min_pressure, max_pressure, or normalization_factors is missing.",
      "The schema declares explicit baseline and pressure-bound constants (including a baseline lower bound) rather than relying on implicit defaults.",
      "Schema validation fails when min_pressure is greater than or equal to max_pressure.",
      "Schema validation fails for non-numeric baseline values and passes for numeric baseline values that satisfy declared bounds.",
      "Schema validation passes for a configuration with numeric baseline, min_pressure < max_pressure, and normalization_factors containing only numbers.",
      "Schema validation fails when normalization_factors contains any non-numeric element.",
      "If a constraints object is provided, constraints.range_check is boolean-typed and non-boolean values fail schema validation.",
      "Schema validation fails when baseline violates the declared lower-bound constant.",
      "A validation case with min_pressure equal to max_pressure fails, confirming strict enforcement of min_pressure < max_pressure.",
      "A validation case with min_pressure greater than max_pressure fails, and the same case with min_pressure less than max_pressure passes when all required fields are otherwise valid.",
      "A validation case with baseline below the declared lower-bound constant fails, and a case at or above that bound passes when other constraints are satisfied.",
      "Schema validation fails when normalization_factors is not an array, even if baseline, min_pressure, and max_pressure are otherwise valid."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #35 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 35,
    "contractRefs": [
      "Game.Core/Contracts/Config/pressure-normalization.config.schema.json"
    ]
  },
  {
    "id": "NG-0036",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0032",
      "NG-0033",
      "NG-0034",
      "NG-0035"
    ],
    "taskmaster_exported": false,
    "title": "Create sample JSON files for all configs with valid data",
    "description": "Generate sample JSON files (difficulty-config.sample.json, spawn-config.sample.json, pressure-normalization.config.sample.json) that adhere to the schemas and include realistic values.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0023",
      "ADR-0007",
      "ADR-0005"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs"
    ],
    "acceptance": [
      "Scope is limited to Taskmaster #36 config-sample deliverables, and outputs are contract-release sample artifacts rather than placeholders; placeholder-only artifacts fail acceptance.",
      "On the Windows Godot+C# baseline, automated validation confirms every required positive sample passes both schema checks and semantic validator checks.",
      "Artifacts are split by config domain (difficulty, spawn, pressure-normalization), and validation-run output includes all three domains; omission of any domain fails acceptance.",
      "difficulty-config.sample.json exists, is non-empty, passes schema and semantic validation, and includes version metadata, deterministic launch-tier defaults, and lock-at-start fields.",
      "spawn-config.sample.json exists, is non-empty, passes schema and semantic validation, and includes Day1-Day15 cadence coverage plus channel isolation flags required by the runtime parser.",
      "pressure-normalization.config.sample.json exists, is non-empty, passes schema and semantic validation, explicitly defines baseline constants, and keeps tuning values within guard bands.",
      "Negative fixtures are provided for all three config domains and cover malformed and boundary-breach inputs; each negative case is rejected while positive samples remain passing in the same validation flow.",
      "A CI-consumable validation summary artifact is produced with schema and semantic outcomes for every positive and negative fixture; missing this artifact fails acceptance.",
      "Acceptance fails if any required positive sample file is missing, empty, or not included in validation-run output.",
      "Validation output includes explicit per-file schema and semantic pass/fail results for each required positive sample; missing per-file results fail acceptance.",
      "For each config domain, at least one malformed fixture and one boundary-breach fixture are executed and rejected with non-empty explicit reason codes in the same run where all required positive samples pass."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #36 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 36,
    "contractRefs": [
      "Game.Core/Contracts/Config/difficulty-config.sample.json",
      "Game.Core/Contracts/Config/spawn-config.sample.json",
      "Game.Core/Contracts/Config/pressure-normalization.config.sample.json"
    ]
  },
  {
    "id": "NG-0037",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0032",
      "NG-0033",
      "NG-0034",
      "NG-0035"
    ],
    "taskmaster_exported": false,
    "title": "Implement config validation and fallback handling in C#",
    "description": "Develop C# code in Godot to load and validate config files against schemas, applying invalid config handling policy: reject and fallback to built-in safe defaults.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0023",
      "ADR-0007",
      "ADR-0005"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs"
    ],
    "acceptance": [
      "Taskmaster #37 implementation enforces PRD-locked behavior: config files are loaded and validated, and invalid inputs end only in reject or fallback to built-in safe defaults.",
      "All referenced automated tests pass on the Windows Godot + C# baseline, including config validation and fallback scenarios.",
      "Executing the validation/fallback flow causes no unintended runtime side effects outside the config decision path, including no deterministic core-loop drift for identical inputs.",
      "Schema-invalid config payloads are rejected at the structural validation stage with deterministic normalized error codes and required error payload fields.",
      "Semantic rule violations are evaluated only after structural pass, and each violation maps to exactly one explicit policy action with a machine-verifiable reason key.",
      "Runtime config application enforces immutable and difficulty-locked fields: only allowed fields may fallback to built-in safe defaults, and forbidden changes are rejected without protected-state mutation.",
      "Each validation decision emits standardized audit entries and CI summary artifacts under logs/ci, including policy decision trace and reject/fallback reasons.",
      "A valid/invalid/boundary config matrix yields policy-consistent terminal outcomes (accept, reject, or fallback) with observable logs for each case.",
      "On every rejection path, protected runtime fields remain unchanged and no partial config mutation is observable after the decision.",
      "Reject and fallback outcomes expose explicit machine-verifiable reason identifiers in both test assertions and emitted audit records.",
      "Each config evaluation produces exactly one terminal outcome (accept, reject, or fallback), and tests confirm no dual/conflicting outcomes for a single input.",
      "Validation runs in layered order (structural -> semantic -> policy routing), and decision traces identify the stage responsible for the terminal outcome.",
      "Boundary-case evaluations are deterministic across repeated runs: identical input yields identical terminal outcome and identical machine-verifiable reason identifiers.",
      "For every structural validation failure, output includes a normalized machine-readable error payload with deterministic code and location fields; structurally valid inputs proceed to semantic validation.",
      "For every semantic violation, policy routing returns exactly one explicit action and one machine-verifiable reason key; unmapped violations are rejected with an explicit reason identifier.",
      "Fallback application updates only allowed mutable fields to built-in safe defaults, while immutable and difficulty-locked fields stay unchanged; any forbidden update attempt is rejected with no partial state mutation.",
      "Each config evaluation writes one standardized audit record and one CI-consumable summary artifact in logs/ci containing terminal outcome, decision stage, policy trace, and reason identifiers.",
      "Obligation lock O4: Implement schema-level structural validation adapters :: Centralize structural validation and collect normalized error payloads is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence.",
      "Obligation lock O7: Encode rule sets from validator contracts and map each failure to policy action is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #37 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 37,
    "contractRefs": [
      "Game.Core/Contracts/Config/spawn-config.validator.rules.md"
    ]
  },
  {
    "id": "NG-0038",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0037"
    ],
    "taskmaster_exported": false,
    "title": "Integrate config governance for gameplay tuning",
    "description": "Connect config values to gameplay systems (e.g., enemy stats, wave spawning) to ensure all tuning is via config only, with no implementation hardcoding.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0023",
      "ADR-0007",
      "ADR-0005"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs"
    ],
    "acceptance": [
      "Taskmaster #38 enforces the PRD lock by sourcing enemy stats and wave spawning parameters from ConfigManager-backed config data, not hardcoded gameplay constants.",
      "Referenced automated tests pass on the Windows Godot+C# baseline, including integration checks for config-driven enemy stats, spawn timing, and seed-based wave generation.",
      "After replacing hardcoded tuning with config-governed values, deterministic simulation behavior and core loop constraints remain within expected results.",
      "When only enemy-config values are changed, corresponding runtime enemy stats (including health) change in gameplay without any C# script edits; unchanged stats after a config-only change fail acceptance.",
      "When only spawn-config timing values are changed, runtime wave spawn timing changes in gameplay without any C# script edits; unchanged timing after a config-only change fails acceptance.",
      "Wave generation uses the spawn-config seed so repeated runs with the same seed produce identical wave composition/order, and changing only the seed changes composition/order.",
      "When valid config values are present, gameplay systems use those values for enemy stats and wave-spawn parameters, and any hardcoded override fails acceptance.",
      "Integration runs with at least two distinct valid config sets show that enemy stats and wave composition outputs follow config differences while remaining deterministic under a fixed seed.",
      "Using the same executable and content, tuning outcomes are achieved by config-only changes: updating enemy-config or spawn-config changes gameplay outputs without editing C# scripts; requiring script changes fails acceptance.",
      "For a selected enemyId and spawn profile, observed runtime enemy health and spawn interval values exactly match the active config values in that run; any mismatch fails acceptance.",
      "In the same executable/content build with spawn-config fixed, changing only enemy-config for a selected enemyId changes that enemyId runtime health/stat outputs to the new config values and requires no C# script edits.",
      "In the same executable/content build with all non-seed spawn settings fixed, changing only spawn-config seed changes wave composition/order outputs, while reruns with that same seed reproduce identical composition/order outputs.",
      "With one executable/content build and two valid config sets A/B, switching A->B changes at least one enemy runtime stat and at least one wave output metric that correspond to changed config fields; no observable change after config-only switching fails acceptance.",
      "With one executable/content build, switching config set A->B->A restores enemy stat outputs and wave composition/order outputs to the original A results under the same seed; failure to restore fails acceptance.",
      "Obligation lock O1: Modify existing gameplay C# scripts to read values from ConfigManager instead of hardcoded constants is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #38 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 38,
    "contractRefs": [
      "Game.Core/Contracts/Config/config-change-audit.schema.json"
    ]
  },
  {
    "id": "NG-0039",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0037"
    ],
    "taskmaster_exported": false,
    "title": "Add config hash/version to battle report metadata for auditability",
    "description": "Implement functionality to compute and include config hash or version in battle report metadata, as required for auditability.",
    "status": "pending",
    "priority": "P3",
    "layer": "core",
    "adr_refs": [
      "ADR-0023",
      "ADR-0007",
      "ADR-0005"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs"
    ],
    "acceptance": [
      "For Taskmaster #39, report generation computes config-derived metadata (either hash or version) and writes it into each generated battle report metadata.",
      "Automated tests covering metadata presence, same-config stability, and changed-config/version detection pass on the Windows Godot+C# baseline.",
      "Adding config metadata does not change battle simulation outcomes: with the same battle inputs, match-result fields remain unchanged except for the added metadata field.",
      "Each generated battle report includes either \"config_hash\" or \"config_version\" with a non-empty value derived from the exact config used for that battle.",
      "Repeated report generation with byte-identical config content or the same declared version yields the same recorded metadata value.",
      "If config content changes or declared version changes before report generation, the next battle report records a different metadata value.",
      "Any battle report that contains neither \"config_hash\" nor \"config_version\" is invalid output and fails audit-complete acceptance.",
      "Persisted battle report payloads retain match-result content and include the selected config metadata field (\"config_hash\" or \"config_version\") for audit retrieval.",
      "The recorded value (\"config_hash\" or \"config_version\") comes from the exact configuration payload/version consumed by that battle at report-generation time and is stored in BattleReport metadata.",
      "When \"config_hash\" is used, the value is computed from the exact consumed config payload and is reproducible for byte-identical payloads.",
      "When \"config_version\" is used, the value equals the declared version extracted from the exact consumed config and changes when that declared version changes.",
      "Obligation lock O1: In ConfigManager, add method to compute hash (e.g., SHA256) of config files or extract version fields is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #39 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 39,
    "contractRefs": [
      "Game.Core/Contracts/Config/config-change-audit.schema.json"
    ]
  },
  {
    "id": "NG-0040",
    "story_id": "BACKLOG-LASTKING-M1",
    "owner": "architecture",
    "depends_on": [
      "NG-0037"
    ],
    "taskmaster_exported": false,
    "title": "Implement version migration rule with force migration",
    "description": "Develop version handling to force migration when config version changes, without dual-version compatibility, per PRD.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0006",
      "ADR-0008",
      "ADR-0011"
    ],
    "chapter_refs": [
      "CH05",
      "CH10",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "backlog",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs"
    ],
    "acceptance": [
      "Taskmaster #40 PRD lock is satisfied: version mismatch rejects the loaded config and loads defaults, while a matching version keeps the loaded config.",
      "Referenced automated tests for this task pass on the Windows Godot+C# baseline.",
      "When config version matches expectedVersion, runtime configuration stays on the loaded-config path and does not trigger default fallback.",
      "If a loaded config version differs from the expected version, the loaded config is rejected and runtime configuration falls back to default values.",
      "On version mismatch, an error log entry is emitted that explicitly indicates migration is required.",
      "No dual-version compatibility path is active: mismatched-version configs are never partially accepted, transformed, or auto-adapted.",
      "Automated unit tests cover both matching and mismatching config versions, and verify fallback occurs only for mismatches.",
      "When a loaded config version equals the expected version, the loaded config is accepted and runtime configuration does not fall back to default values.",
      "Unit tests explicitly assert both paths: matching version keeps loaded config, mismatching version rejects loaded config and triggers default fallback with migration-required logging.",
      "Unit tests explicitly verify that mismatch handling does not activate any compatibility mode or auto-adaptation path.",
      "Version handling applies a single expected-version equality rule: any non-equal version is treated as mismatch and follows reject + default fallback + migration-required logging.",
      "Obligation lock O1: In ConfigManager, check version field of loaded config against expected version is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence."
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #40 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 40,
    "contractRefs": [
      "Game.Core/Contracts/Config/difficulty-config.schema.json"
    ]
  }
]
