[
  {
    "id": "GM-0101",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [],
    "taskmaster_exported": true,
    "title": "Establish baseline Godot 4.5.1 C# Windows project",
    "description": "Create the canonical baseline Godot 4.5.1 C# Windows project used by all later setup tasks.",
    "status": "pending",
    "priority": "P1",
    "layer": "ci",
    "adr_refs": [
      "ADR-0011",
      "ADR-0001"
    ],
    "chapter_refs": [
      "CH07",
      "CH10",
      "CH01"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "ci"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Tests.Godot/tests/Integration/test_project_bootstrap_editor_compile_run.gd",
      "Tests.Godot/tests/Integration/test_windows_export_startup_flow.gd",
      "Tests.Godot/tests/Scenes/Smoke/test_main_scene_smoke.gd",
      "Tests.Godot/tests/Integration/test_project_bootstrap_restart_stability.gd",
      "Tests.Godot/tests/Integration/test_project_bootstrap_windows_sdk_resolution.gd",
      "Tests.Godot/tests/Integration/test_project_creation_csharp_mode.gd",
      "Tests.Godot/tests/Integration/test_project_structure_referenced_assets.gd",
      "Tests.Godot/tests/Integration/test_windows_export_preset_artifact.gd",
      "Tests.Godot/tests/Scenes/Smoke/test_glue_connections.gd",
      "Game.Core.Tests/Tasks/Task1BaselineVerificationGateTests.cs",
      "Game.Core.Tests/Tasks/Task1ProjectRootUniquenessTests.cs",
      "Tests.Godot/tests/Integration/test_dotnet_solution_generation_build.gd",
      "Tests.Godot/tests/Integration/test_windows_verification_evidence_records.gd",
      "Tests.Godot/tests/Scenes/Smoke/test_main_scene_bindings_persist.gd"
    ],
    "acceptance": [
      "A single canonical Godot 4.5.1 .NET Windows project root is explicitly defined, and baseline creation, C# verification, core layout definition, and runnable Windows export verification all execute from that same root. Refs: Tests.Godot/tests/Integration/test_project_bootstrap_editor_compile_run.gd Tests.Godot/tests/Integration/test_windows_export_startup_flow.gd",
      "Baseline verification passes only if the editor opens the canonical root, C# compilation succeeds, and the configured startup scene runs with its attached C# script. Refs: Tests.Godot/tests/Scenes/Smoke/test_main_scene_smoke.gd",
      "After a clean editor restart, two consecutive runs from the canonical root must enter the same startup flow, with any setup-introduced regression causing failure. Refs: Tests.Godot/tests/Integration/test_project_bootstrap_restart_stability.gd",
      "On Windows, baseline verification requires Godot 4.5.1 .NET editor and a compatible .NET SDK to be installed and detected, with no missing-SDK warning. Refs: Tests.Godot/tests/Integration/test_project_bootstrap_windows_sdk_resolution.gd",
      "Canonical bootstrap is performed in C# mode, and at least one node-attached C# script must compile successfully in the editor. Refs: Tests.Godot/tests/Integration/test_project_creation_csharp_mode.gd Tests.Godot/tests/Integration/test_project_bootstrap_editor_compile_run.gd",
      "Running the startup scene in the editor must complete scene load and script execution without C# binding errors, assembly-load errors, or runtime script errors. Refs: Tests.Godot/tests/Scenes/Smoke/test_main_scene_smoke.gd",
      "The canonical root must include baseline core directories for scenes, scripts, and assets, and each directory must contain at least one file referenced by the project. Refs: Tests.Godot/tests/Integration/test_project_structure_referenced_assets.gd",
      "A Windows Desktop export preset is defined in the canonical root, and executing export produces the expected Windows build artifact. Refs: Tests.Godot/tests/Integration/test_windows_export_preset_artifact.gd",
      "Launching the exported Windows artifact as a standalone run must reach the baseline startup flow. Refs: Tests.Godot/tests/Integration/test_windows_export_startup_flow.gd",
      "Startup-path scene creation, node wiring, and script attachment are persisted and observable in saved SceneTree and Inspector bindings. Refs: Tests.Godot/tests/Scenes/Smoke/test_glue_connections.gd",
      "Acceptance must fail fast when any required check fails, including editor open, C# compile, startup scene run, exported artifact run, or single-root validation. Refs: Game.Core.Tests/Tasks/Task1BaselineVerificationGateTests.cs Game.Core.Tests/Tasks/Task1ProjectRootUniquenessTests.cs",
      "A newly initialized canonical Godot 4.5.1 .NET C# project must generate .sln and .csproj files that build successfully with the installed SDK. Refs: Tests.Godot/tests/Integration/test_dotnet_solution_generation_build.gd",
      "The startup scene is configured and saved as Main Scene, and after editor restart it reloads with node-to-script bindings unchanged. Refs: Tests.Godot/tests/Scenes/Smoke/test_main_scene_smoke.gd",
      "Acceptance evidence must include successful Windows verification records for editor open, C# compile, startup scene execution, and export launch, all tied to the same canonical root. Refs: Tests.Godot/tests/Integration/test_windows_verification_evidence_records.gd",
      "Creating and opening the canonical Godot 4.5.1 .NET C# project on Windows must produce no missing SDK, missing assembly, or failed restore errors. Refs: Tests.Godot/tests/Integration/test_project_bootstrap_windows_sdk_resolution.gd",
      "Both editor play of Main Scene and launch of the exported Windows build must reach startup flow without runtime C# script errors. Refs: Tests.Godot/tests/Scenes/Smoke/test_main_scene_smoke.gd",
      "At least one saved startup scene includes an attached C# bootstrap script, and that attachment persists after project reopen. Refs: Tests.Godot/tests/Scenes/Smoke/test_main_scene_bindings_persist.gd",
      "The canonical project is created with C# selected at creation time and opens directly without requiring manual post-creation language conversion. Refs: Tests.Godot/tests/Integration/test_project_creation_csharp_mode.gd",
      "All C# and .NET dependencies needed for editor run and Windows export must resolve on Windows, and any unresolved SDK, assembly, or restore issue fails acceptance. Refs: Tests.Godot/tests/Integration/test_project_bootstrap_windows_sdk_resolution.gd Tests.Godot/tests/Integration/test_dotnet_solution_generation_build.gd",
      "Windows export validation must execute the produced build and confirm it reaches the baseline startup flow. Refs: Tests.Godot/tests/Integration/test_windows_export_startup_flow.gd Tests.Godot/tests/Integration/test_windows_export_preset_artifact.gd",
      "Standalone desktop launch compatibility is accepted only when the exported Windows build starts and reaches expected startup flow without blocking initialization errors. Refs: Tests.Godot/tests/Integration/test_windows_export_startup_flow.gd",
      "Acceptance is rejected if verification bypasses any required check, including C# build, script-attachment validation, startup scene execution, export execution, or root-uniqueness validation. Refs: Game.Core.Tests/Tasks/Task1BaselineVerificationGateTests.cs Game.Core.Tests/Tasks/Task1ProjectRootUniquenessTests.cs",
      "Acceptance fails if this task or any downstream setup task creates a second independent Godot project root instead of reusing the canonical root. Refs: Game.Core.Tests/Tasks/Task1ProjectRootUniquenessTests.cs",
      "Canonical-root contract evidence must be persisted and auditable, including root identifier, mandatory directory structure, and startup binding constraints; missing evidence fails acceptance. Refs: Game.Core.Tests/Tasks/Task1BaselineVerificationGateTests.cs Game.Core.Tests/Tasks/Task1ProjectRootUniquenessTests.cs",
      "Deterministic bootstrap evidence artifacts must use fixed field schema and stable naming; repeated runs with the same input must produce comparable structure, otherwise gate fails. Refs: Game.Core.Tests/Tasks/Task1BaselineVerificationGateTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #1 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 1,
    "contractRefs": [
      "Game.Core/Contracts/Lastking/BootstrapReady.cs"
    ]
  },
  {
    "id": "GM-0102",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0101"
    ],
    "taskmaster_exported": true,
    "title": "Implement config-first balancing system",
    "description": "Create a configuration system to manage game balance values (e.g., wave budgets, day durations) without hardcoding.",
    "status": "pending",
    "priority": "P1",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs",
      "Tests.Godot/tests/Integration/test_balance_runtime_config_reload.gd",
      "Tests.Godot/tests/Integration/test_balance_simulation_determinism.gd",
      "Game.Core.Tests/Services/ConfigManagerAccessSurfaceTests.cs",
      "Tests.Godot/tests/Adapters/Config/test_balance_config_single_source.gd",
      "Game.Core.Tests/Services/ConfigManagerParsingTests.cs",
      "Tests.Godot/tests/Integration/test_balance_runtime_day_night_from_config.gd",
      "Game.Core.Tests/Services/WaveBudgetFromConfigTests.cs",
      "Tests.Godot/tests/Integration/test_balance_runtime_wave_budget_from_config.gd",
      "Game.Core.Tests/Services/SpawnScheduleFromConfigTests.cs",
      "Tests.Godot/tests/Integration/test_balance_runtime_spawn_and_boss_from_config.gd",
      "Game.Core.Tests/Services/WaveChannelSelectionTests.cs",
      "Tests.Godot/tests/Integration/test_balance_runtime_channel_selection_from_config.gd",
      "Tests.Godot/tests/Adapters/Config/test_settings_persistence.gd",
      "Game.Core.Tests/Services/ConfigDrivenRuntimeLoopTests.cs",
      "Game.Core.Tests/Services/ConfigReloadBehaviorTests.cs",
      "Game.Core.Tests/Domain/GameConfigContractTests.cs",
      "Game.Core.Tests/Domain/GameConfigValidationTests.cs",
      "Tests.Godot/tests/Security/Hard/test_balance_config_validation_audit.gd",
      "Tests.Godot/tests/Adapters/Config/test_settings_config_utf8.gd",
      "Tests.Godot/tests/Security/Hard/test_settings_config_security.gd"
    ],
    "acceptance": [
      "Hard gate: malformed JSON/INI input must deterministically fail with a fixed reason code, and parse failure must not advance runtime config snapshot (must keep last-known-good or documented fallback). Refs: Tests.Godot/tests/Adapters/Config/test_settings_persistence.gd",
      "Hard gate: ConfigManager load order must be deterministic and explicitly verified across initial load, reload, and fallback paths; any order drift fails acceptance. Refs: Game.Core.Tests/Domain/GameConfigTests.cs Tests.Godot/tests/Adapters/Config/test_settings_persistence.gd",
      "Hard gate: acceptance requires both anti-hardcode source-scan gate and config-driven runtime behavior regression gate; missing either gate fails acceptance. Refs: Tests.Godot/tests/Security/Hard/test_settings_config_security.gd",
      "只有当运行时可观察到日夜循环、波次预算与刷怪行为由配置值驱动且不依赖代码常量时，本任务才可判定通过。 Refs: Tests.Godot/tests/Integration/test_balance_runtime_config_reload.gd",
      "本任务关联的自动化测试在 Windows Godot + C# 基线环境必须全部通过，任一失败即不通过。 Refs: Tests.Godot/tests/Integration/test_balance_runtime_config_reload.gd",
      "在配置输入不变的条件下，重复执行确定性模拟必须产生一致的核心循环输出，出现任意差异即判失败。 Refs: Tests.Godot/tests/Integration/test_balance_simulation_determinism.gd",
      "系统必须仅采用一个 JSON 或 INI 平衡配置源，且 loop/wave/spawn 只能通过唯一全局 ConfigManager 访问面读取平衡值。 Refs: Game.Core.Tests/Services/ConfigManagerAccessSurfaceTests.cs Tests.Godot/tests/Adapters/Config/test_balance_config_single_source.gd",
      "日夜时长必须由配置解析得到，且运行时实测值必须为 Day=240 秒、Night=120 秒。 Refs: Game.Core.Tests/Services/ConfigManagerParsingTests.cs Tests.Godot/tests/Integration/test_balance_runtime_day_night_from_config.gd",
      "普通波次预算必须由配置解析得到，且运行时值必须为 day1=50、daily growth=120%（1.2）。 Refs: Game.Core.Tests/Services/WaveBudgetFromConfigTests.cs Tests.Godot/tests/Integration/test_balance_runtime_wave_budget_from_config.gd",
      "刷怪节奏与 Boss 数量必须由配置解析得到，且运行时值必须为 spawn cadence=10 秒、boss count=2。 Refs: Game.Core.Tests/Services/SpawnScheduleFromConfigTests.cs Tests.Godot/tests/Integration/test_balance_runtime_spawn_and_boss_from_config.gd",
      "配置必须包含 elite 与 boss channel 字段，且运行时波次/刷怪选路必须实际消费这两个字段。 Refs: Game.Core.Tests/Services/WaveChannelSelectionTests.cs Tests.Godot/tests/Integration/test_balance_runtime_channel_selection_from_config.gd",
      "修改配置并触发重载后，游戏内可观察到的平衡行为必须随新值变化；配置未变化时重载后行为必须保持不变。 Refs: Tests.Godot/tests/Adapters/Config/test_settings_persistence.gd",
      "必须提供可核验证据证明列出的平衡参数在 gameplay 路径均来自 ConfigManager 读取，而非硬编码常量。 Refs: Game.Core.Tests/Services/ConfigDrivenRuntimeLoopTests.cs Game.Core.Tests/Services/ConfigManagerAccessSurfaceTests.cs",
      "在不改动代码的前提下，仅替换平衡配置并重载，必须导致日夜周期、波次预算增长、刷怪节奏和 Boss 数量的运行结果发生变化。 Refs: Game.Core.Tests/Services/ConfigReloadBehaviorTests.cs Tests.Godot/tests/Integration/test_balance_runtime_config_reload.gd",
      "必须定义规范化配置契约（必填 sections/keys、稳定键名、必填键到运行时消费方映射），并可核验日夜时长、普通波次 day1 预算、普通波次日增长、elite channel、boss channel、spawn cadence、boss count 的加载值。 Refs: Game.Core.Tests/Domain/GameConfigContractTests.cs Game.Core.Tests/Services/ConfigManagerParsingTests.cs",
      "初次加载后必须提供全局可访问的强类型平衡快照/API，暴露日时长、夜时长、普通波次 day1 预算、普通波次日增长、elite channel、boss channel、spawn cadence、boss count；缺失可选字段时必须采用确定性默认值。 Refs: Game.Core.Tests/Domain/GameConfigTests.cs",
      "对缺失键、类型错误、越界值，系统必须执行既定 reject/fallback 规则，输出可执行 reason code 审计轨迹，并使运行时保持在文档化 fallback 状态。 Refs: Game.Core.Tests/Domain/GameConfigValidationTests.cs Tests.Godot/tests/Security/Hard/test_balance_config_validation_audit.gd",
      "Obligation lock O9：必须通过测试或审计证据证明“加载配置文件并正确解析值”已满足；无法证明即不通过。 Refs: Tests.Godot/tests/Adapters/Config/test_settings_config_utf8.gd",
      "Obligation lock O11：必须通过测试或审计证据证明“使用 Godot's Resource system or custom file I/O”已满足；无法证明即不通过。 Refs: Tests.Godot/tests/Adapters/Config/test_settings_config_utf8.gd Tests.Godot/tests/Security/Hard/test_settings_config_security.gd"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #2 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 2,
    "contractRefs": [
      "Game.Core/Contracts/Lastking/ConfigLoaded.cs"
    ],
    "evidence_refs": []
  },
  {
    "id": "GM-0103",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0102"
    ],
    "taskmaster_exported": true,
    "title": "Develop runtime state machine for Day/Night cycles",
    "description": "Implement a state machine to manage Day and Night cycles with deterministic progression up to Day15.",
    "status": "pending",
    "priority": "P1",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Game.Core.Tests/Tasks/Task3DayNightScopeGuardTests.cs",
      "Tests.Godot/tests/Integration/test_day_night_cycle_runtime_loop.gd",
      "Game.Core.Tests/State/GameStateManagerTests.cs",
      "Tests.Godot/tests/UI/test_hud_day_night_cycle_status.gd",
      "Game.Core.Tests/Tasks/Task3DayNightDesignArtifactTests.cs"
    ],
    "acceptance": [
      "Hard gate: deterministic cycle verification must include a fixed-seed forced-terminal scenario, not only natural Day15 completion paths. Refs: Game.Core.Tests/State/GameStateMachineTests.cs Game.Core.Tests/State/GameStateManagerTests.cs",
      "Hard gate: forced-terminal verification must assert exactly one terminal emission, zero post-terminal progression, and checkpoint replay parity against baseline. Refs: Game.Core.Tests/State/GameStateManagerTests.cs Game.Core.Tests/State/GameStateMachineTests.cs",
      "Taskmaster #3 的玩法范围仅限 Day/Night 循环推进至 Day15；若引入与该循环无关的玩法行为变更则判定失败。 Refs: Game.Core.Tests/Tasks/Task3DayNightScopeGuardTests.cs Tests.Godot/tests/Integration/test_day_night_cycle_runtime_loop.gd",
      "在 Windows Godot+C# 基线下，引用的自动化玩法测试必须全部通过，并覆盖正常流程、计时边界、固定种子重放一致性与 Day15 终局场景。 Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "对 Day/Night 功能之外的玩法系统，在输入序列不变时，确定性模拟输出与核心循环可观察行为必须保持不变。 Refs: Tests.Godot/tests/Integration/test_day_night_cycle_runtime_loop.gd",
      "终局前玩家可观察的循环阶段仅有 Day 与 Night，且只会出现合法的 Day<->Night 切换；非法切换不得出现。 Refs: Game.Core.Tests/State/GameStateMachineTests.cs",
      "在玩法中使用配置时长时，每个 Day 阶段在 4:00 切换、每个 Night 阶段在 2:00 切换，且未达阈值前不得切换。 Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "可见 day 计数从 Day1 开始并顺序递增，不跳号、不回退，且始终保持在 1-15 范围内。 Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "固定种子且输入/更新序列一致时，重复运行必须产生一致的阶段序列、随机结果与阶段边界检查点。 Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "仅在 Day15 完成时向玩家呈现一次胜利条件；在 Day15 完成前不得呈现任何胜利。 Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "Day/Night 计时仅在运行时循环更新活跃时推进，并在 fixed-step 与 variable-step 下保持单调且与帧率无关。 Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "从 Day1 全新开局开始，玩家应在总耗时 4:00 观察到 Day->Night，在总耗时 6:00 观察到 Night->Day2。 Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "当玩法更新暂停或停止时，阶段切换、循环累计时间与 day 计数均不得变化，直至更新恢复。 Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "Day15 胜利时刻之后，玩家不得观察到 day>15、重复胜利呈现或进一步循环推进。 Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "在每个阶段达到配置阈值之前，玩家不得观察到 Day/Night 切换或 day 递增；仅在活动更新中达到阈值时才出现这些变化。 Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "全新开局时，在任何阶段阈值到达之前且首次切换发生之前，界面可见循环状态必须为 Day1。 Refs: Tests.Godot/tests/UI/test_hud_day_night_cycle_status.gd",
      "必须交付并关联已评审的运行时状态机设计工件，明确 Day/Night 状态图、迁移条件与下游事件消费者；缺失工件即判定不通过。 Refs: Game.Core.Tests/Tasks/Task3DayNightDesignArtifactTests.cs",
      "At every Day<->Night boundary, runtime must emit exactly one deterministic checkpoint event; no missing and no extra checkpoint events are allowed. Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "Replay validation must assert checkpoint-event count equals observed boundary-transition count for the same run input. Refs: Game.Core.Tests/State/GameStateManagerTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #3 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 3,
    "contractRefs": [
      "Game.Core/Contracts/Lastking/DayStarted.cs",
      "Game.Core/Contracts/Lastking/NightStarted.cs"
    ],
    "evidence_refs": []
  },
  {
    "id": "GM-0104",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0102",
      "GM-0103"
    ],
    "taskmaster_exported": true,
    "title": "Implement wave budget and channel system",
    "description": "Set up wave generation with normal, elite, and boss channels based on configurable budgets.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Services/CollisionServiceTests.cs",
      "Game.Core.Tests/Services/WaveManagerBudgetChannelTests.cs",
      "Game.Core.Tests/Services/WaveManagerDeterminismTests.cs",
      "Game.Core.Tests/Engine/GameEngineCoreDeterminismTests.cs"
    ],
    "acceptance": [
      "Taskmaster #4 deliverable produces waves for normal, elite, and boss channels, and each channel output is driven by its configured budget in the generated result set. Refs: Game.Core.Tests/Services/WaveManagerBudgetChannelTests.cs Game.Core.Tests/Services/WaveManagerDeterminismTests.cs",
      "On the Windows Godot+C# baseline, the referenced automated suites run to completion with zero failing tests for budget/channel behavior and determinism. Refs: Game.Core.Tests/Services/WaveManagerBudgetChannelTests.cs Game.Core.Tests/Services/WaveManagerDeterminismTests.cs",
      "Existing deterministic simulation and core-loop invariants remain unchanged, evidenced by passing determinism regression checks after this task. Refs: Game.Core.Tests/Engine/GameEngineCoreDeterminismTests.cs Game.Core.Tests/Services/WaveManagerDeterminismTests.cs",
      "WaveManager accepts day index, channel budget configuration, and seed as inputs, and returns wave outputs deterministically derived from those inputs for that run. Refs: Game.Core.Tests/Services/WaveManagerBudgetChannelTests.cs",
      "With default configuration (normal day1 budget = 50), the computed normal-channel budget for day 1 is exactly 50. Refs: Game.Core.Tests/Services/WaveManagerBudgetChannelTests.cs",
      "For day indices after day 1, the normal-channel budget follows the configured daily growth rule (default 120%) and matches expected values across multiple days. Refs: Game.Core.Tests/Services/WaveManagerBudgetChannelTests.cs",
      "Changing only elite-channel budget leaves normal-channel budget and normal-channel spawn output unchanged for the same day and seed. Refs: Game.Core.Tests/Services/WaveManagerBudgetChannelTests.cs Game.Core.Tests/Services/WaveManagerDeterminismTests.cs",
      "Changing only boss-channel budget leaves normal-channel budget and normal-channel spawn output unchanged for the same day and seed. Refs: Game.Core.Tests/Services/WaveManagerBudgetChannelTests.cs Game.Core.Tests/Services/WaveManagerDeterminismTests.cs",
      "Per-wave enemy allocation for each channel never exceeds that channel's configured budget and does not overrun channel limits. Refs: Game.Core.Tests/Services/WaveManagerBudgetChannelTests.cs",
      "Given the same fixed seed, day, and config, wave outputs are identical across runs; changing only the seed changes at least one spawn decision. Refs: Game.Core.Tests/Services/WaveManagerDeterminismTests.cs",
      "Independent tuning of normal, elite, and boss budgets changes only the targeted channel output, while non-target channels stay unchanged for the same day and seed. Refs: Game.Core.Tests/Services/WaveManagerBudgetChannelTests.cs Game.Core.Tests/Services/WaveManagerDeterminismTests.cs",
      "Each generated wave emits auditable per-channel budget evidence that includes input, allocated, spent, and remaining values for normal, elite, and boss. Refs: Game.Core.Tests/Services/WaveManagerBudgetChannelTests.cs",
      "Invalid accounting transitions (negative spend, over-budget spend, or cross-channel charge) are rejected, channel totals remain unchanged after rejection, and same-seed replay reproduces the rejection trace. Refs: Game.Core.Tests/Services/WaveManagerBudgetChannelTests.cs Game.Core.Tests/Services/WaveManagerDeterminismTests.cs",
      "During a single wave execution, any attempt to modify per-day budget inputs or channel accounting fields must be rejected and must not advance the flow. Refs: Game.Core.Tests/Services/WaveBudgetAllocatorTests.cs",
      "After a rejected mutation attempt, normal/elite/boss input, allocated, spent, and remaining fields must remain bitwise-equivalent to pre-rejection state. Refs: Game.Core.Tests/Services/WaveBudgetAllocatorTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #4 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 4,
    "contractRefs": [
      "Game.Core/Contracts/Lastking/WaveSpawned.cs"
    ]
  },
  {
    "id": "GM-0105",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0103",
      "GM-0104"
    ],
    "taskmaster_exported": true,
    "title": "Create enemy spawning system with cadence",
    "description": "Develop a spawning system that continuously spawns enemies during the first 80% of Night with a 10s cadence.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Services/CollisionServiceTests.cs",
      "Game.Core.Tests/Services/WaveManagerNightCadenceWindowTests.cs",
      "Game.Core.Tests/Services/WaveManagerSpawnPolicyTests.cs",
      "Game.Core.Tests/Services/WaveManagerNightStateGateTests.cs",
      "Game.Core.Tests/Services/WaveManagerNightCompositionValidationTests.cs",
      "Game.Core.Tests/Services/WaveManagerNightDeterminismTests.cs",
      "Game.Core.Tests/Services/WaveManagerNightChannelBoundaryTests.cs",
      "Game.Core.Tests/Services/WaveManagerNightDiagnosticsTests.cs",
      "Game.Core.Tests/Services/WaveManagerNightRegressionTests.cs"
    ],
    "acceptance": [
      "Taskmaster #5 PRD lock is satisfied in gameplay: Night cadence spawning is present in the first 80% phase and absent for new cadence-driven spawns in the final 20% phase. Refs: Game.Core.Tests/Services/WaveManagerNightCadenceWindowTests.cs",
      "Referenced automated tests for gameplay behavior pass on the Windows Godot+C# baseline and validate Night-window gating, 10-second cadence, boss-count behavior, and spawn-point constraints. Refs: Game.Core.Tests/Services/WaveManagerNightCadenceWindowTests.cs Game.Core.Tests/Services/WaveManagerSpawnPolicyTests.cs",
      "Gameplay Night spawning is timer-driven by elapsed Night time, so spawn events are periodic instead of occurring every frame. Refs: Game.Core.Tests/Services/WaveManagerNightCadenceWindowTests.cs",
      "With Night duration configured to 120 seconds, regular enemy spawning occurs only in the first 96 seconds of Night. Refs: Game.Core.Tests/Services/WaveManagerNightCadenceWindowTests.cs",
      "Within that first 96-second Night window, spawn timing follows a 10-second cadence between consecutive regular enemy spawns. Refs: Game.Core.Tests/Services/WaveManagerNightCadenceWindowTests.cs",
      "No new regular enemy cadence spawns occur during the last 24 seconds of Night. Refs: Game.Core.Tests/Services/WaveManagerNightCadenceWindowTests.cs",
      "Boss night behavior produces exactly 2 boss spawns from config. Refs: Game.Core.Tests/Services/WaveManagerSpawnPolicyTests.cs",
      "Each spawned enemy appears at a predefined spawn point in the game world, with no off-list spawn locations. Refs: Game.Core.Tests/Services/WaveManagerSpawnPolicyTests.cs",
      "If gameplay is not in Night state, this Night-cadence spawn flow does not emit new enemy spawn events. Refs: Game.Core.Tests/Services/WaveManagerNightStateGateTests.cs",
      "In a non-boss Night with at least one valid spawn point, gameplay exhibits at least one regular enemy spawn before the 96-second cutoff. Refs: Game.Core.Tests/Services/WaveManagerNightCadenceWindowTests.cs",
      "If Night duration is changed in configuration, gameplay still enforces the same 80% spawn phase and 20% no-new-regular-spawn phase. Refs: Game.Core.Tests/Services/WaveManagerNightCadenceWindowTests.cs",
      "Gameplay treats Night duration as runtime config input, not a fixed 120-second assumption: for D=150 seconds, regular spawn behavior remains enabled only in [0,120) and disabled for new regular spawns in [120,150]. Refs: Game.Core.Tests/Services/WaveManagerNightCadenceWindowTests.cs",
      "For a non-boss Night with Night duration set to 120 seconds and at least one valid spawn point, observed regular spawn count in [0,96) is at least 9 and at most 10, and observed regular spawn count in [96,120] is 0. Refs: Game.Core.Tests/Services/WaveManagerNightCadenceWindowTests.cs",
      "Obligation lock O1: In WaveManager, implement spawning logic during Night state is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Game.Core.Tests/Services/WaveManagerNightStateGateTests.cs Game.Core.Tests/Services/WaveManagerNightCadenceWindowTests.cs",
      "Obligation lock O6: In the final 20% of Night [0.8D, D], the system must emit no new enemy spawn events of any type (regular, elite, or boss). Refs: Game.Core.Tests/Services/WaveManagerSpawnPolicyTests.cs",
      "Gameplay Night spawning consumes a validated spawn composition contract that includes required cadence fields and deterministic sequencing keys; if contract validation fails, no Night spawn flow starts. Refs: Game.Core.Tests/Services/WaveManagerNightCompositionValidationTests.cs",
      "For identical gameplay inputs and deterministic seed, Night spawn outcomes are reproducible run-to-run in both emission ordering and cadence-aligned timing. Refs: Game.Core.Tests/Services/WaveManagerNightDeterminismTests.cs",
      "Gameplay emission channels respect hard boundaries: regular cadence emissions stay within the configured spawn-active window, and boss emissions do not exceed configured boss-night count. Refs: Game.Core.Tests/Services/WaveManagerNightChannelBoundaryTests.cs",
      "On malformed composition states, gameplay produces no undefined spawn behavior and emits structured diagnostics describing the rejection reason. Refs: Game.Core.Tests/Services/WaveManagerNightDiagnosticsTests.cs",
      "Gameplay regression checks cover success and failure paths and detect deterministic-trace drift when seed and inputs are unchanged. Refs: Game.Core.Tests/Services/WaveManagerNightRegressionTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #5 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 5,
    "contractRefs": [
      "Game.Core/Contracts/Lastking/WaveSpawned.cs"
    ],
    "evidence_refs": []
  },
  {
    "id": "GM-0106",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0101"
    ],
    "taskmaster_exported": true,
    "title": "Implement enemy AI with target priority and pathing",
    "description": "Develop enemy AI that follows target priority rules and handles blocked paths with fallback attacks.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Services/CollisionServiceTests.cs",
      "Game.Core.Tests/Services/EnemyAiTargetSelectionTests.cs",
      "Tests.Godot/tests/Scenes/Combat/test_enemy_ai_blocked_route_fallback.gd",
      "Tests.Godot/tests/Integration/test_combat_friendly_fire_disabled.gd",
      "Game.Core.Tests/Services/EnemyAiDecisionDeterminismTests.cs",
      "Game.Core.Tests/Engine/DeterministicSimulationLoopTests.cs",
      "Tests.Godot/tests/Scenes/Combat/test_enemy_ai_navigation_priority.gd",
      "Tests.Godot/tests/Scenes/Combat/test_enemy_ai_attachment_validation.gd",
      "Game.Core.Tests/Services/EnemyAiTargetingServiceTests.cs",
      "Tests.Godot/tests/Integration/test_enemy_ai_target_selection_determinism.gd",
      "Game.Core.Tests/Services/EnemyAiRetargetingServiceTests.cs",
      "Tests.Godot/tests/Scenes/Combat/test_enemy_ai_retarget_unreachable_target.gd",
      "Game.Core.Tests/Services/EnemyAiPathingDiagnosticsTests.cs",
      "Tests.Godot/tests/Integration/test_enemy_ai_blocked_map_fallback_timeout.gd"
    ],
    "acceptance": [
      "Taskmaster #6 passes only when combat runs show enemies selecting targets by the defined priority and executing blocked-path fallback attacks whenever routes are obstructed. Refs: Game.Core.Tests/Services/EnemyAiTargetSelectionTests.cs Tests.Godot/tests/Scenes/Combat/test_enemy_ai_blocked_route_fallback.gd",
      "On the Windows Godot+C# baseline, automated suites for priority selection, blocked-path fallback, fixed-seed determinism, and friendly-fire disablement all pass; any failing suite fails acceptance. Refs: Tests.Godot/tests/Integration/test_combat_friendly_fire_disabled.gd",
      "With unchanged initial state and a fixed seed, deterministic simulation loop outputs match the approved baseline; any divergence is a determinism regression. Refs: Game.Core.Tests/Services/EnemyAiDecisionDeterminismTests.cs Game.Core.Tests/Engine/DeterministicSimulationLoopTests.cs",
      "Given mixed targets and at least one reachable candidate, each enemy selects the highest reachable class in strict order: unit > castle > armed defense > wall/gate. Refs: Game.Core.Tests/Services/EnemyAiTargetSelectionTests.cs Tests.Godot/tests/Scenes/Combat/test_enemy_ai_navigation_priority.gd",
      "With identical initial state and the same fixed seed, ties among equal-priority candidates resolve to the same target across repeated executions. Refs: Game.Core.Tests/Services/EnemyAiDecisionDeterminismTests.cs",
      "When higher-priority targets are blocked, the enemy attacks the nearest structure blocking the route and does not idle or switch to unrelated non-blocking targets. Refs: Game.Core.Tests/Services/EnemyAiTargetSelectionTests.cs Tests.Godot/tests/Scenes/Combat/test_enemy_ai_blocked_route_fallback.gd",
      "Movement decisions obey Godot navigation constraints: enemies follow navigable paths only and cannot traverse blocked geometry. Refs: Tests.Godot/tests/Scenes/Combat/test_enemy_ai_navigation_priority.gd",
      "Every combat enemy node has an active EnemyAI C# attachment at runtime; any missing attachment fails validation/tests. Refs: Tests.Godot/tests/Scenes/Combat/test_enemy_ai_attachment_validation.gd",
      "Player-origin attacks are configured so collision layers/masks prevent friendly/player damage, and friendly-fire hit events do not occur. Refs: Tests.Godot/tests/Integration/test_combat_friendly_fire_disabled.gd",
      "In any decision cycle, selecting a lower-priority target while a higher-priority reachable target exists is a failure. Refs: Game.Core.Tests/Services/EnemyAiTargetSelectionTests.cs Tests.Godot/tests/Scenes/Combat/test_enemy_ai_navigation_priority.gd",
      "Blocked-route tests confirm the fallback target is the nearest blocking structure by distance, and emitted attack events are directed to that blocker. Refs: Game.Core.Tests/Services/EnemyAiTargetSelectionTests.cs Tests.Godot/tests/Scenes/Combat/test_enemy_ai_blocked_route_fallback.gd",
      "Across full player-attack combat runs, friendly/player damage events remain zero from start to finish. Refs: Tests.Godot/tests/Integration/test_combat_friendly_fire_disabled.gd",
      "Targeting first filters by navigation reachability, then applies priority order (unit > castle > armed defense > wall/gate); unreachable higher-priority targets are excluded. Refs: Game.Core.Tests/Services/EnemyAiTargetSelectionTests.cs Tests.Godot/tests/Scenes/Combat/test_enemy_ai_navigation_priority.gd",
      "With fixed seed and identical initial state, repeated runs produce identical decision traces for both equal-priority ties and blocked-path fallback choices. Refs: Game.Core.Tests/Services/EnemyAiDecisionDeterminismTests.cs",
      "Obligation lock O1 is satisfied only when combat enemy nodes run with an active EnemyAI C# script attached at runtime; absence is a configuration failure. Refs: Tests.Godot/tests/Scenes/Combat/test_enemy_ai_attachment_validation.gd",
      "Obligation lock O9 is satisfied only when automated tests verify fixed-seed deterministic behavior across repeated runs for this task. Refs: Game.Core.Tests/Services/EnemyAiDecisionDeterminismTests.cs",
      "For reachable candidates at the same priority, target selection compares deterministic path cost, and equal-cost ties are resolved only by the fixed seed so repeated runs stay identical. Refs: Game.Core.Tests/Services/EnemyAiTargetingServiceTests.cs Tests.Godot/tests/Integration/test_enemy_ai_target_selection_determinism.gd",
      "If the current target becomes unreachable or invalid at runtime, the enemy switches to the next reachable target under reachability-plus-priority rules and does not traverse non-navigable space to keep the old target. Refs: Game.Core.Tests/Services/EnemyAiRetargetingServiceTests.cs Tests.Godot/tests/Scenes/Combat/test_enemy_ai_retarget_unreachable_target.gd",
      "Blocked-map regression runs emit pathing diagnostics for each fallback decision, and each enemy reaches a fallback attack within timeout instead of entering a no-move/no-attack deadlock. Refs: Game.Core.Tests/Services/EnemyAiPathingDiagnosticsTests.cs Tests.Godot/tests/Integration/test_enemy_ai_blocked_map_fallback_timeout.gd"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #6 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 6,
    "contractRefs": [
      "Game.Core/Contracts/Lastking/CastleHpChanged.cs"
    ],
    "evidence_refs": []
  },
  {
    "id": "GM-0107",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0101",
      "GM-0106"
    ],
    "taskmaster_exported": true,
    "title": "Set up castle HP and loss condition",
    "description": "Implement castle health system and loss condition when HP reaches 0.",
    "status": "pending",
    "priority": "P2",
    "layer": "ci",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "ci"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Tests.Godot/tests/Integration/test_battle_castle_loss_flow.gd",
      "Game.Core.Tests/Services/CastleCombatResolutionTests.cs",
      "Game.Core.Tests/State/BattleLossStateMachineTests.cs",
      "Game.Core.Tests/Services/BattleInitializationFromConfigTests.cs",
      "Tests.Godot/tests/Adapters/Config/test_castle_start_hp_config.gd",
      "Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "Game.Core.Tests/Services/EnemyTargetSelectionTests.cs",
      "Tests.Godot/tests/Scenes/Battle/test_castle_current_hp_contract.gd",
      "Game.Core.Tests/Engine/GameEngineCoreEventTests.cs",
      "Game.Core.Tests/Domain/ValueObjects/HealthTests.cs",
      "Tests.Godot/tests/Integration/test_castle_loss_transition_evidence_replay.gd"
    ],
    "acceptance": [
      "Task #7 delivers all required outcomes in one playable flow: castle HP state exists, enemy attacks reduce castle HP, HP=0 triggers loss/game-over, UI shows updated HP, and enemy AI can target the castle. Refs: Tests.Godot/tests/Integration/test_battle_castle_loss_flow.gd",
      "Automated tests on the Windows Godot+C# baseline pass for castle HP reduction under enemy attacks, loss trigger at HP=0, and transition of game state to loss. Refs: Game.Core.Tests/Services/CastleCombatResolutionTests.cs Game.Core.Tests/State/BattleLossStateMachineTests.cs",
      "When castle HP is above 0, battle combat resolution continues normally and the game does not enter unintended loss/game-over. Refs: Game.Core.Tests/State/BattleLossStateMachineTests.cs",
      "At battle start, castle HP is initialized from the configured starting HP value, and that starting value is above 0. Refs: Game.Core.Tests/Services/BattleInitializationFromConfigTests.cs Tests.Godot/tests/Adapters/Config/test_castle_start_hp_config.gd",
      "When an enemy attack is resolved against the castle, castle HP decreases by that attack's resolved damage amount. Refs: Game.Core.Tests/Services/CastleCombatResolutionTests.cs",
      "If no enemy attack is applied to the castle during an observed interval, castle HP remains unchanged during that interval. Refs: Game.Core.Tests/Services/CastleCombatResolutionTests.cs",
      "When enemy damage causes castle HP to reach 0, the game immediately transitions to the loss/game-over state. Refs: Game.Core.Tests/State/BattleLossStateMachineTests.cs Game.Core.Tests/Services/CastleCombatResolutionTests.cs",
      "After the game enters loss/game-over at castle HP=0, normal battle gameplay flow does not continue. Refs: Game.Core.Tests/State/BattleLossStateMachineTests.cs Tests.Godot/tests/Integration/test_battle_castle_loss_flow.gd",
      "Gameplay UI displays the current castle HP and refreshes the displayed HP value after each castle HP change. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "Enemy AI can choose the castle as a valid target, and attacks from that targeting path reduce castle HP. Refs: Game.Core.Tests/Services/EnemyTargetSelectionTests.cs Tests.Godot/tests/Integration/test_battle_castle_loss_flow.gd",
      "Loss/game-over is triggered at the HP=0 threshold; while castle HP stays above 0, loss/game-over is not triggered. Refs: Game.Core.Tests/State/BattleLossStateMachineTests.cs",
      "Across multiple resolved enemy attacks in one battle, castle HP updates cumulatively, and the UI HP display matches the latest castle HP after each update. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "Castle state exposes a readable current HP value from castle script/state for both combat resolution and UI HP update flows. Refs: Tests.Godot/tests/Scenes/Battle/test_castle_current_hp_contract.gd",
      "Changing the configured starting HP value changes castle HP at battle start without requiring code changes. Refs: Tests.Godot/tests/Adapters/Config/test_castle_start_hp_config.gd",
      "Obligation lock O1: A concrete Castle C# script (Castle.cs or equivalent) must exist and expose a readable CurrentHp property for gameplay, combat resolution, and UI binding. Refs: Tests.Godot/tests/Scenes/Battle/test_castle_current_hp_contract.gd",
      "Castle HP mutation boundaries are enforced: CurrentHp changes only at battle initialization from configured starting HP and when resolved enemy attacks apply damage; without either trigger, CurrentHp must remain unchanged. Refs: Game.Core.Tests/Engine/GameEngineCoreEventTests.cs Game.Core.Tests/Domain/ValueObjects/HealthTests.cs",
      "Terminal transition is deterministic and single-dispatch: when CurrentHp first reaches 0, exactly one loss/game-over transition is emitted, and further damage processing while already terminal must not emit an additional loss transition. Refs: Game.Core.Tests/State/GameStateMachineTests.cs Game.Core.Tests/Engine/GameEngineCoreEventTests.cs",
      "Terminal-state evidence and replay checks are required: entering loss/game-over at HP=0 must emit terminal-transition evidence artifacts, and repeated runs with the same seed must produce the same loss-transition timing; missing evidence must fail validation. Refs: Tests.Godot/tests/Integration/test_castle_loss_transition_evidence_replay.gd",
      "Contract tests must verify terminal trigger boundaries: HP=0 triggers loss, HP>0 does not trigger loss, and HP boundary rules are auditable. Refs: Game.Core.Tests/Services/CastleDurabilityTerminalTests.cs",
      "Contract-test gate for terminal trigger boundaries is mandatory on Windows baseline CI and blocks on failure. Refs: Game.Core.Tests/Services/CastleDurabilityTerminalTests.cs",
      "Unit tests must assert single terminal dispatch: first transition to HP=0 emits exactly one loss event and subsequent damage emits no additional terminal event. Refs: Game.Core.Tests/Services/CastleDurabilityTerminalTests.cs",
      "Unit tests must cover multi-hit HP transition traces and assert flow remains stopped after terminal state is reached. Refs: Game.Core.Tests/Services/CastleDurabilityTerminalTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #7 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 7,
    "contractRefs": [
      "Game.Core/Contracts/Lastking/CastleHpChanged.cs"
    ],
    "evidence_refs": []
  },
  {
    "id": "GM-0108",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0103",
      "GM-0107"
    ],
    "taskmaster_exported": true,
    "title": "Develop win condition and game progression",
    "description": "Implement win condition (survive Day15) and integrate with day progression.",
    "status": "pending",
    "priority": "P3",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Game.Core.Tests/State/GameStateManagerTests.cs"
    ],
    "acceptance": [
      "Taskmaster #8 is complete only when run progression applies these rules: reaching Day15 with castle HP > 0 results in win, and loss may end the run earlier. Refs: Game.Core.Tests/State/GameStateManagerTests.cs Game.Core.Tests/State/GameStateMachineTests.cs",
      "Referenced automated tests for Day15 win trigger, pre-Day15 loss precedence when castle HP = 0, and terminal-state handling pass on the Windows Godot+C# baseline. Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "With identical inputs and timing, day/night progression yields deterministic win/loss outcomes without core-loop regression. Refs: Game.Core.Tests/State/GameStateManagerTests.cs Game.Core.Tests/State/GameStateMachineTests.cs",
      "When current day first reaches Day15 and castle HP is greater than 0, the game enters a win terminal state and displays a win screen or win message. Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "If castle HP becomes 0 before Day15, the game enters a loss terminal state and emits no win state for that run. Refs: Game.Core.Tests/State/GameStateManagerTests.cs Game.Core.Tests/State/GameStateMachineTests.cs",
      "Before any terminal state is reached, day/night progression continues normally, and each progression step evaluates Day15 and castle HP end-state conditions. Refs: Game.Core.Tests/State/GameStateManagerTests.cs Game.Core.Tests/State/GameStateMachineTests.cs",
      "After win or loss is triggered, configured end-of-game handling (pause or reset) is applied, and normal progression does not continue without explicit restart/reset. Refs: Game.Core.Tests/State/GameStateManagerTests.cs Game.Core.Tests/State/GameStateMachineTests.cs",
      "When current day is below Day15 and castle HP is above 0, the run remains in a non-terminal, non-win progression state. Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "At the first progression step where current day becomes Day15 and castle HP is greater than 0, win state is entered immediately in that same step. Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "If castle HP is 0 at or before the Day15 evaluation step, the run remains in loss state and cannot transition to win unless an explicit restart/reset starts a new run. Refs: Game.Core.Tests/State/GameStateManagerTests.cs Game.Core.Tests/State/GameStateMachineTests.cs",
      "After entering win or loss, additional day/night ticks do not create extra terminal-state transitions or duplicate win/loss UI emissions in the same run. Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "A playthrough that reaches Day15 while castle HP remains above 0 triggers win in that run and does not emit loss before restart/reset. Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "A playthrough where castle HP becomes 0 before reaching Day15 triggers loss and does not emit win in that run. Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "Before terminal state is reached, each progression update re-evaluates end-state conditions using that run's current day and current castle HP. Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "Once a terminal state is reached, the run stays terminal and normal progression does not resume until an explicit restart/reset starts a new run. Refs: Game.Core.Tests/State/GameStateManagerTests.cs Game.Core.Tests/State/GameStateMachineTests.cs",
      "Obligation lock O1: In GameStateManager, check if current day reaches 15 and castle HP > 0 to trigger win is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Game.Core.Tests/State/GameStateManagerTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #8 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 8,
    "contractRefs": [
      "Game.Core/Contracts/Lastking/DayStarted.cs",
      "Game.Core/Contracts/Lastking/CastleHpChanged.cs"
    ]
  },
  {
    "id": "GM-0109",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0101",
      "GM-0103",
      "GM-0107"
    ],
    "taskmaster_exported": true,
    "title": "Create basic UI for day/night and HP display",
    "description": "Implement a minimal user interface to show current day, time in cycle, and castle HP.",
    "status": "pending",
    "priority": "P3",
    "layer": "adapter",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "adapter"
    ],
    "test_refs": [
      "Tests.Godot/tests/UI/test_hud_scene.gd",
      "Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Game.Core.Tests/State/GameStateManagerTests.cs",
      "Tests.Godot/tests/Integration/test_hud_integration.gd"
    ],
    "acceptance": [
      "Taskmaster #9 deliverable is strictly limited to a minimal HUD in the main play view that shows day, cycle time remaining, and castle HP, with no additional status metrics added. Refs: Tests.Godot/tests/UI/test_hud_scene.gd",
      "All automated tests referenced by this task pass on the Windows Godot + C# baseline environment. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "Adding HUD behavior does not alter deterministic simulation outputs or core-loop progression rules for identical inputs. Refs: Game.Core.Tests/State/GameStateMachineTests.cs Game.Core.Tests/State/GameStateManagerTests.cs",
      "At runtime, the main play view renders three distinct HUD values: current day, remaining time in the active Day/Night cycle, and castle HP. Refs: Tests.Godot/tests/UI/test_hud_scene.gd",
      "As simulation advances, the day HUD value follows the authoritative day counter and remains within 1-15. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "While a Day/Night cycle is active, the displayed remaining cycle time changes over time and is not static between sampled updates. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "When a Day/Night phase transition occurs, the cycle-time HUD switches to the new phase timing state and does not retain stale values from the previous phase. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd Tests.Godot/tests/Integration/test_hud_integration.gd",
      "When gameplay changes castle HP, the HUD HP value updates within the same play session without restart. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "If source values for day, cycle remaining time, and HP do not change, the corresponding HUD outputs also remain unchanged. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "On scene start, all three HUD fields are populated with concrete runtime values before any progression-driven update tick. Refs: Tests.Godot/tests/UI/test_hud_scene.gd",
      "In a session containing at least one Day/Night transition and one HP change, all three HUD fields remain visible and continue updating without freeze or disappearance. Refs: Tests.Godot/tests/Integration/test_hud_integration.gd Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "During normal core-loop gameplay, the three HUD values remain continuously readable in the main play view without opening debug or menu screens. Refs: Tests.Godot/tests/UI/test_hud_scene.gd",
      "The main play scene implements one distinct standard text UI control (Label or equivalent Control-derived text element) per required HUD value. Refs: Tests.Godot/tests/UI/test_hud_scene.gd",
      "During active play, each HUD field refreshes automatically from state changes and never requires scene reload, menu toggle, or manual refresh actions. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "In a run with day progression, at least one Day/Night transition, and at least one HP change, all three HUD values visibly track their source values in real time on the main play view. Refs: Tests.Godot/tests/Integration/test_hud_integration.gd Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "Scope remains minimal: the HUD directly exposes only day, cycle time remaining, and castle HP for core-loop visibility. Refs: Tests.Godot/tests/UI/test_hud_scene.gd",
      "Real-time HUD updates via C# scripts are treated as mandatory and must be verifiable through tests or audit evidence. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "A single HUD data contract defines required fields (day, cycle time remaining, castle HP), required refresh cadence, and explicit fallback placeholders for invalid or unavailable data; contract tests fail if any required field, binding, or fallback definition is missing. Refs: Tests.Godot/tests/UI/test_hud_scene.gd",
      "HUD binding and update flow is event-driven from core-loop transitions with explicit ownership boundaries, and Day/Night transition events plus HP change events must update mapped HUD outputs in the same session without scene reload or manual refresh. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd Tests.Godot/tests/Integration/test_hud_integration.gd",
      "Regression tests cover HUD continuity across Day/Night transitions and HP damage/change events, validate invalid-data fallback behavior, and emit UI state diagnostics at transition and fallback activation points. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #9 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 9,
    "contractRefs": [
      "Game.Core/Contracts/Lastking/DayStarted.cs",
      "Game.Core/Contracts/Lastking/NightStarted.cs",
      "Game.Core/Contracts/Lastking/CastleHpChanged.cs"
    ],
    "evidence_refs": []
  },
  {
    "id": "GM-0110",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0101",
      "GM-0102",
      "GM-0103",
      "GM-0104",
      "GM-0105",
      "GM-0106",
      "GM-0107",
      "GM-0108",
      "GM-0109"
    ],
    "taskmaster_exported": true,
    "title": "Integrate and test full core loop",
    "description": "Combine all systems and test the complete core gameplay loop from start to win/loss.",
    "status": "pending",
    "priority": "P1",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Game.Core.Tests/Engine/GameEngineCoreEventTests.cs",
      "Tests.Godot/tests/Integration/test_day1_day15_seeded_replay_terminal_outcome.gd",
      "Tests.Godot/tests/Integration/test_playable_core_loop_flow_deterministic_order.gd",
      "Tests.Godot/tests/Scenes/Main/test_main_day_night_wave_terminal_dispatch.gd",
      "Game.Core.Tests/Tasks/Task10DeterministicCheckpointSequenceTests.cs",
      "Tests.Godot/tests/Integration/test_day1_day15_checkpoint_sequence_stable.gd",
      "Game.Core.Tests/Services/CollisionServiceTests.cs",
      "Game.Core.Tests/Tasks/Task10BossChannelIsolationTests.cs",
      "Tests.Godot/tests/Integration/test_spawn_channels_boss_lock_isolation.gd",
      "Tests.Godot/tests/Integration/test_integration_slices_emit_evidence_artifacts.gd",
      "Tests.Godot/tests/Integration/test_staged_slices_order_and_verdict.gd",
      "Game.Core.Tests/Tasks/Task10DeterministicReplayTerminalStateTests.cs",
      "Tests.Godot/tests/Integration/test_day1_day15_replay_records_required_anchors.gd",
      "Game.Core.Tests/Services/EventBusTests.cs",
      "Tests.Godot/tests/Integration/test_regression_smoke_logs_core_anchors.gd",
      "Game.Core.Tests/Tasks/Task10StagedGatePrerequisiteTests.cs",
      "Tests.Godot/tests/Integration/test_replay_requires_staged_complete_flag.gd"
    ],
    "acceptance": [
      "Taskmaster #10 is accepted only if a single integration gate verifies runtime-loop wiring, spawn-channel execution, path-block fallback, and win/loss completion in one end-to-end run. Refs: Game.Core.Tests/Engine/GameEngineCoreEventTests.cs",
      "All automated tests referenced by this task (staged integration and full seeded replay) must pass on the Windows Godot+C# baseline; any failing case blocks acceptance. Refs: Tests.Godot/tests/Integration/test_day1_day15_seeded_replay_terminal_outcome.gd",
      "Regression runs against the locked baseline must show zero deterministic-simulation drift and zero core-loop rule regression; any drift or rule break fails acceptance. Refs: Game.Core.Tests/Engine/GameEngineCoreEventTests.cs Game.Core.Tests/State/GameStateMachineTests.cs",
      "One playable scene flow must wire Game.Core runtime-loop services through adapters with an explicit deterministic update order, and smoke evidence must show day-night transition, wave start, and terminal win/loss dispatch. Refs: Tests.Godot/tests/Integration/test_playable_core_loop_flow_deterministic_order.gd Tests.Godot/tests/Scenes/Main/test_main_day_night_wave_terminal_dispatch.gd",
      "Deterministic checkpoints must be emitted at each major transition, and two Day1-Day15 runs with the same seed must produce the same ordered checkpoint sequence; any sequence mismatch fails acceptance. Refs: Game.Core.Tests/Tasks/Task10DeterministicCheckpointSequenceTests.cs Tests.Godot/tests/Integration/test_day1_day15_checkpoint_sequence_stable.gd",
      "Using fully blocked seeded map fixtures, path-block fallback targeting must engage without deadlock and must return to normal targeting after a valid path appears; deadlock or missing recovery fails acceptance. Refs: Game.Core.Tests/Services/CollisionServiceTests.cs",
      "Normal, elite, and boss-night scenarios must enforce fixed boss-count lock and per-channel accounting isolation; any cross-channel budget leakage fails acceptance. Refs: Game.Core.Tests/Tasks/Task10BossChannelIsolationTests.cs Tests.Godot/tests/Integration/test_spawn_channels_boss_lock_isolation.gd",
      "Each integration slice must run independently and publish consolidated evidence artifacts to logs/e2e and logs/ci with required core-anchor fields for CI inspection and manual debugging handoff. Refs: Tests.Godot/tests/Integration/test_integration_slices_emit_evidence_artifacts.gd",
      "Staged integration must execute slices in the required order (runtime loop wiring, seeded checkpoints, blocked-map fallback, boss/channel checks, evidence packaging), and each slice must emit an explicit pass/fail result when run independently. Refs: Tests.Godot/tests/Integration/test_staged_slices_order_and_verdict.gd",
      "A full seeded end-to-end replay from Day1 through Day15 must reach exactly one terminal state (win or loss) and record deterministic timeline, channel isolation, blocker fallback engagement, and boss-count lock anchors in logs/e2e and logs/ci; missing terminal state or missing anchors fails acceptance. Refs: Game.Core.Tests/Tasks/Task10DeterministicReplayTerminalStateTests.cs Tests.Godot/tests/Integration/test_day1_day15_replay_records_required_anchors.gd",
      "Spawn-channel behavior must be exercised in staged slices and in the Day1-Day15 replay with observable channel-specific activity and isolated accounting boundaries; no channel activity evidence or cross-channel attribution fails acceptance. Refs: Game.Core.Tests/Services/EventBusTests.cs",
      "Regression smoke logs must exist for every staged slice and for the final Day1-Day15 replay under logs/e2e and logs/ci, and each log must include required core-anchor fields plus an explicit pass/fail verdict; missing logs or required fields fails acceptance. Refs: Tests.Godot/tests/Integration/test_regression_smoke_logs_core_anchors.gd",
      "Staged integration is accepted only if all five required slices execute to completion in the mandated order with no skipped or inconclusive slice; otherwise acceptance fails. Refs: Tests.Godot/tests/Integration/test_staged_slices_order_and_verdict.gd",
      "The Day1-Day15 seeded replay is accepted only if it starts at Day1, reaches Day15, and emits exactly one terminal outcome (win or loss); early abort, non-terminal completion, or multiple terminal outcomes fails acceptance. Refs: Game.Core.Tests/State/GameStateMachineTests.cs",
      "Spawn-channel verification requires observable per-channel events and per-channel budget/accounting records in both staged slices and the full Day1-Day15 replay; missing per-channel evidence fails acceptance. Refs: Game.Core.Tests/Services/EventBusTests.cs",
      "Staged integration must complete all five slices with pass verdicts before Day1-Day15 full seeded replay starts; replay start without staged_complete=true (or with any incomplete slice) fails acceptance. Refs: Game.Core.Tests/Tasks/Task10StagedGatePrerequisiteTests.cs Tests.Godot/tests/Integration/test_replay_requires_staged_complete_flag.gd",
      "Blocked-map validation must include reproducible seeded tie cases (equal-priority candidates) and record tie-break sequence; same-seed reruns with any tie-break sequence mismatch fail acceptance. Refs: Game.Core.Tests/Services/CollisionServiceTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #10 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 10,
    "contractRefs": [
      "Game.Core/Contracts/Lastking/DayStarted.cs",
      "Game.Core/Contracts/Lastking/NightStarted.cs",
      "Game.Core/Contracts/Lastking/WaveSpawned.cs",
      "Game.Core/Contracts/Lastking/CastleHpChanged.cs",
      "Game.Core/Contracts/Lastking/RewardOffered.cs",
      "Game.Core/Contracts/Lastking/SaveAutosaved.cs"
    ]
  },
  {
    "id": "GM-0111",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0101"
    ],
    "taskmaster_exported": true,
    "title": "Refine baseline bootstrap with main-scene and structure standards",
    "description": "Refine the existing T1 project with stricter main-scene, startup bootstrap script, and folder standards.",
    "status": "pending",
    "priority": "P1",
    "layer": "ci",
    "adr_refs": [
      "ADR-0011",
      "ADR-0001"
    ],
    "chapter_refs": [
      "CH07",
      "CH10",
      "CH01"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "ci"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Game.Core.Tests/Tasks/Task11ProjectReuseGuardsTests.cs",
      "Tests.Godot/tests/Scenes/Smoke/test_main_scene_smoke.gd",
      "Game.Core.Tests/Tasks/Task11WindowsCSharpBaselineGateTests.cs",
      "Tests.Godot/tests/Scenes/Smoke/test_glue_connections.gd",
      "Game.Core.Tests/Tasks/Task11ProjectStructureStandardsTests.cs",
      "Tests.Godot/tests/Scenes/Smoke/test_main_scene_bootstrap_path.gd",
      "Game.Core.Tests/Domain/GameConfigTests.cs",
      "Tests.Godot/tests/Integration/test_editor_reopen_rebuild_stability.gd",
      "Tests.Godot/tests/Integration/test_singleplayer_startup_flow.gd",
      "Game.Core.Tests/Services/StartupBootstrapServiceTests.cs",
      "Game.Core.Tests/Engine/BootstrapStructureContractTests.cs",
      "Tests.Godot/tests/Integration/test_screen_navigator.gd",
      "Tests.Godot/tests/Security/Hard/test_db_open_denied_writes_audit_log.gd"
    ],
    "acceptance": [
      "T11 必须在既有 T1 项目根目录上执行加固与验证，不得新建或替换为另一个 Godot 项目。 Refs: Game.Core.Tests/Tasks/Task11ProjectReuseGuardsTests.cs",
      "既有 T1 项目的 Main Scene 与启动绑定已被检查并收敛到统一标准，运行时使用该绑定。 Refs: Tests.Godot/tests/Scenes/Smoke/test_main_scene_smoke.gd",
      "交付结果保持为 Windows Godot 4.5.1 + C# 工作流的同一基线项目，不接受退化为非 C# 基线。 Refs: Game.Core.Tests/Tasks/Task11WindowsCSharpBaselineGateTests.cs",
      "针对 Windows Godot+C# 基线且与本任务相关的自动化检查在复用的 T1 根目录上全部通过。 Refs: Game.Core.Tests/Tasks/Task11ProjectReuseGuardsTests.cs Game.Core.Tests/Tasks/Task11WindowsCSharpBaselineGateTests.cs",
      "加固后项目可稳定完成基础启动循环，且未引入新的启动不稳定问题。 Refs: Tests.Godot/tests/Scenes/Smoke/test_main_scene_smoke.gd Tests.Godot/tests/Scenes/Smoke/test_glue_connections.gd",
      "在 Windows 上，项目可由 Godot 4.5.1 打开，.NET/C# 支持处于可用状态，且编辑器启动无错误。 Refs: Tests.Godot/tests/Scenes/Smoke/test_main_scene_smoke.gd",
      "在 Godot 编辑器内构建 C# 脚本可完成，且 C# 编译错误为 0。 Refs: Game.Core.Tests/Tasks/Task11WindowsCSharpBaselineGateTests.cs",
      "Main Scene 被配置为启动场景，运行项目时进入该场景且无运行时异常。 Refs: Tests.Godot/tests/Scenes/Smoke/test_main_scene_smoke.gd",
      "项目结构满足目录标准，包含并使用 scripts、scenes、assets、config 四类专用目录。 Refs: Game.Core.Tests/Tasks/Task11ProjectStructureStandardsTests.cs",
      "启动游戏流程由 Godot C# API 的启动路径实现，并在 Main Scene 运行时实际执行。 Refs: Tests.Godot/tests/Scenes/Smoke/test_main_scene_bootstrap_path.gd",
      "C# 启动/配置逻辑可成功加载并解析至少一个 JSON 配置文件，且无加载或解析错误。 Refs: Game.Core.Tests/Domain/GameConfigTests.cs",
      "重开/重建验证必须在同一个 T1 项目根目录执行，不接受在新建项目路径上完成验证。 Refs: Game.Core.Tests/Tasks/Task11ProjectReuseGuardsTests.cs Tests.Godot/tests/Integration/test_editor_reopen_rebuild_stability.gd",
      "至少完成一次完整的编辑器重开并重建流程，且启动场景配置在该流程后保持有效。 Refs: Tests.Godot/tests/Scenes/Smoke/test_main_scene_smoke.gd",
      "完成验证后的项目再次运行可到达初始场景，且不会立即崩溃。 Refs: Tests.Godot/tests/Scenes/Smoke/test_main_scene_smoke.gd",
      "若任一必需的打开、编译、运行、重开或重建验证失败，则该任务不予验收。 Refs: Game.Core.Tests/Tasks/Task11WindowsCSharpBaselineGateTests.cs Tests.Godot/tests/Integration/test_editor_reopen_rebuild_stability.gd",
      "验证需确认 Windows 环境下 Godot 4.5.1 与可用于 Godot C# 编译的 .NET SDK 同时存在；任一缺失即不予验收。 Refs: Game.Core.Tests/Tasks/Task11WindowsCSharpBaselineGateTests.cs",
      "初始场景加载期间，至少一个启动路径 C# 脚本产生可观测效果，证明不是空操作。 Refs: Tests.Godot/tests/Scenes/Smoke/test_glue_connections.gd",
      "验证后的 Windows 构建进入单人启动流程，且不依赖多人会话初始化。 Refs: Tests.Godot/tests/Integration/test_singleplayer_startup_flow.gd Game.Core.Tests/Services/StartupBootstrapServiceTests.cs",
      "Obligation lock O7: 启动路径 C# 脚本必须同时完成窗口初始化设置与初始场景加载，缺任一步即不通过。 Refs: Game.Core.Tests/Services/StartupBootstrapServiceTests.cs Tests.Godot/tests/Scenes/Smoke/test_main_scene_bootstrap_path.gd",
      "Scope boundary: 本任务仅允许对既有 T1 项目做加固与验证；创建第二个 Godot 项目即不通过。 Refs: Game.Core.Tests/Tasks/Task11ProjectReuseGuardsTests.cs",
      "Scope boundary hard gate: T11 必须复用既有 T1 项目根目录，且禁止任何 new-project bootstrap；出现即不通过。 Refs: Game.Core.Tests/Tasks/Task11ProjectReuseGuardsTests.cs",
      "T11 复用验证必须在同一 T1 根目录完成，并包含至少两次编辑器重开且 Main Scene 与脚本绑定保持不变；缺少证据即不通过。 Refs: Tests.Godot/tests/Integration/test_editor_reopen_rebuild_stability.gd",
      "T11 执行期间若发生任何 reinitialization 或再次创建 Godot 项目，即使其他构建检查通过也判定不通过。 Refs: Game.Core.Tests/Tasks/Task11ProjectReuseGuardsTests.cs",
      "在同一 T1 根目录内，必须明确并验证启动基线命名约定（Main Scene 名称、启动脚本名称、scripts/scenes/assets/config 目录命名）并保持一致；任一不一致即不通过。 Refs: Tests.Godot/tests/Scenes/Smoke/test_main_scene_smoke.gd",
      "必需 bootstrap 资产（至少含启动场景与启动脚本）必须由结构契约检查列出并校验；缺失任一必需项时门禁必须失败。 Refs: Game.Core.Tests/Engine/BootstrapStructureContractTests.cs",
      "启动 wiring 与目录标准调整后，集成冒烟需证明启动流仍从既有主场景进入且目录完整；若出现 secondary root 或替代根路径即不通过。 Refs: Tests.Godot/tests/Scenes/Smoke/test_glue_connections.gd Tests.Godot/tests/Integration/test_screen_navigator.gd",
      "结构回归与门禁检查必须在复用的 T1 根目录生成可审计验证工件并记录缺失项失败结果；未产出工件或缺失项未触发失败即不通过。 Refs: Tests.Godot/tests/Security/Hard/test_db_open_denied_writes_audit_log.gd"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #11 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 11,
    "contractRefs": [
      "Game.Core/Contracts/Lastking/BootstrapReady.cs"
    ],
    "evidence_refs": []
  },
  {
    "id": "GM-0112",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0111"
    ],
    "taskmaster_exported": true,
    "title": "Implement Core Resource System with Integer Safety",
    "description": "Create a resource management system for gold, iron, and population cap, ensuring integer-safe operations to prevent floating-point drift.",
    "status": "pending",
    "priority": "P1",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Game.Core.Tests/Services/ResourceManagerTests.cs",
      "Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "Game.Core.Tests/Services/ResourceManagerIntegerSafetyTests.cs",
      "Game.Core.Tests/Engine/GameEngineCoreEventTests.cs"
    ],
    "acceptance": [
      "Hard gate: integer safety requires both static scan and runtime assertion gates; any non-integer resource arithmetic must fail immediately and keep state unchanged. Refs: Game.Core.Tests/Services/ResourceManagerIntegerSafetyTests.cs",
      "Hard gate: all economy modules must consume the shared resource contract/API, with cross-module tests proving consistent names, initial values, and invariants. Refs: Game.Core.Tests/Engine/GameEngineCoreEventTests.cs",
      "Taskmaster #12 gameplay delivery is limited to integer-safe resource behavior for gold, iron, and population cap, without unrelated gameplay changes. Refs: Game.Core.Tests/Services/ResourceManagerTests.cs",
      "Referenced automated tests pass on the Windows Godot+C# baseline. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "Gameplay-visible resource outcomes are deterministic: identical integer start state and identical action sequence produce identical totals and snapshot save/load parity. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "At gameplay start, visible resource totals are exactly gold=800, iron=150, and pop-cap=50. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "Player spend actions deduct integer gold/iron costs only when both requirements are met; failed spends apply zero deduction. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "No supported gameplay resource action can reduce gold, iron, or population cap below zero. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "Gameplay defines explicit deterministic outcomes for zero-value and negative-input resource actions, and tests can observe those outcomes in resource totals. Refs: Game.Core.Tests/Services/ResourceManagerTests.cs",
      "On every successful resource change, gameplay UI receives an emitted signal/event with updated totals and structured delta/reason payloads. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "Gameplay resource updates are integer-only and do not use floating-point arithmetic or drift-prone math. Refs: Game.Core.Tests/Services/ResourceManagerTests.cs",
      "Overflow/underflow guards prevent wrapped gameplay values, and snapshot serialization roundtrips preserve exact integer state. Refs: Game.Core.Tests/Services/ResourceManagerTests.cs",
      "Valid gameplay actions that add, subtract, or spend gold, iron, or population cap apply exact integer deltas via defined mutation APIs, and resulting totals equal prior totals plus/minus those deltas. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "If gameplay submits an invalid mutation (insufficient resources, negative amount, or overflow/underflow risk), gameplay-visible totals remain unchanged. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "Gameplay receives explicit spend success/failure outcomes: success means exact integer deduction occurred; failure means no resource value changed. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "Gameplay-facing automated tests assert initial values, valid/invalid mutations (including zero and negative attempts), overflow/underflow guards, rapid-update event ordering/payload integrity, and snapshot roundtrip parity for gold, iron, and population cap. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "Obligation lock O10: no floating-point usage in resource calculations is a hard acceptance criterion and is verifiable through tests or audit evidence. Refs: Game.Core.Tests/Services/ResourceManagerTests.cs",
      "Obligation lock O11: resource-system unit tests are implemented in C# test projects and executed by NUnit or an equivalent .NET test framework. Refs: Game.Core.Tests/Services/ResourceManagerTests.cs",
      "Obligation lock O1: the task implements a C# ResourceManager that tracks gold, iron, and population cap as integer state. Refs: Game.Core.Tests/Services/ResourceManagerTests.cs",
      "Obligation lock O2: initial resource state is exactly gold=800, iron=150, and pop-cap=50. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #12 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 12,
    "contractRefs": [
      "Game.Core/Contracts/Lastking/ResourcesChanged.cs"
    ],
    "evidence_refs": []
  },
  {
    "id": "GM-0113",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0111",
      "GM-0112"
    ],
    "taskmaster_exported": true,
    "title": "Design and Implement Building System with Footprint Rules",
    "description": "Develop a building system that supports core buildings (castle, residence, mine, barracks, MG tower, wall, mine trap) with footprint rules and placement logic.",
    "status": "pending",
    "priority": "P1",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Tests.Godot/tests/UI/test_hud_scene.gd",
      "Tests.Godot/tests/Scenes/Building/test_build_mode_preview_and_confirm.gd",
      "Tests.Godot/tests/Scenes/Building/test_grid_placement_refusal_and_snap.gd",
      "Tests.Godot/tests/Integration/test_building_gate_fallback_determinism.gd",
      "Tests.Godot/tests/UI/test_hud_building_type_switch_preview.gd",
      "Game.Core.Tests/Domain/BuildingArchetypeTests.cs",
      "Tests.Godot/tests/Scenes/Building/test_wall_drag_line_segments.gd",
      "Tests.Godot/tests/Scenes/Building/test_gate_one_way_traversal.gd",
      "Game.Core.Tests/Services/GatePathingRulesTests.cs",
      "Tests.Godot/tests/Scenes/Building/test_building_debug_overlays_alignment.gd",
      "Game.Core.Tests/Services/BuildingPlacementValidationTests.cs",
      "Game.Core.Tests/Services/WallDragPlacementServiceTests.cs",
      "Tests.Godot/tests/Scenes/Building/test_wall_drag_line_gate_segments.gd",
      "Tests.Godot/tests/Scenes/Building/test_wall_gate_invalid_input_no_side_effects.gd"
    ],
    "acceptance": [
      "Hard gate: scene tests must explicitly assert gate-segment creation outcomes (count, position, direction) during drag-line wall building. Refs: Tests.Godot/tests/Scenes/Building/test_wall_drag_line_gate_segments.gd",
      "Hard gate: invalid gate-creation input must be rejected with no gate/wall side effects and no resource state mutation. Refs: Tests.Godot/tests/Scenes/Building/test_wall_gate_invalid_input_no_side_effects.gd",
      "Taskmaster #13 的 gameplay 行为必须实现所列核心建筑类型，并在交互中执行 footprint 驱动的放置规则。 Refs: Tests.Godot/tests/Scenes/Building/test_build_mode_preview_and_confirm.gd Tests.Godot/tests/Scenes/Building/test_grid_placement_refusal_and_snap.gd",
      "所有被引用的自动化测试在 Windows Godot+C# 基线上通过。 Refs: Tests.Godot/tests/Scenes/Building/test_build_mode_preview_and_confirm.gd Tests.Godot/tests/Integration/test_building_gate_fallback_determinism.gd",
      "在相同玩家输入、初始状态与 seed 下，gameplay 的放置、gate-pathing 与拒绝结果必须保持确定性，不出现核心循环回归。 Refs: Tests.Godot/tests/Integration/test_building_gate_fallback_determinism.gd",
      "建造模式必须可选择 castle、residence、mine、barracks、MG tower、wall、mine trap，并在确认前显示网格对齐的 footprint 预览。 Refs: Tests.Godot/tests/UI/test_hud_building_type_switch_preview.gd Tests.Godot/tests/Scenes/Building/test_build_mode_preview_and_confirm.gd",
      "gameplay 放置必须执行任务明示 footprint：castle=4、barracks=2、MG tower=1、wall=1。 Refs: Tests.Godot/tests/Scenes/Building/test_build_mode_preview_and_confirm.gd Game.Core.Tests/Domain/BuildingArchetypeTests.cs",
      "在 out-of-bounds、blocked 或 occupied 格确认放置时必须拒绝，且不生成建筑、不改变资源。 Refs: Tests.Godot/tests/Scenes/Building/test_grid_placement_refusal_and_snap.gd",
      "资源不足时确认放置必须拒绝，且不生成建筑、不改变资源。 Refs: Tests.Godot/tests/Scenes/Building/test_grid_placement_refusal_and_snap.gd",
      "确认有效放置时，建筑必须吸附到网格并且只扣减一次配置 cost。 Refs: Tests.Godot/tests/Scenes/Building/test_build_mode_preview_and_confirm.gd",
      "wall 拖线建造在有效网格路径上生成连续墙段；无效格保持不变且不消耗资源。 Refs: Tests.Godot/tests/Scenes/Building/test_wall_drag_line_segments.gd",
      "单向 gate 行为在游玩中可观察：非 gate 墙格阻挡通行，gate 格仅允许其配置方向通过。 Refs: Tests.Godot/tests/Scenes/Building/test_gate_one_way_traversal.gd Game.Core.Tests/Services/GatePathingRulesTests.cs",
      "测试运行中的调试可视化必须显示 footprint 边界与最终提交建筑格，并与网格对齐。 Refs: Tests.Godot/tests/Scenes/Building/test_building_debug_overlays_alignment.gd",
      "在预览与确认阶段，放置必须受限于离散网格格子，不能提交到 off-grid 坐标。 Refs: Tests.Godot/tests/Scenes/Building/test_grid_placement_refusal_and_snap.gd Tests.Godot/tests/Scenes/Building/test_build_mode_preview_and_confirm.gd",
      "切换所选建筑类型后，预览 footprint、放置校验和 cost 校验必须立即切换到该类型（castle、residence、mine、barracks、MG tower、wall、mine trap）。 Refs: Tests.Godot/tests/UI/test_hud_building_type_switch_preview.gd",
      "gameplay 测试必须验证每个可选建筑类型（castle、residence、mine、barracks、MG tower、wall、mine trap）在有效格且资源充足时至少可成功放置一次。 Refs: Tests.Godot/tests/Scenes/Building/test_build_mode_preview_and_confirm.gd",
      "对多格 footprint（含 castle=4、barracks=2），预览必须标出全部覆盖格；任一覆盖格无效时确认必须失败且不得出现部分放置。 Refs: Tests.Godot/tests/Scenes/Building/test_grid_placement_refusal_and_snap.gd Game.Core.Tests/Services/BuildingPlacementValidationTests.cs",
      "在 wall 拖线放置中，总扣费必须等于成功创建的墙段数量，且不得计入所有被跳过的无效格。 Refs: Tests.Godot/tests/Scenes/Building/test_wall_drag_line_segments.gd Game.Core.Tests/Services/WallDragPlacementServiceTests.cs",
      "gameplay/integration 测试必须在相同 seed 与输入的重复运行下，验证 blocked-path fallback 交互与 gate 场景 tie 处理的确定性。 Refs: Tests.Godot/tests/Integration/test_building_gate_fallback_determinism.gd"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #13 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 13,
    "contractRefs": [
      "Game.Core/Contracts/Lastking/UiFeedbackRaised.cs"
    ],
    "evidence_refs": []
  },
  {
    "id": "GM-0114",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0112",
      "GM-0113"
    ],
    "taskmaster_exported": true,
    "title": "Implement Economy and Tax System for Residences",
    "description": "Add economy features where residences generate gold tax every 15 seconds and provide population capacity.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Tests.Godot/tests/Integration/test_residence_economy_flow.gd",
      "Tests.Godot/tests/Scenes/Economy/test_residence_tax_timer_cadence.gd",
      "Game.Core.Tests/Services/ResidenceTaxCadenceTests.cs",
      "Game.Core.Tests/Domain/ResidenceBuildingTests.cs",
      "Game.Core.Tests/Services/ResidenceTaxConfigTests.cs",
      "Tests.Godot/tests/Scenes/Economy/test_residence_placement_no_effect_on_cancel.gd",
      "Tests.Godot/tests/Scenes/Economy/test_residence_multi_tax_sum.gd",
      "Tests.Godot/tests/Scenes/Economy/test_residence_timer_node_tax_binding.gd",
      "Game.Core.Tests/Services/ResidenceTaxPolicyTests.cs",
      "Tests.Godot/tests/Integration/test_residence_tax_policy_flow.gd",
      "Game.Core.Tests/Services/ResidenceTaxDeterminismTests.cs",
      "Tests.Godot/tests/Integration/test_residence_tax_tick_determinism.gd",
      "Game.Core.Tests/Services/ResidenceTaxTraceTests.cs",
      "Tests.Godot/tests/Integration/test_residence_tax_trace_replay.gd"
    ],
    "acceptance": [
      "Gameplay 验收仅在两项同时满足时通过：成功放置 Residence 提升人口上限，且已建造 Residence 每 15 秒产生税收收入；任一不满足即不通过。 Refs: Tests.Godot/tests/Integration/test_residence_economy_flow.gd",
      "引用的自动化测试在 Windows Godot+C# 基线上必须全部通过，并验证 Residence 严格 15 秒税收节拍与金币更新。 Refs: Tests.Godot/tests/Scenes/Economy/test_residence_tax_timer_cadence.gd",
      "在玩法层面，给定相同放置与计时序列，Residence 经济结果必须可重复，金币和人口上限结果一致。 Refs: Game.Core.Tests/Services/ResidenceTaxCadenceTests.cs",
      "一次成功 Residence 放置必须立刻且仅一次按配置增加聚落人口上限。 Refs: Tests.Godot/tests/Integration/test_residence_economy_flow.gd Game.Core.Tests/Domain/ResidenceBuildingTests.cs",
      "玩法中 Residence 税收金币只能在 15 秒边界结算；边界之间不得出现 Residence 税收金币变更。 Refs: Tests.Godot/tests/Scenes/Economy/test_residence_tax_timer_cadence.gd",
      "每次 Residence 税收结算金币必须匹配配置值，并在有等级配置时匹配对应等级。 Refs: Game.Core.Tests/Services/ResidenceTaxConfigTests.cs Tests.Godot/tests/Integration/test_residence_economy_flow.gd",
      "运行中可见与持久化的金币和人口上限必须保持整数一致性；长时间运行不得出现小数累计或浮点漂移。 Refs: Game.Core.Tests/Services/ResidenceTaxCadenceTests.cs",
      "当没有已建造 Residence 时，玩法中不得出现 Residence 税收收入。 Refs: Tests.Godot/tests/Integration/test_residence_economy_flow.gd",
      "Windows Godot+C# 实机验证必须可复现：放置 Residence 后人口上限增加一次，随后按 15 秒间隔持续增加金币。 Refs: Tests.Godot/tests/Integration/test_residence_economy_flow.gd",
      "若 Residence 放置无效或取消，玩法状态必须保持：人口上限不增加，Residence 税收收入不启动。 Refs: Tests.Godot/tests/Scenes/Economy/test_residence_placement_no_effect_on_cancel.gd Game.Core.Tests/Domain/ResidenceBuildingTests.cs",
      "有多个已建造 Residence 时，每个 15 秒收入 tick 的金币增量必须等于所有可结算 Residence 配置税额总和。 Refs: Tests.Godot/tests/Scenes/Economy/test_residence_multi_tax_sum.gd",
      "对一个已建造 Residence 观察 45 秒，税收事件只允许出现在 15s、30s、45s 边界，且边界之间不得出现额外 Residence 税收事件。 Refs: Tests.Godot/tests/Scenes/Economy/test_residence_tax_timer_cadence.gd",
      "一次确认成功的 Residence 放置动作只能产生一次人口上限增加；额外增加必须来自额外成功放置。 Refs: Tests.Godot/tests/Integration/test_residence_economy_flow.gd",
      "Residence 玩法经济行为必须由 Building 系统的 Residence 扩展实现；绕过该扩展路径不得产生对应经济效果，并可被测试或可审计证据验证。 Refs: Game.Core.Tests/Domain/ResidenceBuildingTests.cs",
      "Residence 税收玩法流必须使用 Godot Timer 每 15 秒触发并向 ResourceManager 加金；该绑定关系必须可被测试或可审计证据验证。 Refs: Tests.Godot/tests/Scenes/Economy/test_residence_timer_node_tax_binding.gd Tests.Godot/tests/Scenes/Economy/test_residence_tax_timer_cadence.gd",
      "玩法层经济规则必须明确负金币处理策略；Residence 税收影响到的所有状态在验证场景中都必须按该策略变化，不允许未定义或静默变化。 Refs: Game.Core.Tests/Services/ResidenceTaxPolicyTests.cs Tests.Godot/tests/Integration/test_residence_tax_policy_flow.gd",
      "每个 15 秒玩法 tick 中，Residence 税收应用顺序必须确定且仅做整数变更；相同输入重复运行时，金币总量与债务状态迁移必须一致。 Refs: Game.Core.Tests/Services/ResidenceTaxDeterminismTests.cs Tests.Godot/tests/Integration/test_residence_tax_tick_determinism.gd",
      "玩法回归覆盖必须包含结构化税收 tick 轨迹，记录每次结算的变更原因和金币增量；固定种子回放必须复现相同轨迹顺序与聚合结果。 Refs: Game.Core.Tests/Services/ResidenceTaxTraceTests.cs Tests.Godot/tests/Integration/test_residence_tax_trace_replay.gd",
      "Contract tests must lock Residence tax cadence at 15 seconds and fail if runtime cadence drifts under identical tick input. Refs: Game.Core.Tests/Services/ResidenceTaxCadenceTests.cs",
      "Contract tests must enforce integer-only semantics for Residence economy fields and reject non-integer inputs with explicit failure. Refs: Game.Core.Tests/Services/ResidenceTaxConfigTests.cs",
      "Unit tests must verify multi-tick Residence tax accumulation equals expected deterministic totals. Refs: Game.Core.Tests/Services/ResidenceTaxCadenceTests.cs",
      "Unit tests must verify debt-state transition determinism: identical initial state and tick sequence produce identical debt-state outputs. Refs: Game.Core.Tests/Services/ResidenceTaxCadenceTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #14 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 14,
    "contractRefs": [
      "Game.Core/Contracts/Lastking/ResourcesChanged.cs",
      "Game.Core/Contracts/Lastking/TaxCollected.cs"
    ],
    "evidence_refs": []
  },
  {
    "id": "GM-0115",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0113",
      "GM-0114"
    ],
    "taskmaster_exported": true,
    "title": "Develop Upgrade and Repair System with Constraints",
    "description": "Create a system for building upgrades (max level 5, no skipping) and repairs, with economic rules and constraints.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Game.Core.Tests/Domain/BuildingUpgradeTests.cs",
      "Game.Core.Tests/Services/BuildingOperationStateMachineTests.cs",
      "Tests.Godot/tests/Integration/test_building_upgrade_repair_progress_flow.gd",
      "Game.Core.Tests/Engine/GameEngineCoreEventTests.cs",
      "Game.Core.Tests/Services/BuildingRepairProgressTests.cs",
      "Game.Core.Tests/Services/BuildingUpgradeRepairRefundTests.cs",
      "Game.Core.Tests/State/BuildingOperationDeterminismTests.cs",
      "Game.Core.Tests/State/BuildingOperationTimelineTests.cs",
      "Game.Core.Tests/Services/BuildingUpgradeRepairServiceTests.cs"
    ],
    "acceptance": [
      "Taskmaster #15 implementation behavior is limited to the upgrade/repair rules and constraints defined for Develop Upgrade and Repair System with Constraints. Refs: Game.Core.Tests/Domain/BuildingUpgradeTests.cs Game.Core.Tests/Services/BuildingOperationStateMachineTests.cs",
      "All referenced automated tests for Taskmaster #15 pass on the Windows Godot+C# baseline. Refs: Tests.Godot/tests/Integration/test_building_upgrade_repair_progress_flow.gd",
      "With deterministic inputs, behavior outside upgrade/repair effects remains deterministic with no unintended regression to core loop constraints. Refs: Game.Core.Tests/Engine/GameEngineCoreEventTests.cs",
      "Upgrade start is permitted only when state is Idle, level is below 5, and config-defined upgrade resource cost is affordable. Refs: Game.Core.Tests/Domain/BuildingUpgradeTests.cs",
      "Each completed successful upgrade increases level by exactly 1; level skipping is refused and level never exceeds 5. Refs: Game.Core.Tests/Domain/BuildingUpgradeTests.cs",
      "If an upgrade request is invalid (non-Idle state, insufficient resources, or level already 5), upgrade does not start and level/state/resources remain unchanged. Refs: Game.Core.Tests/Domain/BuildingUpgradeTests.cs",
      "On upgrade completion, current HP is restored to full HP. Refs: Game.Core.Tests/Domain/BuildingUpgradeTests.cs",
      "When upgrade cost values change in configuration, subsequent upgrade charges use the updated configured values. Refs: Game.Core.Tests/Domain/BuildingUpgradeTests.cs",
      "Repair consumes gold only; repairing from damaged HP to full HP deducts total gold equal to 50% of the building build cost. Refs: Game.Core.Tests/Services/BuildingRepairProgressTests.cs",
      "Repair is applied incrementally over time (not as an instant full heal) until HP reaches full. Refs: Game.Core.Tests/Services/BuildingRepairProgressTests.cs Tests.Godot/tests/Integration/test_building_upgrade_repair_progress_flow.gd",
      "Upgrade and repair are mutually exclusive; starting one while the other is active is refused and cannot create concurrent Upgrading and Repairing activity. Refs: Game.Core.Tests/Services/BuildingOperationStateMachineTests.cs Tests.Godot/tests/Integration/test_building_upgrade_repair_progress_flow.gd",
      "When a progress operation completes, state returns to Idle, and automated tests verify level progression, cost rules, HP restoration, conflict handling, integer-safe arithmetic, and config-driven values on the Windows Godot+C# baseline. Refs: Game.Core.Tests/Services/BuildingOperationStateMachineTests.cs Game.Core.Tests/Services/BuildingRepairProgressTests.cs",
      "Upgrade and repair complete asynchronously through progress flow (queue/coroutine/timer driven), so completion outcomes are observable only after progress updates, not in the same tick as a successful start request. Refs: Tests.Godot/tests/Integration/test_building_upgrade_repair_progress_flow.gd Game.Core.Tests/Services/BuildingRepairProgressTests.cs",
      "Repair start is permitted only when state is Idle, current HP is below full HP, and required gold is payable; if invalid (non-Idle, full HP, or insufficient gold), repair does not start and HP/state/gold remain unchanged. Refs: Game.Core.Tests/Services/BuildingRepairProgressTests.cs Game.Core.Tests/Services/BuildingOperationStateMachineTests.cs",
      "For any starting HP below full HP, cumulative gold deducted across incremental repair steps to full HP equals exactly 50% of build cost, using deterministic integer-safe arithmetic that never overcharges. Refs: Game.Core.Tests/Services/BuildingRepairProgressTests.cs",
      "While state is Upgrading or Repairing, additional upgrade/repair start requests are rejected and do not create duplicate or parallel progress flows for the same building. Refs: Tests.Godot/tests/Integration/test_building_upgrade_repair_progress_flow.gd",
      "A successful upgrade start deducts exactly one config-defined upgrade cost for the current level, transitions state to Upgrading immediately, and does not change level or restore HP in that same tick. Refs: Game.Core.Tests/Domain/BuildingUpgradeTests.cs Game.Core.Tests/Services/BuildingOperationStateMachineTests.cs",
      "Repair progress updates HP in multiple deterministic integer-safe steps and deducts gold cumulatively so no single step can overcharge beyond the remaining amount needed to reach full HP. Refs: Game.Core.Tests/Services/BuildingRepairProgressTests.cs Tests.Godot/tests/Integration/test_building_upgrade_repair_progress_flow.gd",
      "State transitions cannot bypass Idle: once Upgrading or Repairing has started, switching to the other operation is refused until the active operation completes and state returns to Idle. Refs: Game.Core.Tests/Services/BuildingOperationStateMachineTests.cs",
      "Obligation lock O1: Add upgrade and repair functionality to Building class is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Game.Core.Tests/Domain/BuildingUpgradeTests.cs Game.Core.Tests/Services/BuildingRepairProgressTests.cs",
      "Obligation lock O10: public enum BuildState { Idle, Upgrading, Repairing }; is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Game.Core.Tests/Domain/BuildingUpgradeTests.cs Game.Core.Tests/Services/BuildingOperationStateMachineTests.cs",
      "Obligation lock O11: Progress flow implementation must use Godot queue or coroutine mechanisms; timer-only implementation is rejected as insufficient acceptance evidence. Refs: Tests.Godot/tests/Integration/test_building_upgrade_repair_progress_flow.gd",
      "When a cancel or interruption path is invoked for an active upgrade or repair, refund outcomes are deterministic and integer-safe: refunded value equals only the remaining unconsumed cost and never exceeds what was already deducted. Refs: Game.Core.Tests/Services/BuildingUpgradeRepairRefundTests.cs",
      "Given fixed initial state and fixed progress-step inputs, upgrade/repair execution timing and completion ordering are deterministic across repeated runs. Refs: Game.Core.Tests/State/BuildingOperationDeterminismTests.cs",
      "Regression scenarios must emit an ordered operation timeline (start, progress, completion, refusal) that demonstrates illegal concurrent requests are refused and valid requests can still complete after the building returns to Idle. Refs: Game.Core.Tests/State/BuildingOperationTimelineTests.cs Game.Core.Tests/Services/BuildingUpgradeRepairServiceTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #15 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 15,
    "contractRefs": [
      "Game.Core/Contracts/Lastking/UiFeedbackRaised.cs"
    ],
    "evidence_refs": []
  },
  {
    "id": "GM-0116",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0113",
      "GM-0114"
    ],
    "taskmaster_exported": true,
    "title": "Implement Unit Training Queue in Barracks",
    "description": "Add unit training functionality to barracks with a single queue per barracks, cancellable with 100% refund.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Game.Core.Tests/Services/BarracksTrainingQueueTests.cs",
      "Tests.Godot/tests/Integration/test_barracks_training_queue_flow.gd",
      "Game.Core.Tests/Engine/GameEngineCoreEventTests.cs",
      "Game.Core.Tests/Services/BarracksTrainingCostScheduleTests.cs",
      "Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "Game.Core.Tests/Domain/BarracksBuildingTests.cs"
    ],
    "acceptance": [
      "Each Barracks presents one player-visible training queue, and canceling any queued unit returns exactly 100% of that unit's deducted resources. Refs: Game.Core.Tests/Services/BarracksTrainingQueueTests.cs Tests.Godot/tests/Integration/test_barracks_training_queue_flow.gd",
      "Referenced automated tests pass on the Windows Godot+C# baseline environment. Refs: Tests.Godot/tests/Integration/test_barracks_training_queue_flow.gd",
      "Deterministic gameplay outcomes outside Barracks training-queue scope remain unchanged in covered baselines. Refs: Game.Core.Tests/Engine/GameEngineCoreEventTests.cs Game.Core.Tests/State/GameStateMachineTests.cs",
      "Players can enqueue multiple units in one Barracks and observe one-at-a-time FIFO training using configured durations. Refs: Game.Core.Tests/Services/BarracksTrainingQueueTests.cs Tests.Godot/tests/Integration/test_barracks_training_queue_flow.gd",
      "Different Barracks train independently; queue actions in one Barracks do not change queue order, progress, or outcomes in another. Refs: Game.Core.Tests/Services/BarracksTrainingQueueTests.cs",
      "When a queue request is accepted, deductions follow configured timing; if required request-time payment fails, the request is rejected and queue/resource values stay unchanged. Refs: Game.Core.Tests/Services/BarracksTrainingCostScheduleTests.cs Game.Core.Tests/Services/BarracksTrainingQueueTests.cs",
      "Players can cancel any queued unit, including the currently training unit, and receive a full refund of that unit's deducted resources. Refs: Game.Core.Tests/Services/BarracksTrainingQueueTests.cs Tests.Godot/tests/Integration/test_barracks_training_queue_flow.gd",
      "After cancellation, only the selected job is removed and remaining queued jobs keep their original relative order. Refs: Game.Core.Tests/Services/BarracksTrainingQueueTests.cs",
      "Queue add/cancel/complete transitions trigger Godot signal-driven UI updates that match current queue/resource state. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "During long train/cancel sequences with large integer values, resource totals stay accurate integers, never negative, and without overflow/underflow. Refs: Game.Core.Tests/Services/BarracksTrainingCostScheduleTests.cs",
      "If the currently training unit is canceled, that canceled unit is not spawned and training proceeds with the next queued unit when available. Refs: Game.Core.Tests/Services/BarracksTrainingQueueTests.cs Tests.Godot/tests/Integration/test_barracks_training_queue_flow.gd",
      "Queueing does not instantly produce units; each unit appears only after its configured training duration elapses. Refs: Game.Core.Tests/Services/BarracksTrainingCostScheduleTests.cs",
      "With staged-cost configuration, deductions occur only at configured progress/time points and configured integer amounts. Refs: Game.Core.Tests/Services/BarracksTrainingCostScheduleTests.cs",
      "If a unit is canceled after partial training progress, the total refund for that unit exactly equals the total deducted for that unit (net zero for that canceled unit). Refs: Game.Core.Tests/Services/BarracksTrainingCostScheduleTests.cs",
      "Configured per-unit cost is authoritative in gameplay: for immediate, staged, or mixed deduction timing, total deducted amount for that unit matches configuration, and cancellation refunds exactly that unit's deducted total. Refs: Game.Core.Tests/Services/BarracksTrainingCostScheduleTests.cs",
      "Obligation lock O1: Barracks is implemented as a class extending Building, verifiable through tests or auditable evidence. Refs: Game.Core.Tests/Domain/BarracksBuildingTests.cs",
      "Obligation lock O2: A Barracks unit-training queue implemented with a C# List or Queue exists and is verifiable through tests or auditable evidence. Refs: Game.Core.Tests/Domain/BarracksBuildingTests.cs Game.Core.Tests/Services/BarracksTrainingQueueTests.cs",
      "Obligation lock O8: Unit and regression tests verify queue operations, cancel deduction/refund correctness, and deterministic queue state transitions under stress conditions. Refs: Game.Core.Tests/Services/BarracksTrainingQueueTests.cs Game.Core.Tests/Services/BarracksTrainingCostScheduleTests.cs",
      "Obligation lock O10: At least one in-game test passes multi-unit training + mid-training cancel + exact refund + queue-state correctness, with traceable evidence. Refs: Tests.Godot/tests/Integration/test_barracks_training_queue_flow.gd",
      "When queue capacity is reached, enqueue must be rejected and queue/resource state must remain unchanged. Refs: Game.Core.Tests/Services/BarracksTrainingQueueTests.cs",
      "Boundary tests must cover capacity-1, capacity, and capacity+1 cases and assert deduction timing constraints. Refs: Game.Core.Tests/Services/BarracksTrainingCostScheduleTests.cs",
      "Stress train/cancel scenarios must emit queue diagnostics containing operation index, queue snapshot, and state transition. Refs: Game.Core.Tests/Services/BarracksTrainingQueueTests.cs",
      "Regression tests must assert diagnostics are consistent with FIFO order and observed state transitions. Refs: Game.Core.Tests/Services/BarracksTrainingQueueTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #16 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 16,
    "contractRefs": [
      "Game.Core/Contracts/Lastking/UiFeedbackRaised.cs"
    ]
  },
  {
    "id": "GM-0117",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0113",
      "GM-0116"
    ],
    "taskmaster_exported": true,
    "title": "Design and Integrate Tech Tree for Unit Stats",
    "description": "Develop a config-driven tech tree that affects unit stats (atk speed %, damage, production speed %, range, HP, cost %).",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Tests.Godot/tests/Adapters/test_techtree_resource_loading.gd",
      "Game.Core.Tests/Services/TechTreeManagerJsonLoadingTests.cs",
      "Game.Core.Tests/Services/TechTreeMultiplierTests.cs",
      "Game.Core.Tests/Services/TechTreeDeterminismTests.cs",
      "Game.Core.Tests/Services/BarracksUnitStatApplicationTests.cs",
      "Tests.Godot/tests/Integration/test_barracks_techtree_stats.gd",
      "Tests.Godot/tests/Integration/test_techtree_reload_unlock_paths.gd",
      "Game.Core.Tests/Services/TechTreeUnlockPrerequisitesTests.cs",
      "Game.Core.Tests/Services/TechTreeReloadBehaviorTests.cs",
      "Game.Core.Tests/Services/TechTreeManagerContractTests.cs",
      "Game.Core.Tests/Services/TechTreeManagerTests.cs",
      "Game.Core.Tests/State/TechRuntimeSnapshotTests.cs",
      "Tests.Godot/tests/Integration/test_barracks_tech_snapshot_flow.gd",
      "Tests.Godot/tests/Integration/test_barracks_tech_invalid_modifier_rejection.gd",
      "Tests.Godot/tests/Integration/test_barracks_tech_seeded_determinism.gd"
    ],
    "acceptance": [
      "When a valid tech-tree JSON resource is loaded through Godot Resource APIs, runtime exposes exactly the node IDs, prerequisite links, and stat modifiers defined by that resource. Refs: Tests.Godot/tests/Adapters/test_techtree_resource_loading.gd",
      "On the Windows Godot + C# baseline, the referenced automated tests for JSON load/parse and multiplier computation complete successfully. Refs: Game.Core.Tests/Services/TechTreeManagerJsonLoadingTests.cs Game.Core.Tests/Services/TechTreeMultiplierTests.cs",
      "Given the same JSON config and the same unlock state, repeated evaluations produce identical stat multipliers and identical barracks-trained unit stats. Refs: Game.Core.Tests/Services/TechTreeDeterminismTests.cs Game.Core.Tests/Services/BarracksUnitStatApplicationTests.cs",
      "Runtime tech node definitions and unlock requirements are sourced from the active JSON resource, and the in-memory node set matches that config exactly. Refs: Game.Core.Tests/Services/TechTreeManagerJsonLoadingTests.cs",
      "For attack speed, damage, production speed, range, HP, and cost, effects from unlocked nodes stack multiplicatively (not additively). Refs: Game.Core.Tests/Services/TechTreeMultiplierTests.cs",
      "If no unlocked node provides a modifier for a stat, that stat multiplier is 1.0 and newly trained barracks units keep baseline values for that stat. Refs: Game.Core.Tests/Services/TechTreeMultiplierTests.cs Game.Core.Tests/Services/BarracksUnitStatApplicationTests.cs",
      "After unlocking configured tech nodes, barracks-trained units have stat values equal to baseline multiplied by current computed multipliers. Refs: Tests.Godot/tests/Integration/test_barracks_techtree_stats.gd",
      "Unlock progression is fully config-driven: changing prerequisite or unlock-path JSON data and reloading changes unlock availability without any C# source edits. Refs: Tests.Godot/tests/Integration/test_techtree_reload_unlock_paths.gd",
      "Automated parsing checks confirm runtime node IDs, prerequisite edges, and modifier values match the JSON resource content. Refs: Game.Core.Tests/Services/TechTreeManagerJsonLoadingTests.cs",
      "Unit tests verify multiplicative stacking across multiple unlocked nodes (e.g., 1.1 x 1.2 = 1.32) and verify locked nodes are excluded from calculation. Refs: Game.Core.Tests/Services/TechTreeMultiplierTests.cs",
      "In-game validation unlocks configured techs, trains barracks units, and confirms attack speed, damage, production speed, range, HP, and cost each equal baseline x configured multipliers. Refs: Tests.Godot/tests/Integration/test_barracks_techtree_stats.gd",
      "When prerequisites are not met in the current config state, the target tech remains unavailable and output stats stay at values from currently applicable multipliers only. Refs: Game.Core.Tests/Services/TechTreeUnlockPrerequisitesTests.cs Game.Core.Tests/Services/BarracksUnitStatApplicationTests.cs",
      "Any node present in JSON but still locked at evaluation time contributes no modifier and does not change newly barracks-trained unit stats. Refs: Game.Core.Tests/Services/TechTreeMultiplierTests.cs Game.Core.Tests/Services/BarracksUnitStatApplicationTests.cs",
      "Changing only JSON multiplier values or prerequisite links, then reloading, changes computed multipliers and barracks outcomes without changing C# source. Refs: Tests.Godot/tests/Integration/test_techtree_reload_unlock_paths.gd",
      "Switching between two valid JSON tech-tree resources (without C# source edits) changes unlock availability and barracks-trained unit stats to follow the active resource. Refs: Game.Core.Tests/Services/TechTreeReloadBehaviorTests.cs Tests.Godot/tests/Integration/test_techtree_reload_unlock_paths.gd",
      "For each supported stat (attack speed, damage, production speed, range, HP, cost), runtime multiplier equals the product of modifiers defined for that stat by currently unlocked nodes. Refs: Game.Core.Tests/Services/TechTreeMultiplierTests.cs",
      "A TechTreeManager type exists as the enforced manager for tech-tree behavior and its presence is verifiable by contract tests or audit evidence. Refs: Game.Core.Tests/Services/TechTreeManagerContractTests.cs",
      "TechTreeManager exposes GetStatMultiplier(string stat), and results are computed from currently unlocked tech nodes rather than fixed outputs. Refs: Game.Core.Tests/Services/TechTreeManagerContractTests.cs",
      "TechTreeManager owns loading tech definitions from JSON config via Godot Resource APIs and building the runtime node set; moving JSON load ownership outside it fails acceptance. Refs: Tests.Godot/tests/Adapters/test_techtree_resource_loading.gd",
      "TechTreeManager keeps private ID-keyed node storage as Dictionary<string, TechNode> (or audit-equivalent private map with string keys and TechNode values), verifiable by tests or audit evidence. Refs: Game.Core.Tests/Services/TechTreeManagerContractTests.cs",
      "Before runtime application, tech modifiers are schema-validated: percentage-based modifiers outside defined bounds are rejected, and apply order is deterministic for the same unlocked-node set. Refs: Game.Core.Tests/Services/TechTreeManagerTests.cs",
      "Tech effects propagate through runtime snapshots: after unlock-state changes, the next snapshot used for barracks stat computation reflects new multipliers, while already produced snapshots remain unchanged. Refs: Game.Core.Tests/State/TechRuntimeSnapshotTests.cs Tests.Godot/tests/Integration/test_barracks_tech_snapshot_flow.gd",
      "Runtime calculations use active config values, not embedded constants: reloading with only modifier-value changes updates computed multipliers without source-code edits. Refs: Game.Core.Tests/Services/TechTreeManagerTests.cs",
      "Out-of-range modifier inputs are rejected and do not mutate computed multipliers or trained-unit stats; rejection is observable in runtime results. Refs: Tests.Godot/tests/Integration/test_barracks_tech_invalid_modifier_rejection.gd",
      "Under fixed seeds with identical config and unlock sequences, regression runs produce identical tech-application outcomes, including final multipliers and barracks-trained unit stats. Refs: Game.Core.Tests/Services/TechTreeDeterminismTests.cs Tests.Godot/tests/Integration/test_barracks_tech_seeded_determinism.gd",
      "Regression outputs include deterministic tech-application trace artifacts exposing unlock sequence and multiplier snapshots for audit and replay comparison. Refs: Game.Core.Tests/Services/TechTreeDeterminismTests.cs Game.Core.Tests/Services/TechTreeReloadBehaviorTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #17 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 17,
    "contractRefs": [
      "Game.Core/Contracts/Lastking/TechApplied.cs"
    ],
    "evidence_refs": []
  },
  {
    "id": "GM-0118",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0112",
      "GM-0114"
    ],
    "taskmaster_exported": true,
    "title": "Implement Reward System with Nightly Choices",
    "description": "Add a reward system that triggers each night, offering 3 choices from separate pools, with fallback to gold if pool is exhausted.",
    "status": "pending",
    "priority": "P3",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Game.Core.Tests/Services/RewardManagerBehaviorTests.cs",
      "Tests.Godot/tests/Integration/test_day_night_reward_flow.gd",
      "Tests.Godot/tests/UI/test_reward_panel_shows_three_choices.gd",
      "Game.Core.Tests/Services/RewardPoolJsonConfigurationTests.cs",
      "Tests.Godot/tests/UI/test_reward_panel_supported_choice_kinds.gd",
      "Tests.Godot/tests/UI/test_reward_panel_hidden_on_fallback.gd",
      "Game.Core.Tests/Services/RewardChoiceSelectionTests.cs",
      "Tests.Godot/tests/Scenes/Rewards/test_reward_panel_selection_applies_single_effect.gd",
      "Game.Core.Tests/Services/RewardManagerConstructionTests.cs"
    ],
    "acceptance": [
      "Taskmaster #18 is accepted only when nightly rewards match scope: one reward trigger per night, three choices from the active night-type pool when available, and fixed-gold fallback when that pool yields zero choices. Refs: Game.Core.Tests/Services/RewardManagerBehaviorTests.cs Tests.Godot/tests/Integration/test_day_night_reward_flow.gd",
      "Referenced automated tests pass on the Windows Godot + C# baseline for Taskmaster #18 reward behavior. Refs: Tests.Godot/tests/Integration/test_day_night_reward_flow.gd",
      "Nightly reward handling completes without blocking or skipping normal day/night progression outside intended reward effects. Refs: Game.Core.Tests/Services/RewardManagerBehaviorTests.cs Tests.Godot/tests/Integration/test_day_night_reward_flow.gd",
      "When the day/night cycle enters a night phase, exactly one reward trigger occurs for that night and reward generation uses that active night type. Refs: Game.Core.Tests/Services/RewardManagerBehaviorTests.cs Tests.Godot/tests/Integration/test_day_night_reward_flow.gd",
      "Given an active night type with at least three available entries in its configured pool, the system presents exactly three reward choices sourced from that pool. Refs: Game.Core.Tests/Services/RewardManagerBehaviorTests.cs Tests.Godot/tests/UI/test_reward_panel_shows_three_choices.gd",
      "Reward pools are loaded from JSON configuration keyed by night type, and modifying the JSON changes subsequently generated choices without code changes. Refs: Game.Core.Tests/Services/RewardPoolJsonConfigurationTests.cs",
      "Each generated choice is a supported reward kind (resource, unit, or bonus) and is visible in the Godot UI for night reward selection. Refs: Tests.Godot/tests/UI/test_reward_panel_supported_choice_kinds.gd",
      "If the active night-type pool yields zero choices, the system grants the configured fixed fallback gold amount exactly once for that trigger and does not present selectable reward choices for that trigger. Refs: Game.Core.Tests/Services/RewardManagerBehaviorTests.cs Tests.Godot/tests/UI/test_reward_panel_hidden_on_fallback.gd",
      "Automated coverage includes choice generation, pool exhaustion, fallback-to-gold behavior, and JSON-driven pool selection; in-game night progression verifies reward presentation and fallback behavior. Refs: Game.Core.Tests/Services/RewardPoolJsonConfigurationTests.cs Tests.Godot/tests/Integration/test_day_night_reward_flow.gd",
      "Reward processing does not trigger during non-night phases, and no reward-choice UI or fallback gold is produced outside a night trigger. Refs: Tests.Godot/tests/Integration/test_day_night_reward_flow.gd",
      "For any night trigger where generated choice count is greater than zero, fallback gold is not granted for that trigger. Refs: Game.Core.Tests/Services/RewardManagerBehaviorTests.cs",
      "Across consecutive nights with different night types, each trigger uses the currently active night-type pool, and presented choices correspond to that active night type. Refs: Game.Core.Tests/Services/RewardManagerBehaviorTests.cs Tests.Godot/tests/Integration/test_day_night_reward_flow.gd",
      "For any night trigger with presented choices, selecting one choice applies exactly one corresponding reward effect and does not apply effects from non-selected choices. Refs: Game.Core.Tests/Services/RewardChoiceSelectionTests.cs Tests.Godot/tests/Scenes/Rewards/test_reward_panel_selection_applies_single_effect.gd",
      "Each processed night reward trigger has a verifiable non-noop outcome: either reward-choice UI is presented for selection or fixed-gold fallback is granted. Refs: Tests.Godot/tests/Integration/test_day_night_reward_flow.gd",
      "Within a single night reward trigger, all presented choices originate only from the active night-type pool and do not mix entries from other night-type pools. Refs: Game.Core.Tests/Services/RewardManagerBehaviorTests.cs Tests.Godot/tests/UI/test_reward_panel_shows_three_choices.gd",
      "Changing the configured fixed fallback gold value updates the granted fallback amount on subsequent exhausted-pool night triggers without code changes. Refs: Game.Core.Tests/Services/RewardPoolJsonConfigurationTests.cs",
      "Obligation lock O1: Create a RewardManager class is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Game.Core.Tests/Services/RewardManagerConstructionTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #18 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 18,
    "contractRefs": [
      "Game.Core/Contracts/Lastking/RewardOffered.cs"
    ]
  },
  {
    "id": "GM-0119",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0111",
      "GM-0113"
    ],
    "taskmaster_exported": true,
    "title": "Add Day/Night Cycle and Game Win/Lose Conditions",
    "description": "Implement the day/night cycle (4 min Day + 2 min Night, Day1-Day15) and win/lose conditions based on castle HP.",
    "status": "pending",
    "priority": "P1",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Tests.Godot/tests/Integration/test_game_flow_day_night_terminal_paths.gd",
      "Game.Core.Tests/Services/GameManagerCycleTests.cs",
      "Game.Core.Tests/State/GameStateManagerTests.cs",
      "Game.Core.Tests/Services/GameManagerTerminalConditionsTests.cs",
      "Tests.Godot/tests/UI/test_hud_day_counter_updates.gd",
      "Tests.Godot/tests/Scenes/Gameplay/test_game_manager_phase_signal_flow.gd",
      "Game.Core.Tests/Domain/GameConfigTests.cs",
      "Tests.Godot/tests/UI/test_game_manager_transition_and_terminal_prompts.gd",
      "Tests.Godot/tests/Integration/test_day_night_cycle_and_win_lose_outcomes.gd"
    ],
    "acceptance": [
      "Hard gate: UI integration tests must assert payload-to-display consistency for both transition and terminal events, including correct Win/Lose prompt mapping. Refs: Tests.Godot/tests/UI/test_game_manager_transition_and_terminal_prompts.gd",
      "Hard gate: one deterministic end-to-end suite must jointly gate cycle timing boundaries and terminal outcomes in the same run; any failed assertion fails the suite. Refs: Tests.Godot/tests/Integration/test_day_night_cycle_and_win_lose_outcomes.gd",
      "GameManager is the single runtime authority for phase timing, day progression, and terminal-state evaluation, with transitions observable through exposed state or events. Refs: Game.Core.Tests/State/GameStateMachineTests.cs",
      "On the Windows Godot+C# baseline, automated tests for this feature execute to completion and pass. Refs: Tests.Godot/tests/Integration/test_game_flow_day_night_terminal_paths.gd",
      "Given the same initial state and timing inputs, repeated runs produce the same phase sequence, day boundaries, and terminal result. Refs: Game.Core.Tests/State/GameStateMachineTests.cs",
      "Each cycle runs Day for 240 seconds then Night for 120 seconds in fixed order, with no skipped, duplicated, or reordered phases. Refs: Game.Core.Tests/Services/GameManagerCycleTests.cs",
      "Runtime-observable state exposes current day and cycle progress, and day numbering advances sequentially from Day1 to Day15 only after a completed Day+Night pair. Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "If castle HP reaches 0 or below at any time, the run transitions to Lose immediately and cannot transition to Win afterward. Refs: Game.Core.Tests/State/GameStateMachineTests.cs",
      "If castle HP remains above 0 through completion of Day15->Night15, the run transitions to Win and cannot transition to Lose afterward. Refs: Game.Core.Tests/Services/GameManagerTerminalConditionsTests.cs",
      "Win/Lose evaluation reads castle HP from the building/castle gameplay source of truth, not from UI-only displayed values. Refs: Tests.Godot/tests/Integration/test_game_flow_day_night_terminal_paths.gd",
      "Godot signals with stable payloads are emitted for UI-observable state updates, including day counter updates when day progression occurs. Refs: Tests.Godot/tests/UI/test_hud_day_counter_updates.gd Tests.Godot/tests/Scenes/Gameplay/test_game_manager_phase_signal_flow.gd",
      "Deterministic end-to-end validation covers both terminal paths: forced castle destruction triggers Lose, and surviving the required cycle length triggers Win. Refs: Tests.Godot/tests/Integration/test_game_flow_day_night_terminal_paths.gd",
      "Configured timing for 15 full days is approximately 90 minutes (15 x (4 + 2) minutes), remaining within the stated 60-90 minute match-duration target boundary. Refs: Game.Core.Tests/Domain/GameConfigTests.cs",
      "Runtime-observable state includes current phase plus elapsed or remaining phase time so tests and UI can verify day-night progress without private-field access. Refs: Tests.Godot/tests/Scenes/Gameplay/test_game_manager_phase_signal_flow.gd",
      "A full win-path sequence is observable from Day1->Night1 through Day15->Night15 before terminal Win, and no Day16 phase begins. Refs: Game.Core.Tests/Services/GameManagerCycleTests.cs Tests.Godot/tests/Integration/test_game_flow_day_night_terminal_paths.gd",
      "After entering either terminal state (Win or Lose), phase transitions stop and no further day progression updates are emitted. Refs: Game.Core.Tests/Services/GameManagerTerminalConditionsTests.cs Tests.Godot/tests/Scenes/Gameplay/test_game_manager_phase_signal_flow.gd",
      "Automated unit tests explicitly assert both terminal predicates: (a) castle HP <= 0 triggers Lose, and (b) surviving through completion of Day15->Night15 with castle HP > 0 triggers Win. Refs: Game.Core.Tests/Services/GameManagerTerminalConditionsTests.cs",
      "Timing verification tests measure phase durations and fail when observed Day or Night duration deviates from 240s/120s beyond defined test tolerance. Refs: Game.Core.Tests/Services/GameManagerCycleTests.cs",
      "Phase switches are timer-driven and occur automatically at 240s/120s boundaries; Day->Night and Night->next-Day transitions require no manual player action. Refs: Tests.Godot/tests/Integration/test_game_flow_day_night_terminal_paths.gd",
      "Day numbering increments exactly once per completed Day+Night pair and does not increment on the Day->Night boundary alone. Refs: Game.Core.Tests/Services/GameManagerCycleTests.cs",
      "Terminal-condition evaluation continues during cycle progression, and if castle HP <= 0 during Day15 or Night15, the terminal outcome is Lose rather than Win. Refs: Game.Core.Tests/Services/GameManagerTerminalConditionsTests.cs Tests.Godot/tests/Integration/test_game_flow_day_night_terminal_paths.gd",
      "Win is emitted only after completion of Day15->Night15 with castle HP > 0, and exactly one terminal outcome (Win or Lose) is emitted per run. Refs: Game.Core.Tests/State/GameStateMachineTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #19 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 19,
    "contractRefs": [
      "Game.Core/Contracts/Lastking/DayStarted.cs",
      "Game.Core/Contracts/Lastking/NightStarted.cs",
      "Game.Core/Contracts/Lastking/CastleHpChanged.cs"
    ],
    "evidence_refs": []
  },
  {
    "id": "GM-0120",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0113",
      "GM-0116",
      "GM-0117"
    ],
    "taskmaster_exported": true,
    "title": "Integrate Combat with Friendly Fire Disabled",
    "description": "Implement combat system for units and towers, with friendly fire disabled for all player attacks.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Game.Core.Tests/Services/CombatServiceTests.cs",
      "Tests.Godot/tests/Scenes/Combat/test_combat_scene_targeting_range.gd",
      "Tests.Godot/tests/Integration/test_combat_units_towers_walls_flow.gd",
      "Game.Core.Tests/Services/CombatSystemTests.cs"
    ],
    "acceptance": [
      "Combat is executable for both units and MG towers, and assertions verify that player-owned attacks do not damage player-owned units or buildings in behavior and tests. Refs: Game.Core.Tests/Services/CombatServiceTests.cs",
      "All referenced automated combat tests run on the Windows Godot+C# baseline and complete with pass status and no skipped assertions. Refs: Game.Core.Tests/Services/CombatServiceTests.cs",
      "After combat integration, deterministic simulation checks remain passing and core loop determinism shows no regression under existing deterministic tests. Refs: Game.Core.Tests/State/GameStateMachineTests.cs Game.Core.Tests/Services/CombatServiceTests.cs",
      "If attacker and target share the same team/owner, attack resolution is refused and target HP remains unchanged before and after resolution. Refs: Game.Core.Tests/Services/CombatServiceTests.cs",
      "Player-owned units apply damage only to enemy units or enemy buildings that are valid targets in attack range; invalid or out-of-range targets remain undamaged. Refs: Tests.Godot/tests/Scenes/Combat/test_combat_scene_targeting_range.gd",
      "MG towers acquire enemy targets and damage them, while same-team units and same-team walls are not damaged in equivalent scenarios. Refs: Tests.Godot/tests/Integration/test_combat_units_towers_walls_flow.gd",
      "Resolved damage uses current config or tech-tree-derived attacker stats, and changing those stats produces corresponding measurable damage changes. Refs: Game.Core.Tests/Services/CombatServiceTests.cs",
      "Automated verification includes unit tests for attack resolution and friendly-fire prevention plus an in-game scenario with player units, enemies, MG towers, and walls where only enemies take damage. Refs: Game.Core.Tests/Services/CombatServiceTests.cs",
      "CombatSystem enforces one shared attack-resolution policy for both unit and MG tower attacks, and both apply the same team/owner friendly-fire guard before any damage commit. Refs: Game.Core.Tests/Services/CombatSystemTests.cs",
      "Target acquisition uses in-range detection (physics query or area overlap): only detected in-range enemy targets are damaged, while non-detected or out-of-range targets remain unchanged. Refs: Tests.Godot/tests/Scenes/Combat/test_combat_scene_targeting_range.gd",
      "Combat resolution contract is stable across all unit and MG tower attacks: emitted combat events contain attacker identity/team, target identity/team, resolved damage, and outcome, and contract tests fail on payload field drift. Refs: Game.Core.Tests/Services/CombatServiceTests.cs",
      "Given identical simulation state and tick timing, combat target selection and damage application order are deterministic across repeated runs, and same-team entities are excluded from damage paths before resolution. Refs: Game.Core.Tests/Services/CombatServiceTests.cs",
      "Combat diagnostics are emitted for every target pick and damage or refusal event (including friendly-fire refusals), and dense-engagement regression tests verify those diagnostics are present and consistent. Refs: Game.Core.Tests/Services/CombatServiceTests.cs",
      "Contract tests must enforce friendly-fire invariant: same-team attack outcome is refused and resolved damage is 0. Refs: Game.Core.Tests/Services/CombatServiceTests.cs",
      "Contract tests must fail when combat event fields exist but friendly-fire invariant is violated. Refs: Game.Core.Tests/Services/CombatServiceTests.cs",
      "Unit tests must separately assert target-resolution correctness and damage-application order. Refs: Game.Core.Tests/Services/CombatSystemTests.cs",
      "For identical initial state and tick input, target-resolution and damage-order outcomes must be deterministic. Refs: Game.Core.Tests/Services/CombatSystemTests.cs",
      "High-density combat regression must assert allied unit/building HP unchanged while enemy HP decreases under allowed attacks. Refs: Tests.Godot/tests/Integration/test_combat_units_towers_walls_flow.gd",
      "All friendly-fire attempts in high-density scenarios must take refusal branch and be asserted. Refs: Game.Core.Tests/Services/CombatServiceTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #20 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 20,
    "contractRefs": [
      "Game.Core/Contracts/Lastking/CastleHpChanged.cs"
    ],
    "evidence_refs": []
  },
  {
    "id": "GM-0121",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0111"
    ],
    "taskmaster_exported": true,
    "title": "Lock Windows export profile and Steam runtime startup validation",
    "description": "On top of T11, lock Windows-only export profile and validate Steam runtime startup path for single-player mode.",
    "status": "pending",
    "priority": "P1",
    "layer": "ci",
    "adr_refs": [
      "ADR-0011",
      "ADR-0001"
    ],
    "chapter_refs": [
      "CH07",
      "CH10",
      "CH01"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "ci"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs",
      "Game.Core.Tests/Services/T11BaselineReuseGuardTests.cs",
      "Game.Core.Tests/Services/SteamRuntimeStartupValidationTests.cs",
      "Tests.Godot/tests/Integration/test_windows_startup_steam_runtime.gd",
      "Game.Core.Tests/Tasks/Task21WindowsSteamScopeTests.cs",
      "Game.Core.Tests/Services/WindowsExportProfileLockTests.cs",
      "Game.Core.Tests/Engine/DeterministicCoreLoopRegressionTests.cs",
      "Tests.Godot/tests/Integration/test_csharp_startup_on_godot_451.gd",
      "Game.Core.Tests/Services/ProjectSettingsBaselineTests.cs",
      "Tests.Godot/tests/Scenes/Smoke/test_main_scene_smoke.gd",
      "Tests.Godot/tests/Integration/Security/test_security_http_block_signal.gd",
      "Tests.Godot/tests/Integration/Security/test_security_http_audit.gd"
    ],
    "acceptance": [
      "Validation runs on the existing T11 project root; creating or initializing a new project for this task fails acceptance. Refs: Game.Core.Tests/Services/T11BaselineReuseGuardTests.cs",
      "Windows single-player startup validation must include a launch under Steam runtime context; skipping Steam runtime checks fails acceptance. Refs: Game.Core.Tests/Services/SteamRuntimeStartupValidationTests.cs Tests.Godot/tests/Integration/test_windows_startup_steam_runtime.gd",
      "Taskmaster #21 behavior stays within the PRD lock for Windows export profile locking and Steam runtime startup-path validation. Refs: Game.Core.Tests/Tasks/Task21WindowsSteamScopeTests.cs Game.Core.Tests/Services/WindowsExportProfileLockTests.cs",
      "Referenced automated tests pass on Windows using the reused Godot+C# baseline from T11. Refs: Tests.Godot/tests/Integration/test_windows_startup_steam_runtime.gd",
      "No regression is observed in deterministic simulation and core loop constraints after applying this task on the T11 baseline. Refs: Game.Core.Tests/Engine/DeterministicCoreLoopRegressionTests.cs",
      "The reused T11 project opens in Godot 4.5.1 with C# enabled and without C# project initialization errors. Refs: Tests.Godot/tests/Integration/test_csharp_startup_on_godot_451.gd",
      "On the reused baseline, project settings keep application/config/name=\"LASTKING\" and application/run/main_scene=\"res://scenes/Main.tscn\". Refs: Game.Core.Tests/Services/ProjectSettingsBaselineTests.cs",
      "On the reused baseline, project settings keep display/window/size/width=1920 and display/window/size/height=1080. Refs: Game.Core.Tests/Services/ProjectSettingsBaselineTests.cs",
      "Export presets include Windows Desktop (64-bit) and a Steam App ID placeholder or real appid for single-player runtime launch validation. Refs: Game.Core.Tests/Services/WindowsExportProfileLockTests.cs",
      "Non-Windows export targets are disabled or absent; any enabled non-Windows target fails acceptance. Refs: Game.Core.Tests/Services/WindowsExportProfileLockTests.cs",
      "Required baseline folders for scripts, scenes, configs, saves, assets, ui, and audio remain present for Windows startup validation. Refs: Game.Core.Tests/Services/T11BaselineReuseGuardTests.cs",
      "Main scene at res://scenes/Main.tscn starts on Windows without startup errors and emits console output containing \"Project setup complete\" from attached C# logic. Refs: Tests.Godot/tests/Scenes/Smoke/test_main_scene_smoke.gd",
      ".NET SDK/toolchain is compatible with Godot 4.5.1 C# and successfully builds/runs the validated Windows startup path. Refs: Tests.Godot/tests/Integration/test_csharp_startup_on_godot_451.gd",
      "Scope boundary is enforced: this task validates Windows export and Steam runtime on the T11 baseline only; project re-bootstrap fails acceptance. Refs: Game.Core.Tests/Tasks/Task21WindowsSteamScopeTests.cs Game.Core.Tests/Services/T11BaselineReuseGuardTests.cs",
      "Steam runtime hard gate: at least one Windows export launch under Steam runtime context (real appid or Steam launch stub) reaches startup without Steam-blocking integration errors. Refs: Game.Core.Tests/Services/SteamRuntimeStartupValidationTests.cs Tests.Godot/tests/Integration/test_windows_startup_steam_runtime.gd",
      "Single-player isolation hard gate: startup path does not require backend or multiplayer services; any launch-time online dependency requirement fails acceptance. Refs: Tests.Godot/tests/Integration/Security/test_security_http_block_signal.gd",
      "Steam runtime startup-path validation includes auditable evidence of Steam-context launch and successful startup entry. Refs: Tests.Godot/tests/Integration/Security/test_security_http_audit.gd"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #21 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 21,
    "contractRefs": [
      "Game.Core/Contracts/Lastking/WindowsRuntimeValidated.cs"
    ]
  },
  {
    "id": "GM-0122",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0121"
    ],
    "taskmaster_exported": true,
    "title": "Implement Camera and Interaction System with Edge and Keyboard Scrolling",
    "description": "Develop camera controls for edge scrolling and keyboard-based scrolling in the game world.",
    "status": "pending",
    "priority": "P1",
    "layer": "adapter",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "adapter"
    ],
    "test_refs": [
      "Tests.Godot/tests/UI/test_hud_scene.gd",
      "Tests.Godot/tests/Scenes/Camera/test_camera_controller_scroll_inputs.gd",
      "Tests.Godot/tests/Scenes/Camera/test_main_scene_camera_wiring.gd",
      "Tests.Godot/tests/Scenes/Camera/test_camera_controller_delta_speed_and_bounds.gd",
      "Game.Core.Tests/State/CameraMovementContractTests.cs",
      "Tests.Godot/tests/Adapters/test_camera_controller_bounds_and_lock.gd",
      "Tests.Godot/tests/Adapters/test_camera_controller_active_paused_scroll.gd",
      "Tests.Godot/tests/Adapters/test_camera_controller_mode_transitions.gd"
    ],
    "acceptance": [
      "Taskmaster #22 is complete only when the playable scene allows continuous world navigation using both edge scrolling and keyboard scrolling. Refs: Tests.Godot/tests/Scenes/Camera/test_camera_controller_scroll_inputs.gd Tests.Godot/tests/Scenes/Camera/test_main_scene_camera_wiring.gd",
      "On the Windows Godot+C# baseline, automated tests pass and explicitly assert edge scrolling, keyboard scrolling, and world-boundary clamping outcomes. Refs: Tests.Godot/tests/Scenes/Camera/test_camera_controller_scroll_inputs.gd Tests.Godot/tests/Scenes/Camera/test_camera_controller_delta_speed_and_bounds.gd",
      "With no scroll input across frames, camera position remains unchanged; with sustained scroll input, position updates continuously frame-to-frame without visible discontinuity. Refs: Tests.Godot/tests/Scenes/Camera/test_camera_controller_scroll_inputs.gd Tests.Godot/tests/Scenes/Camera/test_camera_controller_delta_speed_and_bounds.gd",
      "When the mouse enters the configured edge margin at any viewport border, the camera moves in the corresponding world direction; when the mouse is outside all edge margins and no scroll keys are pressed, camera position does not change. Refs: Tests.Godot/tests/Scenes/Camera/test_camera_controller_scroll_inputs.gd",
      "Pressing scroll actions mapped to Arrow keys and WASD moves the camera in the expected cardinal direction, and releasing those actions stops keyboard-driven scrolling. Refs: Tests.Godot/tests/Scenes/Camera/test_camera_controller_scroll_inputs.gd",
      "Camera translation is smooth and frame-rate independent by scaling movement with delta time and configurable scroll speed, and speed adjustments take effect without source edits. Refs: Tests.Godot/tests/Scenes/Camera/test_camera_controller_delta_speed_and_bounds.gd",
      "Camera movement is clamped to configured world boundaries on every side, and attempted movement beyond limits does not move the visible area outside map bounds. Refs: Tests.Godot/tests/Scenes/Camera/test_camera_controller_delta_speed_and_bounds.gd",
      "If edge scrolling and keyboard scrolling are active in the same frame, both inputs are applied without dropped input and movement remains continuous. Refs: Tests.Godot/tests/Scenes/Camera/test_camera_controller_scroll_inputs.gd",
      "The playable scene includes a CameraController with an active Camera2D, and runtime camera movement is applied through that Camera2D. Refs: Tests.Godot/tests/Scenes/Camera/test_main_scene_camera_wiring.gd",
      "With default settings, entering within 20 pixels of any viewport edge triggers movement toward that edge, and scroll input is read via Godot Input plus viewport mouse position. Refs: Tests.Godot/tests/Scenes/Camera/test_camera_controller_scroll_inputs.gd",
      "A camera movement contract defines scroll speed, edge-margin threshold, bounds-clamping invariants, and lock-state interaction rules; contract tests fail when locked state allows movement or movement exceeds configured bounds. Refs: Game.Core.Tests/State/CameraMovementContractTests.cs Tests.Godot/tests/Adapters/test_camera_controller_bounds_and_lock.gd",
      "Runtime behavior is state-aware: in active state, edge and keyboard inputs move the camera continuously; in paused state, the same inputs do not change camera position, while bounds invariants remain satisfied. Refs: Tests.Godot/tests/Adapters/test_camera_controller_active_paused_scroll.gd",
      "Camera state diagnostics are emitted for movement-mode transitions (idle, edge, keyboard, combined, locked), and regression checks verify stable transitions and no boundary escape under repeated input sequences. Refs: Tests.Godot/tests/Adapters/test_camera_controller_mode_transitions.gd"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #22 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 22,
    "contractRefs": [
      "Game.Core/Contracts/Lastking/CameraScrolled.cs"
    ],
    "evidence_refs": []
  },
  {
    "id": "GM-0123",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0121"
    ],
    "taskmaster_exported": true,
    "title": "Develop Runtime Speed Controls (Pause, 1x, 2x) with Timer Freeze",
    "description": "Implement game speed controls including pause, 1x, and 2x speeds, ensuring all timers freeze during pause.",
    "status": "pending",
    "priority": "P1",
    "layer": "core",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Game.Core.Tests/Services/RuntimeSpeedControllerTests.cs",
      "Tests.Godot/tests/UI/test_speed_controls_buttons_apply_speed.gd",
      "Tests.Godot/tests/Integration/test_runtime_speed_progression_order.gd",
      "Game.Core.Tests/Services/GameplayProgressionRateTests.cs",
      "Game.Core.Tests/Services/CountdownSchedulerPauseTests.cs",
      "Tests.Godot/tests/Scenes/Runtime/test_nodes_process_mode_pause_resume.gd",
      "Tests.Godot/tests/Integration/test_game_manager_singleton_speed_modes.gd",
      "Game.Core.Tests/Services/RuntimeSpeedTimelineEvidenceTests.cs",
      "Tests.Godot/tests/Integration/test_runtime_speed_timeline_evidence.gd",
      "Game.Core.Tests/State/RuntimeSpeedReplayDeterminismTests.cs",
      "Tests.Godot/tests/Integration/test_runtime_speed_replay_determinism.gd",
      "Game.Core.Tests/Services/RuntimeSpeedTimelineGateValidationTests.cs",
      "Tests.Godot/tests/Integration/test_runtime_speed_timeline_gate_validation.gd"
    ],
    "acceptance": [
      "运行时速度控制仅暴露 Pause、1x、2x 三种状态；进入 Pause 时必须同时生效计时冻结语义。 Refs: Game.Core.Tests/Services/RuntimeSpeedControllerTests.cs Tests.Godot/tests/UI/test_speed_controls_buttons_apply_speed.gd",
      "在 Windows Godot+C# 基线环境执行本任务引用的自动化测试时结果必须全通过，任一失败即验收失败。 Refs: Tests.Godot/tests/Integration/test_runtime_speed_progression_order.gd",
      "在相同初始状态与输入序列下，除时间倍率引起的推进快慢差异外，玩法规则判定与状态转移顺序保持一致。 Refs: Game.Core.Tests/Services/GameplayProgressionRateTests.cs",
      "触发 Pause 后，本次切换内有效速度必须为 0x，且同一观察窗口内玩法进度保持不变。 Refs: Game.Core.Tests/Services/RuntimeSpeedControllerTests.cs Tests.Godot/tests/Integration/test_runtime_speed_progression_order.gd",
      "触发 1x 后，本次切换内有效速度必须为 1x，且玩法推进速率回到基线。 Refs: Game.Core.Tests/Services/RuntimeSpeedControllerTests.cs Tests.Godot/tests/Integration/test_runtime_speed_progression_order.gd",
      "触发 2x 后，本次切换内有效速度必须为 2x，且相同墙钟时长内玩法推进量严格大于 1x。 Refs: Game.Core.Tests/Services/GameplayProgressionRateTests.cs Tests.Godot/tests/Integration/test_runtime_speed_progression_order.gd",
      "Pause 激活期间，所有活动倒计时与已入队倒计时（含波次倒计时）均停止递减，且不得在暂停中完成。 Refs: Game.Core.Tests/Services/CountdownSchedulerPauseTests.cs Tests.Godot/tests/Integration/test_runtime_speed_progression_order.gd",
      "从 Pause 恢复后，暂停前已存在的倒计时必须从暂停瞬间剩余值继续执行，不得重置或跳段。 Refs: Game.Core.Tests/Services/CountdownSchedulerPauseTests.cs",
      "界面必须提供 Pause、1x、2x 三个可交互按钮；每次点击都在该次交互内更新并应用当前速度状态。 Refs: Tests.Godot/tests/UI/test_speed_controls_buttons_apply_speed.gd",
      "被配置为随玩法暂停的节点在 Pause 期间必须停止处理，恢复后继续处理。 Refs: Tests.Godot/tests/Scenes/Runtime/test_nodes_process_mode_pause_resume.gd",
      "当前处于 Pause 时，直接点击 1x 或 2x 必须清除暂停态并立即应用所选倍率。 Refs: Game.Core.Tests/Services/RuntimeSpeedControllerTests.cs Tests.Godot/tests/UI/test_speed_controls_buttons_apply_speed.gd",
      "Pause 期间即使墙钟时间流逝，自定义计时器剩余值必须保持不变；恢复后从该精确值继续。 Refs: Game.Core.Tests/Services/CountdownSchedulerPauseTests.cs Tests.Godot/tests/Integration/test_runtime_speed_progression_order.gd",
      "任意时刻 Pause、1x、2x 仅允许一个激活态，且观测到的实际推进速率必须与激活态一致。 Refs: Game.Core.Tests/Services/RuntimeSpeedControllerTests.cs Tests.Godot/tests/Integration/test_runtime_speed_progression_order.gd",
      "在持续 Pause 且无新的速度输入时，多次墙钟采样得到的玩法进度值必须完全一致。 Refs: Tests.Godot/tests/Integration/test_runtime_speed_progression_order.gd",
      "在相同初始条件与相同墙钟区间下，2x 模式的倒计时减少量必须严格大于 1x。 Refs: Game.Core.Tests/Services/CountdownSchedulerPauseTests.cs Tests.Godot/tests/Integration/test_runtime_speed_progression_order.gd",
      "运行中执行 1x -> 2x -> 1x 连续切换时，每次切换必须立即生效，且进行中的倒计时不被重置。 Refs: Game.Core.Tests/Services/RuntimeSpeedControllerTests.cs Game.Core.Tests/Services/CountdownSchedulerPauseTests.cs",
      "Pause 激活且未恢复前，每个被跟踪的自定义倒计时剩余值必须保持恒定，直到解除 Pause 或显式选速。 Refs: Game.Core.Tests/Services/CountdownSchedulerPauseTests.cs",
      "若通过取消 Pause 恢复且期间未新选 1x/2x，则必须恢复到最近一次非零速度，并匹配该速度的推进速率。 Refs: Game.Core.Tests/Services/RuntimeSpeedControllerTests.cs",
      "相同初始条件与墙钟时长下，玩法进度与倒计时减少量满足严格顺序：2x > 1x > Pause(0x)。 Refs: Game.Core.Tests/Services/GameplayProgressionRateTests.cs Tests.Godot/tests/Integration/test_runtime_speed_progression_order.gd",
      "无论倒计时在 Pause 前已入队还是 Pause 中新入队，Pause 期间均不推进；恢复后按保存的排队顺序与剩余值继续执行，不重置且不提前完成。 Refs: Game.Core.Tests/Services/CountdownSchedulerPauseTests.cs Tests.Godot/tests/Integration/test_runtime_speed_progression_order.gd",
      "必须有可验证证据证明运行时存在且仅存在一个 GameManager 单例负责游戏状态与速度管理；无法验证则不通过。 Refs: Tests.Godot/tests/Integration/test_game_manager_singleton_speed_modes.gd Game.Core.Tests/Services/RuntimeSpeedControllerTests.cs",
      "必须有可验证证据证明 Pause 路径将 Engine.TimeScale 设为 0，并冻结全部自定义计时器；无法验证则不通过。 Refs: Tests.Godot/tests/Integration/test_game_manager_singleton_speed_modes.gd Game.Core.Tests/Services/CountdownSchedulerPauseTests.cs",
      "必须有可验证证据证明 1x 与 2x 路径分别将 TimeScale 设为 1 与 2；无法验证则不通过。 Refs: Tests.Godot/tests/Integration/test_game_manager_singleton_speed_modes.gd Game.Core.Tests/Services/RuntimeSpeedControllerTests.cs",
      "必须有可验证证据证明节点暂停遵循 Godot ProcessMode 语义，并能观测到暂停/恢复处理行为；无法验证则不通过。 Refs: Tests.Godot/tests/Scenes/Runtime/test_nodes_process_mode_pause_resume.gd",
      "每次速度状态变更（Pause/1x/2x）都必须产出可排序时间线证据，至少包含变更前状态、变更后状态、生效时刻与触发来源；任一字段缺失即判定不通过。 Refs: Game.Core.Tests/Services/RuntimeSpeedTimelineEvidenceTests.cs Tests.Godot/tests/Integration/test_runtime_speed_timeline_evidence.gd",
      "在相同初始状态、相同输入序列与相同随机种子下重放速度切换，时间线锚点（切换顺序、倒计时完成顺序、关键进度里程碑）必须一致；出现锚点漂移即判定不通过。 Refs: Game.Core.Tests/State/RuntimeSpeedReplayDeterminismTests.cs Tests.Godot/tests/Integration/test_runtime_speed_replay_determinism.gd",
      "回归与门禁检查必须读取并校验上述速度时间线证据；若证据未生成、不可读取或与观测状态不一致，则验收失败。 Refs: Game.Core.Tests/Services/RuntimeSpeedTimelineGateValidationTests.cs Tests.Godot/tests/Integration/test_runtime_speed_timeline_gate_validation.gd"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #23 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 23,
    "contractRefs": [
      "Game.Core/Contracts/Lastking/TimeScaleChanged.cs"
    ],
    "evidence_refs": []
  },
  {
    "id": "GM-0124",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0121"
    ],
    "taskmaster_exported": true,
    "title": "Create UI Feedback System for Invalid Actions and Errors",
    "description": "Implement UI feedback for invalid placement, blocked actions, and migration/load errors with clear user-facing messages.",
    "status": "pending",
    "priority": "P2",
    "layer": "adapter",
    "adr_refs": [
      "ADR-0021",
      "ADR-0022",
      "ADR-0018"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH04",
      "CH01",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "adapter"
    ],
    "test_refs": [
      "Tests.Godot/tests/UI/test_hud_scene.gd",
      "Tests.Godot/tests/UI/test_hud_action_feedback.gd",
      "Tests.Godot/tests/UI/test_hud_error_dialog.gd",
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Game.Core.Tests/Services/ScoreServiceTests.cs",
      "Tests.Godot/tests/UI/test_hud_feedback_timeout.gd",
      "Tests.Godot/tests/Integration/test_gameplay_action_rejection_state_invariant.gd",
      "Tests.Godot/tests/Integration/test_load_failure_feedback_flow.gd",
      "Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "Tests.Godot/tests/Adapters/test_event_bus_adapter.gd",
      "Game.Core.Tests/Domain/InvalidActionFeedbackContractTests.cs",
      "Game.Core.Tests/Services/UIFeedbackMessageResolverTests.cs",
      "Tests.Godot/tests/UI/test_settings_locale.gd",
      "Game.Core.Tests/Services/UIFeedbackRegressionTests.cs",
      "Tests.Godot/tests/Integration/test_feedback_error_flows.gd"
    ],
    "acceptance": [
      "Taskmaster #24 provides user-facing UI feedback in each required scenario: invalid placement, blocked actions, and migration/load failures. Refs: Tests.Godot/tests/UI/test_hud_action_feedback.gd Tests.Godot/tests/UI/test_hud_error_dialog.gd",
      "On the Windows Godot+C# baseline, automated tests for invalid placement, blocked actions, and migration/load failure feedback all pass. Refs: Tests.Godot/tests/UI/test_hud_action_feedback.gd Tests.Godot/tests/UI/test_hud_error_dialog.gd",
      "For valid actions, deterministic simulation outputs and core-loop state transitions remain unchanged after this change. Refs: Game.Core.Tests/State/GameStateMachineTests.cs Game.Core.Tests/Services/ScoreServiceTests.cs",
      "When placement is invalid (including blocked placement or invalid terrain), the gameplay UI shows a temporary human-readable message (for example, \"Cannot build here.\"), and that message auto-hides after a short timeout. Refs: Tests.Godot/tests/UI/test_hud_action_feedback.gd Tests.Godot/tests/UI/test_hud_feedback_timeout.gd",
      "When an action is blocked, the UI feedback includes the concrete blocking reason, and the blocked action is refused without changing game state. Refs: Tests.Godot/tests/UI/test_hud_action_feedback.gd Tests.Godot/tests/Integration/test_gameplay_action_rejection_state_invariant.gd",
      "When migration or load fails (including corrupted save input), a persistent error dialog is shown with error details and remains visible until the user dismisses it. Refs: Tests.Godot/tests/UI/test_hud_error_dialog.gd Tests.Godot/tests/Integration/test_load_failure_feedback_flow.gd",
      "Temporary feedback is non-intrusive: while visible, it does not block normal gameplay interaction. Refs: Tests.Godot/tests/UI/test_hud_action_feedback.gd",
      "Feedback display is event-driven: invalid placement, blocked action, and migration/load error events each trigger their corresponding UI feedback output. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd Tests.Godot/tests/Adapters/test_event_bus_adapter.gd",
      "On an invalid placement attempt, placement is refused and no new entity is committed to game state while the temporary feedback is shown. Refs: Tests.Godot/tests/Integration/test_gameplay_action_rejection_state_invariant.gd Tests.Godot/tests/UI/test_hud_action_feedback.gd",
      "The migration/load error dialog is dismissible only by explicit user action and does not auto-hide. Refs: Tests.Godot/tests/UI/test_hud_error_dialog.gd",
      "For blocked actions and migration/load failures, the displayed message content reflects the concrete triggering reason/details rather than a generic placeholder. Refs: Tests.Godot/tests/UI/test_hud_action_feedback.gd Tests.Godot/tests/UI/test_hud_error_dialog.gd",
      "Temporary feedback content for invalid placement is human-readable and non-empty in the active gameplay UI (not only logs/internal codes). Refs: Tests.Godot/tests/UI/test_hud_action_feedback.gd",
      "A timing check confirms temporary feedback is hidden after its configured short timeout and remains hidden unless a new triggering event occurs. Refs: Tests.Godot/tests/UI/test_hud_feedback_timeout.gd",
      "The persistent migration/load error dialog exposes an explicit dismiss control, and using it closes the dialog and returns normal UI control. Refs: Tests.Godot/tests/UI/test_hud_error_dialog.gd Tests.Godot/tests/Integration/test_load_failure_feedback_flow.gd",
      "Obligation O11 is satisfied: UI feedback uses Godot Control nodes, and this is verifiable by tests or audit evidence. Refs: Tests.Godot/tests/UI/test_hud_scene.gd",
      "Obligation O12 is satisfied: a UIFeedbackManager displays feedback through a label or popup, and this is verifiable by tests or audit evidence. Refs: Tests.Godot/tests/UI/test_hud_action_feedback.gd Tests.Godot/tests/UI/test_hud_error_dialog.gd",
      "Invalid-action feedback contract enumerates reason codes and i18n message keys, and contract tests fail when any supported reason code lacks a mapped message key. Refs: Game.Core.Tests/Domain/InvalidActionFeedbackContractTests.cs Game.Core.Tests/Services/UIFeedbackMessageResolverTests.cs",
      "UI feedback resolution uses reason-code-to-message-key mapping so locale changes alter displayed text without changing trigger conditions or reason semantics. Refs: Tests.Godot/tests/UI/test_settings_locale.gd",
      "Runtime feedback dispatch applies deterministic priority rules for competing feedback events, and identical event sequences always produce the same visible feedback outcome. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "Runtime feedback dispatch de-duplicates repeated feedback events with the same reason/details within the configured dedup scope so duplicate concurrent messages/dialogs are not shown. Refs: Tests.Godot/tests/UI/test_hud_updates_on_events.gd",
      "Regression tests cover repeated invalid placements, blocked actions, and load/migration failures to verify stable feedback behavior across repeated errors. Refs: Game.Core.Tests/Services/UIFeedbackRegressionTests.cs Tests.Godot/tests/Integration/test_feedback_error_flows.gd",
      "Feedback diagnostics include reason code and resolved message key/details for blocked actions and migration/load failures so troubleshooting can correlate UI output with triggering cause. Refs: Tests.Godot/tests/Integration/test_feedback_error_flows.gd",
      "Localization checks verify that required feedback paths render non-empty localized user-facing text for active locales rather than raw/internal reason codes. Refs: Tests.Godot/tests/UI/test_settings_locale.gd"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #24 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 24,
    "contractRefs": [
      "Game.Core/Contracts/Lastking/UiFeedbackRaised.cs"
    ],
    "evidence_refs": []
  },
  {
    "id": "GM-0125",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0121"
    ],
    "taskmaster_exported": true,
    "title": "Build Save System with Autosave and Migration Handling",
    "description": "Develop a save system with one autosave slot, start-of-day autosaves, and migration for invalid configs/loads.",
    "status": "pending",
    "priority": "P1",
    "layer": "adapter",
    "adr_refs": [
      "ADR-0006",
      "ADR-0008",
      "ADR-0011"
    ],
    "chapter_refs": [
      "CH05",
      "CH10",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "adapter"
    ],
    "test_refs": [
      "Tests.Godot/tests/Integration/test_backup_restore_savegame.gd",
      "Tests.Godot/tests/Adapters/Save/test_save_manager_autosave_slot_path.gd",
      "Tests.Godot/tests/Adapters/Db/test_savegame_update_overwrite_cross_restart.gd",
      "Tests.Godot/tests/Adapters/Save/test_save_manager_daystart_autosave.gd",
      "Tests.Godot/tests/Adapters/Db/test_savegame_persistence_cross_restart.gd",
      "Tests.Godot/tests/Adapters/Save/test_save_manager_roundtrip_state_seed_wave.gd",
      "Game.Core.Tests/State/SavePayloadSerializationTests.cs",
      "Tests.Godot/tests/Adapters/Save/test_save_manager_load_failures_feedback.gd",
      "Tests.Godot/tests/Adapters/Db/test_savegame_upsert_rollback.gd",
      "Tests.Godot/tests/Adapters/Save/test_save_manager_version_migration_guard.gd",
      "Tests.Godot/tests/Adapters/Save/test_save_manager_contract_save_load.gd"
    ],
    "acceptance": [
      "Every save operation writes only to the single autosave slot at user://autosave.save (Windows-safe user path); writing to any alternate slot path fails acceptance. Refs: Tests.Godot/tests/Adapters/Save/test_save_manager_autosave_slot_path.gd",
      "From the second save onward, saving deterministically overwrites user://autosave.save and creates no additional save-slot files. Refs: Tests.Godot/tests/Adapters/Db/test_savegame_update_overwrite_cross_restart.gd",
      "Each in-game day-start event causes exactly one autosave write attempt. Refs: Tests.Godot/tests/Adapters/Save/test_save_manager_daystart_autosave.gd",
      "Across repeated day-start events, autosave keeps targeting the same autosave path and never creates extra slot files. Refs: Tests.Godot/tests/Adapters/Save/test_save_manager_daystart_autosave.gd Tests.Godot/tests/Adapters/Save/test_save_manager_autosave_slot_path.gd",
      "Loading a valid autosave applies persisted game state, seed, and wave timer to runtime state. Refs: Tests.Godot/tests/Adapters/Db/test_savegame_persistence_cross_restart.gd",
      "A valid save-then-load round trip restores game state, seed, and wave timer exactly to the values captured at save time. Refs: Tests.Godot/tests/Adapters/Save/test_save_manager_roundtrip_state_seed_wave.gd Game.Core.Tests/State/SavePayloadSerializationTests.cs",
      "If no autosave file exists, load returns a deterministic failure result, shows explicit user feedback, and leaves runtime state unchanged. Refs: Tests.Godot/tests/Adapters/Save/test_save_manager_load_failures_feedback.gd",
      "If save-file read or write I/O fails, the operation returns a deterministic failure result with explicit user feedback and no crash; for load failure, runtime state remains unchanged. Refs: Tests.Godot/tests/Adapters/Db/test_savegame_upsert_rollback.gd",
      "If save content is invalid or corrupt, load fails with explicit user feedback and applies no partial runtime state. Refs: Tests.Godot/tests/Adapters/Save/test_save_manager_load_failures_feedback.gd",
      "The serialized save payload includes a version field and all persisted runtime fields needed to restore game state, seed, and wave timer. Refs: Tests.Godot/tests/Adapters/Save/test_save_manager_roundtrip_state_seed_wave.gd",
      "On load, version compatibility is validated before any persisted field mutates runtime state. Refs: Tests.Godot/tests/Adapters/Save/test_save_manager_version_migration_guard.gd",
      "If the save version is incompatible with the current version, load is rejected, a user-visible migration error reason is shown, and runtime state remains unchanged. Refs: Tests.Godot/tests/Adapters/Save/test_save_manager_version_migration_guard.gd",
      "Save and load use one selected serialization format (JSON or binary) consistently for this autosave file. Refs: Game.Core.Tests/State/SavePayloadSerializationTests.cs",
      "If deserialization fails for the selected format, load reports explicit failure and applies no runtime state changes. Refs: Tests.Godot/tests/Adapters/Save/test_save_manager_load_failures_feedback.gd Game.Core.Tests/State/SavePayloadSerializationTests.cs",
      "SaveManager save/load ownership is proven by deterministic verification covering valid roundtrip, missing file, I/O failure, corruption, and version mismatch, with audit evidence containing required fields for each path. Refs: Tests.Godot/tests/Adapters/Save/test_save_manager_contract_save_load.gd",
      "On the first in-match day-start autosave trigger, user://autosave.save is created; missing creation fails acceptance with auditable test or log evidence. Refs: Tests.Godot/tests/Adapters/Save/test_save_manager_daystart_autosave.gd"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #25 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 25,
    "contractRefs": [
      "Game.Core/Contracts/Lastking/SaveAutosaved.cs"
    ]
  },
  {
    "id": "GM-0126",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0125"
    ],
    "taskmaster_exported": true,
    "title": "Integrate Steam Cloud Save with Account Binding",
    "description": "Implement Steam cloud save functionality using Steam account binding for save data synchronization.",
    "status": "pending",
    "priority": "P2",
    "layer": "adapter",
    "adr_refs": [
      "ADR-0006",
      "ADR-0008",
      "ADR-0011"
    ],
    "chapter_refs": [
      "CH05",
      "CH10",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "adapter"
    ],
    "test_refs": [
      "Tests.Godot/tests/Integration/test_backup_restore_savegame.gd",
      "Tests.Godot/tests/Integration/test_save_manager_steam_cloud_sync_flow.gd",
      "Tests.Godot/tests/Integration/test_steam_remote_storage_real_ops.gd",
      "Game.Core.Tests/Engine/DeterministicSimulationLoopTests.cs",
      "Game.Core.Tests/Services/SaveManagerWorkflowTests.cs",
      "Tests.Godot/tests/Adapters/Steam/test_steam_cloud_upload_on_save_trigger.gd",
      "Tests.Godot/tests/Adapters/Db/test_savegame_persistence_cross_restart.gd",
      "Game.Core.Tests/Services/CloudSaveConflictResolverTests.cs",
      "Tests.Godot/tests/UI/test_save_conflict_prompt_blocks_overwrite.gd",
      "Tests.Godot/tests/Adapters/Db/test_savegame_upsert_rollback.gd",
      "Tests.Godot/tests/Adapters/Db/test_savegame_unique_slot_per_user.gd",
      "Tests.Godot/tests/Adapters/Db/test_savegame_repository.gd",
      "Tests.Godot/tests/UI/test_save_conflict_prompt_branch_selection.gd",
      "Tests.Godot/tests/Adapters/Steam/test_steam_api_binding_remote_storage.gd",
      "Tests.Godot/tests/Adapters/Db/test_savegame_update_overwrite_cross_restart.gd"
    ],
    "acceptance": [
      "Task #26 integrates Steam account-bound cloud save synchronization into the existing SaveManager flow, matching this task's defined scope. Refs: Tests.Godot/tests/Integration/test_save_manager_steam_cloud_sync_flow.gd Tests.Godot/tests/Integration/test_steam_remote_storage_real_ops.gd",
      "On the Windows Godot+C# baseline, the referenced automated Steam cloud-sync tests complete with zero failing cases. Refs: Tests.Godot/tests/Integration/test_save_manager_steam_cloud_sync_flow.gd",
      "After cloud-sync integration, all non-cloud execution paths preserve deterministic simulation-loop behavior and core save-workflow invariants. Refs: Game.Core.Tests/Engine/DeterministicSimulationLoopTests.cs Game.Core.Tests/Services/SaveManagerWorkflowTests.cs",
      "With a logged-in Steam development account, triggering save through the existing SaveManager uploads the active save file to Steam Cloud and reports a successful upload result. Refs: Tests.Godot/tests/Adapters/Steam/test_steam_cloud_upload_on_save_trigger.gd Tests.Godot/tests/Integration/test_save_manager_steam_cloud_sync_flow.gd",
      "After a successful cloud upload, restarting the game and loading the same profile restores data from Steam Cloud, and the restored data matches the uploaded save content. Refs: Tests.Godot/tests/Adapters/Db/test_savegame_persistence_cross_restart.gd",
      "When local and cloud save versions conflict, automatic overwrite is blocked and an explicit user decision prompt is required before either version is applied. Refs: Game.Core.Tests/Services/CloudSaveConflictResolverTests.cs Tests.Godot/tests/UI/test_save_conflict_prompt_blocks_overwrite.gd",
      "If upload or download fails because network/API/cloud is unavailable, the failure is surfaced to the user and the pre-existing local save file remains unchanged. Refs: Tests.Godot/tests/Adapters/Db/test_savegame_upsert_rollback.gd",
      "Cloud save read/write operations are scoped to the currently authenticated Steam account identity and cannot access another account's cloud scope. Refs: Tests.Godot/tests/Adapters/Db/test_savegame_unique_slot_per_user.gd",
      "Steam Cloud integration remains compatible with the current SaveManager workflow, and local save/load continues to function when Steam Cloud is unavailable. Refs: Tests.Godot/tests/Adapters/Db/test_savegame_repository.gd",
      "In a Steam development environment, downloading cloud save data to a clean local target after upload restores the same profile state with no missing persisted fields. Refs: Tests.Godot/tests/Integration/test_backup_restore_savegame.gd",
      "When a local-vs-cloud conflict prompt is shown, choosing Local applies local data for that operation without automatic cloud overwrite, and choosing Cloud applies cloud data for that operation. Refs: Game.Core.Tests/Services/CloudSaveConflictResolverTests.cs Tests.Godot/tests/UI/test_save_conflict_prompt_branch_selection.gd",
      "When no valid Steam login is present, cloud sync is explicitly skipped with user-visible status, and SaveManager local save/load still succeeds without save corruption. Refs: Tests.Godot/tests/Adapters/Db/test_savegame_repository.gd",
      "Cloud-sync calls execute against real Steam API integration (Steamworks.NET or GodotSteam) in the Steam development environment and are verifiable as Steam Remote Storage operations for the logged-in account, not local-only mock behavior. Refs: Tests.Godot/tests/Integration/test_steam_remote_storage_real_ops.gd Tests.Godot/tests/Adapters/Steam/test_steam_api_binding_remote_storage.gd",
      "Cloud-save binding enforces exactly one auto-save slot identity per Steam account, and cross-account create/read/overwrite attempts are rejected without modifying current account save state. Refs: Tests.Godot/tests/Adapters/Db/test_savegame_unique_slot_per_user.gd Tests.Godot/tests/Adapters/Db/test_savegame_update_overwrite_cross_restart.gd",
      "Before applying cloud data, sync validates deterministic save metadata and ownership; if ownership does not match the logged-in Steam account, the payload is rejected and local save state remains unchanged. Refs: Tests.Godot/tests/Adapters/Db/test_savegame_unique_slot_per_user.gd Tests.Godot/tests/Adapters/Db/test_savegame_persistence_cross_restart.gd",
      "Regression coverage includes upload, download, conflict, and failure-recovery paths, and each failure path emits structured save-sync diagnostics with evidence for deterministic recovery or explicit rejection. Refs: Tests.Godot/tests/Integration/test_backup_restore_savegame.gd Tests.Godot/tests/Adapters/Db/test_savegame_upsert_rollback.gd",
      "Acceptance must include account-ownership plus single-auto-slot contract tests and pass on Windows baseline. Refs: Tests.Godot/tests/Integration/test_save_manager_steam_cloud_sync_flow.gd Tests.Godot/tests/Adapters/Db/test_savegame_unique_slot_per_user.gd",
      "Contract tests must cover cross-account read/write/overwrite rejection while preserving current-account save state. Refs: Tests.Godot/tests/Adapters/Db/test_savegame_unique_slot_per_user.gd",
      "Integration tests must cover full chain cloud-sync -> ownership check -> allow/reject branches with pass criteria. Refs: Tests.Godot/tests/Integration/test_save_manager_steam_cloud_sync_flow.gd",
      "When ownership mismatches, integration tests must assert sync flow aborts and local save remains unchanged. Refs: Tests.Godot/tests/Integration/test_save_manager_steam_cloud_sync_flow.gd"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #26 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 26,
    "contractRefs": [
      "Game.Core/Contracts/Lastking/SaveAutosaved.cs",
      "Game.Core/Contracts/Lastking/CloudSaveSyncCompleted.cs"
    ],
    "evidence_refs": []
  },
  {
    "id": "GM-0127",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0121"
    ],
    "taskmaster_exported": true,
    "title": "Implement Achievements System with Deterministic Unlocking",
    "description": "Create an achievements system with a visible list, non-hidden achievements, and deterministic unlock triggers.",
    "status": "pending",
    "priority": "P2",
    "layer": "adapter",
    "adr_refs": [
      "ADR-0006",
      "ADR-0008",
      "ADR-0011"
    ],
    "chapter_refs": [
      "CH05",
      "CH10",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "adapter"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Game.Core.Tests/Tasks/Task27DeterministicUnlockFlowTests.cs",
      "Tests.Godot/tests/Integration/test_achievements_end_to_end_unlock_and_sync.gd",
      "Game.Core.Tests/Engine/CoreLoopDeterminismRegressionTests.cs",
      "Tests.Godot/tests/Integration/test_achievements_deterministic_replay_unlock_order.gd",
      "Tests.Godot/tests/UI/test_achievements_list_visible_on_session_start.gd",
      "Tests.Godot/tests/Scenes/Achievements/test_achievement_manager_unlocks_on_day_threshold.gd",
      "Tests.Godot/tests/UI/test_achievements_unlock_notification_once.gd",
      "Tests.Godot/tests/UI/test_achievements_locked_on_invalid_event.gd",
      "Tests.Godot/tests/Adapters/test_steam_achievement_sync_on_first_unlock.gd",
      "Game.Core.Tests/Services/AchievementSteamSyncTests.cs",
      "Tests.Godot/tests/UI/test_achievements_status_reflects_local_state.gd",
      "Game.Core.Tests/Tasks/Task27SingleCoordinatorOwnershipTests.cs",
      "Tests.Godot/tests/Integration/test_achievements_load_from_external_config.gd"
    ],
    "acceptance": [
      "Task #27 gameplay must exhibit the defined deterministic achievement behavior rather than hidden or random unlock outcomes. Refs: Game.Core.Tests/Tasks/Task27DeterministicUnlockFlowTests.cs Tests.Godot/tests/Integration/test_achievements_end_to_end_unlock_and_sync.gd",
      "Referenced automated tests for this task must pass on the Windows Godot+C# baseline. Refs: Tests.Godot/tests/Integration/test_achievements_end_to_end_unlock_and_sync.gd",
      "Deterministic simulation and core-loop constraints used by gameplay must remain unchanged with no regression introduced by this task. Refs: Game.Core.Tests/Engine/CoreLoopDeterminismRegressionTests.cs Tests.Godot/tests/Integration/test_achievements_deterministic_replay_unlock_order.gd",
      "From session start, the achievement list UI must display all configured achievements as visible entries with name and description shown by default (non-hidden). Refs: Tests.Godot/tests/UI/test_achievements_list_visible_on_session_start.gd",
      "When a defined deterministic condition is met during gameplay (for example, surviving day 15), the matching achievement must change to unlocked and an unlock notification must be shown. Refs: Tests.Godot/tests/Scenes/Achievements/test_achievement_manager_unlocks_on_day_threshold.gd Tests.Godot/tests/UI/test_achievements_unlock_notification_once.gd",
      "Replaying the same scenario with identical inputs must unlock the same achievement IDs in the same order at equivalent trigger points across runs. Refs: Tests.Godot/tests/Integration/test_achievements_deterministic_replay_unlock_order.gd",
      "Events that do not satisfy an achievement condition must leave that achievement locked and must not emit an unlock notification. Refs: Tests.Godot/tests/UI/test_achievements_locked_on_invalid_event.gd",
      "If Steam integration is active during gameplay, each first-time unlock must be synchronized to Steam stats in the same session. Refs: Tests.Godot/tests/Adapters/test_steam_achievement_sync_on_first_unlock.gd Game.Core.Tests/Services/AchievementSteamSyncTests.cs",
      "At session start, each listed achievement must show lock/unlock status consistent with current local state, with no hidden entries. Refs: Tests.Godot/tests/UI/test_achievements_status_reflects_local_state.gd",
      "Each achievement must emit at most one unlock notification on first unlock in a session; re-triggering the same condition must not produce another unlock popup. Refs: Tests.Godot/tests/UI/test_achievements_unlock_notification_once.gd",
      "Obligation lock O1: Exactly one achievement coordinator (AchievementManager or equivalent) must own achievement progress tracking and unlock orchestration. Refs: Game.Core.Tests/Tasks/Task27SingleCoordinatorOwnershipTests.cs",
      "Obligation lock O2: Achievement definitions must load from external configuration files (JSON or equivalent), and code hardcoding cannot be the only data source. Refs: Tests.Godot/tests/Integration/test_achievements_load_from_external_config.gd",
      "Obligation lock O10: Automated test gates on Windows baseline must cover unlock trigger plus UI update, achievements list presentation, deterministic repeat actions, deterministic unlock sequence evidence for regression/sync checks, and Steam verification when enabled. Refs: Tests.Godot/tests/Integration/test_achievements_end_to_end_unlock_and_sync.gd",
      "Regression/sync tests must output unlock evidence including deterministic timestamp and sequence anchor for every unlock record, and identical input must reproduce identical evidence. Refs: Game.Core.Tests/Services/AchievementSyncDeterminismTests.cs",
      "Gate must fail when any unlock record misses timestamp/sequence anchor or diverges from deterministic baseline under identical input. Refs: Game.Core.Tests/Services/AchievementSyncDeterminismTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #27 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 27,
    "contractRefs": [
      "Game.Core/Contracts/Lastking/DayStarted.cs",
      "Game.Core/Contracts/Lastking/CastleHpChanged.cs",
      "Game.Core/Contracts/Lastking/RewardOffered.cs"
    ]
  },
  {
    "id": "GM-0128",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0121"
    ],
    "taskmaster_exported": true,
    "title": "Set Up Localization (i18n) for zh-CN and en-US",
    "description": "Implement key-based internationalization workflow supporting zh-CN and en-US at launch.",
    "status": "pending",
    "priority": "P2",
    "layer": "ci",
    "adr_refs": [
      "ADR-0006",
      "ADR-0008",
      "ADR-0011"
    ],
    "chapter_refs": [
      "CH05",
      "CH10",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "ci"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Game.Core.Tests/Tasks/Task28LocalizationScopeLockTests.cs",
      "Tests.Godot/tests/Integration/test_i18n_full_behavior_sweep.gd",
      "Game.Core.Tests/Engine/CoreLoopDeterminismLocalizationTests.cs",
      "Tests.Godot/tests/UI/test_settings_locale.gd",
      "Tests.Godot/tests/Integration/test_settings_event_integration.gd",
      "Game.Core.Tests/Services/LocalizationManagerTests.cs",
      "Tests.Godot/tests/UI/test_settings_locale_persist.gd",
      "Tests.Godot/tests/Adapters/Config/test_settings_persistence.gd",
      "Game.Core.Tests/Services/LocalizationLocaleValidationTests.cs",
      "Tests.Godot/tests/UI/test_settings_locale_unsupported_rejected.gd",
      "Game.Core.Tests/Tasks/Task28LocalizationKeyStabilityTests.cs",
      "Tests.Godot/tests/Integration/test_locale_resource_load_guard.gd"
    ],
    "acceptance": [
      "Taskmaster #28 的范围锁定校验必须通过；若交付内容超出“仅支持 zh-CN/en-US 的键值化 i18n 初始化范围”，校验应失败。 Refs: Game.Core.Tests/Tasks/Task28LocalizationScopeLockTests.cs",
      "Task #28 关联的自动化测试在 Windows Godot + C# 基线上全部通过；任一失败则该验收项不成立。 Refs: Tests.Godot/tests/Integration/test_i18n_full_behavior_sweep.gd",
      "在相同玩法输入下，语言切换只能影响本地化文本渲染，不得改变确定性的模拟/核心循环输出。 Refs: Game.Core.Tests/Engine/CoreLoopDeterminismLocalizationTests.cs",
      "选择 en-US 或 zh-CN 时，系统会加载对应语言资源，并将同一 key（例如 UI_PAUSE）解析为该语言的正确文本。 Refs: Tests.Godot/tests/UI/test_settings_locale.gd",
      "设置中提供运行时语言切换；切换后已显示的本地化 UI 文本在同一运行会话内完成刷新，无需重启。 Refs: Tests.Godot/tests/UI/test_settings_locale.gd Tests.Godot/tests/Integration/test_settings_event_integration.gd",
      "当当前语言缺少某个 key 时，渲染输出必须回退为 key 字面量本身（例如 MISSING_KEY -> \"MISSING_KEY\"）。 Refs: Game.Core.Tests/Services/LocalizationManagerTests.cs",
      "选择 en-US 或 zh-CN 后，语言偏好会持久化到配置，并在下次启动时自动恢复。 Refs: Tests.Godot/tests/UI/test_settings_locale_persist.gd Tests.Godot/tests/Adapters/Config/test_settings_persistence.gd",
      "首发仅支持 en-US 与 zh-CN；请求不支持语言时必须被拒绝，且当前语言状态保持不变。 Refs: Game.Core.Tests/Services/LocalizationLocaleValidationTests.cs Tests.Godot/tests/UI/test_settings_locale_unsupported_rejected.gd",
      "UI 消费的本地化 key 标识在补丁间保持稳定；已发布 UI key 的非预期重命名或删除会触发失败。 Refs: Game.Core.Tests/Tasks/Task28LocalizationKeyStabilityTests.cs",
      "en-US 与 zh-CN 的语言资源在运行时必须存在且可解析；若加载或解析失败，则拒绝语言切换并保持先前语言状态不变。 Refs: Game.Core.Tests/Services/LocalizationManagerTests.cs Tests.Godot/tests/Integration/test_locale_resource_load_guard.gd",
      "代表性可见 UI 文本必须由 key 驱动而非硬编码；同一 key 路径在同一会话切换语言后显示值可观测变化。 Refs: Tests.Godot/tests/UI/test_settings_locale.gd",
      "对同一组代表性 UI key，在一次会话执行 en-US -> zh-CN -> en-US 切换后，每一步都显示对应语言文本且无混合残留。 Refs: Tests.Godot/tests/UI/test_settings_locale.gd",
      "自动化回归校验在检测到任何已发布 UI key 被重命名或移除时必须失败。 Refs: Game.Core.Tests/Tasks/Task28LocalizationKeyStabilityTests.cs",
      "单次自动化联测要同时验证：en-US/zh-CN 运行时切换会刷新已显示 UI、缺失 key 回退为字面量、两套语言资源均可加载并解析。 Refs: Tests.Godot/tests/Integration/test_i18n_full_behavior_sweep.gd",
      "必须交付可验证的 LocalizationManager 能力：为每个支持语言加载翻译文件（如 CSV 或 JSON）；缺失该能力则不通过。 Refs: Game.Core.Tests/Services/LocalizationManagerTests.cs Tests.Godot/tests/Integration/test_locale_resource_load_guard.gd",
      "首发 i18n key 契约被明确定义，且契约中的每个必需 key 在 en-US 与 zh-CN 资源中都存在；任一 locale 缺 key 时校验失败。 Refs: Tests.Godot/tests/UI/test_settings_locale.gd",
      "缺失 key 的回退在同一会话内对重复查询和语言重载保持确定性：同一缺失 key 始终得到同一回退结果。 Refs: Tests.Godot/tests/UI/test_settings_locale_persist.gd",
      "回归/键审计测试会产出未解析 key 与回退路径诊断；每条诊断至少包含 active locale 与 key identifier。 Refs: Tests.Godot/tests/Integration/test_settings_event_integration.gd"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #28 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 28,
    "contractRefs": [
      "Game.Core/Contracts/Lastking/UiFeedbackRaised.cs"
    ],
    "evidence_refs": []
  },
  {
    "id": "GM-0129",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0121"
    ],
    "taskmaster_exported": true,
    "title": "Add Audio Settings for Music and SFX Channels",
    "description": "Implement audio settings to control music and sound effects volume at launch.",
    "status": "pending",
    "priority": "P3",
    "layer": "adapter",
    "adr_refs": [
      "ADR-0006",
      "ADR-0008",
      "ADR-0011"
    ],
    "chapter_refs": [
      "CH05",
      "CH10",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "adapter"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Tests.Godot/tests/UI/test_settings_panel_audio_channels.gd",
      "Tests.Godot/tests/Integration/test_audio_settings_persistence_cross_restart.gd",
      "Game.Core.Tests/Engine/GameEngineCoreEventTests.cs",
      "Tests.Godot/tests/UI/test_settings_panel_logic.gd",
      "Tests.Godot/tests/Adapters/test_audio_manager_channel_isolation.gd",
      "Tests.Godot/tests/Adapters/Config/test_settings_persistence.gd",
      "Tests.Godot/tests/Integration/test_settings_event_integration.gd"
    ],
    "acceptance": [
      "Taskmaster #29 gameplay behavior matches the scoped feature for launch-time music and SFX volume control with persistence. Refs: Tests.Godot/tests/UI/test_settings_panel_audio_channels.gd Tests.Godot/tests/Integration/test_audio_settings_persistence_cross_restart.gd",
      "Referenced automated tests pass on the Windows Godot+C# baseline. Refs: Game.Core.Tests/Engine/GameEngineCoreEventTests.cs",
      "Audio settings interactions do not regress deterministic simulation behavior or core loop constraints. Refs: Game.Core.Tests/State/GameStateMachineTests.cs Game.Core.Tests/Engine/GameEngineCoreEventTests.cs",
      "The settings UI provides separate controls for music volume and SFX volume. Refs: Tests.Godot/tests/UI/test_settings_panel_logic.gd",
      "Moving either control changes only its own channel's audible level immediately while the game is running. Refs: Tests.Godot/tests/UI/test_settings_panel_audio_channels.gd Tests.Godot/tests/Adapters/test_audio_manager_channel_isolation.gd",
      "After the player changes music and SFX volumes, closing and relaunching the game preserves and reapplies the same effective levels at startup. Refs: Tests.Godot/tests/Adapters/Config/test_settings_persistence.gd",
      "During simultaneous music and sound playback, changing music volume leaves current SFX loudness unchanged at the same SFX setting, and changing SFX volume leaves music loudness unchanged at the same music setting. Refs: Tests.Godot/tests/Adapters/test_audio_manager_channel_isolation.gd Tests.Godot/tests/UI/test_settings_panel_audio_channels.gd",
      "Rapid slider adjustments during playback do not interrupt channel playback and do not trigger runtime errors or audible glitches. Refs: Tests.Godot/tests/UI/test_settings_panel_audio_channels.gd Tests.Godot/tests/Adapters/test_audio_manager_channel_isolation.gd",
      "At startup, the settings UI initializes music and SFX controls to the last saved values, and audible levels already match those values before any slider movement. Refs: Tests.Godot/tests/Integration/test_audio_settings_persistence_cross_restart.gd Tests.Godot/tests/UI/test_settings_panel_audio_channels.gd",
      "Changing only one slider and then saving/relaunching keeps the other slider value and effective loudness unchanged from its previously saved state. Refs: Tests.Godot/tests/Adapters/Config/test_settings_persistence.gd",
      "If the player leaves one slider untouched during a session, saving and relaunching keeps that untouched slider value identical to its prior saved value; any drift is a failure. Refs: Tests.Godot/tests/Adapters/Config/test_settings_persistence.gd",
      "If music and SFX sliders are set to two different values, both UI values and audible channel levels remain different in the same way after relaunch, proving per-channel persistence rather than shared-state overwrite. Refs: Tests.Godot/tests/Integration/test_audio_settings_persistence_cross_restart.gd Tests.Godot/tests/UI/test_settings_panel_audio_channels.gd",
      "At launch, the player can access both music and SFX sliders in settings and change either channel without restarting the game. Refs: Tests.Godot/tests/Integration/test_settings_event_integration.gd",
      "Saving settings writes separate user configuration values for music and SFX, and reopening settings after relaunch shows those same values before any new input. Refs: Tests.Godot/tests/Adapters/Config/test_settings_persistence.gd",
      "Obligation lock O5: Audio preferences must be persisted in a configuration file medium (for example user://settings.cfg) and restored from file with separate music_volume and sfx_volume keys. Refs: Tests.Godot/tests/Adapters/Config/test_settings_persistence.gd"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #29 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 29,
    "contractRefs": [
      "Game.Core/Contracts/Lastking/AudioSettingsChanged.cs"
    ]
  },
  {
    "id": "GM-0130",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0121",
      "GM-0122",
      "GM-0123",
      "GM-0124",
      "GM-0125",
      "GM-0126",
      "GM-0127",
      "GM-0128",
      "GM-0129"
    ],
    "taskmaster_exported": true,
    "title": "Optimize for Performance Targets (45 FPS 1% Low, 60 FPS Average)",
    "description": "Implement optimizations to meet non-functional goals: low-end baseline 45 FPS (1% low) and average 60 FPS target.",
    "status": "pending",
    "priority": "P1",
    "layer": "adapter",
    "adr_refs": [
      "ADR-0015",
      "ADR-0005",
      "ADR-0011"
    ],
    "chapter_refs": [
      "CH09",
      "CH07",
      "CH10"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "adapter"
    ],
    "test_refs": [
      "Game.Core.Tests/State/GameStateMachineTests.cs",
      "Game.Core.Tests/Tasks/Task30PerformanceScopeGuardTests.cs",
      "Tests.Godot/tests/Integration/test_performance_gate_windows_baseline.gd",
      "Game.Core.Tests/Engine/DeterministicCoreLoopRegressionTests.cs",
      "Tests.Godot/tests/Integration/test_simulation_determinism_fixed_seed.gd",
      "Tests.Godot/tests/Integration/test_perf_baseline_locked_camera_repeatability.gd",
      "Game.Core.Tests/Services/PerformanceBaselineVarianceTests.cs",
      "Game.Core.Tests/Services/FrameTimeHotspotRankingTests.cs",
      "Game.Core.Tests/Services/PerformanceRemediationImpactTests.cs",
      "Tests.Godot/tests/Integration/test_perf_stress_endurance_presets.gd",
      "Tests.Godot/tests/Integration/test_perf_gate_artifacts_headless_playable.gd",
      "Tests.Godot/tests/Integration/test_perf_gate_thresholds_fixed_seed.gd",
      "Game.Core.Tests/Services/PerformanceGateFailureConditionsTests.cs",
      "Game.Core.Tests/Services/PerformanceEvidencePairingTests.cs",
      "Game.Core.Tests/Services/PerformancePhaseEvidenceTests.cs",
      "Game.Core.Tests/Services/PerformanceComparisonIdentityTests.cs",
      "Game.Core.Tests/Services/PerformanceSummarySchemaTests.cs"
    ],
    "acceptance": [
      "Taskmaster #30 completion remains scoped to the PRD lock for Optimize for Performance Targets (45 FPS 1% Low, 60 FPS Average), and unrelated changes do not satisfy this task. Refs: Game.Core.Tests/Tasks/Task30PerformanceScopeGuardTests.cs",
      "All automated tests referenced by this task pass on the Windows Godot+C# baseline environment. Refs: Tests.Godot/tests/Integration/test_performance_gate_windows_baseline.gd",
      "Post-optimization validation shows no regression in deterministic simulation behavior or core loop constraints. Refs: Game.Core.Tests/Engine/DeterministicCoreLoopRegressionTests.cs Tests.Godot/tests/Integration/test_simulation_determinism_fixed_seed.gd",
      "Deterministic baseline profiles are captured with locked camera paths and scripted sessions, and two repeated runs stay within the declared variance window. Refs: Tests.Godot/tests/Integration/test_perf_baseline_locked_camera_repeatability.gd Game.Core.Tests/Services/PerformanceBaselineVarianceTests.cs",
      "A profiling report identifies and ranks frame-time hotspots by subsystem (AI, spawn, render, UI) with repeatable timing data for each ranked offender. Refs: Game.Core.Tests/Services/FrameTimeHotspotRankingTests.cs",
      "Config-safe targeted optimizations to update loops, pooling, and expensive queries produce measurable frame-time improvement versus baseline, while regression tests verify gameplay semantics are unchanged. Refs: Game.Core.Tests/Services/PerformanceRemediationImpactTests.cs Game.Core.Tests/Engine/DeterministicCoreLoopRegressionTests.cs",
      "Stress and endurance validation at launch presets covers worst-case wave mixes and UI-heavy scenarios, and the report records memory growth and stutter spikes with threshold verdicts or explicit fail reasons plus traces. Refs: Tests.Godot/tests/Integration/test_perf_stress_endurance_presets.gd",
      "Standardized gate artifacts are written to logs/perf and logs/ci for fixed-seed Windows headless and playable runs, with integer threshold fields and verdicts for baseline, 1% low FPS, and average FPS. Refs: Tests.Godot/tests/Integration/test_perf_gate_artifacts_headless_playable.gd",
      "Task completion is PASS only when reproducible fixed-seed Windows headless and playable gate runs meet at least 45 FPS for 1% low and 60 FPS for average FPS. Refs: Tests.Godot/tests/Integration/test_perf_gate_thresholds_fixed_seed.gd",
      "If measurable improvement versus baseline is not shown within the declared variance window, or required artifact files/fields are missing, the task verdict is FAIL and cannot be accepted. Refs: Game.Core.Tests/Services/PerformanceGateFailureConditionsTests.cs",
      "Gate evidence includes paired baseline and post-optimization metrics for the same fixed-seed scenes so 1% low and average FPS deltas are directly verifiable. Refs: Game.Core.Tests/Services/PerformanceEvidencePairingTests.cs",
      "Acceptance is blocked when any required phase evidence (baseline capture, hotspot isolation, frame-budget remediation, stress validation, gate artifact output) is missing from logs/perf or logs/ci. Refs: Game.Core.Tests/Services/PerformancePhaseEvidenceTests.cs",
      "Baseline-to-post comparisons are valid only when scene set, fixed seed, camera path script, launch preset, and run mode (headless/playable) are identical; otherwise the gate verdict is FAIL. Refs: Game.Core.Tests/Services/PerformanceComparisonIdentityTests.cs",
      "Gate summary artifacts include explicit integer fields for baseline and post-optimization 1% low and average FPS, plus the applied variance window and threshold values, enabling machine-verifiable threshold evaluation. Refs: Game.Core.Tests/Services/PerformanceSummarySchemaTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #30 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 30,
    "contractRefs": [
      "Game.Core/Contracts/Lastking/PerfSampled.cs"
    ]
  },
  {
    "id": "GM-0131",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0121"
    ],
    "taskmaster_exported": true,
    "title": "Scaffold config-contract workspace on existing project",
    "description": "Extend the existing project with config schema/sample workspace structure for contract-driven tuning.",
    "status": "pending",
    "priority": "P1",
    "layer": "ci",
    "adr_refs": [
      "ADR-0011",
      "ADR-0001"
    ],
    "chapter_refs": [
      "CH07",
      "CH10",
      "CH01"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "ci"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs",
      "Game.Core.Tests/Tasks/Task31ConfigWorkspaceGuardrailsTests.cs",
      "Tests.Godot/tests/Adapters/Config/test_settings_config_utf8.gd",
      "Game.Core.Tests/Services/CollisionServiceTests.cs",
      "Tests.Godot/tests/Integration/test_hud_integration.gd",
      "Tests.Godot/tests/Scenes/Smoke/test_glue_connections.gd",
      "Tests.Godot/tests/Security/Hard/test_settings_config_security.gd",
      "Game.Core.Tests/Tasks/Task31ConfigContractWiringTests.cs"
    ],
    "acceptance": [
      "Taskmaster #31 implementation stays within PRD lock by scaffolding a config-contract workspace on top of the existing T21 project, without project bootstrap or reinitialization. Refs: Game.Core.Tests/Tasks/Task31ConfigWorkspaceGuardrailsTests.cs",
      "Referenced automated checks pass on the Windows Godot+C# baseline for the added config workspace and contract entrypoints. Refs: Tests.Godot/tests/Adapters/Config/test_settings_config_utf8.gd",
      "Compared with the T21 baseline, no unrelated gameplay/core-loop behavior is changed; this task only introduces config workspace, contract docs, and wiring. Refs: Game.Core.Tests/Services/CollisionServiceTests.cs Tests.Godot/tests/Integration/test_hud_integration.gd",
      "The inherited project still opens in Godot 4.5.1 on Windows, and C# project generation/build succeeds after the scaffold changes. Refs: Tests.Godot/tests/Scenes/Smoke/test_glue_connections.gd",
      "Both directories config/schemas/ and config/samples/ exist under the inherited project root after setup. Refs: Game.Core.Tests/Tasks/Task31ConfigWorkspaceGuardrailsTests.cs",
      "Setup does not create a second project root, standalone Godot project, or reinitialized project artifacts. Refs: Game.Core.Tests/Tasks/Task31ConfigWorkspaceGuardrailsTests.cs",
      "Config-contract workspace paths are wired as project-root-relative paths in the existing project, not absolute or external workspace paths. Refs: Tests.Godot/tests/Security/Hard/test_settings_config_security.gd",
      "A README.md for the config-contract workspace exists and documents the purpose and expected usage of config/schemas/ and config/samples/. Refs: Game.Core.Tests/Tasks/Task31ConfigWorkspaceGuardrailsTests.cs",
      "The existing project exposes config-contract wiring entrypoints that map schema loading to config/schemas/ and sample loading/discovery to config/samples/. Refs: Game.Core.Tests/Domain/GameConfigTests.cs",
      "Acceptance fails if config workspace wiring entrypoints are missing, unreachable, or not connected to the declared config paths. Refs: Game.Core.Tests/Tasks/Task31ConfigContractWiringTests.cs",
      "Scope boundary is enforceable: this task modifies the T21 baseline in place; creating or recreating a standalone Godot project fails acceptance. Refs: Game.Core.Tests/Tasks/Task31ConfigWorkspaceGuardrailsTests.cs",
      "Hard gate: both config/schemas and config/samples plus working wiring entrypoints are required; directory-only scaffolding fails acceptance. Refs: Game.Core.Tests/Tasks/Task31ConfigContractWiringTests.cs Game.Core.Tests/Tasks/Task31ConfigWorkspaceGuardrailsTests.cs",
      "Contract artifacts under config/schemas/ and config/samples/ follow the canonical workspace naming/path conventions and include all required metadata fields; any missing required metadata or naming mismatch fails acceptance. Refs: Game.Core.Tests/Domain/GameConfigTests.cs",
      "Running the scaffold repeatedly on the same inherited T21 project root is idempotent: no duplicate project root or reinitialized artifacts are created, required directories and wiring remain valid, and CI-verifiable scaffold evidence is produced for troubleshooting. Refs: Tests.Godot/tests/Scenes/Smoke/test_glue_connections.gd"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #31 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 31,
    "contractRefs": [
      "Game.Core/Contracts/Config/enemy-config.schema.json",
      "Game.Core/Contracts/Config/difficulty-config.schema.json",
      "Game.Core/Contracts/Config/spawn-config.schema.json",
      "Game.Core/Contracts/Config/pressure-normalization.config.schema.json"
    ],
    "evidence_refs": []
  },
  {
    "id": "GM-0132",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0131"
    ],
    "taskmaster_exported": true,
    "title": "Implement enemy-config.schema.json with validation rules",
    "description": "Define JSON schema for enemy configuration, including fields for enemy types, stats, and behaviors, adhering to config-first balancing and no hardcoded values.",
    "status": "pending",
    "priority": "P1",
    "layer": "core",
    "adr_refs": [
      "ADR-0023",
      "ADR-0007",
      "ADR-0005"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs",
      "Game.Core.Tests/Services/EnemyConfigSchemaValidationTests.cs",
      "Game.Core.Tests/Services/EnemyConfigSampleFileValidationTests.cs",
      "Game.Core.Tests/Engine/GameEngineCoreEventTests.cs",
      "Game.Core.Tests/State/GameStateMachineTests.cs"
    ],
    "acceptance": [
      "Taskmaster #32 behavior matches PRD lock for Implement enemy-config.schema.json with validation rules. Refs: Game.Core.Tests/Services/EnemyConfigSchemaValidationTests.cs",
      "Referenced automated tests pass on Windows Godot+C# baseline. Refs: Game.Core.Tests/Services/EnemyConfigSchemaValidationTests.cs Game.Core.Tests/Services/EnemyConfigSampleFileValidationTests.cs",
      "No regression on deterministic simulation and core loop constraints. Refs: Game.Core.Tests/Engine/GameEngineCoreEventTests.cs Game.Core.Tests/State/GameStateMachineTests.cs",
      "config/schemas/enemy-config.schema.json exists and declares \"$schema\": \"http://json-schema.org/draft-07/schema#\" with top-level \"type\": \"object\". Refs: Game.Core.Tests/Services/EnemyConfigSchemaValidationTests.cs",
      "The schema defines an \"enemies\" property as an array, and each array item is an object schema for a single enemy configuration. Refs: Game.Core.Tests/Services/EnemyConfigSchemaValidationTests.cs",
      "Each enemy item schema includes at least enemy_id (string), health (number, minimum 1), damage (number, minimum 0), and speed (number, minimum 0), and these fields are listed in required. Refs: Game.Core.Tests/Services/EnemyConfigSchemaValidationTests.cs",
      "The schema includes configurable enemy type/identity and behavior-related fields with explicit type constraints, so behavior selection is data-driven by config. Refs: Game.Core.Tests/Services/EnemyConfigSchemaValidationTests.cs",
      "Validator-based tests on Windows C# reject payloads with missing required fields, wrong field types, or numeric values below declared minima. Refs: Game.Core.Tests/Services/EnemyConfigSchemaValidationTests.cs Game.Core.Tests/Services/EnemyConfigSampleFileValidationTests.cs",
      "Validator-based tests on Windows C# accept at least one valid payload where all required fields and numeric constraints are satisfied. Refs: Game.Core.Tests/Services/EnemyConfigSchemaValidationTests.cs Game.Core.Tests/Services/EnemyConfigSampleFileValidationTests.cs",
      "Enemy balance values are sourced from schema-validated configuration data; adding or adjusting enemy balance values does not require hardcoded per-enemy constants for schema compliance. Refs: Game.Core.Tests/Services/EnemyConfigSchemaValidationTests.cs Game.Core.Tests/Services/EnemyConfigSampleFileValidationTests.cs",
      "The root schema lists \"enemies\" in required, and validator-based tests reject a top-level payload that omits \"enemies\". Refs: Game.Core.Tests/Services/EnemyConfigSchemaValidationTests.cs",
      "Validator-based tests reject enemy objects where behavior-related fields are present but use types that differ from the schema declaration. Refs: Game.Core.Tests/Services/EnemyConfigSchemaValidationTests.cs Game.Core.Tests/Services/EnemyConfigSampleFileValidationTests.cs",
      "Validator-based tests accept a payload containing at least two enemy entries with different valid health/damage/speed values without requiring schema or code changes. Refs: Game.Core.Tests/Services/EnemyConfigSampleFileValidationTests.cs",
      "Validator-based tests on Windows C# fail when each required enemy field (enemy_id, health, damage, speed) is omitted individually from an enemy item. Refs: Game.Core.Tests/Services/EnemyConfigSchemaValidationTests.cs",
      "Validator-based tests on Windows C# pass after changing enemy balance numbers only in configuration data (within schema limits) without modifying schema structure or gameplay code. Refs: Game.Core.Tests/Services/EnemyConfigSampleFileValidationTests.cs",
      "Windows C# validator tests must validate schema using payloads loaded from test JSON files (at least one valid sample and multiple invalid samples), not inline-only objects. Refs: Game.Core.Tests/Services/EnemyConfigSampleFileValidationTests.cs",
      "If a required test JSON sample is missing, unreadable, or invalid JSON, the validation test run must fail and cannot be counted as pass. Refs: Game.Core.Tests/Services/EnemyConfigSampleFileValidationTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #32 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 32,
    "contractRefs": [
      "Game.Core/Contracts/Config/enemy-config.schema.json"
    ]
  },
  {
    "id": "GM-0133",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0131"
    ],
    "taskmaster_exported": true,
    "title": "Implement difficulty-config.schema.json with versioning and lock constraints",
    "description": "Create JSON schema for difficulty configuration, including version field, difficulty levels, and constants, ensuring difficulty is locked at run start per PRD.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0023",
      "ADR-0007",
      "ADR-0005"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs",
      "Game.Core.Tests/Engine/GameEngineDifficultyLockTests.cs",
      "Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "Game.Core.Tests/Engine/GameEngineCoreEventTests.cs",
      "Game.Core.Tests/Services/DifficultyConfigSchemaValidationTests.cs",
      "Game.Core.Tests/State/GameStateManagerTests.cs"
    ],
    "acceptance": [
      "After a run starts, any request to change active difficulty is rejected and the active difficulty remains unchanged. Refs: Game.Core.Tests/Engine/GameEngineDifficultyLockTests.cs",
      "On the Windows Godot+C# baseline, all referenced automated tests for this task pass. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs Game.Core.Tests/Engine/GameEngineDifficultyLockTests.cs",
      "After this change, deterministic simulation and core-loop regression checks run and report no new failures. Refs: Game.Core.Tests/Engine/GameEngineCoreEventTests.cs",
      "A file exists at `config/schemas/difficulty-config.schema.json` and parses as valid JSON. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "The schema requires both `version` and `difficulty_level`, and validation rejects inputs where `version` is missing. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "`version` is validated as a string matching `^\\d+\\.\\d+$`; `1.0` passes while `v1` and `1` fail. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "`difficulty_level` is validated as a string enum limited to `easy`, `medium`, and `hard`; any other value is rejected. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "`modifiers` is defined as an object, and each declared modifier field is numeric; non-numeric modifier values are rejected. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "Per the PRD lock constraint, once a run starts, any attempt to change active difficulty is refused or leaves the active difficulty unchanged. Refs: Game.Core.Tests/Engine/GameEngineDifficultyLockTests.cs",
      "Schema validation tests include positive and negative samples for invalid enum, missing `version`, and invalid `version` pattern, with expected pass/fail outcomes. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "The schema declares `version` as an explicit top-level property and includes it in `required`, ensuring revision data is always present for backward-trackability checks. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "Validation accepts at least two configurations that differ only in declared numeric `modifiers` values, confirming these values are configurable data rather than fixed constants. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "A lock-behavior test verifies that difficulty changes can take effect before run start, while after run start a change attempt is refused or leaves active difficulty unchanged. Refs: Game.Core.Tests/Engine/GameEngineDifficultyLockTests.cs",
      "Schema validation rejects inputs where `difficulty_level` is missing, confirming both required fields are enforced. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "Schema validation passes for valid samples using each allowed `difficulty_level` value (`easy`, `medium`, `hard`) with valid `version` and numeric `modifiers`. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "Obligation lock O8: The task schema must not collapse all values into one fixed constant set; configurable fields must allow alternative valid inputs. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "Obligation lock O8: Schema validation accepts at least two valid version values matching `^\\d+\\.\\d+$` (for example `1.0` and `2.1`) while `difficulty_level` and `modifiers` remain otherwise identical. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "Obligation lock O8: If schema constrains version to a single constant value (for example `const` or single-value `enum`), validation must fail. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "Obligation lock O8: All configurable fields must remain tunable and must not be constrained to single constant values; validation tests must fail const/single-value restrictions for `version`, `difficulty_level`, and `modifiers`. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "Schema validation accepts at least two valid `version` values matching `^\\d+\\.\\d+$` (e.g., `1.0` and `2.1`) with identical `difficulty_level` and `modifiers`. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "If schema constrains `version` to a single constant value (e.g., `const` or single-value `enum`), validation test must fail. Refs: Game.Core.Tests/Domain/DifficultyConfigSchemaTests.cs",
      "Subtask 1 coverage: acceptance explicitly requires tier definitions (`easy`,`medium`,`hard`), run-start lock semantics, and migration/backward-trackability metadata via required top-level `version` to be validated together. Refs: Game.Core.Tests/Domain/GameConfigTests.cs",
      "Subtask 2 coverage: strict validation must return explicit reject reasons for invalid tier enum, missing required fields, type mismatch in `modifiers`, and any declared numeric bound violations. Refs: Game.Core.Tests/Services/DifficultyConfigSchemaValidationTests.cs",
      "Subtask 3 coverage: regression fixtures must keep pass/fail outcomes stable across runs, and loading an invalid difficulty config must refuse activation and preserve the last valid runtime state (or configured safe default). Refs: Game.Core.Tests/State/GameStateManagerTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #33 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 33,
    "contractRefs": [
      "Game.Core/Contracts/Config/difficulty-config.schema.json"
    ],
    "evidence_refs": []
  },
  {
    "id": "GM-0134",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0131"
    ],
    "taskmaster_exported": true,
    "title": "Implement spawn-config.schema.json for deterministic wave composition",
    "description": "Define JSON schema for spawn configuration to control enemy waves, ensuring determinism: same seed + same config => same wave timeline.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0023",
      "ADR-0007",
      "ADR-0005"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs",
      "Game.Core.Tests/Services/SpawnWaveTimelineDeterminismTests.cs",
      "Game.Core.Tests/Services/SpawnWaveTimelineCadenceTests.cs"
    ],
    "acceptance": [
      "Taskmaster #34 behavior matches PRD lock for Implement spawn-config.schema.json for deterministic wave composition. Refs: Game.Core.Tests/Domain/GameConfigTests.cs",
      "Referenced automated tests pass on Windows Godot+C# baseline. Refs: Game.Core.Tests/Domain/GameConfigTests.cs",
      "No regression on deterministic simulation and core loop constraints. Refs: Game.Core.Tests/Services/SpawnWaveTimelineDeterminismTests.cs Game.Core.Tests/Services/SpawnWaveTimelineCadenceTests.cs",
      "config/schemas/spawn-config.schema.json exists and validates a spawn config object with seed (integer) and waves (array) fields. Refs: Game.Core.Tests/Domain/GameConfigTests.cs",
      "Each wave object validation enforces day as an integer in [1, 15] and includes day/night timing values aligned to a 4-minute Day + 2-minute Night cycle. Refs: Game.Core.Tests/Domain/GameConfigTests.cs",
      "Enemy entries in each wave validate enemy_id as string and count as integer with minimum 0; negative counts or wrong types fail validation. Refs: Game.Core.Tests/Domain/GameConfigTests.cs",
      "Validation test data includes at least one valid config and failing cases for day outside 1-15 and negative enemy count, and failures are observable in test results. Refs: Game.Core.Tests/Domain/GameConfigTests.cs",
      "Determinism test demonstrates that repeated wave generation with the same seed and the same valid config yields the same wave timeline, while invalid config is rejected with no timeline output. Refs: Game.Core.Tests/Domain/GameConfigTests.cs",
      "Wave timeline generation inputs are restricted to schema-valid config values plus seed, with no hidden runtime override required to reproduce results. Refs: Game.Core.Tests/Domain/GameConfigTests.cs",
      "Schema/timeline verification demonstrates that the configured 4-minute Day + 2-minute Night cadence over Day1-Day15 produces a timeline within the required 60-90 minute match window (90 minutes at full 15-day coverage) using config values only. Refs: Game.Core.Tests/Services/SpawnWaveTimelineCadenceTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #34 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 34,
    "contractRefs": [
      "Game.Core/Contracts/Config/spawn-config.schema.json"
    ]
  },
  {
    "id": "GM-0135",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0131"
    ],
    "taskmaster_exported": true,
    "title": "Implement pressure-normalization.config.schema.json with baseline constants and range checks",
    "description": "Create JSON schema for pressure normalization configuration, including explicit baseline constants and validation for ranges as per PRD.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0023",
      "ADR-0007",
      "ADR-0005"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs",
      "Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs",
      "Game.Core.Tests/Services/DeterministicSimulationConstraintTests.cs",
      "Game.Core.Tests/State/GameStateMachineTests.cs"
    ],
    "acceptance": [
      "Taskmaster #35 records a verifiable mapping from produced schema deliverables to the PRD requirement for explicit pressure-normalization baseline constants and range-validation behavior. Refs: Game.Core.Tests/Domain/GameConfigTests.cs",
      "In the Windows Godot+C# baseline environment, all tests referenced by this task run and pass, and this task introduces zero new failing tests. Refs: Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs Game.Core.Tests/Services/DeterministicSimulationConstraintTests.cs",
      "After the schema update is applied, deterministic simulation and core-loop constraint suites still pass, demonstrating no deterministic-regression from the configuration contract change. Refs: Game.Core.Tests/State/GameStateMachineTests.cs",
      "config/schemas/pressure-normalization.config.schema.json exists at the required path and is accepted by a JSON Schema parser with no syntax errors. Refs: Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs",
      "The schema enforces numeric types for baseline, min_pressure, and max_pressure, and enforces normalization_factors as an array whose items are numbers. Refs: Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs",
      "Validation rejects any document that omits baseline, min_pressure, max_pressure, or normalization_factors. Refs: Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs",
      "Schema constraints explicitly declare baseline and pressure-bound constants, including a baseline lower-bound constant, rather than relying on implicit defaults. Refs: Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs",
      "Validation rejects configurations with min_pressure >= max_pressure, enforcing the strict rule min_pressure < max_pressure. Refs: Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs",
      "Validation rejects non-numeric baseline values, and accepts baseline only when it is numeric and satisfies declared bound constraints. Refs: Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs",
      "A configuration is accepted only when baseline is numeric, min_pressure < max_pressure, and normalization_factors contains only numeric entries. Refs: Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs",
      "Validation rejects any configuration where normalization_factors contains one or more non-numeric elements. Refs: Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs",
      "If constraints is provided, constraints.range_check must be boolean; non-boolean values are rejected. Refs: Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs",
      "Validation rejects configurations where baseline is below the schema-declared baseline lower-bound constant. Refs: Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs",
      "A test input with min_pressure == max_pressure is rejected, proving strict inequality for pressure limits. Refs: Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs",
      "A test input with min_pressure > max_pressure is rejected, while the paired input with min_pressure < max_pressure is accepted when other required fields are valid. Refs: Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs",
      "A test input with baseline below the declared lower bound is rejected, while a paired input at or above that bound is accepted when all other constraints are valid. Refs: Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs",
      "Validation rejects configurations where normalization_factors is not an array, even when baseline, min_pressure, and max_pressure are otherwise valid. Refs: Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs",
      "Regression fixtures include at least one baseline-valid revision and one baseline-invalid revision, and invalid revisions emit stable fallback or rejection reason codes in validation evidence. Refs: Game.Core.Tests/Domain/PressureNormalizationConfigSchemaTests.cs Game.Core.Tests/Services/DeterministicSimulationConstraintTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #35 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 35,
    "contractRefs": [
      "Game.Core/Contracts/Config/pressure-normalization.config.schema.json"
    ]
  },
  {
    "id": "GM-0136",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0132",
      "GM-0133",
      "GM-0134",
      "GM-0135"
    ],
    "taskmaster_exported": true,
    "title": "Create sample JSON files for all configs with valid data",
    "description": "Generate sample JSON files (difficulty-config.sample.json, spawn-config.sample.json, pressure-normalization.config.sample.json) that adhere to the schemas and include realistic values.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0023",
      "ADR-0007",
      "ADR-0005"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs",
      "Game.Core.Tests/Tasks/Task36ConfigSampleArtifactsTests.cs",
      "Game.Core.Tests/Tasks/Task36ConfigValidationFlowTests.cs"
    ],
    "acceptance": [
      "Deliverables are limited to Taskmaster #36 config-sample outputs, and each output is a contract-release sample artifact; placeholder-only artifacts fail acceptance. Refs: Game.Core.Tests/Tasks/Task36ConfigSampleArtifactsTests.cs",
      "On the Windows Godot+C# baseline, automated validation shows every required positive sample passes both schema validation and semantic validation. Refs: Game.Core.Tests/Tasks/Task36ConfigValidationFlowTests.cs",
      "Artifacts are split by config domain (difficulty, spawn, pressure-normalization), and validation output reports all three domains; omission of any domain fails acceptance. Refs: Game.Core.Tests/Tasks/Task36ConfigSampleArtifactsTests.cs Game.Core.Tests/Tasks/Task36ConfigValidationFlowTests.cs",
      "difficulty-config.sample.json exists, is non-empty, passes schema and semantic validation, and includes version metadata, deterministic launch-tier defaults, and lock-at-start fields. Refs: Game.Core.Tests/Tasks/Task36ConfigSampleArtifactsTests.cs",
      "spawn-config.sample.json exists, is non-empty, passes schema and semantic validation, and includes Day1-Day15 cadence coverage plus channel isolation flags required by the runtime parser. Refs: Game.Core.Tests/Tasks/Task36ConfigSampleArtifactsTests.cs",
      "pressure-normalization.config.sample.json exists, is non-empty, passes schema and semantic validation, explicitly defines baseline constants, and keeps tuning values within guard bands. Refs: Game.Core.Tests/Tasks/Task36ConfigSampleArtifactsTests.cs",
      "Negative fixtures are present for all three config domains and include malformed and boundary-breach inputs; each negative case is rejected while positive samples remain passing in the same validation flow. Refs: Game.Core.Tests/Tasks/Task36ConfigValidationFlowTests.cs",
      "A CI-consumable validation summary artifact is produced with schema and semantic outcomes for every positive and negative fixture; missing this artifact fails acceptance. Refs: Game.Core.Tests/Tasks/Task36ConfigValidationFlowTests.cs",
      "Acceptance fails if any required positive sample file is missing, empty, or excluded from validation output. Refs: Game.Core.Tests/Tasks/Task36ConfigValidationFlowTests.cs",
      "Validation output includes explicit per-file schema and semantic pass/fail results for each required positive sample; missing per-file results fail acceptance. Refs: Game.Core.Tests/Tasks/Task36ConfigValidationFlowTests.cs",
      "For each config domain, at least one malformed fixture and one boundary-breach fixture run and are rejected with non-empty explicit reason codes in the same run where all required positive samples pass. Refs: Game.Core.Tests/Tasks/Task36ConfigValidationFlowTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #36 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 36,
    "contractRefs": [
      "Game.Core/Contracts/Config/difficulty-config.sample.json",
      "Game.Core/Contracts/Config/spawn-config.sample.json",
      "Game.Core/Contracts/Config/pressure-normalization.config.sample.json"
    ]
  },
  {
    "id": "GM-0137",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0132",
      "GM-0133",
      "GM-0134",
      "GM-0135"
    ],
    "taskmaster_exported": true,
    "title": "Implement config validation and fallback handling in C#",
    "description": "Develop C# code in Godot to load and validate config files against schemas, applying invalid config handling policy: reject and fallback to built-in safe defaults.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0023",
      "ADR-0007",
      "ADR-0005"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs",
      "Tests.Godot/tests/Adapters/Config/test_settings_config_utf8.gd",
      "Tests.Godot/tests/Adapters/Config/test_settings_persistence.gd",
      "Game.Core.Tests/Services/ConfigValidationPipelineTests.cs",
      "Game.Core.Tests/Services/ConfigApplicationGuardsTests.cs",
      "Game.Core.Tests/Services/ConfigStructuralValidationAdapterTests.cs",
      "Game.Core.Tests/Services/ConfigPolicyRoutingTests.cs",
      "Game.Core.Tests/Services/ConfigAuditArtifactsTests.cs"
    ],
    "acceptance": [
      "Taskmaster #37 implementation enforces PRD-locked behavior: config files are loaded and validated, and invalid inputs end only in reject or fallback to built-in safe defaults. Refs: Tests.Godot/tests/Adapters/Config/test_settings_config_utf8.gd",
      "All referenced automated tests pass on the Windows Godot + C# baseline, including config validation and fallback scenarios. Refs: Tests.Godot/tests/Adapters/Config/test_settings_persistence.gd",
      "Executing the validation/fallback flow causes no unintended runtime side effects outside the config decision path, including no deterministic core-loop drift for identical inputs. Refs: Game.Core.Tests/Services/ConfigValidationPipelineTests.cs Game.Core.Tests/Services/ConfigApplicationGuardsTests.cs",
      "Schema-invalid config payloads are rejected at the structural validation stage with deterministic normalized error codes and required error payload fields. Refs: Game.Core.Tests/Services/ConfigStructuralValidationAdapterTests.cs",
      "Semantic rule violations are evaluated only after structural pass, and each violation maps to exactly one explicit policy action with a machine-verifiable reason key. Refs: Game.Core.Tests/Services/ConfigPolicyRoutingTests.cs",
      "Runtime config application enforces immutable and difficulty-locked fields: only allowed fields may fallback to built-in safe defaults, and forbidden changes are rejected without protected-state mutation. Refs: Game.Core.Tests/Services/ConfigApplicationGuardsTests.cs",
      "Each validation decision emits standardized audit entries and CI summary artifacts under logs/ci, including policy decision trace and reject/fallback reasons. Refs: Game.Core.Tests/Services/ConfigAuditArtifactsTests.cs",
      "A valid/invalid/boundary config matrix yields policy-consistent terminal outcomes (accept, reject, or fallback) with observable logs for each case. Refs: Game.Core.Tests/Services/ConfigValidationPipelineTests.cs Game.Core.Tests/Services/ConfigAuditArtifactsTests.cs",
      "On every rejection path, protected runtime fields remain unchanged and no partial config mutation is observable after the decision. Refs: Game.Core.Tests/Services/ConfigApplicationGuardsTests.cs",
      "Reject and fallback outcomes expose explicit machine-verifiable reason identifiers in both test assertions and emitted audit records. Refs: Game.Core.Tests/Services/ConfigPolicyRoutingTests.cs Game.Core.Tests/Services/ConfigAuditArtifactsTests.cs",
      "Each config evaluation produces exactly one terminal outcome (accept, reject, or fallback), and tests confirm no dual/conflicting outcomes for a single input. Refs: Game.Core.Tests/Services/ConfigValidationPipelineTests.cs",
      "Validation runs in layered order (structural -> semantic -> policy routing), and decision traces identify the stage responsible for the terminal outcome. Refs: Game.Core.Tests/Services/ConfigValidationPipelineTests.cs",
      "Boundary-case evaluations are deterministic across repeated runs: identical input yields identical terminal outcome and identical machine-verifiable reason identifiers. Refs: Game.Core.Tests/Services/ConfigValidationPipelineTests.cs",
      "For every structural validation failure, output includes a normalized machine-readable error payload with deterministic code and location fields; structurally valid inputs proceed to semantic validation. Refs: Game.Core.Tests/Services/ConfigStructuralValidationAdapterTests.cs",
      "For every semantic violation, policy routing returns exactly one explicit action and one machine-verifiable reason key; unmapped violations are rejected with an explicit reason identifier. Refs: Game.Core.Tests/Services/ConfigPolicyRoutingTests.cs",
      "Fallback application updates only allowed mutable fields to built-in safe defaults, while immutable and difficulty-locked fields stay unchanged; any forbidden update attempt is rejected with no partial state mutation. Refs: Game.Core.Tests/Services/ConfigApplicationGuardsTests.cs",
      "Each config evaluation writes one standardized audit record and one CI-consumable summary artifact in logs/ci containing terminal outcome, decision stage, policy trace, and reason identifiers. Refs: Game.Core.Tests/Services/ConfigAuditArtifactsTests.cs",
      "Obligation lock O4: Implement schema-level structural validation adapters :: Centralize structural validation and collect normalized error payloads is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Game.Core.Tests/Services/ConfigStructuralValidationAdapterTests.cs",
      "Obligation lock O7: Encode rule sets from validator contracts and map each failure to policy action is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Game.Core.Tests/Services/ConfigPolicyRoutingTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #37 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 37,
    "contractRefs": [
      "Game.Core/Contracts/Config/spawn-config.validator.rules.md"
    ]
  },
  {
    "id": "GM-0138",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0137"
    ],
    "taskmaster_exported": true,
    "title": "Integrate config governance for gameplay tuning",
    "description": "Connect config values to gameplay systems (e.g., enemy stats, wave spawning) to ensure all tuning is via config only, with no implementation hardcoding.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0023",
      "ADR-0007",
      "ADR-0005"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs",
      "Game.Core.Tests/Tasks/Task38ConfigGovernanceTests.cs",
      "Game.Core.Tests/Services/GameplayTuningConfigIntegrationTests.cs",
      "Game.Core.Tests/Services/WaveSeedDeterminismTests.cs",
      "Game.Core.Tests/Services/EnemyStatConfigBindingTests.cs",
      "Game.Core.Tests/Services/SpawnTimingConfigBindingTests.cs",
      "Game.Core.Tests/Services/GameplayConfigSetSwitchingTests.cs",
      "Game.Core.Tests/State/GameStateManagerTests.cs",
      "Game.Core.Tests/Services/ConfigGovernanceAuditTests.cs",
      "Game.Core.Tests/Services/ConfigGovernancePromotionServiceTests.cs"
    ],
    "acceptance": [
      "Runtime enemy stats and wave spawning parameters must resolve from ConfigManager-backed config values; if a hardcoded gameplay constant is the effective runtime value for those fields, acceptance fails. Refs: Game.Core.Tests/Tasks/Task38ConfigGovernanceTests.cs Game.Core.Tests/Services/GameplayTuningConfigIntegrationTests.cs",
      "Referenced automated tests pass on the Windows Godot+C# baseline and show enemy stats, spawn timing, and wave generation are driven by active config values plus seed input. Refs: Game.Core.Tests/Services/GameplayTuningConfigIntegrationTests.cs Game.Core.Tests/Services/WaveSeedDeterminismTests.cs",
      "After replacing hardcoded tuning values with config-governed values, deterministic simulation behavior and core-loop expectations remain within expected test baselines; any regression fails acceptance. Refs: Game.Core.Tests/Services/WaveSeedDeterminismTests.cs Game.Core.Tests/Services/GameplayTuningConfigIntegrationTests.cs",
      "When only enemy-config values are changed, corresponding runtime enemy stats (including health) must change without any C# script edits; if runtime stats do not change after that config-only update, acceptance fails. Refs: Game.Core.Tests/Services/EnemyStatConfigBindingTests.cs Game.Core.Tests/Services/GameplayTuningConfigIntegrationTests.cs",
      "When only spawn-config timing values are changed, runtime wave spawn timing must change without any C# script edits; if runtime timing does not change after that config-only update, acceptance fails. Refs: Game.Core.Tests/Services/SpawnTimingConfigBindingTests.cs Game.Core.Tests/Services/GameplayTuningConfigIntegrationTests.cs",
      "Wave generation must be controlled by spawn-config seed values: repeated runs with the same seed produce identical wave composition/order, and changing only the seed changes composition/order. Refs: Game.Core.Tests/Services/WaveSeedDeterminismTests.cs",
      "For valid config inputs, gameplay systems must treat config as the source of truth for enemy stats and wave-spawn parameters; any hardcoded override causes acceptance failure. Refs: Game.Core.Tests/Tasks/Task38ConfigGovernanceTests.cs Game.Core.Tests/Services/GameplayTuningConfigIntegrationTests.cs",
      "Integration runs with at least two distinct valid config sets must show enemy stat outputs and wave composition outputs tracking config differences, while runs under a fixed seed remain deterministic. Refs: Game.Core.Tests/Services/GameplayConfigSetSwitchingTests.cs Game.Core.Tests/Services/WaveSeedDeterminismTests.cs",
      "Using the same executable and content, tuning outcomes must be realized by config-only updates to enemy-config or spawn-config; if C# script edits are required to realize those outcomes, acceptance fails. Refs: Game.Core.Tests/Services/GameplayConfigSetSwitchingTests.cs Game.Core.Tests/Tasks/Task38ConfigGovernanceTests.cs",
      "For a selected enemyId and spawn profile, observed runtime enemy health and spawn interval must exactly equal the active config values for that run; any mismatch fails acceptance. Refs: Game.Core.Tests/Services/EnemyStatConfigBindingTests.cs Game.Core.Tests/Services/SpawnTimingConfigBindingTests.cs",
      "In the same executable/content build with spawn-config fixed, changing only enemy-config for a selected enemyId must update that enemyId runtime health/stat outputs to the new config values without C# script edits; otherwise acceptance fails. Refs: Game.Core.Tests/Services/EnemyStatConfigBindingTests.cs",
      "In the same executable/content build with all non-seed spawn settings fixed, changing only spawn-config seed must change wave composition/order outputs, while reruns with that same seed reproduce identical composition/order outputs. Refs: Game.Core.Tests/Services/WaveSeedDeterminismTests.cs",
      "With one executable/content build and two valid config sets A/B, switching A->B must change at least one enemy runtime stat and at least one wave output metric tied to changed config fields; no observable change after config-only switching fails acceptance. Refs: Game.Core.Tests/Services/GameplayConfigSetSwitchingTests.cs Game.Core.Tests/Services/SpawnTimingConfigBindingTests.cs",
      "With one executable/content build, switching config set A->B->A under the same seed must restore enemy stat outputs and wave composition/order outputs to the original A results; failure to restore fails acceptance. Refs: Game.Core.Tests/Services/GameplayConfigSetSwitchingTests.cs Game.Core.Tests/Services/WaveSeedDeterminismTests.cs",
      "Obligation lock O1 is mandatory: existing gameplay C# scripts must read tuning values from ConfigManager rather than hardcoded constants, with proof from tests or audit evidence; otherwise acceptance fails. Refs: Game.Core.Tests/Domain/GameConfigTests.cs",
      "Before any tuning promotion, the config-governance policy contract must be enforced: all mandatory governance fields and promotion preconditions are validated, and if any required field/precondition is missing or invalid, promotion is rejected and active gameplay-config state remains unchanged. Refs: Game.Core.Tests/Domain/GameConfigTests.cs",
      "Governance checks in the tuning workflow must execute fail-fast and emit deterministic reject reasons: for identical invalid input, repeated runs return the same reject outcome and reason, with no partial promotion side effects. Refs: Game.Core.Tests/State/GameStateManagerTests.cs",
      "For every promotion attempt, governance regression/audit outputs must be produced for CI/manual review handoff and include allow/reject decision plus evaluated governance criteria; missing governance audit output for any attempt fails acceptance. Refs: Game.Core.Tests/Services/ConfigGovernanceAuditTests.cs Game.Core.Tests/Services/ConfigGovernancePromotionServiceTests.cs",
      "Contract tests must validate governance metadata required fields and promotion prerequisites before tuning promotion. Refs: Game.Core.Tests/Tasks/Task38ConfigGovernanceTests.cs",
      "If any governance field or prerequisite is missing or invalid, contract tests must deterministically fail with comparable reason code. Refs: Game.Core.Tests/Tasks/Task38ConfigGovernanceTests.cs",
      "Workflow tests must assert missing governance criteria blocks promotion and keeps active gameplay-config state unchanged. Refs: Game.Core.Tests/Services/GameplayTuningConfigIntegrationTests.cs",
      "For identical invalid input, workflow rejection outcome and reason must be deterministic across reruns. Refs: Game.Core.Tests/Services/GameplayTuningConfigIntegrationTests.cs",
      "Regression tests must assert governance checks remain enforced after implementation updates. Refs: Game.Core.Tests/Tasks/Task38ConfigGovernanceTests.cs",
      "Any update that weakens or removes governance enforcement must fail regression gate and block promotion. Refs: Game.Core.Tests/Tasks/Task38ConfigGovernanceTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #38 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 38,
    "contractRefs": [
      "Game.Core/Contracts/Config/config-change-audit.schema.json"
    ],
    "evidence_refs": []
  },
  {
    "id": "GM-0139",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0137"
    ],
    "taskmaster_exported": true,
    "title": "Add config hash/version to battle report metadata for auditability",
    "description": "Implement functionality to compute and include config hash or version in battle report metadata, as required for auditability.",
    "status": "pending",
    "priority": "P3",
    "layer": "core",
    "adr_refs": [
      "ADR-0023",
      "ADR-0007",
      "ADR-0005"
    ],
    "chapter_refs": [
      "CH05",
      "CH06",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs",
      "Game.Core.Tests/Services/BattleReportMetadataTests.cs",
      "Game.Core.Tests/Services/ConfigManagerFingerprintTests.cs",
      "Game.Core.Tests/Services/BattleReportOutcomeStabilityTests.cs",
      "Game.Core.Tests/State/BattleReportPersistenceTests.cs"
    ],
    "acceptance": [
      "For Taskmaster #39, report generation computes config-derived metadata (either hash or version) and writes it into each generated battle report metadata. Refs: Game.Core.Tests/Services/BattleReportMetadataTests.cs",
      "Automated tests covering metadata presence, same-config stability, and changed-config/version detection pass on the Windows Godot+C# baseline. Refs: Game.Core.Tests/Services/BattleReportMetadataTests.cs Game.Core.Tests/Services/ConfigManagerFingerprintTests.cs",
      "Adding config metadata does not change battle simulation outcomes: with the same battle inputs, match-result fields remain unchanged except for the added metadata field. Refs: Game.Core.Tests/Services/BattleReportOutcomeStabilityTests.cs",
      "Each generated battle report includes either \"config_hash\" or \"config_version\" with a non-empty value derived from the exact config used for that battle. Refs: Game.Core.Tests/Services/BattleReportMetadataTests.cs Game.Core.Tests/Services/ConfigManagerFingerprintTests.cs",
      "Repeated report generation with byte-identical config content or the same declared version yields the same recorded metadata value. Refs: Game.Core.Tests/Services/ConfigManagerFingerprintTests.cs",
      "If config content changes or declared version changes before report generation, the next battle report records a different metadata value. Refs: Game.Core.Tests/Services/ConfigManagerFingerprintTests.cs",
      "Any battle report that contains neither \"config_hash\" nor \"config_version\" is invalid output and fails audit-complete acceptance. Refs: Game.Core.Tests/Services/BattleReportMetadataTests.cs",
      "Persisted battle report payloads retain match-result content and include the selected config metadata field (\"config_hash\" or \"config_version\") for audit retrieval. Refs: Game.Core.Tests/State/BattleReportPersistenceTests.cs Game.Core.Tests/Services/BattleReportMetadataTests.cs",
      "The recorded value (\"config_hash\" or \"config_version\") comes from the exact configuration payload/version consumed by that battle at report-generation time and is stored in BattleReport metadata. Refs: Game.Core.Tests/Services/BattleReportMetadataTests.cs Game.Core.Tests/Services/ConfigManagerFingerprintTests.cs",
      "When \"config_hash\" is used, the value is computed from the exact consumed config payload and is reproducible for byte-identical payloads. Refs: Game.Core.Tests/Services/ConfigManagerFingerprintTests.cs",
      "When \"config_version\" is used, the value equals the declared version extracted from the exact consumed config and changes when that declared version changes. Refs: Game.Core.Tests/Services/ConfigManagerFingerprintTests.cs",
      "Obligation lock O1: In ConfigManager, add method to compute hash (e.g., SHA256) of config files or extract version fields is enforced as a hard acceptance criterion and must be verifiable by tests or audit evidence. Refs: Game.Core.Tests/Services/ConfigManagerFingerprintTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #39 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 39,
    "contractRefs": [
      "Game.Core/Contracts/Config/config-change-audit.schema.json"
    ]
  },
  {
    "id": "GM-0140",
    "story_id": "PRD-LASTKING-v1.2",
    "owner": "gameplay",
    "depends_on": [
      "GM-0137"
    ],
    "taskmaster_exported": true,
    "title": "Implement version migration rule with force migration",
    "description": "Develop version handling to force migration when config version changes, without dual-version compatibility, per PRD.",
    "status": "pending",
    "priority": "P2",
    "layer": "core",
    "adr_refs": [
      "ADR-0006",
      "ADR-0008",
      "ADR-0011"
    ],
    "chapter_refs": [
      "CH05",
      "CH10",
      "CH07"
    ],
    "overlay_refs": [
      "docs/architecture/overlays/PRD-lastking-T2/08/_index.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Feature-Slice-T2-Core-Loop.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Contracts-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Testing-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/08-Observability-T2.md",
      "docs/architecture/overlays/PRD-lastking-T2/08/ACCEPTANCE_CHECKLIST.md"
    ],
    "labels": [
      "prd",
      "lastking",
      "taskmaster-view",
      "core"
    ],
    "test_refs": [
      "Game.Core.Tests/Domain/GameConfigTests.cs",
      "Game.Core.Tests/Services/ConfigManagerVersionPolicyTests.cs",
      "Game.Core.Tests/Services/ConfigManagerMigrationLoggingTests.cs",
      "Game.Core.Tests/Services/ConfigManagerTests.cs",
      "Game.Core.Tests/Services/ConfigMigrationExecutorTests.cs"
    ],
    "acceptance": [
      "可通过测试证明：当加载配置的 version 不等于 expectedVersion 时，ConfigManager 必须拒绝该配置并回退默认配置；当两者相等时必须接受加载配置。 Refs: Game.Core.Tests/Services/ConfigManagerVersionPolicyTests.cs Game.Core.Tests/Services/ConfigManagerMigrationLoggingTests.cs",
      "本任务引用的自动化测试必须在 Windows Godot+C# 基线全部通过，并能观测到版本策略对应的最终配置与日志结果。 Refs: Game.Core.Tests/Services/ConfigManagerVersionPolicyTests.cs Game.Core.Tests/Services/ConfigManagerMigrationLoggingTests.cs",
      "当 config.version 等于 expectedVersion 时，最终运行时配置必须来自加载配置，且该次加载不得触发默认回退。 Refs: Game.Core.Tests/Services/ConfigManagerVersionPolicyTests.cs",
      "当 config.version 不等于 expectedVersion 时，系统必须拒绝加载配置并将最终运行时配置设为默认值。 Refs: Game.Core.Tests/Services/ConfigManagerVersionPolicyTests.cs",
      "每次版本不匹配都必须产生错误日志，且日志语义明确表明需要迁移。 Refs: Game.Core.Tests/Services/ConfigManagerMigrationLoggingTests.cs",
      "不得存在双版本兼容路径：版本不匹配的配置不得被部分接受、转换后接受或自动适配接受。 Refs: Game.Core.Tests/Services/ConfigManagerVersionPolicyTests.cs",
      "自动化单元测试必须覆盖版本相等与不相等两类输入，并断言仅不相等输入会触发默认回退。 Refs: Game.Core.Tests/Services/ConfigManagerVersionPolicyTests.cs",
      "当加载配置 version 等于 expectedVersion 时，运行时最终状态必须保持加载配置；若出现默认值则判定失败。 Refs: Game.Core.Tests/Services/ConfigManagerVersionPolicyTests.cs",
      "单元测试必须显式断言两条可观察路径：版本相等保留加载配置；版本不相等拒绝加载配置、触发默认回退并记录迁移必需日志。 Refs: Game.Core.Tests/Services/ConfigManagerVersionPolicyTests.cs Game.Core.Tests/Services/ConfigManagerMigrationLoggingTests.cs",
      "单元测试必须显式验证：版本不匹配处理不会激活任何兼容模式或自动适配路径。 Refs: Game.Core.Tests/Services/ConfigManagerVersionPolicyTests.cs",
      "版本处理必须遵循唯一的 expectedVersion 相等性规则：任何非相等版本都按拒绝加载、默认回退、迁移必需日志处理。 Refs: Game.Core.Tests/Services/ConfigManagerVersionPolicyTests.cs Game.Core.Tests/Services/ConfigManagerMigrationLoggingTests.cs",
      "O1 义务必须可测试：ConfigManager 在选择加载配置路径或默认回退路径前，必须先比较 loaded config version 与 expectedVersion。 Refs: Game.Core.Tests/Services/ConfigManagerVersionPolicyTests.cs",
      "子任务1（强制迁移契约）必须可验证：触发矩阵中，expectedVersion 匹配时保留加载配置；任一非相等版本或不可恢复迁移失败时拒绝加载配置并保持默认运行状态。 Refs: Game.Core.Tests/Services/ConfigManagerTests.cs",
      "子任务2（迁移执行器）必须可验证：迁移过程按确定性顺序执行并进行逐步严格校验；不支持路径或致命步骤结果必须确定性收敛为拒绝加载并回退默认。 Refs: Game.Core.Tests/Services/ConfigMigrationExecutorTests.cs",
      "子任务3（回归与失败路径）必须可验证：自动化测试覆盖版本不匹配与致命迁移场景，要求输出迁移诊断，并证明运行时保持默认状态且不存在部分接受加载配置。 Refs: Game.Core.Tests/Services/ConfigManagerTests.cs Game.Core.Tests/Services/ConfigMigrationExecutorTests.cs",
      "Regression tests must assert deterministic migration step order and deterministic final result for identical inputs. Refs: Game.Core.Tests/Services/ConfigManagerMigrationLoggingTests.cs",
      "Regression tests must assert rejection paths keep default runtime state unchanged and never allow partial acceptance. Refs: Game.Core.Tests/Services/ConfigManagerVersionPolicyTests.cs",
      "Mutual-exclusive policy must be explicit: if config.version != expectedVersion, system must always refuse loaded config and force default fallback. Refs: Game.Core.Tests/Services/ConfigManagerVersionPolicyTests.cs",
      "Single-version policy is mandatory: only expectedVersion is acceptable; all other versions are rejected with no compatibility acceptance path. Refs: Game.Core.Tests/Services/ConfigManagerVersionPolicyTests.cs",
      "Unit-test gate must prove all non-expectedVersion inputs are rejected with default fallback while compatibility mode stays disabled. Refs: Game.Core.Tests/Services/ConfigManagerVersionPolicyTests.cs",
      "Contract tests must cover migration trigger matrix and failure policy, and must pass on Windows baseline CI. Refs: Game.Core.Tests/Services/ConfigManagerVersionPolicyTests.cs Game.Core.Tests/Services/ConfigManagerMigrationLoggingTests.cs",
      "Unit tests must cover each supported migratable path in the trigger matrix and assert migrated key configuration fields exactly match expected post-migration values. Refs: Game.Core.Tests/Services/ConfigManagerVersionPolicyTests.cs",
      "Supported migratable path matrix must explicitly declare from->to list and must state no exemption from the non-expectedVersion rejection rule. Refs: Game.Core.Tests/Services/ConfigManagerVersionPolicyTests.cs",
      "Each supported path must declare one unique final-state rule consistent with single-version policy; no path may simultaneously claim acceptance of non-expectedVersion inputs. Refs: Game.Core.Tests/Services/ConfigManagerVersionPolicyTests.cs"
    ],
    "test_strategy": [
      "Red: add or update test coverage around Taskmaster #40 primary behavior.",
      "Green: implement minimal deterministic logic to satisfy assertions.",
      "Refactor: preserve passing tests and tighten contract boundaries."
    ],
    "taskmaster_id": 40,
    "contractRefs": [
      "Game.Core/Contracts/Config/difficulty-config.schema.json"
    ],
    "evidence_refs": []
  }
]
